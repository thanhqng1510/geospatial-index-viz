(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function t(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(l){if(l.ep)return;l.ep=!0;const d=t(l);fetch(l.href,d)}})();function L_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var P0={exports:{}},s_={};var T1;function vE(){if(T1)return s_;T1=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,l,d){var g=null;if(d!==void 0&&(g=""+d),l.key!==void 0&&(g=""+l.key),"key"in l){d={};for(var o in l)o!=="key"&&(d[o]=l[o])}else d=l;return l=d.ref,{$$typeof:i,type:s,key:g,ref:l!==void 0?l:null,props:d}}return s_.Fragment=e,s_.jsx=t,s_.jsxs=t,s_}var S1;function bE(){return S1||(S1=1,P0.exports=vE()),P0.exports}var Dn=bE(),I0={exports:{}},Ei={};var A1;function xE(){if(A1)return Ei;A1=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.consumer"),g=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),M=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),W=Symbol.iterator;function J(he){return he===null||typeof he!="object"?null:(he=W&&he[W]||he["@@iterator"],typeof he=="function"?he:null)}var oe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,ne={};function Ie(he,Oe,Je){this.props=he,this.context=Oe,this.refs=ne,this.updater=Je||oe}Ie.prototype.isReactComponent={},Ie.prototype.setState=function(he,Oe){if(typeof he!="object"&&typeof he!="function"&&he!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,he,Oe,"setState")},Ie.prototype.forceUpdate=function(he){this.updater.enqueueForceUpdate(this,he,"forceUpdate")};function Ue(){}Ue.prototype=Ie.prototype;function Se(he,Oe,Je){this.props=he,this.context=Oe,this.refs=ne,this.updater=Je||oe}var Ve=Se.prototype=new Ue;Ve.constructor=Se,le(Ve,Ie.prototype),Ve.isPureReactComponent=!0;var st=Array.isArray;function ot(){}var wt={H:null,A:null,T:null,S:null},Ft=Object.prototype.hasOwnProperty;function lt(he,Oe,Je){var gt=Je.ref;return{$$typeof:i,type:he,key:Oe,ref:gt!==void 0?gt:null,props:Je}}function kt(he,Oe){return lt(he.type,Oe,he.props)}function xt(he){return typeof he=="object"&&he!==null&&he.$$typeof===i}function Lt(he){var Oe={"=":"=0",":":"=2"};return"$"+he.replace(/[=:]/g,function(Je){return Oe[Je]})}var Dt=/\/+/g;function Pt(he,Oe){return typeof he=="object"&&he!==null&&he.key!=null?Lt(""+he.key):Oe.toString(36)}function Yt(he){switch(he.status){case"fulfilled":return he.value;case"rejected":throw he.reason;default:switch(typeof he.status=="string"?he.then(ot,ot):(he.status="pending",he.then(function(Oe){he.status==="pending"&&(he.status="fulfilled",he.value=Oe)},function(Oe){he.status==="pending"&&(he.status="rejected",he.reason=Oe)})),he.status){case"fulfilled":return he.value;case"rejected":throw he.reason}}throw he}function re(he,Oe,Je,gt,Mt){var $t=typeof he;($t==="undefined"||$t==="boolean")&&(he=null);var Ht=!1;if(he===null)Ht=!0;else switch($t){case"bigint":case"string":case"number":Ht=!0;break;case"object":switch(he.$$typeof){case i:case e:Ht=!0;break;case I:return Ht=he._init,re(Ht(he._payload),Oe,Je,gt,Mt)}}if(Ht)return Mt=Mt(he),Ht=gt===""?"."+Pt(he,0):gt,st(Mt)?(Je="",Ht!=null&&(Je=Ht.replace(Dt,"$&/")+"/"),re(Mt,Oe,Je,"",function(Mi){return Mi})):Mt!=null&&(xt(Mt)&&(Mt=kt(Mt,Je+(Mt.key==null||he&&he.key===Mt.key?"":(""+Mt.key).replace(Dt,"$&/")+"/")+Ht)),Oe.push(Mt)),1;Ht=0;var Qt=gt===""?".":gt+":";if(st(he))for(var vi=0;vi<he.length;vi++)gt=he[vi],$t=Qt+Pt(gt,vi),Ht+=re(gt,Oe,Je,$t,Mt);else if(vi=J(he),typeof vi=="function")for(he=vi.call(he),vi=0;!(gt=he.next()).done;)gt=gt.value,$t=Qt+Pt(gt,vi++),Ht+=re(gt,Oe,Je,$t,Mt);else if($t==="object"){if(typeof he.then=="function")return re(Yt(he),Oe,Je,gt,Mt);throw Oe=String(he),Error("Objects are not valid as a React child (found: "+(Oe==="[object Object]"?"object with keys {"+Object.keys(he).join(", ")+"}":Oe)+"). If you meant to render a collection of children, use an array instead.")}return Ht}function be(he,Oe,Je){if(he==null)return he;var gt=[],Mt=0;return re(he,gt,"","",function($t){return Oe.call(Je,$t,Mt++)}),gt}function _e(he){if(he._status===-1){var Oe=he._result;Oe=Oe(),Oe.then(function(Je){(he._status===0||he._status===-1)&&(he._status=1,he._result=Je)},function(Je){(he._status===0||he._status===-1)&&(he._status=2,he._result=Je)}),he._status===-1&&(he._status=0,he._result=Oe)}if(he._status===1)return he._result.default;throw he._result}var Be=typeof reportError=="function"?reportError:function(he){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Oe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof he=="object"&&he!==null&&typeof he.message=="string"?String(he.message):String(he),error:he});if(!window.dispatchEvent(Oe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",he);return}console.error(he)},nt={map:be,forEach:function(he,Oe,Je){be(he,function(){Oe.apply(this,arguments)},Je)},count:function(he){var Oe=0;return be(he,function(){Oe++}),Oe},toArray:function(he){return be(he,function(Oe){return Oe})||[]},only:function(he){if(!xt(he))throw Error("React.Children.only expected to receive a single React element child.");return he}};return Ei.Activity=z,Ei.Children=nt,Ei.Component=Ie,Ei.Fragment=t,Ei.Profiler=l,Ei.PureComponent=Se,Ei.StrictMode=s,Ei.Suspense=A,Ei.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=wt,Ei.__COMPILER_RUNTIME={__proto__:null,c:function(he){return wt.H.useMemoCache(he)}},Ei.cache=function(he){return function(){return he.apply(null,arguments)}},Ei.cacheSignal=function(){return null},Ei.cloneElement=function(he,Oe,Je){if(he==null)throw Error("The argument must be a React element, but you passed "+he+".");var gt=le({},he.props),Mt=he.key;if(Oe!=null)for($t in Oe.key!==void 0&&(Mt=""+Oe.key),Oe)!Ft.call(Oe,$t)||$t==="key"||$t==="__self"||$t==="__source"||$t==="ref"&&Oe.ref===void 0||(gt[$t]=Oe[$t]);var $t=arguments.length-2;if($t===1)gt.children=Je;else if(1<$t){for(var Ht=Array($t),Qt=0;Qt<$t;Qt++)Ht[Qt]=arguments[Qt+2];gt.children=Ht}return lt(he.type,Mt,gt)},Ei.createContext=function(he){return he={$$typeof:g,_currentValue:he,_currentValue2:he,_threadCount:0,Provider:null,Consumer:null},he.Provider=he,he.Consumer={$$typeof:d,_context:he},he},Ei.createElement=function(he,Oe,Je){var gt,Mt={},$t=null;if(Oe!=null)for(gt in Oe.key!==void 0&&($t=""+Oe.key),Oe)Ft.call(Oe,gt)&&gt!=="key"&&gt!=="__self"&&gt!=="__source"&&(Mt[gt]=Oe[gt]);var Ht=arguments.length-2;if(Ht===1)Mt.children=Je;else if(1<Ht){for(var Qt=Array(Ht),vi=0;vi<Ht;vi++)Qt[vi]=arguments[vi+2];Mt.children=Qt}if(he&&he.defaultProps)for(gt in Ht=he.defaultProps,Ht)Mt[gt]===void 0&&(Mt[gt]=Ht[gt]);return lt(he,$t,Mt)},Ei.createRef=function(){return{current:null}},Ei.forwardRef=function(he){return{$$typeof:o,render:he}},Ei.isValidElement=xt,Ei.lazy=function(he){return{$$typeof:I,_payload:{_status:-1,_result:he},_init:_e}},Ei.memo=function(he,Oe){return{$$typeof:M,type:he,compare:Oe===void 0?null:Oe}},Ei.startTransition=function(he){var Oe=wt.T,Je={};wt.T=Je;try{var gt=he(),Mt=wt.S;Mt!==null&&Mt(Je,gt),typeof gt=="object"&&gt!==null&&typeof gt.then=="function"&&gt.then(ot,Be)}catch($t){Be($t)}finally{Oe!==null&&Je.types!==null&&(Oe.types=Je.types),wt.T=Oe}},Ei.unstable_useCacheRefresh=function(){return wt.H.useCacheRefresh()},Ei.use=function(he){return wt.H.use(he)},Ei.useActionState=function(he,Oe,Je){return wt.H.useActionState(he,Oe,Je)},Ei.useCallback=function(he,Oe){return wt.H.useCallback(he,Oe)},Ei.useContext=function(he){return wt.H.useContext(he)},Ei.useDebugValue=function(){},Ei.useDeferredValue=function(he,Oe){return wt.H.useDeferredValue(he,Oe)},Ei.useEffect=function(he,Oe){return wt.H.useEffect(he,Oe)},Ei.useEffectEvent=function(he){return wt.H.useEffectEvent(he)},Ei.useId=function(){return wt.H.useId()},Ei.useImperativeHandle=function(he,Oe,Je){return wt.H.useImperativeHandle(he,Oe,Je)},Ei.useInsertionEffect=function(he,Oe){return wt.H.useInsertionEffect(he,Oe)},Ei.useLayoutEffect=function(he,Oe){return wt.H.useLayoutEffect(he,Oe)},Ei.useMemo=function(he,Oe){return wt.H.useMemo(he,Oe)},Ei.useOptimistic=function(he,Oe){return wt.H.useOptimistic(he,Oe)},Ei.useReducer=function(he,Oe,Je){return wt.H.useReducer(he,Oe,Je)},Ei.useRef=function(he){return wt.H.useRef(he)},Ei.useState=function(he){return wt.H.useState(he)},Ei.useSyncExternalStore=function(he,Oe,Je){return wt.H.useSyncExternalStore(he,Oe,Je)},Ei.useTransition=function(){return wt.H.useTransition()},Ei.version="19.2.4",Ei}var E1;function hx(){return E1||(E1=1,I0.exports=xE()),I0.exports}var Si=hx();const wE=L_(Si);var R0={exports:{}},a_={},D0={exports:{}},O0={};var C1;function TE(){return C1||(C1=1,(function(i){function e(re,be){var _e=re.length;re.push(be);e:for(;0<_e;){var Be=_e-1>>>1,nt=re[Be];if(0<l(nt,be))re[Be]=be,re[_e]=nt,_e=Be;else break e}}function t(re){return re.length===0?null:re[0]}function s(re){if(re.length===0)return null;var be=re[0],_e=re.pop();if(_e!==be){re[0]=_e;e:for(var Be=0,nt=re.length,he=nt>>>1;Be<he;){var Oe=2*(Be+1)-1,Je=re[Oe],gt=Oe+1,Mt=re[gt];if(0>l(Je,_e))gt<nt&&0>l(Mt,Je)?(re[Be]=Mt,re[gt]=_e,Be=gt):(re[Be]=Je,re[Oe]=_e,Be=Oe);else if(gt<nt&&0>l(Mt,_e))re[Be]=Mt,re[gt]=_e,Be=gt;else break e}}return be}function l(re,be){var _e=re.sortIndex-be.sortIndex;return _e!==0?_e:re.id-be.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var d=performance;i.unstable_now=function(){return d.now()}}else{var g=Date,o=g.now();i.unstable_now=function(){return g.now()-o}}var A=[],M=[],I=1,z=null,W=3,J=!1,oe=!1,le=!1,ne=!1,Ie=typeof setTimeout=="function"?setTimeout:null,Ue=typeof clearTimeout=="function"?clearTimeout:null,Se=typeof setImmediate<"u"?setImmediate:null;function Ve(re){for(var be=t(M);be!==null;){if(be.callback===null)s(M);else if(be.startTime<=re)s(M),be.sortIndex=be.expirationTime,e(A,be);else break;be=t(M)}}function st(re){if(le=!1,Ve(re),!oe)if(t(A)!==null)oe=!0,ot||(ot=!0,Lt());else{var be=t(M);be!==null&&Yt(st,be.startTime-re)}}var ot=!1,wt=-1,Ft=5,lt=-1;function kt(){return ne?!0:!(i.unstable_now()-lt<Ft)}function xt(){if(ne=!1,ot){var re=i.unstable_now();lt=re;var be=!0;try{e:{oe=!1,le&&(le=!1,Ue(wt),wt=-1),J=!0;var _e=W;try{t:{for(Ve(re),z=t(A);z!==null&&!(z.expirationTime>re&&kt());){var Be=z.callback;if(typeof Be=="function"){z.callback=null,W=z.priorityLevel;var nt=Be(z.expirationTime<=re);if(re=i.unstable_now(),typeof nt=="function"){z.callback=nt,Ve(re),be=!0;break t}z===t(A)&&s(A),Ve(re)}else s(A);z=t(A)}if(z!==null)be=!0;else{var he=t(M);he!==null&&Yt(st,he.startTime-re),be=!1}}break e}finally{z=null,W=_e,J=!1}be=void 0}}finally{be?Lt():ot=!1}}}var Lt;if(typeof Se=="function")Lt=function(){Se(xt)};else if(typeof MessageChannel<"u"){var Dt=new MessageChannel,Pt=Dt.port2;Dt.port1.onmessage=xt,Lt=function(){Pt.postMessage(null)}}else Lt=function(){Ie(xt,0)};function Yt(re,be){wt=Ie(function(){re(i.unstable_now())},be)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(re){re.callback=null},i.unstable_forceFrameRate=function(re){0>re||125<re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ft=0<re?Math.floor(1e3/re):5},i.unstable_getCurrentPriorityLevel=function(){return W},i.unstable_next=function(re){switch(W){case 1:case 2:case 3:var be=3;break;default:be=W}var _e=W;W=be;try{return re()}finally{W=_e}},i.unstable_requestPaint=function(){ne=!0},i.unstable_runWithPriority=function(re,be){switch(re){case 1:case 2:case 3:case 4:case 5:break;default:re=3}var _e=W;W=re;try{return be()}finally{W=_e}},i.unstable_scheduleCallback=function(re,be,_e){var Be=i.unstable_now();switch(typeof _e=="object"&&_e!==null?(_e=_e.delay,_e=typeof _e=="number"&&0<_e?Be+_e:Be):_e=Be,re){case 1:var nt=-1;break;case 2:nt=250;break;case 5:nt=1073741823;break;case 4:nt=1e4;break;default:nt=5e3}return nt=_e+nt,re={id:I++,callback:be,priorityLevel:re,startTime:_e,expirationTime:nt,sortIndex:-1},_e>Be?(re.sortIndex=_e,e(M,re),t(A)===null&&re===t(M)&&(le?(Ue(wt),wt=-1):le=!0,Yt(st,_e-Be))):(re.sortIndex=nt,e(A,re),oe||J||(oe=!0,ot||(ot=!0,Lt()))),re},i.unstable_shouldYield=kt,i.unstable_wrapCallback=function(re){var be=W;return function(){var _e=W;W=be;try{return re.apply(this,arguments)}finally{W=_e}}}})(O0)),O0}var M1;function SE(){return M1||(M1=1,D0.exports=TE()),D0.exports}var k0={exports:{}},ia={};var P1;function AE(){if(P1)return ia;P1=1;var i=hx();function e(A){var M="https://react.dev/errors/"+A;if(1<arguments.length){M+="?args[]="+encodeURIComponent(arguments[1]);for(var I=2;I<arguments.length;I++)M+="&args[]="+encodeURIComponent(arguments[I])}return"Minified React error #"+A+"; visit "+M+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},l=Symbol.for("react.portal");function d(A,M,I){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:z==null?null:""+z,children:A,containerInfo:M,implementation:I}}var g=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(A,M){if(A==="font")return"";if(typeof M=="string")return M==="use-credentials"?M:""}return ia.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,ia.createPortal=function(A,M){var I=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!M||M.nodeType!==1&&M.nodeType!==9&&M.nodeType!==11)throw Error(e(299));return d(A,M,null,I)},ia.flushSync=function(A){var M=g.T,I=s.p;try{if(g.T=null,s.p=2,A)return A()}finally{g.T=M,s.p=I,s.d.f()}},ia.preconnect=function(A,M){typeof A=="string"&&(M?(M=M.crossOrigin,M=typeof M=="string"?M==="use-credentials"?M:"":void 0):M=null,s.d.C(A,M))},ia.prefetchDNS=function(A){typeof A=="string"&&s.d.D(A)},ia.preinit=function(A,M){if(typeof A=="string"&&M&&typeof M.as=="string"){var I=M.as,z=o(I,M.crossOrigin),W=typeof M.integrity=="string"?M.integrity:void 0,J=typeof M.fetchPriority=="string"?M.fetchPriority:void 0;I==="style"?s.d.S(A,typeof M.precedence=="string"?M.precedence:void 0,{crossOrigin:z,integrity:W,fetchPriority:J}):I==="script"&&s.d.X(A,{crossOrigin:z,integrity:W,fetchPriority:J,nonce:typeof M.nonce=="string"?M.nonce:void 0})}},ia.preinitModule=function(A,M){if(typeof A=="string")if(typeof M=="object"&&M!==null){if(M.as==null||M.as==="script"){var I=o(M.as,M.crossOrigin);s.d.M(A,{crossOrigin:I,integrity:typeof M.integrity=="string"?M.integrity:void 0,nonce:typeof M.nonce=="string"?M.nonce:void 0})}}else M==null&&s.d.M(A)},ia.preload=function(A,M){if(typeof A=="string"&&typeof M=="object"&&M!==null&&typeof M.as=="string"){var I=M.as,z=o(I,M.crossOrigin);s.d.L(A,I,{crossOrigin:z,integrity:typeof M.integrity=="string"?M.integrity:void 0,nonce:typeof M.nonce=="string"?M.nonce:void 0,type:typeof M.type=="string"?M.type:void 0,fetchPriority:typeof M.fetchPriority=="string"?M.fetchPriority:void 0,referrerPolicy:typeof M.referrerPolicy=="string"?M.referrerPolicy:void 0,imageSrcSet:typeof M.imageSrcSet=="string"?M.imageSrcSet:void 0,imageSizes:typeof M.imageSizes=="string"?M.imageSizes:void 0,media:typeof M.media=="string"?M.media:void 0})}},ia.preloadModule=function(A,M){if(typeof A=="string")if(M){var I=o(M.as,M.crossOrigin);s.d.m(A,{as:typeof M.as=="string"&&M.as!=="script"?M.as:void 0,crossOrigin:I,integrity:typeof M.integrity=="string"?M.integrity:void 0})}else s.d.m(A)},ia.requestFormReset=function(A){s.d.r(A)},ia.unstable_batchedUpdates=function(A,M){return A(M)},ia.useFormState=function(A,M,I){return g.H.useFormState(A,M,I)},ia.useFormStatus=function(){return g.H.useHostTransitionStatus()},ia.version="19.2.4",ia}var I1;function EE(){if(I1)return k0.exports;I1=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),k0.exports=AE(),k0.exports}var R1;function CE(){if(R1)return a_;R1=1;var i=SE(),e=hx(),t=EE();function s(u){var f="https://react.dev/errors/"+u;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)f+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+u+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function d(u){var f=u,y=u;if(u.alternate)for(;f.return;)f=f.return;else{u=f;do f=u,(f.flags&4098)!==0&&(y=f.return),u=f.return;while(u)}return f.tag===3?y:null}function g(u){if(u.tag===13){var f=u.memoizedState;if(f===null&&(u=u.alternate,u!==null&&(f=u.memoizedState)),f!==null)return f.dehydrated}return null}function o(u){if(u.tag===31){var f=u.memoizedState;if(f===null&&(u=u.alternate,u!==null&&(f=u.memoizedState)),f!==null)return f.dehydrated}return null}function A(u){if(d(u)!==u)throw Error(s(188))}function M(u){var f=u.alternate;if(!f){if(f=d(u),f===null)throw Error(s(188));return f!==u?null:u}for(var y=u,T=f;;){var D=y.return;if(D===null)break;var L=D.alternate;if(L===null){if(T=D.return,T!==null){y=T;continue}break}if(D.child===L.child){for(L=D.child;L;){if(L===y)return A(D),u;if(L===T)return A(D),f;L=L.sibling}throw Error(s(188))}if(y.return!==T.return)y=D,T=L;else{for(var q=!1,ae=D.child;ae;){if(ae===y){q=!0,y=D,T=L;break}if(ae===T){q=!0,T=D,y=L;break}ae=ae.sibling}if(!q){for(ae=L.child;ae;){if(ae===y){q=!0,y=L,T=D;break}if(ae===T){q=!0,T=L,y=D;break}ae=ae.sibling}if(!q)throw Error(s(189))}}if(y.alternate!==T)throw Error(s(190))}if(y.tag!==3)throw Error(s(188));return y.stateNode.current===y?u:f}function I(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u;for(u=u.child;u!==null;){if(f=I(u),f!==null)return f;u=u.sibling}return null}var z=Object.assign,W=Symbol.for("react.element"),J=Symbol.for("react.transitional.element"),oe=Symbol.for("react.portal"),le=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),Ie=Symbol.for("react.profiler"),Ue=Symbol.for("react.consumer"),Se=Symbol.for("react.context"),Ve=Symbol.for("react.forward_ref"),st=Symbol.for("react.suspense"),ot=Symbol.for("react.suspense_list"),wt=Symbol.for("react.memo"),Ft=Symbol.for("react.lazy"),lt=Symbol.for("react.activity"),kt=Symbol.for("react.memo_cache_sentinel"),xt=Symbol.iterator;function Lt(u){return u===null||typeof u!="object"?null:(u=xt&&u[xt]||u["@@iterator"],typeof u=="function"?u:null)}var Dt=Symbol.for("react.client.reference");function Pt(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===Dt?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case le:return"Fragment";case Ie:return"Profiler";case ne:return"StrictMode";case st:return"Suspense";case ot:return"SuspenseList";case lt:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case oe:return"Portal";case Se:return u.displayName||"Context";case Ue:return(u._context.displayName||"Context")+".Consumer";case Ve:var f=u.render;return u=u.displayName,u||(u=f.displayName||f.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case wt:return f=u.displayName||null,f!==null?f:Pt(u.type)||"Memo";case Ft:f=u._payload,u=u._init;try{return Pt(u(f))}catch{}}return null}var Yt=Array.isArray,re=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,be=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_e={pending:!1,data:null,method:null,action:null},Be=[],nt=-1;function he(u){return{current:u}}function Oe(u){0>nt||(u.current=Be[nt],Be[nt]=null,nt--)}function Je(u,f){nt++,Be[nt]=u.current,u.current=f}var gt=he(null),Mt=he(null),$t=he(null),Ht=he(null);function Qt(u,f){switch(Je($t,f),Je(Mt,u),Je(gt,null),f.nodeType){case 9:case 11:u=(u=f.documentElement)&&(u=u.namespaceURI)?Qc(u):0;break;default:if(u=f.tagName,f=f.namespaceURI)f=Qc(f),u=Vm(f,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}Oe(gt),Je(gt,u)}function vi(){Oe(gt),Oe(Mt),Oe($t)}function Mi(u){u.memoizedState!==null&&Je(Ht,u);var f=gt.current,y=Vm(f,u.type);f!==y&&(Je(Mt,u),Je(gt,y))}function Mr(u){Mt.current===u&&(Oe(gt),Oe(Mt)),Ht.current===u&&(Oe(Ht),Rd._currentValue=_e)}var An,Oo;function gn(u){if(An===void 0)try{throw Error()}catch(y){var f=y.stack.trim().match(/\n( *(at )?)/);An=f&&f[1]||"",Oo=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+An+u+Oo}var gi=!1;function bi(u,f){if(!u||gi)return"";gi=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var T={DetermineComponentFrameRoot:function(){try{if(f){var St=function(){throw Error()};if(Object.defineProperty(St.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(St,[])}catch(ht){var at=ht}Reflect.construct(u,[],St)}else{try{St.call()}catch(ht){at=ht}u.call(St.prototype)}}else{try{throw Error()}catch(ht){at=ht}(St=u())&&typeof St.catch=="function"&&St.catch(function(){})}}catch(ht){if(ht&&at&&typeof ht.stack=="string")return[ht.stack,at.stack]}return[null,null]}};T.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var D=Object.getOwnPropertyDescriptor(T.DetermineComponentFrameRoot,"name");D&&D.configurable&&Object.defineProperty(T.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=T.DetermineComponentFrameRoot(),q=L[0],ae=L[1];if(q&&ae){var De=q.split(`
`),rt=ae.split(`
`);for(D=T=0;T<De.length&&!De[T].includes("DetermineComponentFrameRoot");)T++;for(;D<rt.length&&!rt[D].includes("DetermineComponentFrameRoot");)D++;if(T===De.length||D===rt.length)for(T=De.length-1,D=rt.length-1;1<=T&&0<=D&&De[T]!==rt[D];)D--;for(;1<=T&&0<=D;T--,D--)if(De[T]!==rt[D]){if(T!==1||D!==1)do if(T--,D--,0>D||De[T]!==rt[D]){var mt=`
`+De[T].replace(" at new "," at ");return u.displayName&&mt.includes("<anonymous>")&&(mt=mt.replace("<anonymous>",u.displayName)),mt}while(1<=T&&0<=D);break}}}finally{gi=!1,Error.prepareStackTrace=y}return(y=u?u.displayName||u.name:"")?gn(y):""}function mn(u,f){switch(u.tag){case 26:case 27:case 5:return gn(u.type);case 16:return gn("Lazy");case 13:return u.child!==f&&f!==null?gn("Suspense Fallback"):gn("Suspense");case 19:return gn("SuspenseList");case 0:case 15:return bi(u.type,!1);case 11:return bi(u.type.render,!1);case 1:return bi(u.type,!0);case 31:return gn("Activity");default:return""}}function Ea(u){try{var f="",y=null;do f+=mn(u,y),y=u,u=u.return;while(u);return f}catch(T){return`
Error generating stack: `+T.message+`
`+T.stack}}var ko=Object.prototype.hasOwnProperty,to=i.unstable_scheduleCallback,Ca=i.unstable_cancelCallback,oa=i.unstable_shouldYield,yc=i.unstable_requestPaint,rr=i.unstable_now,gs=i.unstable_getCurrentPriorityLevel,vc=i.unstable_ImmediatePriority,io=i.unstable_UserBlockingPriority,no=i.unstable_NormalPriority,fu=i.unstable_LowPriority,Lo=i.unstable_IdlePriority,ze=i.log,G=i.unstable_setDisableYieldValue,K=null,ee=null;function ve(u){if(typeof ze=="function"&&G(u),ee&&typeof ee.setStrictMode=="function")try{ee.setStrictMode(K,u)}catch{}}var Me=Math.clz32?Math.clz32:Fe,Xe=Math.log,We=Math.LN2;function Fe(u){return u>>>=0,u===0?32:31-(Xe(u)/We|0)|0}var qe=256,yt=262144,ut=4194304;function Ce(u){var f=u&42;if(f!==0)return f;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function Wt(u,f,y){var T=u.pendingLanes;if(T===0)return 0;var D=0,L=u.suspendedLanes,q=u.pingedLanes;u=u.warmLanes;var ae=T&134217727;return ae!==0?(T=ae&~L,T!==0?D=Ce(T):(q&=ae,q!==0?D=Ce(q):y||(y=ae&~u,y!==0&&(D=Ce(y))))):(ae=T&~L,ae!==0?D=Ce(ae):q!==0?D=Ce(q):y||(y=T&~u,y!==0&&(D=Ce(y)))),D===0?0:f!==0&&f!==D&&(f&L)===0&&(L=D&-D,y=f&-f,L>=y||L===32&&(y&4194048)!==0)?f:D}function ai(u,f){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&f)===0}function Jt(u,f){switch(u){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ii(){var u=ut;return ut<<=1,(ut&62914560)===0&&(ut=4194304),u}function ni(u){for(var f=[],y=0;31>y;y++)f.push(u);return f}function oi(u,f){u.pendingLanes|=f,f!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function _n(u,f,y,T,D,L){var q=u.pendingLanes;u.pendingLanes=y,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=y,u.entangledLanes&=y,u.errorRecoveryDisabledLanes&=y,u.shellSuspendCounter=0;var ae=u.entanglements,De=u.expirationTimes,rt=u.hiddenUpdates;for(y=q&~y;0<y;){var mt=31-Me(y),St=1<<mt;ae[mt]=0,De[mt]=-1;var at=rt[mt];if(at!==null)for(rt[mt]=null,mt=0;mt<at.length;mt++){var ht=at[mt];ht!==null&&(ht.lane&=-536870913)}y&=~St}T!==0&&kn(u,T,0),L!==0&&D===0&&u.tag!==0&&(u.suspendedLanes|=L&~(q&~f))}function kn(u,f,y){u.pendingLanes|=f,u.suspendedLanes&=~f;var T=31-Me(f);u.entangledLanes|=f,u.entanglements[T]=u.entanglements[T]|1073741824|y&261930}function En(u,f){var y=u.entangledLanes|=f;for(u=u.entanglements;y;){var T=31-Me(y),D=1<<T;D&f|u[T]&f&&(u[T]|=f),y&=~D}}function Tr(u,f){var y=f&-f;return y=(y&42)!==0?1:yn(y),(y&(u.suspendedLanes|f))!==0?0:y}function yn(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function Tt(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function Li(){var u=be.p;return u!==0?u:(u=window.event,u===void 0?32:zy(u.type))}function ln(u,f){var y=be.p;try{return be.p=u,f()}finally{be.p=y}}var Qr=Math.random().toString(36).slice(2),Hi="__reactFiber$"+Qr,Ct="__reactProps$"+Qr,ti="__reactContainer$"+Qr,hi="__reactEvents$"+Qr,ms="__reactListeners$"+Qr,bh="__reactHandles$"+Qr,Ma="__reactResources$"+Qr,fi="__reactMarker$"+Qr;function bl(u){delete u[Hi],delete u[Ct],delete u[hi],delete u[ms],delete u[bh]}function Pa(u){var f=u[Hi];if(f)return f;for(var y=u.parentNode;y;){if(f=y[ti]||y[Hi]){if(y=f.alternate,f.child!==null||y!==null&&y.child!==null)for(u=ug(u);u!==null;){if(y=u[Hi])return y;u=ug(u)}return f}u=y,y=u.parentNode}return null}function ro(u){if(u=u[Hi]||u[ti]){var f=u.tag;if(f===5||f===6||f===13||f===31||f===26||f===27||f===3)return u}return null}function Ia(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u.stateNode;throw Error(s(33))}function Ra(u){var f=u[Ma];return f||(f=u[Ma]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Ln(u){u[fi]=!0}var bc=new Set,Pr={};function Ii(u,f){so(u,f),so(u+"Capture",f)}function so(u,f){for(Pr[u]=f,u=0;u<f.length;u++)bc.add(f[u])}var xc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wc={},Bo={};function la(u){return ko.call(Bo,u)?!0:ko.call(wc,u)?!1:xc.test(u)?Bo[u]=!0:(wc[u]=!0,!1)}function du(u,f,y){if(la(f))if(y===null)u.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":u.removeAttribute(f);return;case"boolean":var T=f.toLowerCase().slice(0,5);if(T!=="data-"&&T!=="aria-"){u.removeAttribute(f);return}}u.setAttribute(f,""+y)}}function Da(u,f,y){if(y===null)u.removeAttribute(f);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(f);return}u.setAttribute(f,""+y)}}function zs(u,f,y,T){if(T===null)u.removeAttribute(y);else{switch(typeof T){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(y);return}u.setAttributeNS(f,y,""+T)}}function Bi(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Rf(u){var f=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function sp(u,f,y){var T=Object.getOwnPropertyDescriptor(u.constructor.prototype,f);if(!u.hasOwnProperty(f)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var D=T.get,L=T.set;return Object.defineProperty(u,f,{configurable:!0,get:function(){return D.call(this)},set:function(q){y=""+q,L.call(this,q)}}),Object.defineProperty(u,f,{enumerable:T.enumerable}),{getValue:function(){return y},setValue:function(q){y=""+q},stopTracking:function(){u._valueTracker=null,delete u[f]}}}}function xl(u){if(!u._valueTracker){var f=Rf(u)?"checked":"value";u._valueTracker=sp(u,f,""+u[f])}}function Df(u){if(!u)return!1;var f=u._valueTracker;if(!f)return!0;var y=f.getValue(),T="";return u&&(T=Rf(u)?u.checked?"true":"false":u.value),u=T,u!==y?(f.setValue(u),!0):!1}function pu(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var ap=/[\n"\\]/g;function Nr(u){return u.replace(ap,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function gu(u,f,y,T,D,L,q,ae){u.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?u.type=q:u.removeAttribute("type"),f!=null?q==="number"?(f===0&&u.value===""||u.value!=f)&&(u.value=""+Bi(f)):u.value!==""+Bi(f)&&(u.value=""+Bi(f)):q!=="submit"&&q!=="reset"||u.removeAttribute("value"),f!=null?mu(u,q,Bi(f)):y!=null?mu(u,q,Bi(y)):T!=null&&u.removeAttribute("value"),D==null&&L!=null&&(u.defaultChecked=!!L),D!=null&&(u.checked=D&&typeof D!="function"&&typeof D!="symbol"),ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?u.name=""+Bi(ae):u.removeAttribute("name")}function xh(u,f,y,T,D,L,q,ae){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(u.type=L),f!=null||y!=null){if(!(L!=="submit"&&L!=="reset"||f!=null)){xl(u);return}y=y!=null?""+Bi(y):"",f=f!=null?""+Bi(f):y,ae||f===u.value||(u.value=f),u.defaultValue=f}T=T??D,T=typeof T!="function"&&typeof T!="symbol"&&!!T,u.checked=ae?u.checked:!!T,u.defaultChecked=!!T,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(u.name=q),xl(u)}function mu(u,f,y){f==="number"&&pu(u.ownerDocument)===u||u.defaultValue===""+y||(u.defaultValue=""+y)}function zo(u,f,y,T){if(u=u.options,f){f={};for(var D=0;D<y.length;D++)f["$"+y[D]]=!0;for(y=0;y<u.length;y++)D=f.hasOwnProperty("$"+u[y].value),u[y].selected!==D&&(u[y].selected=D),D&&T&&(u[y].defaultSelected=!0)}else{for(y=""+Bi(y),f=null,D=0;D<u.length;D++){if(u[D].value===y){u[D].selected=!0,T&&(u[D].defaultSelected=!0);return}f!==null||u[D].disabled||(f=u[D])}f!==null&&(f.selected=!0)}}function op(u,f,y){if(f!=null&&(f=""+Bi(f),f!==u.value&&(u.value=f),y==null)){u.defaultValue!==f&&(u.defaultValue=f);return}u.defaultValue=y!=null?""+Bi(y):""}function Tc(u,f,y,T){if(f==null){if(T!=null){if(y!=null)throw Error(s(92));if(Yt(T)){if(1<T.length)throw Error(s(93));T=T[0]}y=T}y==null&&(y=""),f=y}y=Bi(f),u.defaultValue=y,T=u.textContent,T===y&&T!==""&&T!==null&&(u.value=T),xl(u)}function ao(u,f){if(f){var y=u.firstChild;if(y&&y===u.lastChild&&y.nodeType===3){y.nodeValue=f;return}}u.textContent=f}var lp=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wl(u,f,y){var T=f.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?T?u.setProperty(f,""):f==="float"?u.cssFloat="":u[f]="":T?u.setProperty(f,y):typeof y!="number"||y===0||lp.has(f)?f==="float"?u.cssFloat=y:u[f]=(""+y).trim():u[f]=y+"px"}function wh(u,f,y){if(f!=null&&typeof f!="object")throw Error(s(62));if(u=u.style,y!=null){for(var T in y)!y.hasOwnProperty(T)||f!=null&&f.hasOwnProperty(T)||(T.indexOf("--")===0?u.setProperty(T,""):T==="float"?u.cssFloat="":u[T]="");for(var D in f)T=f[D],f.hasOwnProperty(D)&&y[D]!==T&&wl(u,D,T)}else for(var L in f)f.hasOwnProperty(L)&&wl(u,L,f[L])}function Tl(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Sc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function mi(u){return Sc.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function ca(){}var Of=null;function _u(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var sr=null,Zn=null;function vn(u){var f=ro(u);if(f&&(u=f.stateNode)){var y=u[Ct]||null;e:switch(u=f.stateNode,f.type){case"input":if(gu(u,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),f=y.name,y.type==="radio"&&f!=null){for(y=u;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Nr(""+f)+'"][type="radio"]'),f=0;f<y.length;f++){var T=y[f];if(T!==u&&T.form===u.form){var D=T[Ct]||null;if(!D)throw Error(s(90));gu(T,D.value,D.defaultValue,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name)}}for(f=0;f<y.length;f++)T=y[f],T.form===u.form&&Df(T)}break e;case"textarea":op(u,y.value,y.defaultValue);break e;case"select":f=y.value,f!=null&&zo(u,!!y.multiple,f,!1)}}}var ri=!1;function Ji(u,f,y){if(ri)return u(f,y);ri=!0;try{var T=u(f);return T}finally{if(ri=!1,(sr!==null||Zn!==null)&&(gd(),sr&&(f=sr,u=Zn,Zn=sr=null,vn(f),u)))for(f=0;f<u.length;f++)vn(u[f])}}function Fs(u,f){var y=u.stateNode;if(y===null)return null;var T=y[Ct]||null;if(T===null)return null;y=T[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(T=!T.disabled)||(u=u.type,T=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!T;break e;default:u=!1}if(u)return null;if(y&&typeof y!="function")throw Error(s(231,f,typeof y));return y}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ur=!1;if(Bn)try{var ar={};Object.defineProperty(ar,"passive",{get:function(){Ur=!0}}),window.addEventListener("test",ar,ar),window.removeEventListener("test",ar,ar)}catch{Ur=!1}var _s=null,Oa=null,bn=null;function No(){if(bn)return bn;var u,f=Oa,y=f.length,T,D="value"in _s?_s.value:_s.textContent,L=D.length;for(u=0;u<y&&f[u]===D[u];u++);var q=y-u;for(T=1;T<=q&&f[y-T]===D[L-T];T++);return bn=D.slice(u,1<T?1-T:void 0)}function ys(u){var f=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&f===13&&(u=13)):u=f,u===10&&(u=13),32<=u||u===13?u:0}function Sl(){return!0}function Vr(){return!1}function er(u){function f(y,T,D,L,q){this._reactName=y,this._targetInst=D,this.type=T,this.nativeEvent=L,this.target=q,this.currentTarget=null;for(var ae in u)u.hasOwnProperty(ae)&&(y=u[ae],this[ae]=y?y(L):L[ae]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?Sl:Vr,this.isPropagationStopped=Vr,this}return z(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Sl)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Sl)},persist:function(){},isPersistent:Sl}),f}var jr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yu=er(jr),Al=z({},jr,{view:0,detail:0}),El=er(Al),Gi,Uo,Ai,di=z({},Al,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xu,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Ai&&(Ai&&u.type==="mousemove"?(Gi=u.screenX-Ai.screenX,Uo=u.screenY-Ai.screenY):Uo=Gi=0,Ai=u),Gi)},movementY:function(u){return"movementY"in u?u.movementY:Uo}}),Cl=er(di),Ri=z({},di,{dataTransfer:0}),vu=er(Ri),Ns=z({},Al,{relatedTarget:0}),Vo=er(Ns),jo=z({},jr,{animationName:0,elapsedTime:0,pseudoElement:0}),cp=er(jo),bu=z({},jr,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),kf=er(bu),sm=z({},jr,{data:0}),Lf=er(sm),$r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ka={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ml(u){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(u):(u=xn[u])?!!f[u]:!1}function xu(){return Ml}var wu=z({},Al,{key:function(u){if(u.key){var f=$r[u.key]||u.key;if(f!=="Unidentified")return f}return u.type==="keypress"?(u=ys(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?ka[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xu,charCode:function(u){return u.type==="keypress"?ys(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?ys(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),zn=er(wu),up=z({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Th=er(up),hp=z({},Al,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xu}),am=er(hp),Ac=z({},jr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sh=er(Ac),Ec=z({},di,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),Bf=er(Ec),Tu=z({},jr,{newState:0,oldState:0}),Cc=er(Tu),Mc=[9,13,27,32],Hn=Bn&&"CompositionEvent"in window,Pc=null;Bn&&"documentMode"in document&&(Pc=document.documentMode);var Ic=Bn&&"TextEvent"in window&&!Pc,Rc=Bn&&(!Hn||Pc&&8<Pc&&11>=Pc),$o=" ",fp=!1;function Su(u,f){switch(u){case"keyup":return Mc.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dp(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var ua=!1;function Ah(u,f){switch(u){case"compositionend":return dp(f);case"keypress":return f.which!==32?null:(fp=!0,$o);case"textInput":return u=f.data,u===$o&&fp?null:u;default:return null}}function pp(u,f){if(ua)return u==="compositionend"||!Hn&&Su(u,f)?(u=No(),bn=Oa=_s=null,ua=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Rc&&f.locale!=="ko"?null:f.data;default:return null}}var gp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Eh(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f==="input"?!!gp[u.type]:f==="textarea"}function Ch(u,f,y,T){sr?Zn?Zn.push(T):Zn=[T]:sr=T,f=vd(f,"onChange"),0<f.length&&(y=new yu("onChange","change",null,y,T),u.push({event:y,listeners:f}))}var Pl=null,Dc=null;function mp(u){wy(u,0)}function Au(u){var f=Ia(u);if(Df(f))return u}function Ho(u,f){if(u==="change")return f}var zf=!1;if(Bn){var Eu;if(Bn){var Wo="oninput"in document;if(!Wo){var Ff=document.createElement("div");Ff.setAttribute("oninput","return;"),Wo=typeof Ff.oninput=="function"}Eu=Wo}else Eu=!1;zf=Eu&&(!document.documentMode||9<document.documentMode)}function Cu(){Pl&&(Pl.detachEvent("onpropertychange",_p),Dc=Pl=null)}function _p(u){if(u.propertyName==="value"&&Au(Dc)){var f=[];Ch(f,Dc,u,_u(u)),Ji(mp,f)}}function om(u,f,y){u==="focusin"?(Cu(),Pl=f,Dc=y,Pl.attachEvent("onpropertychange",_p)):u==="focusout"&&Cu()}function yp(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return Au(Dc)}function Mu(u,f){if(u==="click")return Au(f)}function vp(u,f){if(u==="input"||u==="change")return Au(f)}function Nf(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var Jr=typeof Object.is=="function"?Object.is:Nf;function qo(u,f){if(Jr(u,f))return!0;if(typeof u!="object"||u===null||typeof f!="object"||f===null)return!1;var y=Object.keys(u),T=Object.keys(f);if(y.length!==T.length)return!1;for(T=0;T<y.length;T++){var D=y[T];if(!ko.call(f,D)||!Jr(u[D],f[D]))return!1}return!0}function Us(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function Pu(u,f){var y=Us(u);u=0;for(var T;y;){if(y.nodeType===3){if(T=u+y.textContent.length,u<=f&&T>=f)return{node:y,offset:f-u};u=T}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Us(y)}}function Mh(u,f){return u&&f?u===f?!0:u&&u.nodeType===3?!1:f&&f.nodeType===3?Mh(u,f.parentNode):"contains"in u?u.contains(f):u.compareDocumentPosition?!!(u.compareDocumentPosition(f)&16):!1:!1}function Ph(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var f=pu(u.document);f instanceof u.HTMLIFrameElement;){try{var y=typeof f.contentWindow.location.href=="string"}catch{y=!1}if(y)u=f.contentWindow;else break;f=pu(u.document)}return f}function Iu(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f&&(f==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||f==="textarea"||u.contentEditable==="true")}var Ih=Bn&&"documentMode"in document&&11>=document.documentMode,Vs=null,Ru=null,Du=null,Rh=!1;function bp(u,f,y){var T=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Rh||Vs==null||Vs!==pu(T)||(T=Vs,"selectionStart"in T&&Iu(T)?T={start:T.selectionStart,end:T.selectionEnd}:(T=(T.ownerDocument&&T.ownerDocument.defaultView||window).getSelection(),T={anchorNode:T.anchorNode,anchorOffset:T.anchorOffset,focusNode:T.focusNode,focusOffset:T.focusOffset}),Du&&qo(Du,T)||(Du=T,T=vd(Ru,"onSelect"),0<T.length&&(f=new yu("onSelect","select",null,f,y),u.push({event:f,listeners:T}),f.target=Vs)))}function Il(u,f){var y={};return y[u.toLowerCase()]=f.toLowerCase(),y["Webkit"+u]="webkit"+f,y["Moz"+u]="moz"+f,y}var Rl={animationend:Il("Animation","AnimationEnd"),animationiteration:Il("Animation","AnimationIteration"),animationstart:Il("Animation","AnimationStart"),transitionrun:Il("Transition","TransitionRun"),transitionstart:Il("Transition","TransitionStart"),transitioncancel:Il("Transition","TransitionCancel"),transitionend:Il("Transition","TransitionEnd")},Uf={},zi={};Bn&&(zi=document.createElement("div").style,"AnimationEvent"in window||(delete Rl.animationend.animation,delete Rl.animationiteration.animation,delete Rl.animationstart.animation),"TransitionEvent"in window||delete Rl.transitionend.transition);function La(u){if(Uf[u])return Uf[u];if(!Rl[u])return u;var f=Rl[u],y;for(y in f)if(f.hasOwnProperty(y)&&y in zi)return Uf[u]=f[y];return u}var Ou=La("animationend"),ku=La("animationiteration"),Dh=La("animationstart"),Dl=La("transitionrun"),Lu=La("transitionstart"),Oc=La("transitioncancel"),vs=La("transitionend"),Vf=new Map,Oh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Oh.push("scrollEnd");function bs(u,f){Vf.set(u,f),Ii(f,[u])}var Ba=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},Hr=[],oo=0,Ol=0;function kl(){for(var u=oo,f=Ol=oo=0;f<u;){var y=Hr[f];Hr[f++]=null;var T=Hr[f];Hr[f++]=null;var D=Hr[f];Hr[f++]=null;var L=Hr[f];if(Hr[f++]=null,T!==null&&D!==null){var q=T.pending;q===null?D.next=D:(D.next=q.next,q.next=D),T.pending=D}L!==0&&jf(y,D,L)}}function Bu(u,f,y,T){Hr[oo++]=u,Hr[oo++]=f,Hr[oo++]=y,Hr[oo++]=T,Ol|=T,u.lanes|=T,u=u.alternate,u!==null&&(u.lanes|=T)}function Xo(u,f,y,T){return Bu(u,f,y,T),kc(u)}function js(u,f){return Bu(u,null,null,f),kc(u)}function jf(u,f,y){u.lanes|=y;var T=u.alternate;T!==null&&(T.lanes|=y);for(var D=!1,L=u.return;L!==null;)L.childLanes|=y,T=L.alternate,T!==null&&(T.childLanes|=y),L.tag===22&&(u=L.stateNode,u===null||u._visibility&1||(D=!0)),u=L,L=L.return;return u.tag===3?(L=u.stateNode,D&&f!==null&&(D=31-Me(y),u=L.hiddenUpdates,T=u[D],T===null?u[D]=[f]:T.push(f),f.lane=y|536870912),L):null}function kc(u){if(50<pd)throw pd=0,Am=null,Error(s(185));for(var f=u.return;f!==null;)u=f,f=u.return;return u.tag===3?u.stateNode:null}var pi={};function kh(u,f,y,T){this.tag=u,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xs(u,f,y,T){return new kh(u,f,y,T)}function Lh(u){return u=u.prototype,!(!u||!u.isReactComponent)}function ws(u,f){var y=u.alternate;return y===null?(y=xs(u.tag,f,u.key,u.mode),y.elementType=u.elementType,y.type=u.type,y.stateNode=u.stateNode,y.alternate=u,u.alternate=y):(y.pendingProps=f,y.type=u.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=u.flags&65011712,y.childLanes=u.childLanes,y.lanes=u.lanes,y.child=u.child,y.memoizedProps=u.memoizedProps,y.memoizedState=u.memoizedState,y.updateQueue=u.updateQueue,f=u.dependencies,y.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},y.sibling=u.sibling,y.index=u.index,y.ref=u.ref,y.refCleanup=u.refCleanup,y}function xp(u,f){u.flags&=65011714;var y=u.alternate;return y===null?(u.childLanes=0,u.lanes=f,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=y.childLanes,u.lanes=y.lanes,u.child=y.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=y.memoizedProps,u.memoizedState=y.memoizedState,u.updateQueue=y.updateQueue,u.type=y.type,f=y.dependencies,u.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),u}function Bh(u,f,y,T,D,L){var q=0;if(T=u,typeof u=="function")Lh(u)&&(q=1);else if(typeof u=="string")q=mg(u,y,gt.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case lt:return u=xs(31,y,f,D),u.elementType=lt,u.lanes=L,u;case le:return Go(y.children,D,L,f);case ne:q=8,D|=24;break;case Ie:return u=xs(12,y,f,D|2),u.elementType=Ie,u.lanes=L,u;case st:return u=xs(13,y,f,D),u.elementType=st,u.lanes=L,u;case ot:return u=xs(19,y,f,D),u.elementType=ot,u.lanes=L,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case Se:q=10;break e;case Ue:q=9;break e;case Ve:q=11;break e;case wt:q=14;break e;case Ft:q=16,T=null;break e}q=29,y=Error(s(130,u===null?"null":typeof u,"")),T=null}return f=xs(q,y,f,D),f.elementType=u,f.type=T,f.lanes=L,f}function Go(u,f,y,T){return u=xs(7,u,T,f),u.lanes=y,u}function $f(u,f,y){return u=xs(6,u,null,f),u.lanes=y,u}function zh(u){var f=xs(18,null,null,0);return f.stateNode=u,f}function Zo(u,f,y){return f=xs(4,u.children!==null?u.children:[],u.key,f),f.lanes=y,f.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},f}var Lc=new WeakMap;function Wr(u,f){if(typeof u=="object"&&u!==null){var y=Lc.get(u);return y!==void 0?y:(f={value:u,source:f,stack:Ea(f)},Lc.set(u,f),f)}return{value:u,source:f,stack:Ea(f)}}var Yo=[],Ko=0,Ll=null,Qo=0,or=[],ur=0,za=null,Fa=1,es="";function lo(u,f){Yo[Ko++]=Qo,Yo[Ko++]=Ll,Ll=u,Qo=f}function Hf(u,f,y){or[ur++]=Fa,or[ur++]=es,or[ur++]=za,za=u;var T=Fa;u=es;var D=32-Me(T)-1;T&=~(1<<D),y+=1;var L=32-Me(f)+D;if(30<L){var q=D-D%5;L=(T&(1<<q)-1).toString(32),T>>=q,D-=q,Fa=1<<32-Me(f)+D|y<<D|T,es=L+u}else Fa=1<<L|y<<D|T,es=u}function Bl(u){u.return!==null&&(lo(u,1),Hf(u,1,0))}function Bc(u){for(;u===Ll;)Ll=Yo[--Ko],Yo[Ko]=null,Qo=Yo[--Ko],Yo[Ko]=null;for(;u===za;)za=or[--ur],or[ur]=null,es=or[--ur],or[ur]=null,Fa=or[--ur],or[ur]=null}function Wf(u,f){or[ur++]=Fa,or[ur++]=es,or[ur++]=za,Fa=f.id,es=f.overflow,za=u}var hr=null,en=null,Pi=!1,co=null,Ts=!1,Cn=Error(s(519));function ts(u){var f=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw uo(Wr(f,u)),Cn}function is(u){var f=u.stateNode,y=u.type,T=u.memoizedProps;switch(f[Hi]=u,f[Ct]=T,y){case"dialog":ki("cancel",f),ki("close",f);break;case"iframe":case"object":case"embed":ki("load",f);break;case"video":case"audio":for(y=0;y<Kc.length;y++)ki(Kc[y],f);break;case"source":ki("error",f);break;case"img":case"image":case"link":ki("error",f),ki("load",f);break;case"details":ki("toggle",f);break;case"input":ki("invalid",f),xh(f,T.value,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name,!0);break;case"select":ki("invalid",f);break;case"textarea":ki("invalid",f),Tc(f,T.value,T.defaultValue,T.children)}y=T.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||f.textContent===""+y||T.suppressHydrationWarning===!0||Nm(f.textContent,y)?(T.popover!=null&&(ki("beforetoggle",f),ki("toggle",f)),T.onScroll!=null&&ki("scroll",f),T.onScrollEnd!=null&&ki("scrollend",f),T.onClick!=null&&(f.onclick=ca),f=!0):f=!1,f||ts(u,!0)}function zu(u){for(hr=u.return;hr;)switch(hr.tag){case 5:case 31:case 13:Ts=!1;return;case 27:case 3:Ts=!0;return;default:hr=hr.return}}function Na(u){if(u!==hr)return!1;if(!Pi)return zu(u),Pi=!0,!1;var f=u.tag,y;if((y=f!==3&&f!==27)&&((y=f===5)&&(y=u.type,y=!(y!=="form"&&y!=="button")||og(u.type,u.memoizedProps)),y=!y),y&&en&&ts(u),zu(u),f===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));en=Or(u)}else if(f===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(317));en=Or(u)}else f===27?(f=en,eu(u.type)?(u=Ds,Ds=null,en=u):en=f):en=hr?wa(u.stateNode.nextSibling):null;return!0}function Ua(){en=hr=null,Pi=!1}function Va(){var u=co;return u!==null&&(Qs===null?Qs=u:Qs.push.apply(Qs,u),co=null),u}function uo(u){co===null?co=[u]:co.push(u)}var ho=he(null),$s=null,ja=null;function fo(u,f,y){Je(ho,f._currentValue),f._currentValue=y}function $a(u){u._currentValue=ho.current,Oe(ho)}function Fh(u,f,y){for(;u!==null;){var T=u.alternate;if((u.childLanes&f)!==f?(u.childLanes|=f,T!==null&&(T.childLanes|=f)):T!==null&&(T.childLanes&f)!==f&&(T.childLanes|=f),u===y)break;u=u.return}}function Nh(u,f,y,T){var D=u.child;for(D!==null&&(D.return=u);D!==null;){var L=D.dependencies;if(L!==null){var q=D.child;L=L.firstContext;e:for(;L!==null;){var ae=L;L=D;for(var De=0;De<f.length;De++)if(ae.context===f[De]){L.lanes|=y,ae=L.alternate,ae!==null&&(ae.lanes|=y),Fh(L.return,y,u),T||(q=null);break e}L=ae.next}}else if(D.tag===18){if(q=D.return,q===null)throw Error(s(341));q.lanes|=y,L=q.alternate,L!==null&&(L.lanes|=y),Fh(q,y,u),q=null}else q=D.child;if(q!==null)q.return=D;else for(q=D;q!==null;){if(q===u){q=null;break}if(D=q.sibling,D!==null){D.return=q.return,q=D;break}q=q.return}D=q}}function Ss(u,f,y,T){u=null;for(var D=f,L=!1;D!==null;){if(!L){if((D.flags&524288)!==0)L=!0;else if((D.flags&262144)!==0)break}if(D.tag===10){var q=D.alternate;if(q===null)throw Error(s(387));if(q=q.memoizedProps,q!==null){var ae=D.type;Jr(D.pendingProps.value,q.value)||(u!==null?u.push(ae):u=[ae])}}else if(D===Ht.current){if(q=D.alternate,q===null)throw Error(s(387));q.memoizedState.memoizedState!==D.memoizedState.memoizedState&&(u!==null?u.push(Rd):u=[Rd])}D=D.return}u!==null&&Nh(f,u,y,T),f.flags|=262144}function zc(u){for(u=u.firstContext;u!==null;){if(!Jr(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function po(u){$s=u,ja=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function Yn(u){return Uh($s,u)}function Fu(u,f){return $s===null&&po(u),Uh(u,f)}function Uh(u,f){var y=f._currentValue;if(f={context:f,memoizedValue:y,next:null},ja===null){if(u===null)throw Error(s(308));ja=f,u.dependencies={lanes:0,firstContext:f},u.flags|=524288}else ja=ja.next=f;return y}var qf=typeof AbortController<"u"?AbortController:function(){var u=[],f=this.signal={aborted:!1,addEventListener:function(y,T){u.push(T)}};this.abort=function(){f.aborted=!0,u.forEach(function(y){return y()})}},wp=i.unstable_scheduleCallback,Xf=i.unstable_NormalPriority,Wn={$$typeof:Se,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ha(){return{controller:new qf,data:new Map,refCount:0}}function Fc(u){u.refCount--,u.refCount===0&&wp(Xf,function(){u.controller.abort()})}var Ir=null,As=0,zl=0,Rr=null;function lm(u,f){if(Ir===null){var y=Ir=[];As=0,zl=km(),Rr={status:"pending",value:void 0,then:function(T){y.push(T)}}}return As++,f.then(Nc,Nc),f}function Nc(){if(--As===0&&Ir!==null){Rr!==null&&(Rr.status="fulfilled");var u=Ir;Ir=null,zl=0,Rr=null;for(var f=0;f<u.length;f++)(0,u[f])()}}function Nu(u,f){var y=[],T={status:"pending",value:null,reason:null,then:function(D){y.push(D)}};return u.then(function(){T.status="fulfilled",T.value=f;for(var D=0;D<y.length;D++)(0,y[D])(f)},function(D){for(T.status="rejected",T.reason=D,D=0;D<y.length;D++)(0,y[D])(void 0)}),T}var lr=re.S;re.S=function(u,f){sy=rr(),typeof f=="object"&&f!==null&&typeof f.then=="function"&&lm(u,f),lr!==null&&lr(u,f)};var ha=he(null);function Vh(){var u=ha.current;return u!==null?u:Sn.pooledCache}function jh(u,f){f===null?Je(ha,ha.current):Je(ha,f.pool)}function Tp(){var u=Vh();return u===null?null:{parent:Wn._currentValue,pool:u}}var fa=Error(s(460)),Jo=Error(s(474)),ns=Error(s(542)),Nt={then:function(){}};function Uu(u){return u=u.status,u==="fulfilled"||u==="rejected"}function $h(u,f,y){switch(y=u[y],y===void 0?u.push(f):y!==f&&(f.then(ca,ca),f=y),f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,Hh(u),u;default:if(typeof f.status=="string")f.then(ca,ca);else{if(u=Sn,u!==null&&100<u.shellSuspendCounter)throw Error(s(482));u=f,u.status="pending",u.then(function(T){if(f.status==="pending"){var D=f;D.status="fulfilled",D.value=T}},function(T){if(f.status==="pending"){var D=f;D.status="rejected",D.reason=T}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,Hh(u),u}throw da=f,fa}}function Hs(u){try{var f=u._init;return f(u._payload)}catch(y){throw y!==null&&typeof y=="object"&&typeof y.then=="function"?(da=y,fa):y}}var da=null;function Uc(){if(da===null)throw Error(s(459));var u=da;return da=null,u}function Hh(u){if(u===fa||u===ns)throw Error(s(483))}var Wa=null,Fl=0;function Vu(u){var f=Fl;return Fl+=1,Wa===null&&(Wa=[]),$h(Wa,u,f)}function qa(u,f){f=f.props.ref,u.ref=f!==void 0?f:null}function Wh(u,f){throw f.$$typeof===W?Error(s(525)):(u=Object.prototype.toString.call(f),Error(s(31,u==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":u)))}function ju(u){function f(He,Le){if(u){var it=He.deletions;it===null?(He.deletions=[Le],He.flags|=16):it.push(Le)}}function y(He,Le){if(!u)return null;for(;Le!==null;)f(He,Le),Le=Le.sibling;return null}function T(He){for(var Le=new Map;He!==null;)He.key!==null?Le.set(He.key,He):Le.set(He.index,He),He=He.sibling;return Le}function D(He,Le){return He=ws(He,Le),He.index=0,He.sibling=null,He}function L(He,Le,it){return He.index=it,u?(it=He.alternate,it!==null?(it=it.index,it<Le?(He.flags|=67108866,Le):it):(He.flags|=67108866,Le)):(He.flags|=1048576,Le)}function q(He){return u&&He.alternate===null&&(He.flags|=67108866),He}function ae(He,Le,it,vt){return Le===null||Le.tag!==6?(Le=$f(it,He.mode,vt),Le.return=He,Le):(Le=D(Le,it),Le.return=He,Le)}function De(He,Le,it,vt){var si=it.type;return si===le?mt(He,Le,it.props.children,vt,it.key):Le!==null&&(Le.elementType===si||typeof si=="object"&&si!==null&&si.$$typeof===Ft&&Hs(si)===Le.type)?(Le=D(Le,it.props),qa(Le,it),Le.return=He,Le):(Le=Bh(it.type,it.key,it.props,null,He.mode,vt),qa(Le,it),Le.return=He,Le)}function rt(He,Le,it,vt){return Le===null||Le.tag!==4||Le.stateNode.containerInfo!==it.containerInfo||Le.stateNode.implementation!==it.implementation?(Le=Zo(it,He.mode,vt),Le.return=He,Le):(Le=D(Le,it.children||[]),Le.return=He,Le)}function mt(He,Le,it,vt,si){return Le===null||Le.tag!==7?(Le=Go(it,He.mode,vt,si),Le.return=He,Le):(Le=D(Le,it),Le.return=He,Le)}function St(He,Le,it){if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return Le=$f(""+Le,He.mode,it),Le.return=He,Le;if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case J:return it=Bh(Le.type,Le.key,Le.props,null,He.mode,it),qa(it,Le),it.return=He,it;case oe:return Le=Zo(Le,He.mode,it),Le.return=He,Le;case Ft:return Le=Hs(Le),St(He,Le,it)}if(Yt(Le)||Lt(Le))return Le=Go(Le,He.mode,it,null),Le.return=He,Le;if(typeof Le.then=="function")return St(He,Vu(Le),it);if(Le.$$typeof===Se)return St(He,Fu(He,Le),it);Wh(He,Le)}return null}function at(He,Le,it,vt){var si=Le!==null?Le.key:null;if(typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint")return si!==null?null:ae(He,Le,""+it,vt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case J:return it.key===si?De(He,Le,it,vt):null;case oe:return it.key===si?rt(He,Le,it,vt):null;case Ft:return it=Hs(it),at(He,Le,it,vt)}if(Yt(it)||Lt(it))return si!==null?null:mt(He,Le,it,vt,null);if(typeof it.then=="function")return at(He,Le,Vu(it),vt);if(it.$$typeof===Se)return at(He,Le,Fu(He,it),vt);Wh(He,it)}return null}function ht(He,Le,it,vt,si){if(typeof vt=="string"&&vt!==""||typeof vt=="number"||typeof vt=="bigint")return He=He.get(it)||null,ae(Le,He,""+vt,si);if(typeof vt=="object"&&vt!==null){switch(vt.$$typeof){case J:return He=He.get(vt.key===null?it:vt.key)||null,De(Le,He,vt,si);case oe:return He=He.get(vt.key===null?it:vt.key)||null,rt(Le,He,vt,si);case Ft:return vt=Hs(vt),ht(He,Le,it,vt,si)}if(Yt(vt)||Lt(vt))return He=He.get(it)||null,mt(Le,He,vt,si,null);if(typeof vt.then=="function")return ht(He,Le,it,Vu(vt),si);if(vt.$$typeof===Se)return ht(He,Le,it,Fu(Le,vt),si);Wh(Le,vt)}return null}function Zt(He,Le,it,vt){for(var si=null,Ki=null,ei=Le,yi=Le=0,li=null;ei!==null&&yi<it.length;yi++){ei.index>yi?(li=ei,ei=null):li=ei.sibling;var $i=at(He,ei,it[yi],vt);if($i===null){ei===null&&(ei=li);break}u&&ei&&$i.alternate===null&&f(He,ei),Le=L($i,Le,yi),Ki===null?si=$i:Ki.sibling=$i,Ki=$i,ei=li}if(yi===it.length)return y(He,ei),Pi&&lo(He,yi),si;if(ei===null){for(;yi<it.length;yi++)ei=St(He,it[yi],vt),ei!==null&&(Le=L(ei,Le,yi),Ki===null?si=ei:Ki.sibling=ei,Ki=ei);return Pi&&lo(He,yi),si}for(ei=T(ei);yi<it.length;yi++)li=ht(ei,He,yi,it[yi],vt),li!==null&&(u&&li.alternate!==null&&ei.delete(li.key===null?yi:li.key),Le=L(li,Le,yi),Ki===null?si=li:Ki.sibling=li,Ki=li);return u&&ei.forEach(function(oc){return f(He,oc)}),Pi&&lo(He,yi),si}function ui(He,Le,it,vt){if(it==null)throw Error(s(151));for(var si=null,Ki=null,ei=Le,yi=Le=0,li=null,$i=it.next();ei!==null&&!$i.done;yi++,$i=it.next()){ei.index>yi?(li=ei,ei=null):li=ei.sibling;var oc=at(He,ei,$i.value,vt);if(oc===null){ei===null&&(ei=li);break}u&&ei&&oc.alternate===null&&f(He,ei),Le=L(oc,Le,yi),Ki===null?si=oc:Ki.sibling=oc,Ki=oc,ei=li}if($i.done)return y(He,ei),Pi&&lo(He,yi),si;if(ei===null){for(;!$i.done;yi++,$i=it.next())$i=St(He,$i.value,vt),$i!==null&&(Le=L($i,Le,yi),Ki===null?si=$i:Ki.sibling=$i,Ki=$i);return Pi&&lo(He,yi),si}for(ei=T(ei);!$i.done;yi++,$i=it.next())$i=ht(ei,He,yi,$i.value,vt),$i!==null&&(u&&$i.alternate!==null&&ei.delete($i.key===null?yi:$i.key),Le=L($i,Le,yi),Ki===null?si=$i:Ki.sibling=$i,Ki=$i);return u&&ei.forEach(function(Hy){return f(He,Hy)}),Pi&&lo(He,yi),si}function an(He,Le,it,vt){if(typeof it=="object"&&it!==null&&it.type===le&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case J:e:{for(var si=it.key;Le!==null;){if(Le.key===si){if(si=it.type,si===le){if(Le.tag===7){y(He,Le.sibling),vt=D(Le,it.props.children),vt.return=He,He=vt;break e}}else if(Le.elementType===si||typeof si=="object"&&si!==null&&si.$$typeof===Ft&&Hs(si)===Le.type){y(He,Le.sibling),vt=D(Le,it.props),qa(vt,it),vt.return=He,He=vt;break e}y(He,Le);break}else f(He,Le);Le=Le.sibling}it.type===le?(vt=Go(it.props.children,He.mode,vt,it.key),vt.return=He,He=vt):(vt=Bh(it.type,it.key,it.props,null,He.mode,vt),qa(vt,it),vt.return=He,He=vt)}return q(He);case oe:e:{for(si=it.key;Le!==null;){if(Le.key===si)if(Le.tag===4&&Le.stateNode.containerInfo===it.containerInfo&&Le.stateNode.implementation===it.implementation){y(He,Le.sibling),vt=D(Le,it.children||[]),vt.return=He,He=vt;break e}else{y(He,Le);break}else f(He,Le);Le=Le.sibling}vt=Zo(it,He.mode,vt),vt.return=He,He=vt}return q(He);case Ft:return it=Hs(it),an(He,Le,it,vt)}if(Yt(it))return Zt(He,Le,it,vt);if(Lt(it)){if(si=Lt(it),typeof si!="function")throw Error(s(150));return it=si.call(it),ui(He,Le,it,vt)}if(typeof it.then=="function")return an(He,Le,Vu(it),vt);if(it.$$typeof===Se)return an(He,Le,Fu(He,it),vt);Wh(He,it)}return typeof it=="string"&&it!==""||typeof it=="number"||typeof it=="bigint"?(it=""+it,Le!==null&&Le.tag===6?(y(He,Le.sibling),vt=D(Le,it),vt.return=He,He=vt):(y(He,Le),vt=$f(it,He.mode,vt),vt.return=He,He=vt),q(He)):y(He,Le)}return function(He,Le,it,vt){try{Fl=0;var si=an(He,Le,it,vt);return Wa=null,si}catch(ei){if(ei===fa||ei===ns)throw ei;var Ki=xs(29,ei,null,He.mode);return Ki.lanes=vt,Ki.return=He,Ki}}}var Xa=ju(!0),Gf=ju(!1),Ga=!1;function qh(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $u(u,f){u=u.updateQueue,f.updateQueue===u&&(f.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Za(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function go(u,f,y){var T=u.updateQueue;if(T===null)return null;if(T=T.shared,(rn&2)!==0){var D=T.pending;return D===null?f.next=f:(f.next=D.next,D.next=f),T.pending=f,f=kc(u),jf(u,null,y),f}return Bu(u,T,f,y),kc(u)}function Ws(u,f,y){if(f=f.updateQueue,f!==null&&(f=f.shared,(y&4194048)!==0)){var T=f.lanes;T&=u.pendingLanes,y|=T,f.lanes=y,En(u,y)}}function Wi(u,f){var y=u.updateQueue,T=u.alternate;if(T!==null&&(T=T.updateQueue,y===T)){var D=null,L=null;if(y=y.firstBaseUpdate,y!==null){do{var q={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};L===null?D=L=q:L=L.next=q,y=y.next}while(y!==null);L===null?D=L=f:L=L.next=f}else D=L=f;y={baseState:T.baseState,firstBaseUpdate:D,lastBaseUpdate:L,shared:T.shared,callbacks:T.callbacks},u.updateQueue=y;return}u=y.lastBaseUpdate,u===null?y.firstBaseUpdate=f:u.next=f,y.lastBaseUpdate=f}var Zf=!1;function mo(){if(Zf){var u=Rr;if(u!==null)throw u}}function el(u,f,y,T){Zf=!1;var D=u.updateQueue;Ga=!1;var L=D.firstBaseUpdate,q=D.lastBaseUpdate,ae=D.shared.pending;if(ae!==null){D.shared.pending=null;var De=ae,rt=De.next;De.next=null,q===null?L=rt:q.next=rt,q=De;var mt=u.alternate;mt!==null&&(mt=mt.updateQueue,ae=mt.lastBaseUpdate,ae!==q&&(ae===null?mt.firstBaseUpdate=rt:ae.next=rt,mt.lastBaseUpdate=De))}if(L!==null){var St=D.baseState;q=0,mt=rt=De=null,ae=L;do{var at=ae.lane&-536870913,ht=at!==ae.lane;if(ht?(Oi&at)===at:(T&at)===at){at!==0&&at===zl&&(Zf=!0),mt!==null&&(mt=mt.next={lane:0,tag:ae.tag,payload:ae.payload,callback:null,next:null});e:{var Zt=u,ui=ae;at=f;var an=y;switch(ui.tag){case 1:if(Zt=ui.payload,typeof Zt=="function"){St=Zt.call(an,St,at);break e}St=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=ui.payload,at=typeof Zt=="function"?Zt.call(an,St,at):Zt,at==null)break e;St=z({},St,at);break e;case 2:Ga=!0}}at=ae.callback,at!==null&&(u.flags|=64,ht&&(u.flags|=8192),ht=D.callbacks,ht===null?D.callbacks=[at]:ht.push(at))}else ht={lane:at,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},mt===null?(rt=mt=ht,De=St):mt=mt.next=ht,q|=at;if(ae=ae.next,ae===null){if(ae=D.shared.pending,ae===null)break;ht=ae,ae=ht.next,ht.next=null,D.lastBaseUpdate=ht,D.shared.pending=null}}while(!0);mt===null&&(De=St),D.baseState=De,D.firstBaseUpdate=rt,D.lastBaseUpdate=mt,L===null&&(D.shared.lanes=0),Ql|=q,u.lanes=q,u.memoizedState=St}}function Hu(u,f){if(typeof u!="function")throw Error(s(191,u));u.call(f)}function Xh(u,f){var y=u.callbacks;if(y!==null)for(u.callbacks=null,u=0;u<y.length;u++)Hu(y[u],f)}var Nl=he(null),Wu=he(0);function Yf(u,f){u=Kl,Je(Wu,u),Je(Nl,f),Kl=u|f.baseLanes}function Es(){Je(Wu,Kl),Je(Nl,Nl.current)}function Ul(){Kl=Wu.current,Oe(Nl),Oe(Wu)}var Ut=he(null),Xt=null;function qs(u){var f=u.alternate;Je(Fn,Fn.current&1),Je(Ut,u),Xt===null&&(f===null||Nl.current!==null||f.memoizedState!==null)&&(Xt=u)}function Vc(u){Je(Fn,Fn.current),Je(Ut,u),Xt===null&&(Xt=u)}function qu(u){u.tag===22?(Je(Fn,Fn.current),Je(Ut,u),Xt===null&&(Xt=u)):qn()}function qn(){Je(Fn,Fn.current),Je(Ut,Ut.current)}function Mn(u){Oe(Ut),Xt===u&&(Xt=null),Oe(Fn)}var Fn=he(0);function Xu(u){for(var f=u;f!==null;){if(f.tag===13){var y=f.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||os(y)||In(y)))return f}else if(f.tag===19&&(f.memoizedProps.revealOrder==="forwards"||f.memoizedProps.revealOrder==="backwards"||f.memoizedProps.revealOrder==="unstable_legacy-backwards"||f.memoizedProps.revealOrder==="together")){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var _o=0,Ti=null,Vi=null,xi=null,wn=!1,Xs=!1,pa=!1,Vl=0,jl=0,yo=null,Kf=0;function hn(){throw Error(s(321))}function ga(u,f){if(f===null)return!1;for(var y=0;y<f.length&&y<u.length;y++)if(!Jr(u[y],f[y]))return!1;return!0}function jc(u,f,y,T,D,L){return _o=L,Ti=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,re.H=u===null||u.memoizedState===null?nn:Kn,pa=!1,L=y(T,D),pa=!1,Xs&&(L=Gu(f,y,T,D)),$c(u),L}function $c(u){re.H=qi;var f=Vi!==null&&Vi.next!==null;if(_o=0,xi=Vi=Ti=null,wn=!1,jl=0,yo=null,f)throw Error(s(300));u===null||pr||(u=u.dependencies,u!==null&&zc(u)&&(pr=!0))}function Gu(u,f,y,T){Ti=u;var D=0;do{if(Xs&&(yo=null),jl=0,Xs=!1,25<=D)throw Error(s(301));if(D+=1,xi=Vi=null,u.updateQueue!=null){var L=u.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}re.H=tr,L=f(y,T)}while(Xs);return L}function Zu(){var u=re.H,f=u.useState()[0];return f=typeof f.then=="function"?$l(f):f,u=u.useState()[0],(Vi!==null?Vi.memoizedState:null)!==u&&(Ti.flags|=1024),f}function Yu(){var u=Vl!==0;return Vl=0,u}function tl(u,f,y){f.updateQueue=u.updateQueue,f.flags&=-2053,u.lanes&=~y}function vo(u){if(wn){for(u=u.memoizedState;u!==null;){var f=u.queue;f!==null&&(f.pending=null),u=u.next}wn=!1}_o=0,xi=Vi=Ti=null,Xs=!1,jl=Vl=0,yo=null}function Sr(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xi===null?Ti.memoizedState=xi=u:xi=xi.next=u,xi}function Tn(){if(Vi===null){var u=Ti.alternate;u=u!==null?u.memoizedState:null}else u=Vi.next;var f=xi===null?Ti.memoizedState:xi.next;if(f!==null)xi=f,Vi=u;else{if(u===null)throw Ti.alternate===null?Error(s(467)):Error(s(310));Vi=u,u={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},xi===null?Ti.memoizedState=xi=u:xi=xi.next=u}return xi}function Ya(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $l(u){var f=jl;return jl+=1,yo===null&&(yo=[]),u=$h(yo,u,f),f=Ti,(xi===null?f.memoizedState:xi.next)===null&&(f=f.alternate,re.H=f===null||f.memoizedState===null?nn:Kn),u}function Hl(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return $l(u);if(u.$$typeof===Se)return Yn(u)}throw Error(s(438,String(u)))}function Hc(u){var f=null,y=Ti.updateQueue;if(y!==null&&(f=y.memoCache),f==null){var T=Ti.alternate;T!==null&&(T=T.updateQueue,T!==null&&(T=T.memoCache,T!=null&&(f={data:T.data.map(function(D){return D.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),y===null&&(y=Ya(),Ti.updateQueue=y),y.memoCache=f,y=f.data[f.index],y===void 0)for(y=f.data[f.index]=Array(u),T=0;T<u;T++)y[T]=kt;return f.index++,y}function ma(u,f){return typeof f=="function"?f(u):f}function w(u){var f=Tn();return r(f,Vi,u)}function r(u,f,y){var T=u.queue;if(T===null)throw Error(s(311));T.lastRenderedReducer=y;var D=u.baseQueue,L=T.pending;if(L!==null){if(D!==null){var q=D.next;D.next=L.next,L.next=q}f.baseQueue=D=L,T.pending=null}if(L=u.baseState,D===null)u.memoizedState=L;else{f=D.next;var ae=q=null,De=null,rt=f,mt=!1;do{var St=rt.lane&-536870913;if(St!==rt.lane?(Oi&St)===St:(_o&St)===St){var at=rt.revertLane;if(at===0)De!==null&&(De=De.next={lane:0,revertLane:0,gesture:null,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),St===zl&&(mt=!0);else if((_o&at)===at){rt=rt.next,at===zl&&(mt=!0);continue}else St={lane:0,revertLane:rt.revertLane,gesture:null,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},De===null?(ae=De=St,q=L):De=De.next=St,Ti.lanes|=at,Ql|=at;St=rt.action,pa&&y(L,St),L=rt.hasEagerState?rt.eagerState:y(L,St)}else at={lane:St,revertLane:rt.revertLane,gesture:rt.gesture,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null},De===null?(ae=De=at,q=L):De=De.next=at,Ti.lanes|=St,Ql|=St;rt=rt.next}while(rt!==null&&rt!==f);if(De===null?q=L:De.next=ae,!Jr(L,u.memoizedState)&&(pr=!0,mt&&(y=Rr,y!==null)))throw y;u.memoizedState=L,u.baseState=q,u.baseQueue=De,T.lastRenderedState=L}return D===null&&(T.lanes=0),[u.memoizedState,T.dispatch]}function h(u){var f=Tn(),y=f.queue;if(y===null)throw Error(s(311));y.lastRenderedReducer=u;var T=y.dispatch,D=y.pending,L=f.memoizedState;if(D!==null){y.pending=null;var q=D=D.next;do L=u(L,q.action),q=q.next;while(q!==D);Jr(L,f.memoizedState)||(pr=!0),f.memoizedState=L,f.baseQueue===null&&(f.baseState=L),y.lastRenderedState=L}return[L,T]}function m(u,f,y){var T=Ti,D=Tn(),L=Pi;if(L){if(y===void 0)throw Error(s(407));y=y()}else y=f();var q=!Jr((Vi||D).memoizedState,y);if(q&&(D.memoizedState=y,pr=!0),D=D.queue,Qe(C.bind(null,T,D,u),[u]),D.getSnapshot!==f||q||xi!==null&&xi.memoizedState.tag&1){if(T.flags|=2048,we(9,{destroy:void 0},S.bind(null,T,D,y,f),null),Sn===null)throw Error(s(349));L||(_o&127)!==0||v(T,f,y)}return y}function v(u,f,y){u.flags|=16384,u={getSnapshot:f,value:y},f=Ti.updateQueue,f===null?(f=Ya(),Ti.updateQueue=f,f.stores=[u]):(y=f.stores,y===null?f.stores=[u]:y.push(u))}function S(u,f,y,T){f.value=y,f.getSnapshot=T,R(f)&&k(u)}function C(u,f,y){return y(function(){R(f)&&k(u)})}function R(u){var f=u.getSnapshot;u=u.value;try{var y=f();return!Jr(u,y)}catch{return!0}}function k(u){var f=js(u,2);f!==null&&ea(f,u,2)}function N(u){var f=Sr();if(typeof u=="function"){var y=u;if(u=y(),pa){ve(!0);try{y()}finally{ve(!1)}}}return f.memoizedState=f.baseState=u,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:u},f}function U(u,f,y,T){return u.baseState=y,r(u,Vi,typeof T=="function"?T:ma)}function H(u,f,y,T,D){if(Cs(u))throw Error(s(485));if(u=f.action,u!==null){var L={payload:D,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){L.listeners.push(q)}};re.T!==null?y(!0):L.isTransition=!1,T(L),y=f.pending,y===null?(L.next=f.pending=L,$(f,L)):(L.next=y.next,f.pending=y.next=L)}}function $(u,f){var y=f.action,T=f.payload,D=u.state;if(f.isTransition){var L=re.T,q={};re.T=q;try{var ae=y(D,T),De=re.S;De!==null&&De(q,ae),Y(u,f,ae)}catch(rt){ce(u,f,rt)}finally{L!==null&&q.types!==null&&(L.types=q.types),re.T=L}}else try{L=y(D,T),Y(u,f,L)}catch(rt){ce(u,f,rt)}}function Y(u,f,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(T){te(u,f,T)},function(T){return ce(u,f,T)}):te(u,f,y)}function te(u,f,y){f.status="fulfilled",f.value=y,de(f),u.state=y,f=u.pending,f!==null&&(y=f.next,y===f?u.pending=null:(y=y.next,f.next=y,$(u,y)))}function ce(u,f,y){var T=u.pending;if(u.pending=null,T!==null){T=T.next;do f.status="rejected",f.reason=y,de(f),f=f.next;while(f!==T)}u.action=null}function de(u){u=u.listeners;for(var f=0;f<u.length;f++)(0,u[f])()}function fe(u,f){return f}function ye(u,f){if(Pi){var y=Sn.formState;if(y!==null){e:{var T=Ti;if(Pi){if(en){t:{for(var D=en,L=Ts;D.nodeType!==8;){if(!L){D=null;break t}if(D=wa(D.nextSibling),D===null){D=null;break t}}L=D.data,D=L==="F!"||L==="F"?D:null}if(D){en=wa(D.nextSibling),T=D.data==="F!";break e}}ts(T)}T=!1}T&&(f=y[0])}}return y=Sr(),y.memoizedState=y.baseState=f,T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fe,lastRenderedState:f},y.queue=T,y=Wc.bind(null,Ti,T),T.dispatch=y,T=N(!1),L=ss.bind(null,Ti,!1,T.queue),T=Sr(),D={state:f,dispatch:null,action:u,pending:null},T.queue=D,y=H.bind(null,Ti,D,L,y),D.dispatch=y,T.memoizedState=u,[f,y,!1]}function Ee(u){var f=Tn();return me(f,Vi,u)}function me(u,f,y){if(f=r(u,f,fe)[0],u=w(ma)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var T=$l(f)}catch(q){throw q===fa?ns:q}else T=f;f=Tn();var D=f.queue,L=D.dispatch;return y!==f.memoizedState&&(Ti.flags|=2048,we(9,{destroy:void 0},Ae.bind(null,D,y),null)),[T,L,u]}function Ae(u,f){u.action=f}function Pe(u){var f=Tn(),y=Vi;if(y!==null)return me(f,y,u);Tn(),f=f.memoizedState,y=Tn();var T=y.queue.dispatch;return y.memoizedState=u,[f,T,!1]}function we(u,f,y,T){return u={tag:u,create:y,deps:T,inst:f,next:null},f=Ti.updateQueue,f===null&&(f=Ya(),Ti.updateQueue=f),y=f.lastEffect,y===null?f.lastEffect=u.next=u:(T=y.next,y.next=u,u.next=T,f.lastEffect=u),u}function ke(){return Tn().memoizedState}function et(u,f,y,T){var D=Sr();Ti.flags|=u,D.memoizedState=we(1|f,{destroy:void 0},y,T===void 0?null:T)}function Ze(u,f,y,T){var D=Tn();T=T===void 0?null:T;var L=D.memoizedState.inst;Vi!==null&&T!==null&&ga(T,Vi.memoizedState.deps)?D.memoizedState=we(f,L,y,T):(Ti.flags|=u,D.memoizedState=we(1|f,L,y,T))}function Ke(u,f){et(8390656,8,u,f)}function Qe(u,f){Ze(2048,8,u,f)}function Rt(u){Ti.flags|=4;var f=Ti.updateQueue;if(f===null)f=Ya(),Ti.updateQueue=f,f.events=[u];else{var y=f.events;y===null?f.events=[u]:y.push(u)}}function Ot(u){var f=Tn().memoizedState;return Rt({ref:f,nextImpl:u}),function(){if((rn&2)!==0)throw Error(s(440));return f.impl.apply(void 0,arguments)}}function _t(u,f){return Ze(4,2,u,f)}function zt(u,f){return Ze(4,4,u,f)}function ci(u,f){if(typeof f=="function"){u=u();var y=f(u);return function(){typeof y=="function"?y():f(null)}}if(f!=null)return u=u(),f.current=u,function(){f.current=null}}function ji(u,f,y){y=y!=null?y.concat([u]):null,Ze(4,4,ci.bind(null,f,u),y)}function on(){}function tn(u,f){var y=Tn();f=f===void 0?null:f;var T=y.memoizedState;return f!==null&&ga(f,T[1])?T[0]:(y.memoizedState=[u,f],u)}function fn(u,f){var y=Tn();f=f===void 0?null:f;var T=y.memoizedState;if(f!==null&&ga(f,T[1]))return T[0];if(T=u(),pa){ve(!0);try{u()}finally{ve(!1)}}return y.memoizedState=[T,f],T}function Zi(u,f,y){return y===void 0||(_o&1073741824)!==0&&(Oi&261930)===0?u.memoizedState=f:(u.memoizedState=y,u=oy(),Ti.lanes|=u,Ql|=u,y)}function Pn(u,f,y,T){return Jr(y,f)?y:Nl.current!==null?(u=Zi(u,y,T),Jr(u,f)||(pr=!0),u):(_o&42)===0||(_o&1073741824)!==0&&(Oi&261930)===0?(pr=!0,u.memoizedState=y):(u=oy(),Ti.lanes|=u,Ql|=u,f)}function dn(u,f,y,T,D){var L=be.p;be.p=L!==0&&8>L?L:8;var q=re.T,ae={};re.T=ae,ss(u,!1,f,y);try{var De=D(),rt=re.S;if(rt!==null&&rt(ae,De),De!==null&&typeof De=="object"&&typeof De.then=="function"){var mt=Nu(De,T);ya(u,f,mt,Js(u))}else ya(u,f,T,Js(u))}catch(St){ya(u,f,{then:function(){},status:"rejected",reason:St},Js())}finally{be.p=L,q!==null&&ae.types!==null&&(q.types=ae.types),re.T=q}}function fr(){}function Nn(u,f,y,T){if(u.tag!==5)throw Error(s(476));var D=Un(u).queue;dn(u,D,f,_e,y===null?fr:function(){return dr(u),y(T)})}function Un(u){var f=u.memoizedState;if(f!==null)return f;f={memoizedState:_e,baseState:_e,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:_e},next:null};var y={};return f.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:y},next:null},u.memoizedState=f,u=u.alternate,u!==null&&(u.memoizedState=f),f}function dr(u){var f=Un(u);f.next===null&&(f=u.alternate.memoizedState),ya(u,f.next.queue,{},Js())}function Ka(){return Yn(Rd)}function Qa(){return Tn().memoizedState}function _a(){return Tn().memoizedState}function rs(u){for(var f=u.return;f!==null;){switch(f.tag){case 24:case 3:var y=Js();u=Za(y);var T=go(f,u,y);T!==null&&(ea(T,f,y),Ws(T,f,y)),f={cache:Ha()},u.payload=f;return}f=f.return}}function Wl(u,f,y){var T=Js();y={lane:T,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null},Cs(u)?Gs(f,y):(y=Xo(u,f,y,T),y!==null&&(ea(y,u,T),Zs(y,f,T)))}function Wc(u,f,y){var T=Js();ya(u,f,y,T)}function ya(u,f,y,T){var D={lane:T,revertLane:0,gesture:null,action:y,hasEagerState:!1,eagerState:null,next:null};if(Cs(u))Gs(f,D);else{var L=u.alternate;if(u.lanes===0&&(L===null||L.lanes===0)&&(L=f.lastRenderedReducer,L!==null))try{var q=f.lastRenderedState,ae=L(q,y);if(D.hasEagerState=!0,D.eagerState=ae,Jr(ae,q))return Bu(u,f,D,0),Sn===null&&kl(),!1}catch{}if(y=Xo(u,f,D,T),y!==null)return ea(y,u,T),Zs(y,f,T),!0}return!1}function ss(u,f,y,T){if(T={lane:2,revertLane:km(),gesture:null,action:T,hasEagerState:!1,eagerState:null,next:null},Cs(u)){if(f)throw Error(s(479))}else f=Xo(u,y,T,2),f!==null&&ea(f,u,2)}function Cs(u){var f=u.alternate;return u===Ti||f!==null&&f===Ti}function Gs(u,f){Xs=wn=!0;var y=u.pending;y===null?f.next=f:(f.next=y.next,y.next=f),u.pending=f}function Zs(u,f,y){if((y&4194048)!==0){var T=f.lanes;T&=u.pendingLanes,y|=T,f.lanes=y,En(u,y)}}var qi={readContext:Yn,use:Hl,useCallback:hn,useContext:hn,useEffect:hn,useImperativeHandle:hn,useLayoutEffect:hn,useInsertionEffect:hn,useMemo:hn,useReducer:hn,useRef:hn,useState:hn,useDebugValue:hn,useDeferredValue:hn,useTransition:hn,useSyncExternalStore:hn,useId:hn,useHostTransitionStatus:hn,useFormState:hn,useActionState:hn,useOptimistic:hn,useMemoCache:hn,useCacheRefresh:hn};qi.useEffectEvent=hn;var nn={readContext:Yn,use:Hl,useCallback:function(u,f){return Sr().memoizedState=[u,f===void 0?null:f],u},useContext:Yn,useEffect:Ke,useImperativeHandle:function(u,f,y){y=y!=null?y.concat([u]):null,et(4194308,4,ci.bind(null,f,u),y)},useLayoutEffect:function(u,f){return et(4194308,4,u,f)},useInsertionEffect:function(u,f){et(4,2,u,f)},useMemo:function(u,f){var y=Sr();f=f===void 0?null:f;var T=u();if(pa){ve(!0);try{u()}finally{ve(!1)}}return y.memoizedState=[T,f],T},useReducer:function(u,f,y){var T=Sr();if(y!==void 0){var D=y(f);if(pa){ve(!0);try{y(f)}finally{ve(!1)}}}else D=f;return T.memoizedState=T.baseState=D,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:D},T.queue=u,u=u.dispatch=Wl.bind(null,Ti,u),[T.memoizedState,u]},useRef:function(u){var f=Sr();return u={current:u},f.memoizedState=u},useState:function(u){u=N(u);var f=u.queue,y=Wc.bind(null,Ti,f);return f.dispatch=y,[u.memoizedState,y]},useDebugValue:on,useDeferredValue:function(u,f){var y=Sr();return Zi(y,u,f)},useTransition:function(){var u=N(!1);return u=dn.bind(null,Ti,u.queue,!0,!1),Sr().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,f,y){var T=Ti,D=Sr();if(Pi){if(y===void 0)throw Error(s(407));y=y()}else{if(y=f(),Sn===null)throw Error(s(349));(Oi&127)!==0||v(T,f,y)}D.memoizedState=y;var L={value:y,getSnapshot:f};return D.queue=L,Ke(C.bind(null,T,L,u),[u]),T.flags|=2048,we(9,{destroy:void 0},S.bind(null,T,L,y,f),null),y},useId:function(){var u=Sr(),f=Sn.identifierPrefix;if(Pi){var y=es,T=Fa;y=(T&~(1<<32-Me(T)-1)).toString(32)+y,f="_"+f+"R_"+y,y=Vl++,0<y&&(f+="H"+y.toString(32)),f+="_"}else y=Kf++,f="_"+f+"r_"+y.toString(32)+"_";return u.memoizedState=f},useHostTransitionStatus:Ka,useFormState:ye,useActionState:ye,useOptimistic:function(u){var f=Sr();f.memoizedState=f.baseState=u;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=y,f=ss.bind(null,Ti,!0,y),y.dispatch=f,[u,f]},useMemoCache:Hc,useCacheRefresh:function(){return Sr().memoizedState=rs.bind(null,Ti)},useEffectEvent:function(u){var f=Sr(),y={impl:u};return f.memoizedState=y,function(){if((rn&2)!==0)throw Error(s(440));return y.impl.apply(void 0,arguments)}}},Kn={readContext:Yn,use:Hl,useCallback:tn,useContext:Yn,useEffect:Qe,useImperativeHandle:ji,useInsertionEffect:_t,useLayoutEffect:zt,useMemo:fn,useReducer:w,useRef:ke,useState:function(){return w(ma)},useDebugValue:on,useDeferredValue:function(u,f){var y=Tn();return Pn(y,Vi.memoizedState,u,f)},useTransition:function(){var u=w(ma)[0],f=Tn().memoizedState;return[typeof u=="boolean"?u:$l(u),f]},useSyncExternalStore:m,useId:Qa,useHostTransitionStatus:Ka,useFormState:Ee,useActionState:Ee,useOptimistic:function(u,f){var y=Tn();return U(y,Vi,u,f)},useMemoCache:Hc,useCacheRefresh:_a};Kn.useEffectEvent=Ot;var tr={readContext:Yn,use:Hl,useCallback:tn,useContext:Yn,useEffect:Qe,useImperativeHandle:ji,useInsertionEffect:_t,useLayoutEffect:zt,useMemo:fn,useReducer:h,useRef:ke,useState:function(){return h(ma)},useDebugValue:on,useDeferredValue:function(u,f){var y=Tn();return Vi===null?Zi(y,u,f):Pn(y,Vi.memoizedState,u,f)},useTransition:function(){var u=h(ma)[0],f=Tn().memoizedState;return[typeof u=="boolean"?u:$l(u),f]},useSyncExternalStore:m,useId:Qa,useHostTransitionStatus:Ka,useFormState:Pe,useActionState:Pe,useOptimistic:function(u,f){var y=Tn();return Vi!==null?U(y,Vi,u,f):(y.baseState=u,[u,y.queue.dispatch])},useMemoCache:Hc,useCacheRefresh:_a};tr.useEffectEvent=Ot;function Gh(u,f,y,T){f=u.memoizedState,y=y(T,f),y=y==null?f:z({},f,y),u.memoizedState=y,u.lanes===0&&(u.updateQueue.baseState=y)}var Zh={enqueueSetState:function(u,f,y){u=u._reactInternals;var T=Js(),D=Za(T);D.payload=f,y!=null&&(D.callback=y),f=go(u,D,T),f!==null&&(ea(f,u,T),Ws(f,u,T))},enqueueReplaceState:function(u,f,y){u=u._reactInternals;var T=Js(),D=Za(T);D.tag=1,D.payload=f,y!=null&&(D.callback=y),f=go(u,D,T),f!==null&&(ea(f,u,T),Ws(f,u,T))},enqueueForceUpdate:function(u,f){u=u._reactInternals;var y=Js(),T=Za(y);T.tag=2,f!=null&&(T.callback=f),f=go(u,T,y),f!==null&&(ea(f,u,y),Ws(f,u,y))}};function il(u,f,y,T,D,L,q){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(T,L,q):f.prototype&&f.prototype.isPureReactComponent?!qo(y,T)||!qo(D,L):!0}function Sp(u,f,y,T){u=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(y,T),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(y,T),f.state!==u&&Zh.enqueueReplaceState(f,f.state,null)}function nl(u,f){var y=f;if("ref"in f){y={};for(var T in f)T!=="ref"&&(y[T]=f[T])}if(u=u.defaultProps){y===f&&(y=z({},y));for(var D in u)y[D]===void 0&&(y[D]=u[D])}return y}function Yh(u){Ba(u)}function bo(u){console.error(u)}function xo(u){Ba(u)}function va(u,f){try{var y=u.onUncaughtError;y(f.value,{componentStack:f.stack})}catch(T){setTimeout(function(){throw T})}}function Kh(u,f,y){try{var T=u.onCaughtError;T(y.value,{componentStack:y.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(D){setTimeout(function(){throw D})}}function Ku(u,f,y){return y=Za(y),y.tag=3,y.payload={element:null},y.callback=function(){va(u,f)},y}function Qu(u){return u=Za(u),u.tag=3,u}function Ju(u,f,y,T){var D=y.type.getDerivedStateFromError;if(typeof D=="function"){var L=T.value;u.payload=function(){return D(L)},u.callback=function(){Kh(f,y,T)}}var q=y.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(u.callback=function(){Kh(f,y,T),typeof D!="function"&&(Jl===null?Jl=new Set([this]):Jl.add(this));var ae=T.stack;this.componentDidCatch(T.value,{componentStack:ae!==null?ae:""})})}function Ap(u,f,y,T,D){if(y.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){if(f=y.alternate,f!==null&&Ss(f,y,D,!0),y=Ut.current,y!==null){switch(y.tag){case 31:case 13:return Xt===null?md():y.alternate===null&&Qn===0&&(Qn=3),y.flags&=-257,y.flags|=65536,y.lanes=D,T===Nt?y.flags|=16384:(f=y.updateQueue,f===null?y.updateQueue=new Set([T]):f.add(T),Yp(u,T,D)),!1;case 22:return y.flags|=65536,T===Nt?y.flags|=16384:(f=y.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([T])},y.updateQueue=f):(y=f.retryQueue,y===null?f.retryQueue=new Set([T]):y.add(T)),Yp(u,T,D)),!1}throw Error(s(435,y.tag))}return Yp(u,T,D),md(),!1}if(Pi)return f=Ut.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=D,T!==Cn&&(u=Error(s(422),{cause:T}),uo(Wr(u,y)))):(T!==Cn&&(f=Error(s(423),{cause:T}),uo(Wr(f,y))),u=u.current.alternate,u.flags|=65536,D&=-D,u.lanes|=D,T=Wr(T,y),D=Ku(u.stateNode,T,D),Wi(u,D),Qn!==4&&(Qn=2)),!1;var L=Error(s(520),{cause:T});if(L=Wr(L,y),fd===null?fd=[L]:fd.push(L),Qn!==4&&(Qn=2),f===null)return!0;T=Wr(T,y),y=f;do{switch(y.tag){case 3:return y.flags|=65536,u=D&-D,y.lanes|=u,u=Ku(y.stateNode,T,u),Wi(y,u),!1;case 1:if(f=y.type,L=y.stateNode,(y.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(Jl===null||!Jl.has(L))))return y.flags|=65536,D&=-D,y.lanes|=D,D=Qu(D),Ju(D,u,y,T),Wi(y,D),!1}y=y.return}while(y!==null);return!1}var Ep=Error(s(461)),pr=!1;function Ar(u,f,y,T){f.child=u===null?Gf(f,null,y,T):Xa(f,u.child,y,T)}function H_(u,f,y,T,D){y=y.render;var L=f.ref;if("ref"in T){var q={};for(var ae in T)ae!=="ref"&&(q[ae]=T[ae])}else q=T;return po(f),T=jc(u,f,y,q,L,D),ae=Yu(),u!==null&&!pr?(tl(u,f,D),sl(u,f,D)):(Pi&&ae&&Bl(f),f.flags|=1,Ar(u,f,T,D),f.child)}function Cp(u,f,y,T,D){if(u===null){var L=y.type;return typeof L=="function"&&!Lh(L)&&L.defaultProps===void 0&&y.compare===null?(f.tag=15,f.type=L,cm(u,f,L,T,D)):(u=Bh(y.type,null,T,f,f.mode,D),u.ref=f.ref,u.return=f,f.child=u)}if(L=u.child,!ed(u,D)){var q=L.memoizedProps;if(y=y.compare,y=y!==null?y:qo,y(q,T)&&u.ref===f.ref)return sl(u,f,D)}return f.flags|=1,u=ws(L,T),u.ref=f.ref,u.return=f,f.child=u}function cm(u,f,y,T,D){if(u!==null){var L=u.memoizedProps;if(qo(L,T)&&u.ref===f.ref)if(pr=!1,f.pendingProps=T=L,ed(u,D))(u.flags&131072)!==0&&(pr=!0);else return f.lanes=u.lanes,sl(u,f,D)}return hm(u,f,y,T,D)}function um(u,f,y,T){var D=T.children,L=u!==null?u.memoizedState:null;if(u===null&&f.stateNode===null&&(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),T.mode==="hidden"){if((f.flags&128)!==0){if(L=L!==null?L.baseLanes|y:y,u!==null){for(T=f.child=u.child,D=0;T!==null;)D=D|T.lanes|T.childLanes,T=T.sibling;T=D&~L}else T=0,f.child=null;return W_(u,f,L,y,T)}if((y&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},u!==null&&jh(f,L!==null?L.cachePool:null),L!==null?Yf(f,L):Es(),qu(f);else return T=f.lanes=536870912,W_(u,f,L!==null?L.baseLanes|y:y,y,T)}else L!==null?(jh(f,L.cachePool),Yf(f,L),qn(),f.memoizedState=null):(u!==null&&jh(f,null),Es(),qn());return Ar(u,f,D,y),f.child}function rl(u,f){return u!==null&&u.tag===22||f.stateNode!==null||(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.sibling}function W_(u,f,y,T,D){var L=Vh();return L=L===null?null:{parent:Wn._currentValue,pool:L},f.memoizedState={baseLanes:y,cachePool:L},u!==null&&jh(f,null),Es(),qu(f),u!==null&&Ss(u,f,T,!0),f.childLanes=D,null}function ql(u,f){return f=Dp({mode:f.mode,children:f.children},u.mode),f.ref=u.ref,u.child=f,f.return=u,f}function Qf(u,f,y){return Xa(f,u.child,null,y),u=ql(f,f.pendingProps),u.flags|=2,Mn(f),f.memoizedState=null,u}function Mp(u,f,y){var T=f.pendingProps,D=(f.flags&128)!==0;if(f.flags&=-129,u===null){if(Pi){if(T.mode==="hidden")return u=ql(f,T),f.lanes=536870912,rl(null,u);if(Vc(f),(u=en)?(u=tu(u,Ts),u=u!==null&&u.data==="&"?u:null,u!==null&&(f.memoizedState={dehydrated:u,treeContext:za!==null?{id:Fa,overflow:es}:null,retryLane:536870912,hydrationErrors:null},y=zh(u),y.return=f,f.child=y,hr=f,en=null)):u=null,u===null)throw ts(f);return f.lanes=536870912,null}return ql(f,T)}var L=u.memoizedState;if(L!==null){var q=L.dehydrated;if(Vc(f),D)if(f.flags&256)f.flags&=-257,f=Qf(u,f,y);else if(f.memoizedState!==null)f.child=u.child,f.flags|=128,f=null;else throw Error(s(558));else if(pr||Ss(u,f,y,!1),D=(y&u.childLanes)!==0,pr||D){if(T=Sn,T!==null&&(q=Tr(T,y),q!==0&&q!==L.retryLane))throw L.retryLane=q,js(u,q),ea(T,u,q),Ep;md(),f=Qf(u,f,y)}else u=L.treeContext,en=wa(q.nextSibling),hr=f,Pi=!0,co=null,Ts=!1,u!==null&&Wf(f,u),f=ql(f,T),f.flags|=4096;return f}return u=ws(u.child,{mode:T.mode,children:T.children}),u.ref=f.ref,f.child=u,u.return=f,u}function Pp(u,f){var y=f.ref;if(y===null)u!==null&&u.ref!==null&&(f.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(s(284));(u===null||u.ref!==y)&&(f.flags|=4194816)}}function hm(u,f,y,T,D){return po(f),y=jc(u,f,y,T,void 0,D),T=Yu(),u!==null&&!pr?(tl(u,f,D),sl(u,f,D)):(Pi&&T&&Bl(f),f.flags|=1,Ar(u,f,y,D),f.child)}function q_(u,f,y,T,D,L){return po(f),f.updateQueue=null,y=Gu(f,T,y,D),$c(u),T=Yu(),u!==null&&!pr?(tl(u,f,L),sl(u,f,L)):(Pi&&T&&Bl(f),f.flags|=1,Ar(u,f,y,L),f.child)}function X_(u,f,y,T,D){if(po(f),f.stateNode===null){var L=pi,q=y.contextType;typeof q=="object"&&q!==null&&(L=Yn(q)),L=new y(T,L),f.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=Zh,f.stateNode=L,L._reactInternals=f,L=f.stateNode,L.props=T,L.state=f.memoizedState,L.refs={},qh(f),q=y.contextType,L.context=typeof q=="object"&&q!==null?Yn(q):pi,L.state=f.memoizedState,q=y.getDerivedStateFromProps,typeof q=="function"&&(Gh(f,y,q,T),L.state=f.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(q=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),q!==L.state&&Zh.enqueueReplaceState(L,L.state,null),el(f,T,L,D),mo(),L.state=f.memoizedState),typeof L.componentDidMount=="function"&&(f.flags|=4194308),T=!0}else if(u===null){L=f.stateNode;var ae=f.memoizedProps,De=nl(y,ae);L.props=De;var rt=L.context,mt=y.contextType;q=pi,typeof mt=="object"&&mt!==null&&(q=Yn(mt));var St=y.getDerivedStateFromProps;mt=typeof St=="function"||typeof L.getSnapshotBeforeUpdate=="function",ae=f.pendingProps!==ae,mt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(ae||rt!==q)&&Sp(f,L,T,q),Ga=!1;var at=f.memoizedState;L.state=at,el(f,T,L,D),mo(),rt=f.memoizedState,ae||at!==rt||Ga?(typeof St=="function"&&(Gh(f,y,St,T),rt=f.memoizedState),(De=Ga||il(f,y,De,T,at,rt,q))?(mt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(f.flags|=4194308)):(typeof L.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=T,f.memoizedState=rt),L.props=T,L.state=rt,L.context=q,T=De):(typeof L.componentDidMount=="function"&&(f.flags|=4194308),T=!1)}else{L=f.stateNode,$u(u,f),q=f.memoizedProps,mt=nl(y,q),L.props=mt,St=f.pendingProps,at=L.context,rt=y.contextType,De=pi,typeof rt=="object"&&rt!==null&&(De=Yn(rt)),ae=y.getDerivedStateFromProps,(rt=typeof ae=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(q!==St||at!==De)&&Sp(f,L,T,De),Ga=!1,at=f.memoizedState,L.state=at,el(f,T,L,D),mo();var ht=f.memoizedState;q!==St||at!==ht||Ga||u!==null&&u.dependencies!==null&&zc(u.dependencies)?(typeof ae=="function"&&(Gh(f,y,ae,T),ht=f.memoizedState),(mt=Ga||il(f,y,mt,T,at,ht,De)||u!==null&&u.dependencies!==null&&zc(u.dependencies))?(rt||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(T,ht,De),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(T,ht,De)),typeof L.componentDidUpdate=="function"&&(f.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof L.componentDidUpdate!="function"||q===u.memoizedProps&&at===u.memoizedState||(f.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===u.memoizedProps&&at===u.memoizedState||(f.flags|=1024),f.memoizedProps=T,f.memoizedState=ht),L.props=T,L.state=ht,L.context=De,T=mt):(typeof L.componentDidUpdate!="function"||q===u.memoizedProps&&at===u.memoizedState||(f.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||q===u.memoizedProps&&at===u.memoizedState||(f.flags|=1024),T=!1)}return L=T,Pp(u,f),T=(f.flags&128)!==0,L||T?(L=f.stateNode,y=T&&typeof y.getDerivedStateFromError!="function"?null:L.render(),f.flags|=1,u!==null&&T?(f.child=Xa(f,u.child,null,D),f.child=Xa(f,null,y,D)):Ar(u,f,y,D),f.memoizedState=L.state,u=f.child):u=sl(u,f,D),u}function G_(u,f,y,T){return Ua(),f.flags|=256,Ar(u,f,y,T),f.child}var Ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Jf(u){return{baseLanes:u,cachePool:Tp()}}function Rp(u,f,y){return u=u!==null?u.childLanes&~y:0,f&&(u|=qr),u}function fm(u,f,y){var T=f.pendingProps,D=!1,L=(f.flags&128)!==0,q;if((q=L)||(q=u!==null&&u.memoizedState===null?!1:(Fn.current&2)!==0),q&&(D=!0,f.flags&=-129),q=(f.flags&32)!==0,f.flags&=-33,u===null){if(Pi){if(D?qs(f):qn(),(u=en)?(u=tu(u,Ts),u=u!==null&&u.data!=="&"?u:null,u!==null&&(f.memoizedState={dehydrated:u,treeContext:za!==null?{id:Fa,overflow:es}:null,retryLane:536870912,hydrationErrors:null},y=zh(u),y.return=f,f.child=y,hr=f,en=null)):u=null,u===null)throw ts(f);return In(u)?f.lanes=32:f.lanes=536870912,null}var ae=T.children;return T=T.fallback,D?(qn(),D=f.mode,ae=Dp({mode:"hidden",children:ae},D),T=Go(T,D,y,null),ae.return=f,T.return=f,ae.sibling=T,f.child=ae,T=f.child,T.memoizedState=Jf(y),T.childLanes=Rp(u,q,y),f.memoizedState=Ip,rl(null,T)):(qs(f),dm(f,ae))}var De=u.memoizedState;if(De!==null&&(ae=De.dehydrated,ae!==null)){if(L)f.flags&256?(qs(f),f.flags&=-257,f=Op(u,f,y)):f.memoizedState!==null?(qn(),f.child=u.child,f.flags|=128,f=null):(qn(),ae=T.fallback,D=f.mode,T=Dp({mode:"visible",children:T.children},D),ae=Go(ae,D,y,null),ae.flags|=2,T.return=f,ae.return=f,T.sibling=ae,f.child=T,Xa(f,u.child,null,y),T=f.child,T.memoizedState=Jf(y),T.childLanes=Rp(u,q,y),f.memoizedState=Ip,f=rl(null,T));else if(qs(f),In(ae)){if(q=ae.nextSibling&&ae.nextSibling.dataset,q)var rt=q.dgst;q=rt,T=Error(s(419)),T.stack="",T.digest=q,uo({value:T,source:null,stack:null}),f=Op(u,f,y)}else if(pr||Ss(u,f,y,!1),q=(y&u.childLanes)!==0,pr||q){if(q=Sn,q!==null&&(T=Tr(q,y),T!==0&&T!==De.retryLane))throw De.retryLane=T,js(u,T),ea(q,u,T),Ep;os(ae)||md(),f=Op(u,f,y)}else os(ae)?(f.flags|=192,f.child=u.child,f=null):(u=De.treeContext,en=wa(ae.nextSibling),hr=f,Pi=!0,co=null,Ts=!1,u!==null&&Wf(f,u),f=dm(f,T.children),f.flags|=4096);return f}return D?(qn(),ae=T.fallback,D=f.mode,De=u.child,rt=De.sibling,T=ws(De,{mode:"hidden",children:T.children}),T.subtreeFlags=De.subtreeFlags&65011712,rt!==null?ae=ws(rt,ae):(ae=Go(ae,D,y,null),ae.flags|=2),ae.return=f,T.return=f,T.sibling=ae,f.child=T,rl(null,T),T=f.child,ae=u.child.memoizedState,ae===null?ae=Jf(y):(D=ae.cachePool,D!==null?(De=Wn._currentValue,D=D.parent!==De?{parent:De,pool:De}:D):D=Tp(),ae={baseLanes:ae.baseLanes|y,cachePool:D}),T.memoizedState=ae,T.childLanes=Rp(u,q,y),f.memoizedState=Ip,rl(u.child,T)):(qs(f),y=u.child,u=y.sibling,y=ws(y,{mode:"visible",children:T.children}),y.return=f,y.sibling=null,u!==null&&(q=f.deletions,q===null?(f.deletions=[u],f.flags|=16):q.push(u)),f.child=y,f.memoizedState=null,y)}function dm(u,f){return f=Dp({mode:"visible",children:f},u.mode),f.return=u,u.child=f}function Dp(u,f){return u=xs(22,u,null,f),u.lanes=0,u}function Op(u,f,y){return Xa(f,u.child,null,y),u=dm(f,f.pendingProps.children),u.flags|=2,f.memoizedState=null,u}function pm(u,f,y){u.lanes|=f;var T=u.alternate;T!==null&&(T.lanes|=f),Fh(u.return,f,y)}function gm(u,f,y,T,D,L){var q=u.memoizedState;q===null?u.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:T,tail:y,tailMode:D,treeForkCount:L}:(q.isBackwards=f,q.rendering=null,q.renderingStartTime=0,q.last=T,q.tail=y,q.tailMode=D,q.treeForkCount=L)}function kp(u,f,y){var T=f.pendingProps,D=T.revealOrder,L=T.tail;T=T.children;var q=Fn.current,ae=(q&2)!==0;if(ae?(q=q&1|2,f.flags|=128):q&=1,Je(Fn,q),Ar(u,f,T,y),T=Pi?Qo:0,!ae&&u!==null&&(u.flags&128)!==0)e:for(u=f.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&pm(u,y,f);else if(u.tag===19)pm(u,y,f);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===f)break e;for(;u.sibling===null;){if(u.return===null||u.return===f)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(D){case"forwards":for(y=f.child,D=null;y!==null;)u=y.alternate,u!==null&&Xu(u)===null&&(D=y),y=y.sibling;y=D,y===null?(D=f.child,f.child=null):(D=y.sibling,y.sibling=null),gm(f,!1,D,y,L,T);break;case"backwards":case"unstable_legacy-backwards":for(y=null,D=f.child,f.child=null;D!==null;){if(u=D.alternate,u!==null&&Xu(u)===null){f.child=D;break}u=D.sibling,D.sibling=y,y=D,D=u}gm(f,!0,y,null,L,T);break;case"together":gm(f,!1,null,null,void 0,T);break;default:f.memoizedState=null}return f.child}function sl(u,f,y){if(u!==null&&(f.dependencies=u.dependencies),Ql|=f.lanes,(y&f.childLanes)===0)if(u!==null){if(Ss(u,f,y,!1),(y&f.childLanes)===0)return null}else return null;if(u!==null&&f.child!==u.child)throw Error(s(153));if(f.child!==null){for(u=f.child,y=ws(u,u.pendingProps),f.child=y,y.return=f;u.sibling!==null;)u=u.sibling,y=y.sibling=ws(u,u.pendingProps),y.return=f;y.sibling=null}return f.child}function ed(u,f){return(u.lanes&f)!==0?!0:(u=u.dependencies,!!(u!==null&&zc(u)))}function td(u,f,y){switch(f.tag){case 3:Qt(f,f.stateNode.containerInfo),fo(f,Wn,u.memoizedState.cache),Ua();break;case 27:case 5:Mi(f);break;case 4:Qt(f,f.stateNode.containerInfo);break;case 10:fo(f,f.type,f.memoizedProps.value);break;case 31:if(f.memoizedState!==null)return f.flags|=128,Vc(f),null;break;case 13:var T=f.memoizedState;if(T!==null)return T.dehydrated!==null?(qs(f),f.flags|=128,null):(y&f.child.childLanes)!==0?fm(u,f,y):(qs(f),u=sl(u,f,y),u!==null?u.sibling:null);qs(f);break;case 19:var D=(u.flags&128)!==0;if(T=(y&f.childLanes)!==0,T||(Ss(u,f,y,!1),T=(y&f.childLanes)!==0),D){if(T)return kp(u,f,y);f.flags|=128}if(D=f.memoizedState,D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),Je(Fn,Fn.current),T)break;return null;case 22:return f.lanes=0,um(u,f,y,f.pendingProps);case 24:fo(f,Wn,u.memoizedState.cache)}return sl(u,f,y)}function as(u,f,y){if(u!==null)if(u.memoizedProps!==f.pendingProps)pr=!0;else{if(!ed(u,y)&&(f.flags&128)===0)return pr=!1,td(u,f,y);pr=(u.flags&131072)!==0}else pr=!1,Pi&&(f.flags&1048576)!==0&&Hf(f,Qo,f.index);switch(f.lanes=0,f.tag){case 16:e:{var T=f.pendingProps;if(u=Hs(f.elementType),f.type=u,typeof u=="function")Lh(u)?(T=nl(u,T),f.tag=1,f=X_(null,f,u,T,y)):(f.tag=0,f=hm(null,f,u,T,y));else{if(u!=null){var D=u.$$typeof;if(D===Ve){f.tag=11,f=H_(null,f,u,T,y);break e}else if(D===wt){f.tag=14,f=Cp(null,f,u,T,y);break e}}throw f=Pt(u)||u,Error(s(306,f,""))}}return f;case 0:return hm(u,f,f.type,f.pendingProps,y);case 1:return T=f.type,D=nl(T,f.pendingProps),X_(u,f,T,D,y);case 3:e:{if(Qt(f,f.stateNode.containerInfo),u===null)throw Error(s(387));T=f.pendingProps;var L=f.memoizedState;D=L.element,$u(u,f),el(f,T,null,y);var q=f.memoizedState;if(T=q.cache,fo(f,Wn,T),T!==L.cache&&Nh(f,[Wn],y,!0),mo(),T=q.element,L.isDehydrated)if(L={element:T,isDehydrated:!1,cache:q.cache},f.updateQueue.baseState=L,f.memoizedState=L,f.flags&256){f=G_(u,f,T,y);break e}else if(T!==D){D=Wr(Error(s(424)),f),uo(D),f=G_(u,f,T,y);break e}else for(u=f.stateNode.containerInfo,u.nodeType===9?u=u.body:u=u.nodeName==="HTML"?u.ownerDocument.body:u,en=wa(u.firstChild),hr=f,Pi=!0,co=null,Ts=!0,y=Gf(f,null,T,y),f.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Ua(),T===D){f=sl(u,f,y);break e}Ar(u,f,T,y)}f=f.child}return f;case 26:return Pp(u,f),u===null?(y=Xm(f.type,null,f.pendingProps,null))?f.memoizedState=y:Pi||(y=f.type,u=f.pendingProps,T=wd($t.current).createElement(y),T[Hi]=f,T[Ct]=u,Cr(T,y,u),Ln(T),f.stateNode=T):f.memoizedState=Xm(f.type,u.memoizedProps,f.pendingProps,u.memoizedState),null;case 27:return Mi(f),u===null&&Pi&&(T=f.stateNode=My(f.type,f.pendingProps,$t.current),hr=f,Ts=!0,D=en,eu(f.type)?(Ds=D,en=wa(T.firstChild)):en=D),Ar(u,f,f.pendingProps.children,y),Pp(u,f),u===null&&(f.flags|=4194304),f.child;case 5:return u===null&&Pi&&((D=T=en)&&(T=Dr(T,f.type,f.pendingProps,Ts),T!==null?(f.stateNode=T,hr=f,en=wa(T.firstChild),Ts=!1,D=!0):D=!1),D||ts(f)),Mi(f),D=f.type,L=f.pendingProps,q=u!==null?u.memoizedProps:null,T=L.children,og(D,L)?T=null:q!==null&&og(D,q)&&(f.flags|=32),f.memoizedState!==null&&(D=jc(u,f,Zu,null,null,y),Rd._currentValue=D),Pp(u,f),Ar(u,f,T,y),f.child;case 6:return u===null&&Pi&&((u=y=en)&&(y=Ao(y,f.pendingProps,Ts),y!==null?(f.stateNode=y,hr=f,en=null,u=!0):u=!1),u||ts(f)),null;case 13:return fm(u,f,y);case 4:return Qt(f,f.stateNode.containerInfo),T=f.pendingProps,u===null?f.child=Xa(f,null,T,y):Ar(u,f,T,y),f.child;case 11:return H_(u,f,f.type,f.pendingProps,y);case 7:return Ar(u,f,f.pendingProps,y),f.child;case 8:return Ar(u,f,f.pendingProps.children,y),f.child;case 12:return Ar(u,f,f.pendingProps.children,y),f.child;case 10:return T=f.pendingProps,fo(f,f.type,T.value),Ar(u,f,T.children,y),f.child;case 9:return D=f.type._context,T=f.pendingProps.children,po(f),D=Yn(D),T=T(D),f.flags|=1,Ar(u,f,T,y),f.child;case 14:return Cp(u,f,f.type,f.pendingProps,y);case 15:return cm(u,f,f.type,f.pendingProps,y);case 19:return kp(u,f,y);case 31:return Mp(u,f,y);case 22:return um(u,f,y,f.pendingProps);case 24:return po(f),T=Yn(Wn),u===null?(D=Vh(),D===null&&(D=Sn,L=Ha(),D.pooledCache=L,L.refCount++,L!==null&&(D.pooledCacheLanes|=y),D=L),f.memoizedState={parent:T,cache:D},qh(f),fo(f,Wn,D)):((u.lanes&y)!==0&&($u(u,f),el(f,null,null,y),mo()),D=u.memoizedState,L=f.memoizedState,D.parent!==T?(D={parent:T,cache:T},f.memoizedState=D,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=D),fo(f,Wn,T)):(T=L.cache,fo(f,Wn,T),T!==D.cache&&Nh(f,[Wn],y,!0))),Ar(u,f,f.pendingProps.children,y),f.child;case 29:throw f.pendingProps}throw Error(s(156,f.tag))}function al(u){u.flags|=4}function id(u,f,y,T,D){if((f=(u.mode&32)!==0)&&(f=!1),f){if(u.flags|=16777216,(D&335544128)===D)if(u.stateNode.complete)u.flags|=8192;else if(Cm())u.flags|=8192;else throw da=Nt,Jo}else u.flags&=-16777217}function Z_(u,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!_g(f))if(Cm())u.flags|=8192;else throw da=Nt,Jo}function nd(u,f){f!==null&&(u.flags|=4),u.flags&16384&&(f=u.tag!==22?ii():536870912,u.lanes|=f,rh|=f)}function rd(u,f){if(!Pi)switch(u.tailMode){case"hidden":f=u.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?u.tail=null:y.sibling=null;break;case"collapsed":y=u.tail;for(var T=null;y!==null;)y.alternate!==null&&(T=y),y=y.sibling;T===null?f||u.tail===null?u.tail=null:u.tail.sibling=null:T.sibling=null}}function Vn(u){var f=u.alternate!==null&&u.alternate.child===u.child,y=0,T=0;if(f)for(var D=u.child;D!==null;)y|=D.lanes|D.childLanes,T|=D.subtreeFlags&65011712,T|=D.flags&65011712,D.return=u,D=D.sibling;else for(D=u.child;D!==null;)y|=D.lanes|D.childLanes,T|=D.subtreeFlags,T|=D.flags,D.return=u,D=D.sibling;return u.subtreeFlags|=T,u.childLanes=y,f}function Y_(u,f,y){var T=f.pendingProps;switch(Bc(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vn(f),null;case 1:return Vn(f),null;case 3:return y=f.stateNode,T=null,u!==null&&(T=u.memoizedState.cache),f.memoizedState.cache!==T&&(f.flags|=2048),$a(Wn),vi(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(u===null||u.child===null)&&(Na(f)?al(f):u===null||u.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Va())),Vn(f),null;case 26:var D=f.type,L=f.memoizedState;return u===null?(al(f),L!==null?(Vn(f),Z_(f,L)):(Vn(f),id(f,D,null,T,y))):L?L!==u.memoizedState?(al(f),Vn(f),Z_(f,L)):(Vn(f),f.flags&=-16777217):(u=u.memoizedProps,u!==T&&al(f),Vn(f),id(f,D,u,T,y)),null;case 27:if(Mr(f),y=$t.current,D=f.type,u!==null&&f.stateNode!=null)u.memoizedProps!==T&&al(f);else{if(!T){if(f.stateNode===null)throw Error(s(166));return Vn(f),null}u=gt.current,Na(f)?is(f):(u=My(D,T,y),f.stateNode=u,al(f))}return Vn(f),null;case 5:if(Mr(f),D=f.type,u!==null&&f.stateNode!=null)u.memoizedProps!==T&&al(f);else{if(!T){if(f.stateNode===null)throw Error(s(166));return Vn(f),null}if(L=gt.current,Na(f))is(f);else{var q=wd($t.current);switch(L){case 1:L=q.createElementNS("http://www.w3.org/2000/svg",D);break;case 2:L=q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;default:switch(D){case"svg":L=q.createElementNS("http://www.w3.org/2000/svg",D);break;case"math":L=q.createElementNS("http://www.w3.org/1998/Math/MathML",D);break;case"script":L=q.createElement("div"),L.innerHTML="<script><\/script>",L=L.removeChild(L.firstChild);break;case"select":L=typeof T.is=="string"?q.createElement("select",{is:T.is}):q.createElement("select"),T.multiple?L.multiple=!0:T.size&&(L.size=T.size);break;default:L=typeof T.is=="string"?q.createElement(D,{is:T.is}):q.createElement(D)}}L[Hi]=f,L[Ct]=T;e:for(q=f.child;q!==null;){if(q.tag===5||q.tag===6)L.appendChild(q.stateNode);else if(q.tag!==4&&q.tag!==27&&q.child!==null){q.child.return=q,q=q.child;continue}if(q===f)break e;for(;q.sibling===null;){if(q.return===null||q.return===f)break e;q=q.return}q.sibling.return=q.return,q=q.sibling}f.stateNode=L;e:switch(Cr(L,D,T),D){case"button":case"input":case"select":case"textarea":T=!!T.autoFocus;break e;case"img":T=!0;break e;default:T=!1}T&&al(f)}}return Vn(f),id(f,f.type,u===null?null:u.memoizedProps,f.pendingProps,y),null;case 6:if(u&&f.stateNode!=null)u.memoizedProps!==T&&al(f);else{if(typeof T!="string"&&f.stateNode===null)throw Error(s(166));if(u=$t.current,Na(f)){if(u=f.stateNode,y=f.memoizedProps,T=null,D=hr,D!==null)switch(D.tag){case 27:case 5:T=D.memoizedProps}u[Hi]=f,u=!!(u.nodeValue===y||T!==null&&T.suppressHydrationWarning===!0||Nm(u.nodeValue,y)),u||ts(f,!0)}else u=wd(u).createTextNode(T),u[Hi]=f,f.stateNode=u}return Vn(f),null;case 31:if(y=f.memoizedState,u===null||u.memoizedState!==null){if(T=Na(f),y!==null){if(u===null){if(!T)throw Error(s(318));if(u=f.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(s(557));u[Hi]=f}else Ua(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Vn(f),u=!1}else y=Va(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=y),u=!0;if(!u)return f.flags&256?(Mn(f),f):(Mn(f),null);if((f.flags&128)!==0)throw Error(s(558))}return Vn(f),null;case 13:if(T=f.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(D=Na(f),T!==null&&T.dehydrated!==null){if(u===null){if(!D)throw Error(s(318));if(D=f.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(s(317));D[Hi]=f}else Ua(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Vn(f),D=!1}else D=Va(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=D),D=!0;if(!D)return f.flags&256?(Mn(f),f):(Mn(f),null)}return Mn(f),(f.flags&128)!==0?(f.lanes=y,f):(y=T!==null,u=u!==null&&u.memoizedState!==null,y&&(T=f.child,D=null,T.alternate!==null&&T.alternate.memoizedState!==null&&T.alternate.memoizedState.cachePool!==null&&(D=T.alternate.memoizedState.cachePool.pool),L=null,T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(L=T.memoizedState.cachePool.pool),L!==D&&(T.flags|=2048)),y!==u&&y&&(f.child.flags|=8192),nd(f,f.updateQueue),Vn(f),null);case 4:return vi(),u===null&&zm(f.stateNode.containerInfo),Vn(f),null;case 10:return $a(f.type),Vn(f),null;case 19:if(Oe(Fn),T=f.memoizedState,T===null)return Vn(f),null;if(D=(f.flags&128)!==0,L=T.rendering,L===null)if(D)rd(T,!1);else{if(Qn!==0||u!==null&&(u.flags&128)!==0)for(u=f.child;u!==null;){if(L=Xu(u),L!==null){for(f.flags|=128,rd(T,!1),u=L.updateQueue,f.updateQueue=u,nd(f,u),f.subtreeFlags=0,u=y,y=f.child;y!==null;)xp(y,u),y=y.sibling;return Je(Fn,Fn.current&1|2),Pi&&lo(f,T.treeForkCount),f.child}u=u.sibling}T.tail!==null&&rr()>dd&&(f.flags|=128,D=!0,rd(T,!1),f.lanes=4194304)}else{if(!D)if(u=Xu(L),u!==null){if(f.flags|=128,D=!0,u=u.updateQueue,f.updateQueue=u,nd(f,u),rd(T,!0),T.tail===null&&T.tailMode==="hidden"&&!L.alternate&&!Pi)return Vn(f),null}else 2*rr()-T.renderingStartTime>dd&&y!==536870912&&(f.flags|=128,D=!0,rd(T,!1),f.lanes=4194304);T.isBackwards?(L.sibling=f.child,f.child=L):(u=T.last,u!==null?u.sibling=L:f.child=L,T.last=L)}return T.tail!==null?(u=T.tail,T.rendering=u,T.tail=u.sibling,T.renderingStartTime=rr(),u.sibling=null,y=Fn.current,Je(Fn,D?y&1|2:y&1),Pi&&lo(f,T.treeForkCount),u):(Vn(f),null);case 22:case 23:return Mn(f),Ul(),T=f.memoizedState!==null,u!==null?u.memoizedState!==null!==T&&(f.flags|=8192):T&&(f.flags|=8192),T?(y&536870912)!==0&&(f.flags&128)===0&&(Vn(f),f.subtreeFlags&6&&(f.flags|=8192)):Vn(f),y=f.updateQueue,y!==null&&nd(f,y.retryQueue),y=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),T=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==y&&(f.flags|=2048),u!==null&&Oe(ha),null;case 24:return y=null,u!==null&&(y=u.memoizedState.cache),f.memoizedState.cache!==y&&(f.flags|=2048),$a(Wn),Vn(f),null;case 25:return null;case 30:return null}throw Error(s(156,f.tag))}function h0(u,f){switch(Bc(f),f.tag){case 1:return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 3:return $a(Wn),vi(),u=f.flags,(u&65536)!==0&&(u&128)===0?(f.flags=u&-65537|128,f):null;case 26:case 27:case 5:return Mr(f),null;case 31:if(f.memoizedState!==null){if(Mn(f),f.alternate===null)throw Error(s(340));Ua()}return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 13:if(Mn(f),u=f.memoizedState,u!==null&&u.dehydrated!==null){if(f.alternate===null)throw Error(s(340));Ua()}return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 19:return Oe(Fn),null;case 4:return vi(),null;case 10:return $a(f.type),null;case 22:case 23:return Mn(f),Ul(),u!==null&&Oe(ha),u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 24:return $a(Wn),null;case 25:return null;default:return null}}function Lp(u,f){switch(Bc(f),f.tag){case 3:$a(Wn),vi();break;case 26:case 27:case 5:Mr(f);break;case 4:vi();break;case 31:f.memoizedState!==null&&Mn(f);break;case 13:Mn(f);break;case 19:Oe(Fn);break;case 10:$a(f.type);break;case 22:case 23:Mn(f),Ul(),u!==null&&Oe(ha);break;case 24:$a(Wn)}}function Qh(u,f){try{var y=f.updateQueue,T=y!==null?y.lastEffect:null;if(T!==null){var D=T.next;y=D;do{if((y.tag&u)===u){T=void 0;var L=y.create,q=y.inst;T=L(),q.destroy=T}y=y.next}while(y!==D)}}catch(ae){sn(f,f.return,ae)}}function Xl(u,f,y){try{var T=f.updateQueue,D=T!==null?T.lastEffect:null;if(D!==null){var L=D.next;T=L;do{if((T.tag&u)===u){var q=T.inst,ae=q.destroy;if(ae!==void 0){q.destroy=void 0,D=f;var De=y,rt=ae;try{rt()}catch(mt){sn(D,De,mt)}}}T=T.next}while(T!==L)}}catch(mt){sn(f,f.return,mt)}}function K_(u){var f=u.updateQueue;if(f!==null){var y=u.stateNode;try{Xh(f,y)}catch(T){sn(u,u.return,T)}}}function Q_(u,f,y){y.props=nl(u.type,u.memoizedProps),y.state=u.memoizedState;try{y.componentWillUnmount()}catch(T){sn(u,f,T)}}function sd(u,f){try{var y=u.ref;if(y!==null){switch(u.tag){case 26:case 27:case 5:var T=u.stateNode;break;case 30:T=u.stateNode;break;default:T=u.stateNode}typeof y=="function"?u.refCleanup=y(T):y.current=T}}catch(D){sn(u,f,D)}}function ba(u,f){var y=u.ref,T=u.refCleanup;if(y!==null)if(typeof T=="function")try{T()}catch(D){sn(u,f,D)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(D){sn(u,f,D)}else y.current=null}function Bp(u){var f=u.type,y=u.memoizedProps,T=u.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":y.autoFocus&&T.focus();break e;case"img":y.src?T.src=y.src:y.srcSet&&(T.srcset=y.srcSet)}}catch(D){sn(u,u.return,D)}}function zp(u,f,y){try{var T=u.stateNode;Ey(T,u.type,y,f),T[Ct]=f}catch(D){sn(u,u.return,D)}}function qc(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&eu(u.type)||u.tag===4}function eh(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||qc(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&eu(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function mm(u,f,y){var T=u.tag;if(T===5||T===6)u=u.stateNode,f?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(u,f):(f=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,f.appendChild(u),y=y._reactRootContainer,y!=null||f.onclick!==null||(f.onclick=ca));else if(T!==4&&(T===27&&eu(u.type)&&(y=u.stateNode,f=null),u=u.child,u!==null))for(mm(u,f,y),u=u.sibling;u!==null;)mm(u,f,y),u=u.sibling}function Fp(u,f,y){var T=u.tag;if(T===5||T===6)u=u.stateNode,f?y.insertBefore(u,f):y.appendChild(u);else if(T!==4&&(T===27&&eu(u.type)&&(y=u.stateNode),u=u.child,u!==null))for(Fp(u,f,y),u=u.sibling;u!==null;)Fp(u,f,y),u=u.sibling}function J_(u){var f=u.stateNode,y=u.memoizedProps;try{for(var T=u.type,D=f.attributes;D.length;)f.removeAttributeNode(D[0]);Cr(f,T,y),f[Hi]=u,f[Ct]=y}catch(L){sn(u,u.return,L)}}var Gl=!1,gr=!1,_m=!1,ey=typeof WeakSet=="function"?WeakSet:Set,mr=null;function f0(u,f){if(u=u.containerInfo,xd=nu,u=Ph(u),Iu(u)){if("selectionStart"in u)var y={start:u.selectionStart,end:u.selectionEnd};else e:{y=(y=u.ownerDocument)&&y.defaultView||window;var T=y.getSelection&&y.getSelection();if(T&&T.rangeCount!==0){y=T.anchorNode;var D=T.anchorOffset,L=T.focusNode;T=T.focusOffset;try{y.nodeType,L.nodeType}catch{y=null;break e}var q=0,ae=-1,De=-1,rt=0,mt=0,St=u,at=null;t:for(;;){for(var ht;St!==y||D!==0&&St.nodeType!==3||(ae=q+D),St!==L||T!==0&&St.nodeType!==3||(De=q+T),St.nodeType===3&&(q+=St.nodeValue.length),(ht=St.firstChild)!==null;)at=St,St=ht;for(;;){if(St===u)break t;if(at===y&&++rt===D&&(ae=q),at===L&&++mt===T&&(De=q),(ht=St.nextSibling)!==null)break;St=at,at=St.parentNode}St=ht}y=ae===-1||De===-1?null:{start:ae,end:De}}else y=null}y=y||{start:0,end:0}}else y=null;for(Um={focusedElem:u,selectionRange:y},nu=!1,mr=f;mr!==null;)if(f=mr,u=f.child,(f.subtreeFlags&1028)!==0&&u!==null)u.return=f,mr=u;else for(;mr!==null;){switch(f=mr,L=f.alternate,u=f.flags,f.tag){case 0:if((u&4)!==0&&(u=f.updateQueue,u=u!==null?u.events:null,u!==null))for(y=0;y<u.length;y++)D=u[y],D.ref.impl=D.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&L!==null){u=void 0,y=f,D=L.memoizedProps,L=L.memoizedState,T=y.stateNode;try{var Zt=nl(y.type,D);u=T.getSnapshotBeforeUpdate(Zt,L),T.__reactInternalSnapshotBeforeUpdate=u}catch(ui){sn(y,y.return,ui)}}break;case 3:if((u&1024)!==0){if(u=f.stateNode.containerInfo,y=u.nodeType,y===9)cl(u);else if(y===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":cl(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(s(163))}if(u=f.sibling,u!==null){u.return=f.return,mr=u;break}mr=f.return}}function ym(u,f,y){var T=y.flags;switch(y.tag){case 0:case 11:case 15:Ks(u,y),T&4&&Qh(5,y);break;case 1:if(Ks(u,y),T&4)if(u=y.stateNode,f===null)try{u.componentDidMount()}catch(q){sn(y,y.return,q)}else{var D=nl(y.type,f.memoizedProps);f=f.memoizedState;try{u.componentDidUpdate(D,f,u.__reactInternalSnapshotBeforeUpdate)}catch(q){sn(y,y.return,q)}}T&64&&K_(y),T&512&&sd(y,y.return);break;case 3:if(Ks(u,y),T&64&&(u=y.updateQueue,u!==null)){if(f=null,y.child!==null)switch(y.child.tag){case 27:case 5:f=y.child.stateNode;break;case 1:f=y.child.stateNode}try{Xh(u,f)}catch(q){sn(y,y.return,q)}}break;case 27:f===null&&T&4&&J_(y);case 26:case 5:Ks(u,y),f===null&&T&4&&Bp(y),T&512&&sd(y,y.return);break;case 12:Ks(u,y);break;case 31:Ks(u,y),T&4&&ad(u,y);break;case 13:Ks(u,y),T&4&&od(u,y),T&64&&(u=y.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(y=Pm.bind(null,y),yr(u,y))));break;case 22:if(T=y.memoizedState!==null||Gl,!T){f=f!==null&&f.memoizedState!==null||gr,D=Gl;var L=gr;Gl=T,(gr=f)&&!L?Zl(u,y,(y.subtreeFlags&8772)!==0):Ks(u,y),Gl=D,gr=L}break;case 30:break;default:Ks(u,y)}}function Jh(u){var f=u.alternate;f!==null&&(u.alternate=null,Jh(f)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(f=u.stateNode,f!==null&&bl(f)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Xn=null,Fi=!1;function Ys(u,f,y){for(y=y.child;y!==null;)vm(u,f,y),y=y.sibling}function vm(u,f,y){if(ee&&typeof ee.onCommitFiberUnmount=="function")try{ee.onCommitFiberUnmount(K,y)}catch{}switch(y.tag){case 26:gr||ba(y,f),Ys(u,f,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:gr||ba(y,f);var T=Xn,D=Fi;eu(y.type)&&(Xn=y.stateNode,Fi=!1),Ys(u,f,y),Td(y.stateNode),Xn=T,Fi=D;break;case 5:gr||ba(y,f);case 6:if(T=Xn,D=Fi,Xn=null,Ys(u,f,y),Xn=T,Fi=D,Xn!==null)if(Fi)try{(Xn.nodeType===9?Xn.body:Xn.nodeName==="HTML"?Xn.ownerDocument.body:Xn).removeChild(y.stateNode)}catch(L){sn(y,f,L)}else try{Xn.removeChild(y.stateNode)}catch(L){sn(y,f,L)}break;case 18:Xn!==null&&(Fi?(u=Xn,Cy(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,y.stateNode),mf(u)):Cy(Xn,y.stateNode));break;case 4:T=Xn,D=Fi,Xn=y.stateNode.containerInfo,Fi=!0,Ys(u,f,y),Xn=T,Fi=D;break;case 0:case 11:case 14:case 15:Xl(2,y,f),gr||Xl(4,y,f),Ys(u,f,y);break;case 1:gr||(ba(y,f),T=y.stateNode,typeof T.componentWillUnmount=="function"&&Q_(y,f,T)),Ys(u,f,y);break;case 21:Ys(u,f,y);break;case 22:gr=(T=gr)||y.memoizedState!==null,Ys(u,f,y),gr=T;break;default:Ys(u,f,y)}}function ad(u,f){if(f.memoizedState===null&&(u=f.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{mf(u)}catch(y){sn(f,f.return,y)}}}function od(u,f){if(f.memoizedState===null&&(u=f.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{mf(u)}catch(y){sn(f,f.return,y)}}function ld(u){switch(u.tag){case 31:case 13:case 19:var f=u.stateNode;return f===null&&(f=u.stateNode=new ey),f;case 22:return u=u.stateNode,f=u._retryCache,f===null&&(f=u._retryCache=new ey),f;default:throw Error(s(435,u.tag))}}function cd(u,f){var y=ld(u);f.forEach(function(T){if(!y.has(T)){y.add(T);var D=g0.bind(null,u,T);T.then(D,D)}})}function Ms(u,f){var y=f.deletions;if(y!==null)for(var T=0;T<y.length;T++){var D=y[T],L=u,q=f,ae=q;e:for(;ae!==null;){switch(ae.tag){case 27:if(eu(ae.type)){Xn=ae.stateNode,Fi=!1;break e}break;case 5:Xn=ae.stateNode,Fi=!1;break e;case 3:case 4:Xn=ae.stateNode.containerInfo,Fi=!0;break e}ae=ae.return}if(Xn===null)throw Error(s(160));vm(L,q,D),Xn=null,Fi=!1,L=D.alternate,L!==null&&(L.return=null),D.return=null}if(f.subtreeFlags&13886)for(f=f.child;f!==null;)Np(f,u),f=f.sibling}var Ps=null;function Np(u,f){var y=u.alternate,T=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:Ms(f,u),Er(u),T&4&&(Xl(3,u,u.return),Qh(3,u),Xl(5,u,u.return));break;case 1:Ms(f,u),Er(u),T&512&&(gr||y===null||ba(y,y.return)),T&64&&Gl&&(u=u.updateQueue,u!==null&&(T=u.callbacks,T!==null&&(y=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=y===null?T:y.concat(T))));break;case 26:var D=Ps;if(Ms(f,u),Er(u),T&512&&(gr||y===null||ba(y,y.return)),T&4){var L=y!==null?y.memoizedState:null;if(T=u.memoizedState,y===null)if(T===null)if(u.stateNode===null){e:{T=u.type,y=u.memoizedProps,D=D.ownerDocument||D;t:switch(T){case"title":L=D.getElementsByTagName("title")[0],(!L||L[fi]||L[Hi]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=D.createElement(T),D.head.insertBefore(L,D.querySelector("head > title"))),Cr(L,T,y),L[Hi]=u,Ln(L),T=L;break e;case"link":var q=Ad("link","href",D).get(T+(y.href||""));if(q){for(var ae=0;ae<q.length;ae++)if(L=q[ae],L.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&L.getAttribute("rel")===(y.rel==null?null:y.rel)&&L.getAttribute("title")===(y.title==null?null:y.title)&&L.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){q.splice(ae,1);break t}}L=D.createElement(T),Cr(L,T,y),D.head.appendChild(L);break;case"meta":if(q=Ad("meta","content",D).get(T+(y.content||""))){for(ae=0;ae<q.length;ae++)if(L=q[ae],L.getAttribute("content")===(y.content==null?null:""+y.content)&&L.getAttribute("name")===(y.name==null?null:y.name)&&L.getAttribute("property")===(y.property==null?null:y.property)&&L.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&L.getAttribute("charset")===(y.charSet==null?null:y.charSet)){q.splice(ae,1);break t}}L=D.createElement(T),Cr(L,T,y),D.head.appendChild(L);break;default:throw Error(s(468,T))}L[Hi]=u,Ln(L),T=L}u.stateNode=T}else Ed(D,u.type,u.stateNode);else u.stateNode=ch(D,T,u.memoizedProps);else L!==T?(L===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):L.count--,T===null?Ed(D,u.type,u.stateNode):ch(D,T,u.memoizedProps)):T===null&&u.stateNode!==null&&zp(u,u.memoizedProps,y.memoizedProps)}break;case 27:Ms(f,u),Er(u),T&512&&(gr||y===null||ba(y,y.return)),y!==null&&T&4&&zp(u,u.memoizedProps,y.memoizedProps);break;case 5:if(Ms(f,u),Er(u),T&512&&(gr||y===null||ba(y,y.return)),u.flags&32){D=u.stateNode;try{ao(D,"")}catch(Zt){sn(u,u.return,Zt)}}T&4&&u.stateNode!=null&&(D=u.memoizedProps,zp(u,D,y!==null?y.memoizedProps:D)),T&1024&&(_m=!0);break;case 6:if(Ms(f,u),Er(u),T&4){if(u.stateNode===null)throw Error(s(162));T=u.memoizedProps,y=u.stateNode;try{y.nodeValue=T}catch(Zt){sn(u,u.return,Zt)}}break;case 3:if(Sd=null,D=Ps,Ps=ic(f.containerInfo),Ms(f,u),Ps=D,Er(u),T&4&&y!==null&&y.memoizedState.isDehydrated)try{mf(f.containerInfo)}catch(Zt){sn(u,u.return,Zt)}_m&&(_m=!1,ud(u));break;case 4:T=Ps,Ps=ic(u.stateNode.containerInfo),Ms(f,u),Er(u),Ps=T;break;case 12:Ms(f,u),Er(u);break;case 31:Ms(f,u),Er(u),T&4&&(T=u.updateQueue,T!==null&&(u.updateQueue=null,cd(u,T)));break;case 13:Ms(f,u),Er(u),u.child.flags&8192&&u.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(jp=rr()),T&4&&(T=u.updateQueue,T!==null&&(u.updateQueue=null,cd(u,T)));break;case 22:D=u.memoizedState!==null;var De=y!==null&&y.memoizedState!==null,rt=Gl,mt=gr;if(Gl=rt||D,gr=mt||De,Ms(f,u),gr=mt,Gl=rt,Er(u),T&8192)e:for(f=u.stateNode,f._visibility=D?f._visibility&-2:f._visibility|1,D&&(y===null||De||Gl||gr||wo(u)),y=null,f=u;;){if(f.tag===5||f.tag===26){if(y===null){De=y=f;try{if(L=De.stateNode,D)q=L.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{ae=De.stateNode;var St=De.memoizedProps.style,at=St!=null&&St.hasOwnProperty("display")?St.display:null;ae.style.display=at==null||typeof at=="boolean"?"":(""+at).trim()}}catch(Zt){sn(De,De.return,Zt)}}}else if(f.tag===6){if(y===null){De=f;try{De.stateNode.nodeValue=D?"":De.memoizedProps}catch(Zt){sn(De,De.return,Zt)}}}else if(f.tag===18){if(y===null){De=f;try{var ht=De.stateNode;D?Xi(ht,!0):Xi(De.stateNode,!1)}catch(Zt){sn(De,De.return,Zt)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===u)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break e;for(;f.sibling===null;){if(f.return===null||f.return===u)break e;y===f&&(y=null),f=f.return}y===f&&(y=null),f.sibling.return=f.return,f=f.sibling}T&4&&(T=u.updateQueue,T!==null&&(y=T.retryQueue,y!==null&&(T.retryQueue=null,cd(u,y))));break;case 19:Ms(f,u),Er(u),T&4&&(T=u.updateQueue,T!==null&&(u.updateQueue=null,cd(u,T)));break;case 30:break;case 21:break;default:Ms(f,u),Er(u)}}function Er(u){var f=u.flags;if(f&2){try{for(var y,T=u.return;T!==null;){if(qc(T)){y=T;break}T=T.return}if(y==null)throw Error(s(160));switch(y.tag){case 27:var D=y.stateNode,L=eh(u);Fp(u,L,D);break;case 5:var q=y.stateNode;y.flags&32&&(ao(q,""),y.flags&=-33);var ae=eh(u);Fp(u,ae,q);break;case 3:case 4:var De=y.stateNode.containerInfo,rt=eh(u);mm(u,rt,De);break;default:throw Error(s(161))}}catch(mt){sn(u,u.return,mt)}u.flags&=-3}f&4096&&(u.flags&=-4097)}function ud(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var f=u;ud(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),u=u.sibling}}function Ks(u,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)ym(u,f.alternate,f),f=f.sibling}function wo(u){for(u=u.child;u!==null;){var f=u;switch(f.tag){case 0:case 11:case 14:case 15:Xl(4,f,f.return),wo(f);break;case 1:ba(f,f.return);var y=f.stateNode;typeof y.componentWillUnmount=="function"&&Q_(f,f.return,y),wo(f);break;case 27:Td(f.stateNode);case 26:case 5:ba(f,f.return),wo(f);break;case 22:f.memoizedState===null&&wo(f);break;case 30:wo(f);break;default:wo(f)}u=u.sibling}}function Zl(u,f,y){for(y=y&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var T=f.alternate,D=u,L=f,q=L.flags;switch(L.tag){case 0:case 11:case 15:Zl(D,L,y),Qh(4,L);break;case 1:if(Zl(D,L,y),T=L,D=T.stateNode,typeof D.componentDidMount=="function")try{D.componentDidMount()}catch(rt){sn(T,T.return,rt)}if(T=L,D=T.updateQueue,D!==null){var ae=T.stateNode;try{var De=D.shared.hiddenCallbacks;if(De!==null)for(D.shared.hiddenCallbacks=null,D=0;D<De.length;D++)Hu(De[D],ae)}catch(rt){sn(T,T.return,rt)}}y&&q&64&&K_(L),sd(L,L.return);break;case 27:J_(L);case 26:case 5:Zl(D,L,y),y&&T===null&&q&4&&Bp(L),sd(L,L.return);break;case 12:Zl(D,L,y);break;case 31:Zl(D,L,y),y&&q&4&&ad(D,L);break;case 13:Zl(D,L,y),y&&q&4&&od(D,L);break;case 22:L.memoizedState===null&&Zl(D,L,y),sd(L,L.return);break;case 30:break;default:Zl(D,L,y)}f=f.sibling}}function Up(u,f){var y=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),u=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(u=f.memoizedState.cachePool.pool),u!==y&&(u!=null&&u.refCount++,y!=null&&Fc(y))}function Yl(u,f){u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&Fc(u))}function To(u,f,y,T){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)bm(u,f,y,T),f=f.sibling}function bm(u,f,y,T){var D=f.flags;switch(f.tag){case 0:case 11:case 15:To(u,f,y,T),D&2048&&Qh(9,f);break;case 1:To(u,f,y,T);break;case 3:To(u,f,y,T),D&2048&&(u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&Fc(u)));break;case 12:if(D&2048){To(u,f,y,T),u=f.stateNode;try{var L=f.memoizedProps,q=L.id,ae=L.onPostCommit;typeof ae=="function"&&ae(q,f.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(De){sn(f,f.return,De)}}else To(u,f,y,T);break;case 31:To(u,f,y,T);break;case 13:To(u,f,y,T);break;case 23:break;case 22:L=f.stateNode,q=f.alternate,f.memoizedState!==null?L._visibility&2?To(u,f,y,T):th(u,f):L._visibility&2?To(u,f,y,T):(L._visibility|=2,ol(u,f,y,T,(f.subtreeFlags&10256)!==0||!1)),D&2048&&Up(q,f);break;case 24:To(u,f,y,T),D&2048&&Yl(f.alternate,f);break;default:To(u,f,y,T)}}function ol(u,f,y,T,D){for(D=D&&((f.subtreeFlags&10256)!==0||!1),f=f.child;f!==null;){var L=u,q=f,ae=y,De=T,rt=q.flags;switch(q.tag){case 0:case 11:case 15:ol(L,q,ae,De,D),Qh(8,q);break;case 23:break;case 22:var mt=q.stateNode;q.memoizedState!==null?mt._visibility&2?ol(L,q,ae,De,D):th(L,q):(mt._visibility|=2,ol(L,q,ae,De,D)),D&&rt&2048&&Up(q.alternate,q);break;case 24:ol(L,q,ae,De,D),D&&rt&2048&&Yl(q.alternate,q);break;default:ol(L,q,ae,De,D)}f=f.sibling}}function th(u,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var y=u,T=f,D=T.flags;switch(T.tag){case 22:th(y,T),D&2048&&Up(T.alternate,T);break;case 24:th(y,T),D&2048&&Yl(T.alternate,T);break;default:th(y,T)}f=f.sibling}}var ef=8192;function ih(u,f,y){if(u.subtreeFlags&ef)for(u=u.child;u!==null;)ty(u,f,y),u=u.sibling}function ty(u,f,y){switch(u.tag){case 26:ih(u,f,y),u.flags&ef&&u.memoizedState!==null&&Ym(y,Ps,u.memoizedState,u.memoizedProps);break;case 5:ih(u,f,y);break;case 3:case 4:var T=Ps;Ps=ic(u.stateNode.containerInfo),ih(u,f,y),Ps=T;break;case 22:u.memoizedState===null&&(T=u.alternate,T!==null&&T.memoizedState!==null?(T=ef,ef=16777216,ih(u,f,y),ef=T):ih(u,f,y));break;default:ih(u,f,y)}}function iy(u){var f=u.alternate;if(f!==null&&(u=f.child,u!==null)){f.child=null;do f=u.sibling,u.sibling=null,u=f;while(u!==null)}}function hd(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var T=f[y];mr=T,tf(T,u)}iy(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)ny(u),u=u.sibling}function ny(u){switch(u.tag){case 0:case 11:case 15:hd(u),u.flags&2048&&Xl(9,u,u.return);break;case 3:hd(u);break;case 12:hd(u);break;case 22:var f=u.stateNode;u.memoizedState!==null&&f._visibility&2&&(u.return===null||u.return.tag!==13)?(f._visibility&=-3,Vp(u)):hd(u);break;default:hd(u)}}function Vp(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var y=0;y<f.length;y++){var T=f[y];mr=T,tf(T,u)}iy(u)}for(u=u.child;u!==null;){switch(f=u,f.tag){case 0:case 11:case 15:Xl(8,f,f.return),Vp(f);break;case 22:y=f.stateNode,y._visibility&2&&(y._visibility&=-3,Vp(f));break;default:Vp(f)}u=u.sibling}}function tf(u,f){for(;mr!==null;){var y=mr;switch(y.tag){case 0:case 11:case 15:Xl(8,y,f);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var T=y.memoizedState.cachePool.pool;T!=null&&T.refCount++}break;case 24:Fc(y.memoizedState.cache)}if(T=y.child,T!==null)T.return=y,mr=T;else e:for(y=u;mr!==null;){T=mr;var D=T.sibling,L=T.return;if(Jh(T),T===y){mr=null;break e}if(D!==null){D.return=L,mr=D;break e}mr=L}}}var d0={getCacheForType:function(u){var f=Yn(Wn),y=f.data.get(u);return y===void 0&&(y=u(),f.data.set(u,y)),y},cacheSignal:function(){return Yn(Wn).controller.signal}},ry=typeof WeakMap=="function"?WeakMap:Map,rn=0,Sn=null,Di=null,Oi=0,cn=0,Is=null,Ja=!1,Xc=!1,xm=!1,Kl=0,Qn=0,Ql=0,nh=0,wm=0,qr=0,rh=0,fd=null,Qs=null,Tm=!1,jp=0,sy=0,dd=1/0,nf=null,Jl=null,_r=0,ec=null,rf=null,eo=0,Sm=0,$p=null,ay=null,pd=0,Am=null;function Js(){return(rn&2)!==0&&Oi!==0?Oi&-Oi:re.T!==null?km():Li()}function oy(){if(qr===0)if((Oi&536870912)===0||Pi){var u=yt;yt<<=1,(yt&3932160)===0&&(yt=262144),qr=u}else qr=536870912;return u=Ut.current,u!==null&&(u.flags|=32),qr}function ea(u,f,y){(u===Sn&&(cn===2||cn===9)||u.cancelPendingCommit!==null)&&(af(u,0),Gc(u,Oi,qr,!1)),oi(u,y),((rn&2)===0||u!==Sn)&&(u===Sn&&((rn&2)===0&&(nh|=y),Qn===4&&Gc(u,Oi,qr,!1)),So(u))}function cr(u,f,y){if((rn&6)!==0)throw Error(s(327));var T=!y&&(f&127)===0&&(f&u.expiredLanes)===0||ai(u,f),D=T?of(u,f):qp(u,f,!0),L=T;do{if(D===0){Xc&&!T&&Gc(u,f,0,!1);break}else{if(y=u.current.alternate,L&&!p0(y)){D=qp(u,f,!1),L=!1;continue}if(D===2){if(L=f,u.errorRecoveryDisabledLanes&L)var q=0;else q=u.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){f=q;e:{var ae=u;D=fd;var De=ae.current.memoizedState.isDehydrated;if(De&&(af(ae,q).flags|=256),q=qp(ae,q,!1),q!==2){if(xm&&!De){ae.errorRecoveryDisabledLanes|=L,nh|=L,D=4;break e}L=Qs,Qs=D,L!==null&&(Qs===null?Qs=L:Qs.push.apply(Qs,L))}D=q}if(L=!1,D!==2)continue}}if(D===1){af(u,0),Gc(u,f,0,!0);break}e:{switch(T=u,L=D,L){case 0:case 1:throw Error(s(345));case 4:if((f&4194048)!==f)break;case 6:Gc(T,f,qr,!Ja);break e;case 2:Qs=null;break;case 3:case 5:break;default:throw Error(s(329))}if((f&62914560)===f&&(D=jp+300-rr(),10<D)){if(Gc(T,f,qr,!Ja),Wt(T,0,!0)!==0)break e;eo=f,T.timeoutHandle=cg(sf.bind(null,T,y,Qs,nf,Tm,f,qr,nh,rh,Ja,L,"Throttled",-0,0),D);break e}sf(T,y,Qs,nf,Tm,f,qr,nh,rh,Ja,L,null,-0,0)}}break}while(!0);So(u)}function sf(u,f,y,T,D,L,q,ae,De,rt,mt,St,at,ht){if(u.timeoutHandle=-1,St=f.subtreeFlags,St&8192||(St&16785408)===16785408){St={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ca},ty(f,L,St);var Zt=(L&62914560)===L?jp-rr():(L&4194048)===L?sy-rr():0;if(Zt=Ry(St,Zt),Zt!==null){eo=L,u.cancelPendingCommit=Zt(fy.bind(null,u,f,L,y,T,D,q,ae,De,mt,St,null,at,ht)),Gc(u,L,q,!rt);return}}fy(u,f,L,y,T,D,q,ae,De)}function p0(u){for(var f=u;;){var y=f.tag;if((y===0||y===11||y===15)&&f.flags&16384&&(y=f.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var T=0;T<y.length;T++){var D=y[T],L=D.getSnapshot;D=D.value;try{if(!Jr(L(),D))return!1}catch{return!1}}if(y=f.child,f.subtreeFlags&16384&&y!==null)y.return=f,f=y;else{if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Gc(u,f,y,T){f&=~wm,f&=~nh,u.suspendedLanes|=f,u.pingedLanes&=~f,T&&(u.warmLanes|=f),T=u.expirationTimes;for(var D=f;0<D;){var L=31-Me(D),q=1<<L;T[L]=-1,D&=~q}y!==0&&kn(u,y,f)}function gd(){return(rn&6)===0?(xa(0),!1):!0}function Hp(){if(Di!==null){if(cn===0)var u=Di.return;else u=Di,ja=$s=null,vo(u),Wa=null,Fl=0,u=Di;for(;u!==null;)Lp(u.alternate,u),u=u.return;Di=null}}function af(u,f){var y=u.timeoutHandle;y!==-1&&(u.timeoutHandle=-1,jm(y)),y=u.cancelPendingCommit,y!==null&&(u.cancelPendingCommit=null,y()),eo=0,Hp(),Sn=u,Di=y=ws(u.current,null),Oi=f,cn=0,Is=null,Ja=!1,Xc=ai(u,f),xm=!1,rh=qr=wm=nh=Ql=Qn=0,Qs=fd=null,Tm=!1,(f&8)!==0&&(f|=f&32);var T=u.entangledLanes;if(T!==0)for(u=u.entanglements,T&=f;0<T;){var D=31-Me(T),L=1<<D;f|=u[D],T&=~L}return Kl=f,kl(),y}function Em(u,f){Ti=null,re.H=qi,f===fa||f===ns?(f=Uc(),cn=3):f===Jo?(f=Uc(),cn=4):cn=f===Ep?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Is=f,Di===null&&(Qn=1,va(u,Wr(f,u.current)))}function Cm(){var u=Ut.current;return u===null?!0:(Oi&4194048)===Oi?Xt===null:(Oi&62914560)===Oi||(Oi&536870912)!==0?u===Xt:!1}function sh(){var u=re.H;return re.H=qi,u===null?qi:u}function Wp(){var u=re.A;return re.A=d0,u}function md(){Qn=4,Ja||(Oi&4194048)!==Oi&&Ut.current!==null||(Xc=!0),(Ql&134217727)===0&&(nh&134217727)===0||Sn===null||Gc(Sn,Oi,qr,!1)}function qp(u,f,y){var T=rn;rn|=2;var D=sh(),L=Wp();(Sn!==u||Oi!==f)&&(nf=null,af(u,f)),f=!1;var q=Qn;e:do try{if(cn!==0&&Di!==null){var ae=Di,De=Is;switch(cn){case 8:Hp(),q=6;break e;case 3:case 2:case 9:case 6:Ut.current===null&&(f=!0);var rt=cn;if(cn=0,Is=null,lf(u,ae,De,rt),y&&Xc){q=0;break e}break;default:rt=cn,cn=0,Is=null,lf(u,ae,De,rt)}}Xp(),q=Qn;break}catch(mt){Em(u,mt)}while(!0);return f&&u.shellSuspendCounter++,ja=$s=null,rn=T,re.H=D,re.A=L,Di===null&&(Sn=null,Oi=0,kl()),q}function Xp(){for(;Di!==null;)cy(Di)}function of(u,f){var y=rn;rn|=2;var T=sh(),D=Wp();Sn!==u||Oi!==f?(nf=null,dd=rr()+500,af(u,f)):Xc=ai(u,f);e:do try{if(cn!==0&&Di!==null){f=Di;var L=Is;t:switch(cn){case 1:cn=0,Is=null,lf(u,f,L,1);break;case 2:case 9:if(Uu(L)){cn=0,Is=null,uy(f);break}f=function(){cn!==2&&cn!==9||Sn!==u||(cn=7),So(u)},L.then(f,f);break e;case 3:cn=7;break e;case 4:cn=5;break e;case 7:Uu(L)?(cn=0,Is=null,uy(f)):(cn=0,Is=null,lf(u,f,L,7));break;case 5:var q=null;switch(Di.tag){case 26:q=Di.memoizedState;case 5:case 27:var ae=Di;if(q?_g(q):ae.stateNode.complete){cn=0,Is=null;var De=ae.sibling;if(De!==null)Di=De;else{var rt=ae.return;rt!==null?(Di=rt,Gp(rt)):Di=null}break t}}cn=0,Is=null,lf(u,f,L,5);break;case 6:cn=0,Is=null,lf(u,f,L,6);break;case 8:Hp(),Qn=6;break e;default:throw Error(s(462))}}ly();break}catch(mt){Em(u,mt)}while(!0);return ja=$s=null,re.H=T,re.A=D,rn=y,Di!==null?0:(Sn=null,Oi=0,kl(),Qn)}function ly(){for(;Di!==null&&!oa();)cy(Di)}function cy(u){var f=as(u.alternate,u,Kl);u.memoizedProps=u.pendingProps,f===null?Gp(u):Di=f}function uy(u){var f=u,y=f.alternate;switch(f.tag){case 15:case 0:f=q_(y,f,f.pendingProps,f.type,void 0,Oi);break;case 11:f=q_(y,f,f.pendingProps,f.type.render,f.ref,Oi);break;case 5:vo(f);default:Lp(y,f),f=Di=xp(f,Kl),f=as(y,f,Kl)}u.memoizedProps=u.pendingProps,f===null?Gp(u):Di=f}function lf(u,f,y,T){ja=$s=null,vo(f),Wa=null,Fl=0;var D=f.return;try{if(Ap(u,D,f,y,Oi)){Qn=1,va(u,Wr(y,u.current)),Di=null;return}}catch(L){if(D!==null)throw Di=D,L;Qn=1,va(u,Wr(y,u.current)),Di=null;return}f.flags&32768?(Pi||T===1?u=!0:Xc||(Oi&536870912)!==0?u=!1:(Ja=u=!0,(T===2||T===9||T===3||T===6)&&(T=Ut.current,T!==null&&T.tag===13&&(T.flags|=16384))),hy(f,u)):Gp(f)}function Gp(u){var f=u;do{if((f.flags&32768)!==0){hy(f,Ja);return}u=f.return;var y=Y_(f.alternate,f,Kl);if(y!==null){Di=y;return}if(f=f.sibling,f!==null){Di=f;return}Di=f=u}while(f!==null);Qn===0&&(Qn=5)}function hy(u,f){do{var y=h0(u.alternate,u);if(y!==null){y.flags&=32767,Di=y;return}if(y=u.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!f&&(u=u.sibling,u!==null)){Di=u;return}Di=u=y}while(u!==null);Qn=6,Di=null}function fy(u,f,y,T,D,L,q,ae,De){u.cancelPendingCommit=null;do Zp();while(_r!==0);if((rn&6)!==0)throw Error(s(327));if(f!==null){if(f===u.current)throw Error(s(177));if(L=f.lanes|f.childLanes,L|=Ol,_n(u,y,L,q,ae,De),u===Sn&&(Di=Sn=null,Oi=0),rf=f,ec=u,eo=y,Sm=L,$p=D,ay=T,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,yy(no,function(){return _y(),null})):(u.callbackNode=null,u.callbackPriority=0),T=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||T){T=re.T,re.T=null,D=be.p,be.p=2,q=rn,rn|=4;try{f0(u,f,y)}finally{rn=q,be.p=D,re.T=T}}_r=1,dy(),py(),gy()}}function dy(){if(_r===1){_r=0;var u=ec,f=rf,y=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||y){y=re.T,re.T=null;var T=be.p;be.p=2;var D=rn;rn|=4;try{Np(f,u);var L=Um,q=Ph(u.containerInfo),ae=L.focusedElem,De=L.selectionRange;if(q!==ae&&ae&&ae.ownerDocument&&Mh(ae.ownerDocument.documentElement,ae)){if(De!==null&&Iu(ae)){var rt=De.start,mt=De.end;if(mt===void 0&&(mt=rt),"selectionStart"in ae)ae.selectionStart=rt,ae.selectionEnd=Math.min(mt,ae.value.length);else{var St=ae.ownerDocument||document,at=St&&St.defaultView||window;if(at.getSelection){var ht=at.getSelection(),Zt=ae.textContent.length,ui=Math.min(De.start,Zt),an=De.end===void 0?ui:Math.min(De.end,Zt);!ht.extend&&ui>an&&(q=an,an=ui,ui=q);var He=Pu(ae,ui),Le=Pu(ae,an);if(He&&Le&&(ht.rangeCount!==1||ht.anchorNode!==He.node||ht.anchorOffset!==He.offset||ht.focusNode!==Le.node||ht.focusOffset!==Le.offset)){var it=St.createRange();it.setStart(He.node,He.offset),ht.removeAllRanges(),ui>an?(ht.addRange(it),ht.extend(Le.node,Le.offset)):(it.setEnd(Le.node,Le.offset),ht.addRange(it))}}}}for(St=[],ht=ae;ht=ht.parentNode;)ht.nodeType===1&&St.push({element:ht,left:ht.scrollLeft,top:ht.scrollTop});for(typeof ae.focus=="function"&&ae.focus(),ae=0;ae<St.length;ae++){var vt=St[ae];vt.element.scrollLeft=vt.left,vt.element.scrollTop=vt.top}}nu=!!xd,Um=xd=null}finally{rn=D,be.p=T,re.T=y}}u.current=f,_r=2}}function py(){if(_r===2){_r=0;var u=ec,f=rf,y=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||y){y=re.T,re.T=null;var T=be.p;be.p=2;var D=rn;rn|=4;try{ym(u,f.alternate,f)}finally{rn=D,be.p=T,re.T=y}}_r=3}}function gy(){if(_r===4||_r===3){_r=0,yc();var u=ec,f=rf,y=eo,T=ay;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?_r=5:(_r=0,rf=ec=null,my(u,u.pendingLanes));var D=u.pendingLanes;if(D===0&&(Jl=null),Tt(y),f=f.stateNode,ee&&typeof ee.onCommitFiberRoot=="function")try{ee.onCommitFiberRoot(K,f,void 0,(f.current.flags&128)===128)}catch{}if(T!==null){f=re.T,D=be.p,be.p=2,re.T=null;try{for(var L=u.onRecoverableError,q=0;q<T.length;q++){var ae=T[q];L(ae.value,{componentStack:ae.stack})}}finally{re.T=f,be.p=D}}(eo&3)!==0&&Zp(),So(u),D=u.pendingLanes,(y&261930)!==0&&(D&42)!==0?u===Am?pd++:(pd=0,Am=u):pd=0,xa(0)}}function my(u,f){(u.pooledCacheLanes&=f)===0&&(f=u.pooledCache,f!=null&&(u.pooledCache=null,Fc(f)))}function Zp(){return dy(),py(),gy(),_y()}function _y(){if(_r!==5)return!1;var u=ec,f=Sm;Sm=0;var y=Tt(eo),T=re.T,D=be.p;try{be.p=32>y?32:y,re.T=null,y=$p,$p=null;var L=ec,q=eo;if(_r=0,rf=ec=null,eo=0,(rn&6)!==0)throw Error(s(331));var ae=rn;if(rn|=4,ny(L.current),bm(L,L.current,q,y),rn=ae,xa(0,!1),ee&&typeof ee.onPostCommitFiberRoot=="function")try{ee.onPostCommitFiberRoot(K,L)}catch{}return!0}finally{be.p=D,re.T=T,my(u,f)}}function Mm(u,f,y){f=Wr(y,f),f=Ku(u.stateNode,f,2),u=go(u,f,2),u!==null&&(oi(u,2),So(u))}function sn(u,f,y){if(u.tag===3)Mm(u,u,y);else for(;f!==null;){if(f.tag===3){Mm(f,u,y);break}else if(f.tag===1){var T=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(Jl===null||!Jl.has(T))){u=Wr(y,u),y=Qu(2),T=go(f,y,2),T!==null&&(Ju(y,T,f,u),oi(T,2),So(T));break}}f=f.return}}function Yp(u,f,y){var T=u.pingCache;if(T===null){T=u.pingCache=new ry;var D=new Set;T.set(f,D)}else D=T.get(f),D===void 0&&(D=new Set,T.set(f,D));D.has(y)||(xm=!0,D.add(y),u=Zc.bind(null,u,f,y),f.then(u,u))}function Zc(u,f,y){var T=u.pingCache;T!==null&&T.delete(f),u.pingedLanes|=u.suspendedLanes&y,u.warmLanes&=~y,Sn===u&&(Oi&y)===y&&(Qn===4||Qn===3&&(Oi&62914560)===Oi&&300>rr()-jp?(rn&2)===0&&af(u,0):wm|=y,rh===Oi&&(rh=0)),So(u)}function _d(u,f){f===0&&(f=ii()),u=js(u,f),u!==null&&(oi(u,f),So(u))}function Pm(u){var f=u.memoizedState,y=0;f!==null&&(y=f.retryLane),_d(u,y)}function g0(u,f){var y=0;switch(u.tag){case 31:case 13:var T=u.stateNode,D=u.memoizedState;D!==null&&(y=D.retryLane);break;case 19:T=u.stateNode;break;case 22:T=u.stateNode._retryCache;break;default:throw Error(s(314))}T!==null&&T.delete(f),_d(u,y)}function yy(u,f){return to(u,f)}var Kp=null,cf=null,Im=!1,Qp=!1,Rm=!1,tc=0;function So(u){u!==cf&&u.next===null&&(cf===null?Kp=cf=u:cf=cf.next=u),Qp=!0,Im||(Im=!0,Om())}function xa(u,f){if(!Rm&&Qp){Rm=!0;do for(var y=!1,T=Kp;T!==null;){if(u!==0){var D=T.pendingLanes;if(D===0)var L=0;else{var q=T.suspendedLanes,ae=T.pingedLanes;L=(1<<31-Me(42|u)+1)-1,L&=D&~(q&~ae),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(y=!0,yd(T,L))}else L=Oi,L=Wt(T,T===Sn?L:0,T.cancelPendingCommit!==null||T.timeoutHandle!==-1),(L&3)===0||ai(T,L)||(y=!0,yd(T,L));T=T.next}while(y);Rm=!1}}function Yc(){Dm()}function Dm(){Qp=Im=!1;var u=0;tc!==0&&lg()&&(u=tc);for(var f=rr(),y=null,T=Kp;T!==null;){var D=T.next,L=Jp(T,f);L===0?(T.next=null,y===null?Kp=D:y.next=D,D===null&&(cf=y)):(y=T,(u!==0||(L&3)!==0)&&(Qp=!0)),T=D}_r!==0&&_r!==5||xa(u),tc!==0&&(tc=0)}function Jp(u,f){for(var y=u.suspendedLanes,T=u.pingedLanes,D=u.expirationTimes,L=u.pendingLanes&-62914561;0<L;){var q=31-Me(L),ae=1<<q,De=D[q];De===-1?((ae&y)===0||(ae&T)!==0)&&(D[q]=Jt(ae,f)):De<=f&&(u.expiredLanes|=ae),L&=~ae}if(f=Sn,y=Oi,y=Wt(u,u===f?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),T=u.callbackNode,y===0||u===f&&(cn===2||cn===9)||u.cancelPendingCommit!==null)return T!==null&&T!==null&&Ca(T),u.callbackNode=null,u.callbackPriority=0;if((y&3)===0||ai(u,y)){if(f=y&-y,f===u.callbackPriority)return f;switch(T!==null&&Ca(T),Tt(y)){case 2:case 8:y=io;break;case 32:y=no;break;case 268435456:y=Lo;break;default:y=no}return T=vy.bind(null,u),y=to(y,T),u.callbackPriority=f,u.callbackNode=y,f}return T!==null&&T!==null&&Ca(T),u.callbackPriority=2,u.callbackNode=null,2}function vy(u,f){if(_r!==0&&_r!==5)return u.callbackNode=null,u.callbackPriority=0,null;var y=u.callbackNode;if(Zp()&&u.callbackNode!==y)return null;var T=Oi;return T=Wt(u,u===Sn?T:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),T===0?null:(cr(u,T,f),Jp(u,rr()),u.callbackNode!=null&&u.callbackNode===y?vy.bind(null,u):null)}function yd(u,f){if(Zp())return null;cr(u,f,!0)}function Om(){Hm(function(){(rn&6)!==0?to(vc,Yc):Dm()})}function km(){if(tc===0){var u=zl;u===0&&(u=qe,qe<<=1,(qe&261888)===0&&(qe=256)),tc=u}return tc}function eg(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:mi(""+u)}function tg(u,f){var y=f.ownerDocument.createElement("input");return y.name=f.name,y.value=f.value,u.id&&y.setAttribute("form",u.id),f.parentNode.insertBefore(y,f),u=new FormData(u),y.parentNode.removeChild(y),u}function uf(u,f,y,T,D){if(f==="submit"&&y&&y.stateNode===D){var L=eg((D[Ct]||null).action),q=T.submitter;q&&(f=(f=q[Ct]||null)?eg(f.formAction):q.getAttribute("formAction"),f!==null&&(L=f,q=null));var ae=new yu("action","action",null,T,D);u.push({event:ae,listeners:[{instance:null,listener:function(){if(T.defaultPrevented){if(tc!==0){var De=q?tg(D,q):new FormData(D);Nn(y,{pending:!0,data:De,method:D.method,action:L},null,De)}}else typeof L=="function"&&(ae.preventDefault(),De=q?tg(D,q):new FormData(D),Nn(y,{pending:!0,data:De,method:D.method,action:L},L,De))},currentTarget:D}]})}}for(var ig=0;ig<Oh.length;ig++){var ng=Oh[ig],Lm=ng.toLowerCase(),by=ng[0].toUpperCase()+ng.slice(1);bs(Lm,"on"+by)}bs(Ou,"onAnimationEnd"),bs(ku,"onAnimationIteration"),bs(Dh,"onAnimationStart"),bs("dblclick","onDoubleClick"),bs("focusin","onFocus"),bs("focusout","onBlur"),bs(Dl,"onTransitionRun"),bs(Lu,"onTransitionStart"),bs(Oc,"onTransitionCancel"),bs(vs,"onTransitionEnd"),so("onMouseEnter",["mouseout","mouseover"]),so("onMouseLeave",["mouseout","mouseover"]),so("onPointerEnter",["pointerout","pointerover"]),so("onPointerLeave",["pointerout","pointerover"]),Ii("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ii("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ii("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ii("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ii("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ii("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xy=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Kc));function wy(u,f){f=(f&4)!==0;for(var y=0;y<u.length;y++){var T=u[y],D=T.event;T=T.listeners;e:{var L=void 0;if(f)for(var q=T.length-1;0<=q;q--){var ae=T[q],De=ae.instance,rt=ae.currentTarget;if(ae=ae.listener,De!==L&&D.isPropagationStopped())break e;L=ae,D.currentTarget=rt;try{L(D)}catch(mt){Ba(mt)}D.currentTarget=null,L=De}else for(q=0;q<T.length;q++){if(ae=T[q],De=ae.instance,rt=ae.currentTarget,ae=ae.listener,De!==L&&D.isPropagationStopped())break e;L=ae,D.currentTarget=rt;try{L(D)}catch(mt){Ba(mt)}D.currentTarget=null,L=De}}}}function ki(u,f){var y=f[hi];y===void 0&&(y=f[hi]=new Set);var T=u+"__bubble";y.has(T)||(sg(f,u,2,!1),y.add(T))}function Bm(u,f,y){var T=0;f&&(T|=4),sg(y,u,T,f)}var rg="_reactListening"+Math.random().toString(36).slice(2);function zm(u){if(!u[rg]){u[rg]=!0,bc.forEach(function(y){y!=="selectionchange"&&(xy.has(y)||Bm(y,!1,u),Bm(y,!0,u))});var f=u.nodeType===9?u:u.ownerDocument;f===null||f[rg]||(f[rg]=!0,Bm("selectionchange",!1,f))}}function sg(u,f,y,T){switch(zy(f)){case 2:var D=m0;break;case 8:D=e_;break;default:D=Dd}y=D.bind(null,f,y,u),D=void 0,!Ur||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(D=!0),T?D!==void 0?u.addEventListener(f,y,{capture:!0,passive:D}):u.addEventListener(f,y,!0):D!==void 0?u.addEventListener(f,y,{passive:D}):u.addEventListener(f,y,!1)}function ll(u,f,y,T,D){var L=T;if((f&1)===0&&(f&2)===0&&T!==null)e:for(;;){if(T===null)return;var q=T.tag;if(q===3||q===4){var ae=T.stateNode.containerInfo;if(ae===D)break;if(q===4)for(q=T.return;q!==null;){var De=q.tag;if((De===3||De===4)&&q.stateNode.containerInfo===D)return;q=q.return}for(;ae!==null;){if(q=Pa(ae),q===null)return;if(De=q.tag,De===5||De===6||De===26||De===27){T=L=q;continue e}ae=ae.parentNode}}T=T.return}Ji(function(){var rt=L,mt=_u(y),St=[];e:{var at=Vf.get(u);if(at!==void 0){var ht=yu,Zt=u;switch(u){case"keypress":if(ys(y)===0)break e;case"keydown":case"keyup":ht=zn;break;case"focusin":Zt="focus",ht=Vo;break;case"focusout":Zt="blur",ht=Vo;break;case"beforeblur":case"afterblur":ht=Vo;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ht=Cl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ht=vu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ht=am;break;case Ou:case ku:case Dh:ht=cp;break;case vs:ht=Sh;break;case"scroll":case"scrollend":ht=El;break;case"wheel":ht=Bf;break;case"copy":case"cut":case"paste":ht=kf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ht=Th;break;case"toggle":case"beforetoggle":ht=Cc}var ui=(f&4)!==0,an=!ui&&(u==="scroll"||u==="scrollend"),He=ui?at!==null?at+"Capture":null:at;ui=[];for(var Le=rt,it;Le!==null;){var vt=Le;if(it=vt.stateNode,vt=vt.tag,vt!==5&&vt!==26&&vt!==27||it===null||He===null||(vt=Fs(Le,He),vt!=null&&ui.push(hf(Le,vt,it))),an)break;Le=Le.return}0<ui.length&&(at=new ht(at,Zt,null,y,mt),St.push({event:at,listeners:ui}))}}if((f&7)===0){e:{if(at=u==="mouseover"||u==="pointerover",ht=u==="mouseout"||u==="pointerout",at&&y!==Of&&(Zt=y.relatedTarget||y.fromElement)&&(Pa(Zt)||Zt[ti]))break e;if((ht||at)&&(at=mt.window===mt?mt:(at=mt.ownerDocument)?at.defaultView||at.parentWindow:window,ht?(Zt=y.relatedTarget||y.toElement,ht=rt,Zt=Zt?Pa(Zt):null,Zt!==null&&(an=d(Zt),ui=Zt.tag,Zt!==an||ui!==5&&ui!==27&&ui!==6)&&(Zt=null)):(ht=null,Zt=rt),ht!==Zt)){if(ui=Cl,vt="onMouseLeave",He="onMouseEnter",Le="mouse",(u==="pointerout"||u==="pointerover")&&(ui=Th,vt="onPointerLeave",He="onPointerEnter",Le="pointer"),an=ht==null?at:Ia(ht),it=Zt==null?at:Ia(Zt),at=new ui(vt,Le+"leave",ht,y,mt),at.target=an,at.relatedTarget=it,vt=null,Pa(mt)===rt&&(ui=new ui(He,Le+"enter",Zt,y,mt),ui.target=it,ui.relatedTarget=an,vt=ui),an=vt,ht&&Zt)t:{for(ui=Ty,He=ht,Le=Zt,it=0,vt=He;vt;vt=ui(vt))it++;vt=0;for(var si=Le;si;si=ui(si))vt++;for(;0<it-vt;)He=ui(He),it--;for(;0<vt-it;)Le=ui(Le),vt--;for(;it--;){if(He===Le||Le!==null&&He===Le.alternate){ui=He;break t}He=ui(He),Le=ui(Le)}ui=null}else ui=null;ht!==null&&Fm(St,at,ht,ui,!1),Zt!==null&&an!==null&&Fm(St,an,Zt,ui,!0)}}e:{if(at=rt?Ia(rt):window,ht=at.nodeName&&at.nodeName.toLowerCase(),ht==="select"||ht==="input"&&at.type==="file")var Ki=Ho;else if(Eh(at))if(zf)Ki=vp;else{Ki=yp;var ei=om}else ht=at.nodeName,!ht||ht.toLowerCase()!=="input"||at.type!=="checkbox"&&at.type!=="radio"?rt&&Tl(rt.elementType)&&(Ki=Ho):Ki=Mu;if(Ki&&(Ki=Ki(u,rt))){Ch(St,Ki,y,mt);break e}ei&&ei(u,at,rt),u==="focusout"&&rt&&at.type==="number"&&rt.memoizedProps.value!=null&&mu(at,"number",at.value)}switch(ei=rt?Ia(rt):window,u){case"focusin":(Eh(ei)||ei.contentEditable==="true")&&(Vs=ei,Ru=rt,Du=null);break;case"focusout":Du=Ru=Vs=null;break;case"mousedown":Rh=!0;break;case"contextmenu":case"mouseup":case"dragend":Rh=!1,bp(St,y,mt);break;case"selectionchange":if(Ih)break;case"keydown":case"keyup":bp(St,y,mt)}var yi;if(Hn)e:{switch(u){case"compositionstart":var li="onCompositionStart";break e;case"compositionend":li="onCompositionEnd";break e;case"compositionupdate":li="onCompositionUpdate";break e}li=void 0}else ua?Su(u,y)&&(li="onCompositionEnd"):u==="keydown"&&y.keyCode===229&&(li="onCompositionStart");li&&(Rc&&y.locale!=="ko"&&(ua||li!=="onCompositionStart"?li==="onCompositionEnd"&&ua&&(yi=No()):(_s=mt,Oa="value"in _s?_s.value:_s.textContent,ua=!0)),ei=vd(rt,li),0<ei.length&&(li=new Lf(li,u,null,y,mt),St.push({event:li,listeners:ei}),yi?li.data=yi:(yi=dp(y),yi!==null&&(li.data=yi)))),(yi=Ic?Ah(u,y):pp(u,y))&&(li=vd(rt,"onBeforeInput"),0<li.length&&(ei=new Lf("onBeforeInput","beforeinput",null,y,mt),St.push({event:ei,listeners:li}),ei.data=yi)),uf(St,u,rt,y,mt)}wy(St,f)})}function hf(u,f,y){return{instance:u,listener:f,currentTarget:y}}function vd(u,f){for(var y=f+"Capture",T=[];u!==null;){var D=u,L=D.stateNode;if(D=D.tag,D!==5&&D!==26&&D!==27||L===null||(D=Fs(u,y),D!=null&&T.unshift(hf(u,D,L)),D=Fs(u,f),D!=null&&T.push(hf(u,D,L))),u.tag===3)return T;u=u.return}return[]}function Ty(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function Fm(u,f,y,T,D){for(var L=f._reactName,q=[];y!==null&&y!==T;){var ae=y,De=ae.alternate,rt=ae.stateNode;if(ae=ae.tag,De!==null&&De===T)break;ae!==5&&ae!==26&&ae!==27||rt===null||(De=rt,D?(rt=Fs(y,L),rt!=null&&q.unshift(hf(y,rt,De))):D||(rt=Fs(y,L),rt!=null&&q.push(hf(y,rt,De)))),y=y.return}q.length!==0&&u.push({event:f,listeners:q})}var Sy=/\r\n?/g,Ay=/\u0000|\uFFFD/g;function bd(u){return(typeof u=="string"?u:""+u).replace(Sy,`
`).replace(Ay,"")}function Nm(u,f){return f=bd(f),bd(u)===f}function Yi(u,f,y,T,D,L){switch(y){case"children":typeof T=="string"?f==="body"||f==="textarea"&&T===""||ao(u,T):(typeof T=="number"||typeof T=="bigint")&&f!=="body"&&ao(u,""+T);break;case"className":Da(u,"class",T);break;case"tabIndex":Da(u,"tabindex",T);break;case"dir":case"role":case"viewBox":case"width":case"height":Da(u,y,T);break;case"style":wh(u,T,L);break;case"data":if(f!=="object"){Da(u,"data",T);break}case"src":case"href":if(T===""&&(f!=="a"||y!=="href")){u.removeAttribute(y);break}if(T==null||typeof T=="function"||typeof T=="symbol"||typeof T=="boolean"){u.removeAttribute(y);break}T=mi(""+T),u.setAttribute(y,T);break;case"action":case"formAction":if(typeof T=="function"){u.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(y==="formAction"?(f!=="input"&&Yi(u,f,"name",D.name,D,null),Yi(u,f,"formEncType",D.formEncType,D,null),Yi(u,f,"formMethod",D.formMethod,D,null),Yi(u,f,"formTarget",D.formTarget,D,null)):(Yi(u,f,"encType",D.encType,D,null),Yi(u,f,"method",D.method,D,null),Yi(u,f,"target",D.target,D,null)));if(T==null||typeof T=="symbol"||typeof T=="boolean"){u.removeAttribute(y);break}T=mi(""+T),u.setAttribute(y,T);break;case"onClick":T!=null&&(u.onclick=ca);break;case"onScroll":T!=null&&ki("scroll",u);break;case"onScrollEnd":T!=null&&ki("scrollend",u);break;case"dangerouslySetInnerHTML":if(T!=null){if(typeof T!="object"||!("__html"in T))throw Error(s(61));if(y=T.__html,y!=null){if(D.children!=null)throw Error(s(60));u.innerHTML=y}}break;case"multiple":u.multiple=T&&typeof T!="function"&&typeof T!="symbol";break;case"muted":u.muted=T&&typeof T!="function"&&typeof T!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(T==null||typeof T=="function"||typeof T=="boolean"||typeof T=="symbol"){u.removeAttribute("xlink:href");break}y=mi(""+T),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":T!=null&&typeof T!="function"&&typeof T!="symbol"?u.setAttribute(y,""+T):u.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":T&&typeof T!="function"&&typeof T!="symbol"?u.setAttribute(y,""):u.removeAttribute(y);break;case"capture":case"download":T===!0?u.setAttribute(y,""):T!==!1&&T!=null&&typeof T!="function"&&typeof T!="symbol"?u.setAttribute(y,T):u.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":T!=null&&typeof T!="function"&&typeof T!="symbol"&&!isNaN(T)&&1<=T?u.setAttribute(y,T):u.removeAttribute(y);break;case"rowSpan":case"start":T==null||typeof T=="function"||typeof T=="symbol"||isNaN(T)?u.removeAttribute(y):u.setAttribute(y,T);break;case"popover":ki("beforetoggle",u),ki("toggle",u),du(u,"popover",T);break;case"xlinkActuate":zs(u,"http://www.w3.org/1999/xlink","xlink:actuate",T);break;case"xlinkArcrole":zs(u,"http://www.w3.org/1999/xlink","xlink:arcrole",T);break;case"xlinkRole":zs(u,"http://www.w3.org/1999/xlink","xlink:role",T);break;case"xlinkShow":zs(u,"http://www.w3.org/1999/xlink","xlink:show",T);break;case"xlinkTitle":zs(u,"http://www.w3.org/1999/xlink","xlink:title",T);break;case"xlinkType":zs(u,"http://www.w3.org/1999/xlink","xlink:type",T);break;case"xmlBase":zs(u,"http://www.w3.org/XML/1998/namespace","xml:base",T);break;case"xmlLang":zs(u,"http://www.w3.org/XML/1998/namespace","xml:lang",T);break;case"xmlSpace":zs(u,"http://www.w3.org/XML/1998/namespace","xml:space",T);break;case"is":du(u,"is",T);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Fo.get(y)||y,du(u,y,T))}}function ag(u,f,y,T,D,L){switch(y){case"style":wh(u,T,L);break;case"dangerouslySetInnerHTML":if(T!=null){if(typeof T!="object"||!("__html"in T))throw Error(s(61));if(y=T.__html,y!=null){if(D.children!=null)throw Error(s(60));u.innerHTML=y}}break;case"children":typeof T=="string"?ao(u,T):(typeof T=="number"||typeof T=="bigint")&&ao(u,""+T);break;case"onScroll":T!=null&&ki("scroll",u);break;case"onScrollEnd":T!=null&&ki("scrollend",u);break;case"onClick":T!=null&&(u.onclick=ca);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pr.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(D=y.endsWith("Capture"),f=y.slice(2,D?y.length-7:void 0),L=u[Ct]||null,L=L!=null?L[y]:null,typeof L=="function"&&u.removeEventListener(f,L,D),typeof T=="function")){typeof L!="function"&&L!==null&&(y in u?u[y]=null:u.hasAttribute(y)&&u.removeAttribute(y)),u.addEventListener(f,T,D);break e}y in u?u[y]=T:T===!0?u.setAttribute(y,""):du(u,y,T)}}}function Cr(u,f,y){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ki("error",u),ki("load",u);var T=!1,D=!1,L;for(L in y)if(y.hasOwnProperty(L)){var q=y[L];if(q!=null)switch(L){case"src":T=!0;break;case"srcSet":D=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Yi(u,f,L,q,y,null)}}D&&Yi(u,f,"srcSet",y.srcSet,y,null),T&&Yi(u,f,"src",y.src,y,null);return;case"input":ki("invalid",u);var ae=L=q=D=null,De=null,rt=null;for(T in y)if(y.hasOwnProperty(T)){var mt=y[T];if(mt!=null)switch(T){case"name":D=mt;break;case"type":q=mt;break;case"checked":De=mt;break;case"defaultChecked":rt=mt;break;case"value":L=mt;break;case"defaultValue":ae=mt;break;case"children":case"dangerouslySetInnerHTML":if(mt!=null)throw Error(s(137,f));break;default:Yi(u,f,T,mt,y,null)}}xh(u,L,ae,De,rt,q,D,!1);return;case"select":ki("invalid",u),T=q=L=null;for(D in y)if(y.hasOwnProperty(D)&&(ae=y[D],ae!=null))switch(D){case"value":L=ae;break;case"defaultValue":q=ae;break;case"multiple":T=ae;default:Yi(u,f,D,ae,y,null)}f=L,y=q,u.multiple=!!T,f!=null?zo(u,!!T,f,!1):y!=null&&zo(u,!!T,y,!0);return;case"textarea":ki("invalid",u),L=D=T=null;for(q in y)if(y.hasOwnProperty(q)&&(ae=y[q],ae!=null))switch(q){case"value":T=ae;break;case"defaultValue":D=ae;break;case"children":L=ae;break;case"dangerouslySetInnerHTML":if(ae!=null)throw Error(s(91));break;default:Yi(u,f,q,ae,y,null)}Tc(u,T,D,L);return;case"option":for(De in y)y.hasOwnProperty(De)&&(T=y[De],T!=null)&&(De==="selected"?u.selected=T&&typeof T!="function"&&typeof T!="symbol":Yi(u,f,De,T,y,null));return;case"dialog":ki("beforetoggle",u),ki("toggle",u),ki("cancel",u),ki("close",u);break;case"iframe":case"object":ki("load",u);break;case"video":case"audio":for(T=0;T<Kc.length;T++)ki(Kc[T],u);break;case"image":ki("error",u),ki("load",u);break;case"details":ki("toggle",u);break;case"embed":case"source":case"link":ki("error",u),ki("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(rt in y)if(y.hasOwnProperty(rt)&&(T=y[rt],T!=null))switch(rt){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,f));default:Yi(u,f,rt,T,y,null)}return;default:if(Tl(f)){for(mt in y)y.hasOwnProperty(mt)&&(T=y[mt],T!==void 0&&ag(u,f,mt,T,y,void 0));return}}for(ae in y)y.hasOwnProperty(ae)&&(T=y[ae],T!=null&&Yi(u,f,ae,T,y,null))}function Ey(u,f,y,T){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var D=null,L=null,q=null,ae=null,De=null,rt=null,mt=null;for(ht in y){var St=y[ht];if(y.hasOwnProperty(ht)&&St!=null)switch(ht){case"checked":break;case"value":break;case"defaultValue":De=St;default:T.hasOwnProperty(ht)||Yi(u,f,ht,null,T,St)}}for(var at in T){var ht=T[at];if(St=y[at],T.hasOwnProperty(at)&&(ht!=null||St!=null))switch(at){case"type":L=ht;break;case"name":D=ht;break;case"checked":rt=ht;break;case"defaultChecked":mt=ht;break;case"value":q=ht;break;case"defaultValue":ae=ht;break;case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(s(137,f));break;default:ht!==St&&Yi(u,f,at,ht,T,St)}}gu(u,q,ae,De,rt,mt,L,D);return;case"select":ht=q=ae=at=null;for(L in y)if(De=y[L],y.hasOwnProperty(L)&&De!=null)switch(L){case"value":break;case"multiple":ht=De;default:T.hasOwnProperty(L)||Yi(u,f,L,null,T,De)}for(D in T)if(L=T[D],De=y[D],T.hasOwnProperty(D)&&(L!=null||De!=null))switch(D){case"value":at=L;break;case"defaultValue":ae=L;break;case"multiple":q=L;default:L!==De&&Yi(u,f,D,L,T,De)}f=ae,y=q,T=ht,at!=null?zo(u,!!y,at,!1):!!T!=!!y&&(f!=null?zo(u,!!y,f,!0):zo(u,!!y,y?[]:"",!1));return;case"textarea":ht=at=null;for(ae in y)if(D=y[ae],y.hasOwnProperty(ae)&&D!=null&&!T.hasOwnProperty(ae))switch(ae){case"value":break;case"children":break;default:Yi(u,f,ae,null,T,D)}for(q in T)if(D=T[q],L=y[q],T.hasOwnProperty(q)&&(D!=null||L!=null))switch(q){case"value":at=D;break;case"defaultValue":ht=D;break;case"children":break;case"dangerouslySetInnerHTML":if(D!=null)throw Error(s(91));break;default:D!==L&&Yi(u,f,q,D,T,L)}op(u,at,ht);return;case"option":for(var Zt in y)at=y[Zt],y.hasOwnProperty(Zt)&&at!=null&&!T.hasOwnProperty(Zt)&&(Zt==="selected"?u.selected=!1:Yi(u,f,Zt,null,T,at));for(De in T)at=T[De],ht=y[De],T.hasOwnProperty(De)&&at!==ht&&(at!=null||ht!=null)&&(De==="selected"?u.selected=at&&typeof at!="function"&&typeof at!="symbol":Yi(u,f,De,at,T,ht));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ui in y)at=y[ui],y.hasOwnProperty(ui)&&at!=null&&!T.hasOwnProperty(ui)&&Yi(u,f,ui,null,T,at);for(rt in T)if(at=T[rt],ht=y[rt],T.hasOwnProperty(rt)&&at!==ht&&(at!=null||ht!=null))switch(rt){case"children":case"dangerouslySetInnerHTML":if(at!=null)throw Error(s(137,f));break;default:Yi(u,f,rt,at,T,ht)}return;default:if(Tl(f)){for(var an in y)at=y[an],y.hasOwnProperty(an)&&at!==void 0&&!T.hasOwnProperty(an)&&ag(u,f,an,void 0,T,at);for(mt in T)at=T[mt],ht=y[mt],!T.hasOwnProperty(mt)||at===ht||at===void 0&&ht===void 0||ag(u,f,mt,at,T,ht);return}}for(var He in y)at=y[He],y.hasOwnProperty(He)&&at!=null&&!T.hasOwnProperty(He)&&Yi(u,f,He,null,T,at);for(St in T)at=T[St],ht=y[St],!T.hasOwnProperty(St)||at===ht||at==null&&ht==null||Yi(u,f,St,at,T,ht)}function Rs(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ff(){if(typeof performance.getEntriesByType=="function"){for(var u=0,f=0,y=performance.getEntriesByType("resource"),T=0;T<y.length;T++){var D=y[T],L=D.transferSize,q=D.initiatorType,ae=D.duration;if(L&&ae&&Rs(q)){for(q=0,ae=D.responseEnd,T+=1;T<y.length;T++){var De=y[T],rt=De.startTime;if(rt>ae)break;var mt=De.transferSize,St=De.initiatorType;mt&&Rs(St)&&(De=De.responseEnd,q+=mt*(De<ae?1:(ae-rt)/(De-rt)))}if(--T,f+=8*(L+q)/(D.duration/1e3),u++,10<u)break}}if(0<u)return f/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var xd=null,Um=null;function wd(u){return u.nodeType===9?u:u.ownerDocument}function Qc(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Vm(u,f){if(u===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&f==="foreignObject"?0:u}function og(u,f){return u==="textarea"||u==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var Jc=null;function lg(){var u=window.event;return u&&u.type==="popstate"?u===Jc?!1:(Jc=u,!0):(Jc=null,!1)}var cg=typeof setTimeout=="function"?setTimeout:void 0,jm=typeof clearTimeout=="function"?clearTimeout:void 0,$m=typeof Promise=="function"?Promise:void 0,Hm=typeof queueMicrotask=="function"?queueMicrotask:typeof $m<"u"?function(u){return $m.resolve(null).then(u).catch(Wm)}:cg;function Wm(u){setTimeout(function(){throw u})}function eu(u){return u==="head"}function Cy(u,f){var y=f,T=0;do{var D=y.nextSibling;if(u.removeChild(y),D&&D.nodeType===8)if(y=D.data,y==="/$"||y==="/&"){if(T===0){u.removeChild(D),mf(f);return}T--}else if(y==="$"||y==="$?"||y==="$~"||y==="$!"||y==="&")T++;else if(y==="html")Td(u.ownerDocument.documentElement);else if(y==="head"){y=u.ownerDocument.head,Td(y);for(var L=y.firstChild;L;){var q=L.nextSibling,ae=L.nodeName;L[fi]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&L.rel.toLowerCase()==="stylesheet"||y.removeChild(L),L=q}}else y==="body"&&Td(u.ownerDocument.body);y=D}while(y);mf(f)}function Xi(u,f){var y=u;u=0;do{var T=y.nextSibling;if(y.nodeType===1?f?(y._stashedDisplay=y.style.display,y.style.display="none"):(y.style.display=y._stashedDisplay||"",y.getAttribute("style")===""&&y.removeAttribute("style")):y.nodeType===3&&(f?(y._stashedText=y.nodeValue,y.nodeValue=""):y.nodeValue=y._stashedText||""),T&&T.nodeType===8)if(y=T.data,y==="/$"){if(u===0)break;u--}else y!=="$"&&y!=="$?"&&y!=="$~"&&y!=="$!"||u++;y=T}while(y)}function cl(u){var f=u.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var y=f;switch(f=f.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":cl(y),bl(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}u.removeChild(y)}}function Dr(u,f,y,T){for(;u.nodeType===1;){var D=y;if(u.nodeName.toLowerCase()!==f.toLowerCase()){if(!T&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(T){if(!u[fi])switch(f){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(L=u.getAttribute("rel"),L==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(L!==D.rel||u.getAttribute("href")!==(D.href==null||D.href===""?null:D.href)||u.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin)||u.getAttribute("title")!==(D.title==null?null:D.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(L=u.getAttribute("src"),(L!==(D.src==null?null:D.src)||u.getAttribute("type")!==(D.type==null?null:D.type)||u.getAttribute("crossorigin")!==(D.crossOrigin==null?null:D.crossOrigin))&&L&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(f==="input"&&u.type==="hidden"){var L=D.name==null?null:""+D.name;if(D.type==="hidden"&&u.getAttribute("name")===L)return u}else return u;if(u=wa(u.nextSibling),u===null)break}return null}function Ao(u,f,y){if(f==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!y||(u=wa(u.nextSibling),u===null))return null;return u}function tu(u,f){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!f||(u=wa(u.nextSibling),u===null))return null;return u}function os(u){return u.data==="$?"||u.data==="$~"}function In(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function yr(u,f){var y=u.ownerDocument;if(u.data==="$~")u._reactRetry=f;else if(u.data!=="$?"||y.readyState!=="loading")f();else{var T=function(){f(),y.removeEventListener("DOMContentLoaded",T)};y.addEventListener("DOMContentLoaded",T),u._reactRetry=T}}function wa(u){for(;u!=null;u=u.nextSibling){var f=u.nodeType;if(f===1||f===3)break;if(f===8){if(f=u.data,f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"||f==="F!"||f==="F")break;if(f==="/$"||f==="/&")return null}}return u}var Ds=null;function Or(u){u=u.nextSibling;for(var f=0;u;){if(u.nodeType===8){var y=u.data;if(y==="/$"||y==="/&"){if(f===0)return wa(u.nextSibling);f--}else y!=="$"&&y!=="$!"&&y!=="$?"&&y!=="$~"&&y!=="&"||f++}u=u.nextSibling}return null}function ug(u){u=u.previousSibling;for(var f=0;u;){if(u.nodeType===8){var y=u.data;if(y==="$"||y==="$!"||y==="$?"||y==="$~"||y==="&"){if(f===0)return u;f--}else y!=="/$"&&y!=="/&"||f++}u=u.previousSibling}return null}function My(u,f,y){switch(f=wd(y),u){case"html":if(u=f.documentElement,!u)throw Error(s(452));return u;case"head":if(u=f.head,!u)throw Error(s(453));return u;case"body":if(u=f.body,!u)throw Error(s(454));return u;default:throw Error(s(451))}}function Td(u){for(var f=u.attributes;f.length;)u.removeAttributeNode(f[0]);bl(u)}var Ni=new Map,Os=new Set;function ic(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var ul=be.d;be.d={f:Py,r:Iy,D:ls,C:Eo,L:fg,m:cs,X:dg,S:iu,M:qm};function Py(){var u=ul.f(),f=gd();return u||f}function Iy(u){var f=ro(u);f!==null&&f.tag===5&&f.type==="form"?dr(f):ul.r(u)}var ah=typeof document>"u"?null:document;function hg(u,f,y){var T=ah;if(T&&typeof f=="string"&&f){var D=Nr(f);D='link[rel="'+u+'"][href="'+D+'"]',typeof y=="string"&&(D+='[crossorigin="'+y+'"]'),Os.has(D)||(Os.add(D),u={rel:u,crossOrigin:y,href:f},T.querySelector(D)===null&&(f=T.createElement("link"),Cr(f,"link",u),Ln(f),T.head.appendChild(f)))}}function ls(u){ul.D(u),hg("dns-prefetch",u,null)}function Eo(u,f){ul.C(u,f),hg("preconnect",u,f)}function fg(u,f,y){ul.L(u,f,y);var T=ah;if(T&&u&&f){var D='link[rel="preload"][as="'+Nr(f)+'"]';f==="image"&&y&&y.imageSrcSet?(D+='[imagesrcset="'+Nr(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(D+='[imagesizes="'+Nr(y.imageSizes)+'"]')):D+='[href="'+Nr(u)+'"]';var L=D;switch(f){case"style":L=oh(u);break;case"script":L=lh(u)}Ni.has(L)||(u=z({rel:"preload",href:f==="image"&&y&&y.imageSrcSet?void 0:u,as:f},y),Ni.set(L,u),T.querySelector(D)!==null||f==="style"&&T.querySelector(df(L))||f==="script"&&T.querySelector(pf(L))||(f=T.createElement("link"),Cr(f,"link",u),Ln(f),T.head.appendChild(f)))}}function cs(u,f){ul.m(u,f);var y=ah;if(y&&u){var T=f&&typeof f.as=="string"?f.as:"script",D='link[rel="modulepreload"][as="'+Nr(T)+'"][href="'+Nr(u)+'"]',L=D;switch(T){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=lh(u)}if(!Ni.has(L)&&(u=z({rel:"modulepreload",href:u},f),Ni.set(L,u),y.querySelector(D)===null)){switch(T){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(pf(L)))return}T=y.createElement("link"),Cr(T,"link",u),Ln(T),y.head.appendChild(T)}}}function iu(u,f,y){ul.S(u,f,y);var T=ah;if(T&&u){var D=Ra(T).hoistableStyles,L=oh(u);f=f||"default";var q=D.get(L);if(!q){var ae={loading:0,preload:null};if(q=T.querySelector(df(L)))ae.loading=5;else{u=z({rel:"stylesheet",href:u,"data-precedence":f},y),(y=Ni.get(L))&&gg(u,y);var De=q=T.createElement("link");Ln(De),Cr(De,"link",u),De._p=new Promise(function(rt,mt){De.onload=rt,De.onerror=mt}),De.addEventListener("load",function(){ae.loading|=1}),De.addEventListener("error",function(){ae.loading|=2}),ae.loading|=4,gf(q,f,T)}q={type:"stylesheet",instance:q,count:1,state:ae},D.set(L,q)}}}function dg(u,f){ul.X(u,f);var y=ah;if(y&&u){var T=Ra(y).hoistableScripts,D=lh(u),L=T.get(D);L||(L=y.querySelector(pf(D)),L||(u=z({src:u,async:!0},f),(f=Ni.get(D))&&Zm(u,f),L=y.createElement("script"),Ln(L),Cr(L,"link",u),y.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},T.set(D,L))}}function qm(u,f){ul.M(u,f);var y=ah;if(y&&u){var T=Ra(y).hoistableScripts,D=lh(u),L=T.get(D);L||(L=y.querySelector(pf(D)),L||(u=z({src:u,async:!0,type:"module"},f),(f=Ni.get(D))&&Zm(u,f),L=y.createElement("script"),Ln(L),Cr(L,"link",u),y.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},T.set(D,L))}}function Xm(u,f,y,T){var D=(D=$t.current)?ic(D):null;if(!D)throw Error(s(446));switch(u){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(f=oh(y.href),y=Ra(D).hoistableStyles,T=y.get(f),T||(T={type:"style",instance:null,count:0,state:null},y.set(f,T)),T):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){u=oh(y.href);var L=Ra(D).hoistableStyles,q=L.get(u);if(q||(D=D.ownerDocument||D,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(u,q),(L=D.querySelector(df(u)))&&!L._p&&(q.instance=L,q.state.loading=5),Ni.has(u)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Ni.set(u,y),L||pg(D,u,y,q.state))),f&&T===null)throw Error(s(528,""));return q}if(f&&T!==null)throw Error(s(529,""));return null;case"script":return f=y.async,y=y.src,typeof y=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=lh(y),y=Ra(D).hoistableScripts,T=y.get(f),T||(T={type:"script",instance:null,count:0,state:null},y.set(f,T)),T):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,u))}}function oh(u){return'href="'+Nr(u)+'"'}function df(u){return'link[rel="stylesheet"]['+u+"]"}function Gm(u){return z({},u,{"data-precedence":u.precedence,precedence:null})}function pg(u,f,y,T){u.querySelector('link[rel="preload"][as="style"]['+f+"]")?T.loading=1:(f=u.createElement("link"),T.preload=f,f.addEventListener("load",function(){return T.loading|=1}),f.addEventListener("error",function(){return T.loading|=2}),Cr(f,"link",y),Ln(f),u.head.appendChild(f))}function lh(u){return'[src="'+Nr(u)+'"]'}function pf(u){return"script[async]"+u}function ch(u,f,y){if(f.count++,f.instance===null)switch(f.type){case"style":var T=u.querySelector('style[data-href~="'+Nr(y.href)+'"]');if(T)return f.instance=T,Ln(T),T;var D=z({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return T=(u.ownerDocument||u).createElement("style"),Ln(T),Cr(T,"style",D),gf(T,y.precedence,u),f.instance=T;case"stylesheet":D=oh(y.href);var L=u.querySelector(df(D));if(L)return f.state.loading|=4,f.instance=L,Ln(L),L;T=Gm(y),(D=Ni.get(D))&&gg(T,D),L=(u.ownerDocument||u).createElement("link"),Ln(L);var q=L;return q._p=new Promise(function(ae,De){q.onload=ae,q.onerror=De}),Cr(L,"link",T),f.state.loading|=4,gf(L,y.precedence,u),f.instance=L;case"script":return L=lh(y.src),(D=u.querySelector(pf(L)))?(f.instance=D,Ln(D),D):(T=y,(D=Ni.get(L))&&(T=z({},y),Zm(T,D)),u=u.ownerDocument||u,D=u.createElement("script"),Ln(D),Cr(D,"link",T),u.head.appendChild(D),f.instance=D);case"void":return null;default:throw Error(s(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(T=f.instance,f.state.loading|=4,gf(T,y.precedence,u));return f.instance}function gf(u,f,y){for(var T=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),D=T.length?T[T.length-1]:null,L=D,q=0;q<T.length;q++){var ae=T[q];if(ae.dataset.precedence===f)L=ae;else if(L!==D)break}L?L.parentNode.insertBefore(u,L.nextSibling):(f=y.nodeType===9?y.head:y,f.insertBefore(u,f.firstChild))}function gg(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.title==null&&(u.title=f.title)}function Zm(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.integrity==null&&(u.integrity=f.integrity)}var Sd=null;function Ad(u,f,y){if(Sd===null){var T=new Map,D=Sd=new Map;D.set(y,T)}else D=Sd,T=D.get(y),T||(T=new Map,D.set(y,T));if(T.has(u))return T;for(T.set(u,null),y=y.getElementsByTagName(u),D=0;D<y.length;D++){var L=y[D];if(!(L[fi]||L[Hi]||u==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var q=L.getAttribute(f)||"";q=u+q;var ae=T.get(q);ae?ae.push(L):T.set(q,[L])}}return T}function Ed(u,f,y){u=u.ownerDocument||u,u.head.insertBefore(y,f==="title"?u.querySelector("head > title"):null)}function mg(u,f,y){if(y===1||f.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;return f.rel==="stylesheet"?(u=f.disabled,typeof f.precedence=="string"&&u==null):!0;case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function _g(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function Ym(u,f,y,T){if(y.type==="stylesheet"&&(typeof T.media!="string"||matchMedia(T.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var D=oh(T.href),L=f.querySelector(df(D));if(L){f=L._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(u.count++,u=Md.bind(u),f.then(u,u)),y.state.loading|=4,y.instance=L,Ln(L);return}L=f.ownerDocument||f,T=Gm(T),(D=Ni.get(D))&&gg(T,D),L=L.createElement("link"),Ln(L);var q=L;q._p=new Promise(function(ae,De){q.onload=ae,q.onerror=De}),Cr(L,"link",T),y.instance=L}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(y,f),(f=y.state.preload)&&(y.state.loading&3)===0&&(u.count++,y=Md.bind(u),f.addEventListener("load",y),f.addEventListener("error",y))}}var Cd=0;function Ry(u,f){return u.stylesheets&&u.count===0&&Id(u,u.stylesheets),0<u.count||0<u.imgCount?function(y){var T=setTimeout(function(){if(u.stylesheets&&Id(u,u.stylesheets),u.unsuspend){var L=u.unsuspend;u.unsuspend=null,L()}},6e4+f);0<u.imgBytes&&Cd===0&&(Cd=62500*ff());var D=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&Id(u,u.stylesheets),u.unsuspend)){var L=u.unsuspend;u.unsuspend=null,L()}},(u.imgBytes>Cd?50:800)+f);return u.unsuspend=y,function(){u.unsuspend=null,clearTimeout(T),clearTimeout(D)}}:null}function Md(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Id(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var Pd=null;function Id(u,f){u.stylesheets=null,u.unsuspend!==null&&(u.count++,Pd=new Map,f.forEach(Dy,u),Pd=null,Md.call(u))}function Dy(u,f){if(!(f.state.loading&4)){var y=Pd.get(u);if(y)var T=y.get(null);else{y=new Map,Pd.set(u,y);for(var D=u.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<D.length;L++){var q=D[L];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(y.set(q.dataset.precedence,q),T=q)}T&&y.set(null,T)}D=f.instance,q=D.getAttribute("data-precedence"),L=y.get(q)||T,L===T&&y.set(null,D),y.set(q,D),this.count++,T=Md.bind(this),D.addEventListener("load",T),D.addEventListener("error",T),L?L.parentNode.insertBefore(D,L.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(D,u.firstChild)),f.state.loading|=4}}var Rd={$$typeof:Se,Provider:null,Consumer:null,_currentValue:_e,_currentValue2:_e,_threadCount:0};function Oy(u,f,y,T,D,L,q,ae,De){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ni(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ni(0),this.hiddenUpdates=ni(null),this.identifierPrefix=T,this.onUncaughtError=D,this.onCaughtError=L,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=De,this.incompleteTransitions=new Map}function ky(u,f,y,T,D,L,q,ae,De,rt,mt,St){return u=new Oy(u,f,y,q,De,rt,mt,St,ae),f=1,L===!0&&(f|=24),L=xs(3,null,null,f),u.current=L,L.stateNode=u,f=Ha(),f.refCount++,u.pooledCache=f,f.refCount++,L.memoizedState={element:T,isDehydrated:y,cache:f},qh(L),u}function Ly(u){return u?(u=pi,u):pi}function yg(u,f,y,T,D,L){D=Ly(D),T.context===null?T.context=D:T.pendingContext=D,T=Za(f),T.payload={element:y},L=L===void 0?null:L,L!==null&&(T.callback=L),y=go(u,T,f),y!==null&&(ea(y,u,f),Ws(y,u,f))}function Km(u,f){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var y=u.retryLane;u.retryLane=y!==0&&y<f?y:f}}function Qm(u,f){Km(u,f),(u=u.alternate)&&Km(u,f)}function By(u){if(u.tag===13||u.tag===31){var f=js(u,67108864);f!==null&&ea(f,u,67108864),Qm(u,67108864)}}function Jm(u){if(u.tag===13||u.tag===31){var f=Js();f=yn(f);var y=js(u,f);y!==null&&ea(y,u,f),Qm(u,f)}}var nu=!0;function m0(u,f,y,T){var D=re.T;re.T=null;var L=be.p;try{be.p=2,Dd(u,f,y,T)}finally{be.p=L,re.T=D}}function e_(u,f,y,T){var D=re.T;re.T=null;var L=be.p;try{be.p=8,Dd(u,f,y,T)}finally{be.p=L,re.T=D}}function Dd(u,f,y,T){if(nu){var D=vg(T);if(D===null)ll(u,f,T,nc,y),Ny(u,T);else if(_0(D,u,f,y,T))T.stopPropagation();else if(Ny(u,T),f&4&&-1<Fy.indexOf(u)){for(;D!==null;){var L=ro(D);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var q=Ce(L.pendingLanes);if(q!==0){var ae=L;for(ae.pendingLanes|=2,ae.entangledLanes|=2;q;){var De=1<<31-Me(q);ae.entanglements[1]|=De,q&=~De}So(L),(rn&6)===0&&(dd=rr()+500,xa(0))}}break;case 31:case 13:ae=js(L,2),ae!==null&&ea(ae,L,2),gd(),Qm(L,2)}if(L=vg(T),L===null&&ll(u,f,T,nc,y),L===D)break;D=L}D!==null&&T.stopPropagation()}else ll(u,f,T,null,y)}}function vg(u){return u=_u(u),bg(u)}var nc=null;function bg(u){if(nc=null,u=Pa(u),u!==null){var f=d(u);if(f===null)u=null;else{var y=f.tag;if(y===13){if(u=g(f),u!==null)return u;u=null}else if(y===31){if(u=o(f),u!==null)return u;u=null}else if(y===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;u=null}else f!==u&&(u=null)}}return nc=u,null}function zy(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(gs()){case vc:return 2;case io:return 8;case no:case fu:return 32;case Lo:return 268435456;default:return 32}default:return 32}}var uh=!1,rc=null,sc=null,ac=null,Od=new Map,kd=new Map,hl=[],Fy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ny(u,f){switch(u){case"focusin":case"focusout":rc=null;break;case"dragenter":case"dragleave":sc=null;break;case"mouseover":case"mouseout":ac=null;break;case"pointerover":case"pointerout":Od.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":kd.delete(f.pointerId)}}function Ld(u,f,y,T,D,L){return u===null||u.nativeEvent!==L?(u={blockedOn:f,domEventName:y,eventSystemFlags:T,nativeEvent:L,targetContainers:[D]},f!==null&&(f=ro(f),f!==null&&By(f)),u):(u.eventSystemFlags|=T,f=u.targetContainers,D!==null&&f.indexOf(D)===-1&&f.push(D),u)}function _0(u,f,y,T,D){switch(f){case"focusin":return rc=Ld(rc,u,f,y,T,D),!0;case"dragenter":return sc=Ld(sc,u,f,y,T,D),!0;case"mouseover":return ac=Ld(ac,u,f,y,T,D),!0;case"pointerover":var L=D.pointerId;return Od.set(L,Ld(Od.get(L)||null,u,f,y,T,D)),!0;case"gotpointercapture":return L=D.pointerId,kd.set(L,Ld(kd.get(L)||null,u,f,y,T,D)),!0}return!1}function Uy(u){var f=Pa(u.target);if(f!==null){var y=d(f);if(y!==null){if(f=y.tag,f===13){if(f=g(y),f!==null){u.blockedOn=f,ln(u.priority,function(){Jm(y)});return}}else if(f===31){if(f=o(y),f!==null){u.blockedOn=f,ln(u.priority,function(){Jm(y)});return}}else if(f===3&&y.stateNode.current.memoizedState.isDehydrated){u.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}u.blockedOn=null}function xg(u){if(u.blockedOn!==null)return!1;for(var f=u.targetContainers;0<f.length;){var y=vg(u.nativeEvent);if(y===null){y=u.nativeEvent;var T=new y.constructor(y.type,y);Of=T,y.target.dispatchEvent(T),Of=null}else return f=ro(y),f!==null&&By(f),u.blockedOn=y,!1;f.shift()}return!0}function t_(u,f,y){xg(u)&&y.delete(f)}function y0(){uh=!1,rc!==null&&xg(rc)&&(rc=null),sc!==null&&xg(sc)&&(sc=null),ac!==null&&xg(ac)&&(ac=null),Od.forEach(t_),kd.forEach(t_)}function ru(u,f){u.blockedOn===f&&(u.blockedOn=null,uh||(uh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,y0)))}var wg=null;function Vy(u){wg!==u&&(wg=u,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){wg===u&&(wg=null);for(var f=0;f<u.length;f+=3){var y=u[f],T=u[f+1],D=u[f+2];if(typeof T!="function"){if(bg(T||y)===null)continue;break}var L=ro(y);L!==null&&(u.splice(f,3),f-=3,Nn(L,{pending:!0,data:D,method:y.method,action:T},T,D))}}))}function mf(u){function f(De){return ru(De,u)}rc!==null&&ru(rc,u),sc!==null&&ru(sc,u),ac!==null&&ru(ac,u),Od.forEach(f),kd.forEach(f);for(var y=0;y<hl.length;y++){var T=hl[y];T.blockedOn===u&&(T.blockedOn=null)}for(;0<hl.length&&(y=hl[0],y.blockedOn===null);)Uy(y),y.blockedOn===null&&hl.shift();if(y=(u.ownerDocument||u).$$reactFormReplay,y!=null)for(T=0;T<y.length;T+=3){var D=y[T],L=y[T+1],q=D[Ct]||null;if(typeof L=="function")q||Vy(y);else if(q){var ae=null;if(L&&L.hasAttribute("formAction")){if(D=L,q=L[Ct]||null)ae=q.formAction;else if(bg(D)!==null)continue}else ae=q.action;typeof ae=="function"?y[T+1]=ae:(y.splice(T,3),T-=3),Vy(y)}}}function Tg(){function u(L){L.canIntercept&&L.info==="react-transition"&&L.intercept({handler:function(){return new Promise(function(q){return D=q})},focusReset:"manual",scroll:"manual"})}function f(){D!==null&&(D(),D=null),T||setTimeout(y,20)}function y(){if(!T&&!navigation.transition){var L=navigation.currentEntry;L&&L.url!=null&&navigation.navigate(L.url,{state:L.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var T=!1,D=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",f),navigation.addEventListener("navigateerror",f),setTimeout(y,100),function(){T=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",f),navigation.removeEventListener("navigateerror",f),D!==null&&(D(),D=null)}}}function Sg(u){this._internalRoot=u}Ag.prototype.render=Sg.prototype.render=function(u){var f=this._internalRoot;if(f===null)throw Error(s(409));var y=f.current,T=Js();yg(y,T,u,f,null,null)},Ag.prototype.unmount=Sg.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var f=u.containerInfo;yg(u.current,2,null,u,null,null),gd(),f[ti]=null}};function Ag(u){this._internalRoot=u}Ag.prototype.unstable_scheduleHydration=function(u){if(u){var f=Li();u={blockedOn:null,target:u,priority:f};for(var y=0;y<hl.length&&f!==0&&f<hl[y].priority;y++);hl.splice(y,0,u),y===0&&Uy(u)}};var jy=e.version;if(jy!=="19.2.4")throw Error(s(527,jy,"19.2.4"));be.findDOMNode=function(u){var f=u._reactInternals;if(f===void 0)throw typeof u.render=="function"?Error(s(188)):(u=Object.keys(u).join(","),Error(s(268,u)));return u=M(f),u=u!==null?I(u):null,u=u===null?null:u.stateNode,u};var $y={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:re,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bd.isDisabled&&Bd.supportsFiber)try{K=Bd.inject($y),ee=Bd}catch{}}return a_.createRoot=function(u,f){if(!l(u))throw Error(s(299));var y=!1,T="",D=Yh,L=bo,q=xo;return f!=null&&(f.unstable_strictMode===!0&&(y=!0),f.identifierPrefix!==void 0&&(T=f.identifierPrefix),f.onUncaughtError!==void 0&&(D=f.onUncaughtError),f.onCaughtError!==void 0&&(L=f.onCaughtError),f.onRecoverableError!==void 0&&(q=f.onRecoverableError)),f=ky(u,1,!1,null,null,y,T,null,D,L,q,Tg),u[ti]=f.current,zm(u),new Sg(f)},a_.hydrateRoot=function(u,f,y){if(!l(u))throw Error(s(299));var T=!1,D="",L=Yh,q=bo,ae=xo,De=null;return y!=null&&(y.unstable_strictMode===!0&&(T=!0),y.identifierPrefix!==void 0&&(D=y.identifierPrefix),y.onUncaughtError!==void 0&&(L=y.onUncaughtError),y.onCaughtError!==void 0&&(q=y.onCaughtError),y.onRecoverableError!==void 0&&(ae=y.onRecoverableError),y.formState!==void 0&&(De=y.formState)),f=ky(u,1,!0,f,y??null,T,D,De,L,q,ae,Tg),f.context=Ly(null),y=f.current,T=Js(),T=yn(T),D=Za(T),D.callback=null,go(y,D,T),y=T,f.current.lanes=y,oi(f,y),So(f),u[ti]=f.current,zm(u),new Ag(f)},a_.version="19.2.4",a_}var D1;function ME(){if(D1)return R0.exports;D1=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),R0.exports=CE(),R0.exports}var PE=ME();const IE=L_(PE);function RE({mode:i,basemap:e,onModeChange:t,onBasemapChange:s}){return Dn.jsxs("header",{className:"header",children:[Dn.jsx("span",{className:"header__title",children:"Geospatial Index Visualizer"}),Dn.jsxs("div",{className:"header__controls",children:[Dn.jsxs("div",{className:"toggle-group",role:"group","aria-label":"Index mode",children:[Dn.jsx("button",{className:`toggle-group__btn${i==="geohash"?" toggle-group__btn--active":""}`,onClick:()=>t("geohash"),children:"Geohash"}),Dn.jsx("button",{className:`toggle-group__btn${i==="h3"?" toggle-group__btn--active":""}`,onClick:()=>t("h3"),children:"H3"}),Dn.jsx("button",{className:`toggle-group__btn${i==="none"?" toggle-group__btn--active":""}`,onClick:()=>t("none"),children:"None"})]}),Dn.jsxs("div",{className:"toggle-group",role:"group","aria-label":"Basemap",children:[Dn.jsx("button",{className:`toggle-group__btn${e==="streets"?" toggle-group__btn--active":""}`,onClick:()=>s("streets"),children:"Streets"}),Dn.jsx("button",{className:`toggle-group__btn${e==="minimal"?" toggle-group__btn--active":""}`,onClick:()=>s("minimal"),children:"Minimal"})]})]})]})}function DE(){return Dn.jsxs("aside",{className:"left-panel",children:[Dn.jsx("section",{className:"left-panel__coordinate-input",children:Dn.jsx("p",{className:"left-panel__placeholder",children:"Coordinate input coming soon"})}),Dn.jsx("section",{className:"left-panel__metadata",children:Dn.jsx("p",{className:"left-panel__placeholder",children:"Click a cell to see its details"})})]})}function Mv(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const fx=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),O1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O1&&parseFloat(O1[1]);const k1=globalThis,L1=globalThis.process||{},OE=globalThis.navigator||{};function A2(i){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function ip(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||A2()}function kE(i){return ip()?A2()?"Electron":(OE.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const E2="4.1.1";function dx(i,e){if(!i)throw new Error("Assertion failed")}function C2(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return dx(Number.isFinite(e)&&e>=0),e}function LE(i){const{logLevel:e,message:t}=i;i.logLevel=C2(e);const s=i.args?Array.from(i.args):[];for(;s.length&&s.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&s.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const l=typeof i.message;return dx(l==="string"||l==="object"),Object.assign(i,{args:s},i.opts)}const kg=()=>{};class BE{constructor({level:e=0}={}){this.userData={},this._onceCache=new Set,this._level=e}set level(e){this.setLevel(e)}get level(){return this.getLevel()}setLevel(e){return this._level=e,this}getLevel(){return this._level}warn(e,...t){return this._log("warn",0,e,t,{once:!0})}error(e,...t){return this._log("error",0,e,t)}log(e,t,...s){return this._log("log",e,t,s)}info(e,t,...s){return this._log("info",e,t,s)}once(e,t,...s){return this._log("once",e,t,s,{once:!0})}_log(e,t,s,l,d={}){const g=LE({logLevel:t,message:s,args:this._buildArgs(t,s,l),opts:d});return this._createLogFunction(e,g,d)}_buildArgs(e,t,s){return[e,t,...s]}_createLogFunction(e,t,s){if(!this._shouldLog(t.logLevel))return kg;const l=this._getOnceTag(s.tag??t.tag??t.message);if((s.once||t.once)&&l!==void 0){if(this._onceCache.has(l))return kg;this._onceCache.add(l)}return this._emit(e,t)}_shouldLog(e){return this.getLevel()>=C2(e)}_getOnceTag(e){if(e!==void 0)try{return typeof e=="string"?e:String(e)}catch{return}}}function zE(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class FE{constructor(e,t,s="sessionStorage"){this.storage=zE(s),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function NE(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function UE(i,e=8){const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}var Pv;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Pv||(Pv={}));const VE=10;function B1(i){return typeof i!="string"?i:(i=i.toUpperCase(),Pv[i]||Pv.WHITE)}function jE(i,e,t){return!ip&&typeof i=="string"&&(e&&(i=`\x1B[${B1(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${B1(t)+VE}m${i}\x1B[49m`)),i}function $E(i,e=["constructor"]){const t=Object.getPrototypeOf(i),s=Object.getOwnPropertyNames(t),l=i;for(const d of s){const g=l[d];typeof g=="function"&&(e.find(o=>d===o)||(l[d]=g.bind(i)))}}function o_(){let i;if(ip()&&k1.performance)i=k1?.performance?.now?.();else if("hrtime"in L1){const e=L1?.hrtime?.();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}const Pg={debug:ip()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},L0={enabled:!0,level:0};class B_ extends BE{constructor({id:e}={id:""}){super({level:0}),this.VERSION=E2,this._startTs=o_(),this._deltaTs=o_(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new FE(`__probe-${this.id}__`,{[this.id]:L0}),this.timeStamp(`${this.id} started`),$E(this),Object.seal(this)}isEnabled(){return this._getConfiguration().enabled}getLevel(){return this._getConfiguration().level}getTotal(){return Number((o_()-this._startTs).toPrecision(10))}getDelta(){return Number((o_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._updateConfiguration({enabled:e}),this}setLevel(e){return this._updateConfiguration({level:e}),this}get(e){return this._getConfiguration()[e]}set(e,t){this._updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e,...t){return this._log("warn",0,e,t,{method:Pg.warn,once:!0})}error(e,...t){return this._log("error",0,e,t,{method:Pg.error})}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t,...s){return this._log("log",e,t,s,{method:Pg.log,time:!0,once:!0})}log(e,t,...s){return this._log("log",e,t,s,{method:Pg.debug})}info(e,t,...s){return this._log("info",e,t,s,{method:console.info})}once(e,t,...s){return this._log("once",e,t,s,{method:Pg.debug||Pg.info,once:!0})}table(e,t,s){return t?this._log("table",e,t,s&&[s]||[],{method:console.table||kg,tag:WE(t)}):kg}time(e,t){return this._log("time",e,t,[],{method:console.time?console.time:console.info})}timeEnd(e,t){return this._log("time",e,t,[],{method:console.timeEnd?console.timeEnd:console.info})}timeStamp(e,t){return this._log("time",e,t,[],{method:console.timeStamp||kg})}group(e,t,s={collapsed:!1}){const l=(s.collapsed?console.groupCollapsed:console.group)||console.info;return this._log("group",e,t,[],{method:l})}groupCollapsed(e,t,s={}){return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._log("groupEnd",e,"",[],{method:console.groupEnd||kg})}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&super._shouldLog(e)}_emit(e,t){const s=t.method;dx(s),t.total=this.getTotal(),t.delta=this.getDelta(),this._deltaTs=o_();const l=HE(this.id,t.message,t);return s.bind(console,l,...t.args)}_getConfiguration(){return this._storage.config[this.id]||this._updateConfiguration(L0),this._storage.config[this.id]}_updateConfiguration(e){const t=this._storage.config[this.id]||{...L0};this._storage.setConfiguration({[this.id]:{...t,...e}})}}B_.VERSION=E2;function HE(i,e,t){if(typeof e=="string"){const s=t.time?UE(NE(t.total)):"";e=t.time?`${i}: ${s}  ${e}`:`${i}: ${e}`,e=jE(e,t.color,t.background)}return e}function WE(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const B0="4.3.3",qE=B0[0]>="0"&&B0[0]<="9"?`v${B0}`:"";function XE(){const i=new B_({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=i,globalThis.loaders.version=qE,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=i,i}const GE=XE();function ZE(i,e){return M2(i||{},e)}function M2(i,e,t=0){if(t>3)return e;const s={...i};for(const[l,d]of Object.entries(e))d&&typeof d=="object"&&!Array.isArray(d)?s[l]=M2(s[l]||{},e[l],t+1):s[l]=e[l];return s}const YE="latest";function KE(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const QE=KE();function If(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const qd=typeof process!="object"||String(process)!=="[object process]"||process.browser,JE=typeof window<"u"&&typeof window.orientation<"u",z1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);z1&&parseFloat(z1[1]);class e3{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((s,l)=>{this._resolve=s,this._reject=l})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){If(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){If(this.isRunning),this.isRunning=!1,this._reject(e)}}class z0{terminate(){}}const F0=new Map;function t3(i){If(i.source&&!i.url||!i.source&&i.url);let e=F0.get(i.source||i.url);return e||(i.url&&(e=i3(i.url),F0.set(i.url,e)),i.source&&(e=P2(i.source),F0.set(i.source,e))),If(e),e}function i3(i){if(!i.startsWith("http"))return i;const e=n3(i);return P2(e)}function P2(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function n3(i){return`try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`}function I2(i,e=!0,t){const s=t||new Set;if(i){if(F1(i))s.add(i);else if(F1(i.buffer))s.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const l in i)I2(i[l],e,s)}}return t===void 0?Array.from(s):[]}function F1(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const N0=()=>{};class Cb{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&qd||typeof z0<"u"&&!qd}constructor(e){const{name:t,source:s,url:l}=e;If(s||l),this.name=t,this.source=s,this.url=l,this.onMessage=N0,this.onError=d=>console.log(d),this.worker=qd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=N0,this.onError=N0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||I2(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=t3({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new z0(s,{eval:!1})}else if(this.source)e=new z0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class r3{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Cb.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(l,d,g)=>l.done(g),s=(l,d)=>l.error(d)){const l=new Promise(d=>(this.jobQueue.push({name:e,onMessage:t,onError:s,onStart:d}),this));return this._startQueuedJob(),await l}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new e3(t.name,e);e.onMessage=l=>t.onMessage(s,l.type,l.payload),e.onError=l=>t.onError(s,l),t.onStart(s);try{await s.result}catch(l){console.error(`Worker exception: ${l}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!qd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Cb({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return JE?this.maxMobileConcurrency:this.maxConcurrency}}const s3={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class wf{props;workerPools=new Map;static _workerFarm;static isSupported(){return Cb.isSupported()}static getWorkerFarm(e={}){return wf._workerFarm=wf._workerFarm||new wf({}),wf._workerFarm.setProps(e),wf._workerFarm}constructor(e){this.props={...s3},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:s,url:l}=e;let d=this.workerPools.get(t);return d||(d=new r3({name:t,source:s,url:l}),d.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,d)),d}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function a3(i,e={}){const t=e[i.id]||{},s=qd?`${i.id}-worker.js`:`${i.id}-worker-node.js`;let l=t.workerUrl;if(!l&&i.id==="compression"&&(l=e.workerUrl),e._workerType==="test"&&(qd?l=`modules/${i.module}/dist/${s}`:l=`modules/${i.module}/src/workers/${i.id}-worker-node.ts`),!l){let d=i.version;d==="latest"&&(d=YE);const g=d?`@${d}`:"";l=`https://unpkg.com/@loaders.gl/${i.module}${g}/dist/${s}`}return If(l),l}function o3(i,e=QE){If(i,"no worker provided");const t=i.version;return!(!e||!t)}function l3(i,e){return!wf.isSupported()||!qd&&!e?._nodeWorkers?!1:i.worker&&e?.worker}async function c3(i,e,t,s,l){const d=i.id,g=a3(i,t),A=wf.getWorkerFarm(t).getWorkerPool({name:d,url:g});t=JSON.parse(JSON.stringify(t)),s=JSON.parse(JSON.stringify(s||{}));const M=await A.startJob("process-on-worker",u3.bind(null,l));return M.postMessage("process",{input:e,options:t,context:s}),await(await M.result).result}async function u3(i,e,t,s){switch(t){case"done":e.done(s);break;case"error":e.error(new Error(s.error));break;case"process":const{id:l,input:d,options:g}=s;try{const o=await i(d,g);e.postMessage("done",{id:l,result:o})}catch(o){const A=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:l,error:A})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function h3(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const s=new Uint8Array(i),l=new Uint8Array(e);for(let d=0;d<s.length;++d)if(s[d]!==l[d])return!1;return!0}function f3(...i){return d3(i)}function d3(i){const e=i.map(d=>d instanceof ArrayBuffer?new Uint8Array(d):d),t=e.reduce((d,g)=>d+g.byteLength,0),s=new Uint8Array(t);let l=0;for(const d of e)s.set(d,l),l+=d.byteLength;return s.buffer}async function p3(i){const e=[];for await(const t of i)e.push(t);return f3(...e)}function N1(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class U1{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=N1(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(N1()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Qv{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:s}=e;let l=this.stats[t];return l||(e instanceof U1?l=e:l=new U1(t,s),this.stats[t]=l),l}}let g3="";const V1={};function m3(i){for(const e in V1)if(i.startsWith(e)){const t=V1[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i=`${g3}${i}`),i}function _3(i){return i&&typeof i=="object"&&i.isBuffer}function R2(i){if(_3(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function D2(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function y3(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const v3=i=>typeof i=="boolean",v_=i=>typeof i=="function",z_=i=>i!==null&&typeof i=="object",j1=i=>z_(i)&&i.constructor==={}.constructor,b3=i=>!!i&&typeof i[Symbol.iterator]=="function",x3=i=>i&&typeof i[Symbol.asyncIterator]=="function",np=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,rp=i=>typeof Blob<"u"&&i instanceof Blob,w3=i=>i&&typeof i=="object"&&i.isBuffer,T3=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||z_(i)&&v_(i.tee)&&v_(i.cancel)&&v_(i.getReader),S3=i=>z_(i)&&v_(i.read)&&v_(i.pipe)&&v3(i.readable),O2=i=>T3(i)||S3(i);class A3 extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const E3=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,C3=/^([-\w.]+\/[-\w.+]+)/;function $1(i,e){return i.toLowerCase()===e.toLowerCase()}function M3(i){const e=C3.exec(i);return e?e[1]:i}function H1(i){const e=E3.exec(i);return e?e[1]:""}const k2=/\?.*/;function P3(i){const e=i.match(k2);return e&&e[0]}function px(i){return i.replace(k2,"")}function I3(i){if(i.length<50)return i;const e=i.slice(i.length-15);return`${i.substr(0,32)}...${e}`}function Jv(i){return np(i)?i.url:rp(i)?i.name||"":typeof i=="string"?i:""}function gx(i){if(np(i)){const e=i,t=e.headers.get("content-type")||"",s=px(e.url);return M3(t)||H1(s)}return rp(i)?i.type||"":typeof i=="string"?H1(i):""}function R3(i){return np(i)?i.headers["content-length"]||-1:rp(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function L2(i){if(np(i))return i;const e={},t=R3(i);t>=0&&(e["content-length"]=String(t));const s=Jv(i),l=gx(i);l&&(e["content-type"]=l);const d=await k3(i);d&&(e["x-first-bytes"]=d),typeof i=="string"&&(i=new TextEncoder().encode(i));const g=new Response(i,{headers:e});return Object.defineProperty(g,"url",{value:s}),g}async function D3(i){if(!i.ok)throw await O3(i)}async function O3(i){const e=I3(i.url);let t=`Failed to fetch resource (${i.status}) ${i.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const s={reason:i.statusText,url:i.url,response:i};try{const l=i.headers.get("Content-Type");s.reason=!i.bodyUsed&&l?.includes("application/json")?await i.json():await i.text()}catch{}return new A3(t,s)}async function k3(i){if(typeof i=="string")return`data:,${i.slice(0,5)}`;if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(s=>{const l=new FileReader;l.onload=d=>s(d?.target?.result),l.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5);return`data:base64,${L3(t)}`}return null}function L3(i){let e="";const t=new Uint8Array(i);for(let s=0;s<t.byteLength;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function B3(i){return!z3(i)&&!F3(i)}function z3(i){return i.startsWith("http:")||i.startsWith("https:")}function F3(i){return i.startsWith("data:")}async function W1(i,e){if(typeof i=="string"){const t=m3(i);return B3(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await L2(i)}const q1=new B_({id:"loaders.gl"});class N3{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class U3{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const B2={fetch:null,mimeType:void 0,nothrow:!1,log:new U3,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:fx,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},V3={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function z2(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state||(i._state={}),i._state}function F2(){const i=z2();return i.globalOptions=i.globalOptions||{...B2},i.globalOptions}function j3(i,e,t,s){return t=t||[],t=Array.isArray(t)?t:[t],$3(i,t),W3(e,i,s)}function $3(i,e){X1(i,null,B2,V3,e);for(const t of e){const s=i&&i[t.id]||{},l=t.options&&t.options[t.id]||{},d=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};X1(s,t.id,l,d,e)}}function X1(i,e,t,s,l){const d=e||"Top level",g=e?`${e}.`:"";for(const o in i){const A=!e&&z_(i[o]),M=o==="baseUri"&&!e,I=o==="workerUrl"&&e;if(!(o in t)&&!M&&!I){if(o in s)q1.warn(`${d} loader option '${g}${o}' no longer supported, use '${s[o]}'`)();else if(!A){const z=H3(o,l);q1.warn(`${d} loader option '${g}${o}' not recognized. ${z}`)()}}}}function H3(i,e){const t=i.toLowerCase();let s="";for(const l of e)for(const d in l.options){if(i===d)return`Did you mean '${l.id}.${d}'?`;const g=d.toLowerCase();(t.startsWith(g)||g.startsWith(t))&&(s=s||`Did you mean '${l.id}.${d}'?`)}return s}function W3(i,e,t){const l={...i.options||{}};return q3(l,t),l.log===null&&(l.log=new N3),G1(l,F2()),G1(l,e),l}function G1(i,e){for(const t in e)if(t in e){const s=e[t];j1(s)&&j1(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function q3(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function mx(i){return i?(Array.isArray(i)&&(i=i[0]),Array.isArray(i?.extensions)):!1}function _x(i){Mv(i,"null loader"),Mv(mx(i),"invalid loader");let e;return Array.isArray(i)&&(e=i[1],i=i[0],i={...i,options:{...i.options,...e}}),(i?.parseTextSync||i?.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const N2=()=>{const i=z2();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function X3(i){const e=N2();i=Array.isArray(i)?i:[i];for(const t of i){const s=_x(t);e.find(l=>s===l)||e.unshift(s)}}function G3(){return N2()}const Z3=/\.([^.]+)$/;async function Y3(i,e=[],t,s){if(!U2(i))return null;let l=Z1(i,e,{...t,nothrow:!0},s);if(l)return l;if(rp(i)&&(i=await i.slice(0,10).arrayBuffer(),l=Z1(i,e,t,s)),!l&&!t?.nothrow)throw new Error(V2(i));return l}function Z1(i,e=[],t,s){if(!U2(i))return null;if(e&&!Array.isArray(e))return _x(e);let l=[];e&&(l=l.concat(e)),t?.ignoreRegisteredLoaders||l.push(...G3()),Q3(l);const d=K3(i,l,t,s);if(!d&&!t?.nothrow)throw new Error(V2(i));return d}function K3(i,e,t,s){const l=Jv(i),d=gx(i),g=px(l)||s?.url;let o=null,A="";return t?.mimeType&&(o=U0(e,t?.mimeType),A=`match forced by supplied MIME type ${t?.mimeType}`),o=o||J3(e,g),A=A||(o?`matched url ${g}`:""),o=o||U0(e,d),A=A||(o?`matched MIME type ${d}`:""),o=o||tC(e,i),A=A||(o?`matched initial data ${j2(i)}`:""),t?.fallbackMimeType&&(o=o||U0(e,t?.fallbackMimeType),A=A||(o?`matched fallback MIME type ${d}`:"")),A&&GE.log(1,`selectLoader selected ${o?.name}: ${A}.`),o}function U2(i){return!(i instanceof Response&&i.status===204)}function V2(i){const e=Jv(i),t=gx(i);let s="No valid loader found (";s+=e?`${D2(e)}, `:"no url provided, ",s+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const l=i?j2(i):"";return s+=l?` first bytes: "${l}"`:"first bytes: not available",s+=")",s}function Q3(i){for(const e of i)_x(e)}function J3(i,e){const t=e&&Z3.exec(e),s=t&&t[1];return s?eC(i,s):null}function eC(i,e){e=e.toLowerCase();for(const t of i)for(const s of t.extensions)if(s.toLowerCase()===e)return t;return null}function U0(i,e){for(const t of i)if(t.mimeTypes?.some(s=>$1(e,s))||$1(e,`application/x.${t.id}`))return t;return null}function tC(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(iC(e,t))return t}else if(ArrayBuffer.isView(e)){if(Y1(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Y1(e,0,t))return t;return null}function iC(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(s=>i.startsWith(s))}function Y1(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(l=>nC(i,e,t,l))}function nC(i,e,t,s){if(s instanceof ArrayBuffer)return h3(s,i,s.byteLength);switch(typeof s){case"function":return s(i);case"string":const l=Mb(i,e,s.length);return s===l;default:return!1}}function j2(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Mb(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Mb(i,0,e):""}function Mb(i,e,t){if(i.byteLength<e+t)return"";const s=new DataView(i);let l="";for(let d=0;d<t;d++)l+=String.fromCharCode(s.getUint8(e+d));return l}const rC=256*1024;function*sC(i,e){const t=e?.chunkSize||rC;let s=0;const l=new TextEncoder;for(;s<i.length;){const d=Math.min(i.length-s,t),g=i.slice(s,s+d);s+=d,yield l.encode(g)}}const aC=256*1024;function*oC(i,e={}){const{chunkSize:t=aC}=e;let s=0;for(;s<i.byteLength;){const l=Math.min(i.byteLength-s,t),d=new ArrayBuffer(l),g=new Uint8Array(i,s,l);new Uint8Array(d).set(g),s+=l,yield d}}const lC=1024*1024;async function*cC(i,e){const t=e?.chunkSize||lC;let s=0;for(;s<i.size;){const l=s+t,d=await i.slice(s,l).arrayBuffer();s=l,yield d}}function K1(i,e){return fx?uC(i,e):hC(i)}async function*uC(i,e){const t=i.getReader();let s;try{for(;;){const l=s||t.read();e?._streamReadAhead&&(s=t.read());const{done:d,value:g}=await l;if(d)return;yield R2(g)}}catch{t.releaseLock()}}async function*hC(i,e){for await(const t of i)yield R2(t)}function fC(i,e){if(typeof i=="string")return sC(i,e);if(i instanceof ArrayBuffer)return oC(i,e);if(rp(i))return cC(i,e);if(O2(i))return K1(i,e);if(np(i))return K1(i.body,e);throw new Error("makeIterator")}const $2="Cannot convert supplied data type";function dC(i,e,t){if(e.text&&typeof i=="string")return i;if(w3(i)&&(i=i.buffer),i instanceof ArrayBuffer){const s=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let s=i.buffer;const l=i.byteLength||i.length;return(i.byteOffset!==0||l!==s.byteLength)&&(s=s.slice(i.byteOffset,i.byteOffset+l)),s}throw new Error($2)}async function pC(i,e,t){const s=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||s)return dC(i,e);if(rp(i)&&(i=await L2(i)),np(i)){const l=i;return await D3(l),e.binary?await l.arrayBuffer():await l.text()}if(O2(i)&&(i=fC(i,t)),b3(i)||x3(i))return p3(i);throw new Error($2)}function H2(i,e){const t=F2(),s=i||t;return typeof s.fetch=="function"?s.fetch:z_(s.fetch)?l=>W1(l,s.fetch):e?.fetch?e?.fetch:W1}function gC(i,e,t){if(t)return t;const s={fetch:H2(e,i),...i};if(s.url){const l=px(s.url);s.baseUrl=l,s.queryString=P3(s.url),s.filename=D2(l),s.baseUrl=y3(l)}return Array.isArray(s.loaders)||(s.loaders=null),s}function mC(i,e){if(i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const s=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...s]:s}return t&&t.length?t:void 0}async function Iv(i,e,t,s){e&&!Array.isArray(e)&&!mx(e)&&(s=void 0,t=e,e=void 0),i=await i,t=t||{};const l=Jv(i),g=mC(e,s),o=await Y3(i,g,t);return o?(t=j3(t,o,g,l),s=gC({url:l,_parse:Iv,loaders:g},t,s||null),await _C(o,i,t,s)):null}async function _C(i,e,t,s){if(o3(i),t=ZE(i.options,t),np(e)){const d=e,{ok:g,redirected:o,status:A,statusText:M,type:I,url:z}=d,W=Object.fromEntries(d.headers.entries());s.response={headers:W,ok:g,redirected:o,status:A,statusText:M,type:I,url:z}}e=await pC(e,i,t);const l=i;if(l.parseTextSync&&typeof e=="string")return l.parseTextSync(e,t,s);if(l3(i,t))return await c3(i,e,t,s,Iv);if(l.parseText&&typeof e=="string")return await l.parseText(e,t,s);if(l.parse)return await l.parse(e,t,s);throw If(!l.parseSync),new Error(`${i.id} loader - no parser found and worker is disabled`)}async function Rv(i,e,t,s){let l,d;!Array.isArray(e)&&!mx(e)?(l=[],d=e):(l=e,d=t);const g=H2(d);let o=i;return typeof i=="string"&&(o=await g(i)),rp(i)&&(o=await g(i)),Array.isArray(l)?await Iv(o,l,d):await Iv(o,l,d)}const yC="4.3.3",vC=globalThis.loaders?.parseImageNode,Pb=typeof Image<"u",Ib=typeof ImageBitmap<"u",bC=!!vC,Rb=fx?!0:bC;function xC(i){switch(i){case"auto":return Ib||Pb||Rb;case"imagebitmap":return Ib;case"image":return Pb;case"data":return Rb;default:throw new Error(`@loaders.gl/images: image ${i} not supported in this environment`)}}function wC(){if(Ib)return"imagebitmap";if(Pb)return"image";if(Rb)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function TC(i){const e=AC(i);if(!e)throw new Error("Not an image");return e}function SC(i){switch(TC(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function AC(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const EC=/^data:image\/svg\+xml/,CC=/\.svg((\?|#).*)?$/;function yx(i){return i&&(EC.test(i)||CC.test(i))}function MC(i,e){if(yx(e)){let s=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(d){throw new Error(d.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return W2(i,e)}function W2(i,e){if(yx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function q2(i,e,t){const s=MC(i,t),l=self.URL||self.webkitURL,d=typeof s!="string"&&l.createObjectURL(s);try{return await PC(d||s,e)}finally{d&&l.revokeObjectURL(d)}}async function PC(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((s,l)=>{try{t.onload=()=>s(t),t.onerror=d=>{const g=d instanceof Error?d.message:"error";l(new Error(g))}}catch(d){l(d)}})}const IC={};let Q1=!0;async function RC(i,e,t){let s;yx(t)?s=await q2(i,e,t):s=W2(i,t);const l=e&&e.imagebitmap;return await DC(s,l)}async function DC(i,e=null){if((OC(e)||!Q1)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),Q1=!1}return await createImageBitmap(i)}function OC(i){for(const e in i||IC)return!1;return!0}function kC(i){return!FC(i,"ftyp",4)||(i[8]&96)===0?null:LC(i)}function LC(i){switch(BC(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function BC(i,e,t){return String.fromCharCode(...i.slice(e,t))}function zC(i){return[...i].map(e=>e.charCodeAt(0))}function FC(i,e,t=0){const s=zC(e);for(let l=0;l<s.length;++l)if(s[l]!==i[l+t])return!1;return!0}const cu=!1,b_=!0;function X2(i){const e=F_(i);return UC(e)||$C(e)||VC(e)||jC(e)||NC(e)}function NC(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=kC(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function UC(i){const e=F_(i);return e.byteLength>=24&&e.getUint32(0,cu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,cu),height:e.getUint32(20,cu)}:null}function VC(i){const e=F_(i);return e.byteLength>=10&&e.getUint32(0,cu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,b_),height:e.getUint16(8,b_)}:null}function jC(i){const e=F_(i);return e.byteLength>=14&&e.getUint16(0,cu)===16973&&e.getUint32(2,b_)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,b_),height:e.getUint32(22,b_)}:null}function $C(i){const e=F_(i);if(!(e.byteLength>=3&&e.getUint16(0,cu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:l}=HC();let d=2;for(;d+9<e.byteLength;){const g=e.getUint16(d,cu);if(l.has(g))return{mimeType:"image/jpeg",height:e.getUint16(d+5,cu),width:e.getUint16(d+7,cu)};if(!s.has(g))return null;d+=2,d+=e.getUint16(d,cu)}return null}function HC(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function F_(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function WC(i,e){const{mimeType:t}=X2(i)||{},s=globalThis.loaders?.parseImageNode;return Mv(s),await s(i,t)}async function qC(i,e,t){e=e||{};const l=(e.image||{}).type||"auto",{url:d}=t||{},g=XC(l);let o;switch(g){case"imagebitmap":o=await RC(i,e,d);break;case"image":o=await q2(i,e,d);break;case"data":o=await WC(i);break;default:Mv(!1)}return l==="data"&&(o=SC(o)),o}function XC(i){switch(i){case"auto":case"data":return wC();default:return xC(i),i}}const GC=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ZC=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],YC={image:{type:"auto",decode:!0}},KC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:yC,mimeTypes:ZC,extensions:GC,parse:qC,tests:[i=>!!X2(new DataView(i))],options:YC},Ui=new B_({id:"deck"});let Db={};function QC(i){Db=i}function aa(i,e,t,s){Ui.level>0&&Db[i]&&Db[i].call(null,e,t,s)}function JC(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const eM={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:JC,parseTextSync:JSON.parse};function tM(){const i="9.2.9",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${i}`);return e||(Ui.log(1,`deck.gl ${i}`)(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:Ui,_registerLoggers:QC},X3([eM,[KC,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const iM=tM();function vx(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const V0={number:{type:"number",validate(i,e){return Number.isFinite(i)&&typeof e=="object"&&(e.max===void 0||i<=e.max)&&(e.min===void 0||i>=e.min)}},array:{type:"array",validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function nM(i){const e={};for(const[t,s]of Object.entries(i))e[t]=rM(s);return e}function rM(i){let e=J1(i);if(e!=="object")return{value:i,...V0[e],type:e};if(typeof i=="object")return i?i.type!==void 0?{...i,...V0[i.type],type:i.type}:i.value===void 0?{type:"object",value:i}:(e=J1(i.value),{...i,...V0[e],type:e}):{type:"object",value:null};throw new Error("props")}function J1(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const sM=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,aM=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,oM={vertex:sM,fragment:aM},ew=/void\s+main\s*\([^)]*\)\s*\{\n?/,tw=/}\n?[^{}]*$/,j0=[],pv="__LUMA_INJECT_DECLARATIONS__";function lM(i){const e={vertex:{},fragment:{}};for(const t in i){let s=i[t];const l=cM(t);typeof s=="string"&&(s={order:0,injection:s}),e[l][t]=s}return e}function cM(i){const e=i.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Dv(i,e,t,s=!1){const l=e==="vertex";for(const d in t){const g=t[d];g.sort((A,M)=>A.order-M.order),j0.length=g.length;for(let A=0,M=g.length;A<M;++A)j0[A]=g[A].injection;const o=`${j0.join(`
`)}
`;switch(d){case"vs:#decl":l&&(i=i.replace(pv,o));break;case"vs:#main-start":l&&(i=i.replace(ew,A=>A+o));break;case"vs:#main-end":l&&(i=i.replace(tw,A=>o+A));break;case"fs:#decl":l||(i=i.replace(pv,o));break;case"fs:#main-start":l||(i=i.replace(ew,A=>A+o));break;case"fs:#main-end":l||(i=i.replace(tw,A=>o+A));break;default:i=i.replace(d,A=>A+o)}}return i=i.replace(pv,""),s&&(i=i.replace(/\}\s*$/,d=>d+oM[e])),i}function Ov(i){i.map(e=>uM(e))}function uM(i){if(i.instance)return;Ov(i.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:s={}}=i,l={normalizedInjections:lM(s),parsedDeprecations:hM(t)};e&&(l.propValidators=nM(e)),i.instance=l;let d={};e&&(d=Object.entries(e).reduce((g,[o,A])=>{const M=A?.value;return M&&(g[o]=M),g},{})),i.defaultUniforms={...i.defaultUniforms,...d}}function G2(i,e,t){i.deprecations?.forEach(s=>{s.regex?.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function hM(i){return i.forEach(e=>{e.type==="function"?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)}),i}function bx(i){Ov(i);const e={},t={};Z2({modules:i,level:0,moduleMap:e,moduleDepth:t});const s=Object.keys(t).sort((l,d)=>t[d]-t[l]).map(l=>e[l]);return Ov(s),s}function Z2(i){const{modules:e,level:t,moduleMap:s,moduleDepth:l}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const d of e)s[d.name]=d,(l[d.name]===void 0||l[d.name]<t)&&(l[d.name]=t);for(const d of e)d.dependencies&&Z2({modules:d.dependencies,level:t+1,moduleMap:s,moduleDepth:l})}function fM(i){switch(i?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function dM(i,e){if(Number(i.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return i=iw(i,pM),i;case"fragment":return i=iw(i,gM),i;default:throw new Error(e)}}const Y2=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],pM=[...Y2,[Ob("attribute"),"in $1"],[Ob("varying"),"out $1"]],gM=[...Y2,[Ob("varying"),"in $1"]];function iw(i,e){for(const[t,s]of e)i=i.replace(t,s);return i}function Ob(i){return new RegExp(`\\b${i}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function K2(i,e){let t="";for(const s in i){const l=i[s];if(t+=`void ${l.signature} {
`,l.header&&(t+=`  ${l.header}`),e[s]){const d=e[s];d.sort((g,o)=>g.order-o.order);for(const g of d)t+=`  ${g.injection}
`}l.footer&&(t+=`  ${l.footer}`),t+=`}
`}return t}function Q2(i){const e={vertex:{},fragment:{}};for(const t of i){let s,l;typeof t!="string"?(s=t,l=s.hook):(s={},l=t),l=l.trim();const[d,g]=l.split(":"),o=l.replace(/\(.+/,""),A=Object.assign(s,{signature:g});switch(d){case"vs":e.vertex[o]=A;break;case"fs":e.fragment[o]=A;break;default:throw new Error(d)}}return e}function mM(i,e){return{name:_M(i,e),language:"glsl",version:yM(i)}}function _M(i,e="unnamed"){const s=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(i);return s?s[1]:e}function yM(i){let e=100;const t=i.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const s=parseInt(t[1],10);Number.isFinite(s)&&(e=s)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const J2=`

${pv}
`,vM=`precision highp float;
`;function bM(i){const e=bx(i.modules||[]);return{source:wM(i.platformInfo,{...i,source:i.source,stage:"vertex",modules:e}),getUniforms:eS(e)}}function xM(i){const{vs:e,fs:t}=i,s=bx(i.modules||[]);return{vs:nw(i.platformInfo,{...i,source:e,stage:"vertex",modules:s}),fs:nw(i.platformInfo,{...i,source:t,stage:"fragment",modules:s}),getUniforms:eS(s)}}function wM(i,e){const{source:t,stage:s,modules:l,hookFunctions:d=[],inject:g={},log:o}=e;vx(typeof t=="string","shader source must be a string");const A=t;let M="";const I=Q2(d),z={},W={},J={};for(const le in g){const ne=typeof g[le]=="string"?{injection:g[le],order:0}:g[le],Ie=/^(v|f)s:(#)?([\w-]+)$/.exec(le);if(Ie){const Ue=Ie[2],Se=Ie[3];Ue?Se==="decl"?W[le]=[ne]:J[le]=[ne]:z[le]=[ne]}else J[le]=[ne]}const oe=l;for(const le of oe){o&&G2(le,A,o);const ne=tS(le,"wgsl");M+=ne;const Ie=le.injections?.[s]||{};for(const Ue in Ie){const Se=/^(v|f)s:#([\w-]+)$/.exec(Ue);if(Se){const st=Se[2]==="decl"?W:J;st[Ue]=st[Ue]||[],st[Ue].push(Ie[Ue])}else z[Ue]=z[Ue]||[],z[Ue].push(Ie[Ue])}}return M+=J2,M=Dv(M,s,W),M+=K2(I[s],z),M+=A,M=Dv(M,s,J),M}function nw(i,e){const{source:t,stage:s,language:l="glsl",modules:d,defines:g={},hookFunctions:o=[],inject:A={},prologue:M=!0,log:I}=e;vx(typeof t=="string","shader source must be a string");const z=l==="glsl"?mM(t).version:-1,W=i.shaderLanguageVersion,J=z===100?"#version 100":"#version 300 es",le=t.split(`
`).slice(1).join(`
`),ne={};d.forEach(ot=>{Object.assign(ne,ot.defines)}),Object.assign(ne,g);let Ie="";switch(l){case"wgsl":break;case"glsl":Ie=M?`${J}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${fM(i)}
${s==="fragment"?vM:""}

// ----- APPLICATION DEFINES -------------------------

${TM(ne)}

`:`${J}
`;break}const Ue=Q2(o),Se={},Ve={},st={};for(const ot in A){const wt=typeof A[ot]=="string"?{injection:A[ot],order:0}:A[ot],Ft=/^(v|f)s:(#)?([\w-]+)$/.exec(ot);if(Ft){const lt=Ft[2],kt=Ft[3];lt?kt==="decl"?Ve[ot]=[wt]:st[ot]=[wt]:Se[ot]=[wt]}else st[ot]=[wt]}for(const ot of d){I&&G2(ot,le,I);const wt=tS(ot,s);Ie+=wt;const Ft=ot.instance?.normalizedInjections[s]||{};for(const lt in Ft){const kt=/^(v|f)s:#([\w-]+)$/.exec(lt);if(kt){const Lt=kt[2]==="decl"?Ve:st;Lt[lt]=Lt[lt]||[],Lt[lt].push(Ft[lt])}else Se[lt]=Se[lt]||[],Se[lt].push(Ft[lt])}}return Ie+="// ----- MAIN SHADER SOURCE -------------------------",Ie+=J2,Ie=Dv(Ie,s,Ve),Ie+=K2(Ue[s],Se),Ie+=le,Ie=Dv(Ie,s,st),l==="glsl"&&z!==W&&(Ie=dM(Ie,s)),Ie.trim()}function eS(i){return function(t){const s={};for(const l of i){const d=l.getUniforms?.(t,s);Object.assign(s,d)}return s}}function TM(i={}){let e="";for(const t in i){const s=i[t];(s||Number.isFinite(s))&&(e+=`#define ${t.toUpperCase()} ${i[t]}
`)}return e}function tS(i,e){let t;switch(e){case"vertex":t=i.vs||"";break;case"fragment":t=i.fs||"";break;case"wgsl":t=i.source||"";break;default:vx(!1)}if(!i.name)throw new Error("Shader module must have a name");const s=i.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let l=`// ----- MODULE ${i.name} ---------------

`;return e!=="wgsl"&&(l+=`#define MODULE_${s}
`),l+=`${t}
`,l}const SM=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,AM=/^\s*\#\s*endif\s*$/;function EM(i,e){const t=i.split(`
`),s=[];let l=!0,d=null;for(const g of t){const o=g.match(SM),A=g.match(AM);o?(d=o[1],l=!!e?.defines?.[d]):A?l=!0:l&&s.push(g)}return s.join(`
`)}class $d{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return $d.defaultShaderAssembler=$d.defaultShaderAssembler||new $d,$d.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(s=>s.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),s=this._hookFunctions,{source:l,getUniforms:d}=bM({...e,source:e.source,modules:t,hookFunctions:s});return{source:e.platformInfo.shaderLanguage==="wgsl"?EM(l):l,getUniforms:d,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),s=this._hookFunctions;return{...xM({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:s}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),s={};let l=0;for(let d=0,g=this._defaultModules.length;d<g;++d){const o=this._defaultModules[d],A=o.name;t[l++]=o,s[A]=!0}for(let d=0,g=e.length;d<g;++d){const o=e[d],A=o.name;s[A]||(t[l++]=o,s[A]=!0)}return t.length=l,Ov(t),t}}const CM=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,MM=`#version 300 es
${CM}`;function PM(i){const{input:e,inputChannels:t,output:s}={};if(!e)return MM;if(!t)throw new Error("inputChannels");const l=IM(t),d=RM(e,t);return`#version 300 es
in ${l} ${e};
out vec4 ${s};
void main() {
  ${s} = ${d};
}`}function IM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${i}`)}}function RM(i,e){switch(e){case 1:return`vec4(${i}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${i}, 0.0, 1.0)`;case 3:return`vec4(${i}, 1.0)`;case 4:return i;default:throw new Error(`invalid channels: ${e}`)}}class DM{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Qv({id:e})),this.stats.get(e)}}const iS=new DM,It=new B_({id:"luma.gl"}),$0={};function e0(i="id"){$0[i]=$0[i]||1;const e=$0[i]++;return`${i}-${e}`}let On=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,s){if(!e)throw new Error("no device");this._device=e,this.props=OM(t,s);const l=this.props.id!=="undefined"?this.props.id:e0(this[Symbol.toStringTag]);this.props.id=l,this.id=l,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const s=this._device.statsManager.getStats("Resource Counts");s.get("GPU Memory").addCount(e),s.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function OM(i,e){const t={...e};for(const s in i)i[s]!==void 0&&(t[s]=i[s]);return t}class $n extends On{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const s={...t};(t.usage||0)&$n.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?s.indexType="uint32":t.data instanceof Uint16Array?s.indexType="uint16":t.data instanceof Uint8Array&&(s.indexType="uint8")),delete s.data,super(e,s,$n.defaultProps),this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,s){const l=ArrayBuffer.isView(e)?e.buffer:e,d=Math.min(e?e.byteLength:s,$n.DEBUG_DATA_MAX_LENGTH);l===null?this.debugData=new ArrayBuffer(d):t===0&&s===l.byteLength?this.debugData=l.slice(0,d):this.debugData=l.slice(t,t+d)}static defaultProps={...On.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function nS(i){const[e,t,s]=Tx[i],l=i.includes("norm"),d=!l&&!i.startsWith("float"),g=i.startsWith("s");return{signedType:e,primitiveType:t,byteLength:s,normalized:l,integer:d,signed:g}}function kM(i){const e=i;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function LM(i,e){switch(e){case 1:return i;case 2:return i+i%2;default:return i+(4-i%4)%4}}function xx(i){const e=ArrayBuffer.isView(i)?i.constructor:i;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(Tx).find(s=>e===s[4]);if(!t)throw new Error(e.name);return t[0]}function wx(i){const[,,,,e]=Tx[i];return e}const Tx={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function Sx(i){let e;i.endsWith("-webgl")&&(i.replace("-webgl",""),e=!0);const[t,s]=i.split("x"),l=t,d=s?parseInt(s):1,g=nS(l),o={type:l,components:d,byteLength:g.byteLength*d,integer:g.integer,signed:g.signed,normalized:g.normalized};return e&&(o.webglOnly=!0),o}function BM(i,e,t){const s=t?kM(i):i;switch(s){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${s}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${s}x${e}`;default:return e===1?s:`${s}x${e}`}}function zM(i,e,t){if(!e||e>4)throw new Error(`size ${e}`);const s=e,l=xx(i);return BM(l,s,t)}function FM(i){let e;switch(i.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return i.components<=2?"float16x2":"float16x4"}return i.components===1?e:`${e}x${i.components}`}const na="texture-compression-bc",Rn="texture-compression-astc",au="texture-compression-etc2",NM="texture-compression-etc1-webgl",Xy="texture-compression-pvrtc-webgl",H0="texture-compression-atc-webgl",Gy="float32-renderable-webgl",W0="float16-renderable-webgl",UM="rgb9e5ufloat-renderable-webgl",q0="snorm8-renderable-webgl",l_="norm16-renderable-webgl",X0="snorm16-renderable-webgl",Zy="float32-filterable",rw="float16-filterable-webgl";function rS(i){const e=$M[i];if(!e)throw new Error(`Unsupported texture format ${i}`);return e}const VM={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:q0},rg8snorm:{render:q0},"rgb8snorm-webgl":{},rgba8snorm:{render:q0},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:l_},rg16unorm:{render:l_},"rgb16unorm-webgl":{f:l_},rgba16unorm:{render:l_},r16snorm:{f:X0},rg16snorm:{render:X0},"rgb16snorm-webgl":{f:l_},rgba16snorm:{render:X0},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:W0,filter:"float16-filterable-webgl"},rg16float:{render:W0,filter:rw},rgba16float:{render:W0,filter:rw},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Gy,filter:Zy},rg32float:{render:!1,filter:Zy},"rgb32float-webgl":{render:Gy,filter:Zy},rgba32float:{render:Gy,filter:Zy},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:UM},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Gy},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},jM={"bc1-rgb-unorm-webgl":{f:na},"bc1-rgb-unorm-srgb-webgl":{f:na},"bc1-rgba-unorm":{f:na},"bc1-rgba-unorm-srgb":{f:na},"bc2-rgba-unorm":{f:na},"bc2-rgba-unorm-srgb":{f:na},"bc3-rgba-unorm":{f:na},"bc3-rgba-unorm-srgb":{f:na},"bc4-r-unorm":{f:na},"bc4-r-snorm":{f:na},"bc5-rg-unorm":{f:na},"bc5-rg-snorm":{f:na},"bc6h-rgb-ufloat":{f:na},"bc6h-rgb-float":{f:na},"bc7-rgba-unorm":{f:na},"bc7-rgba-unorm-srgb":{f:na},"etc2-rgb8unorm":{f:au},"etc2-rgb8unorm-srgb":{f:au},"etc2-rgb8a1unorm":{f:au},"etc2-rgb8a1unorm-srgb":{f:au},"etc2-rgba8unorm":{f:au},"etc2-rgba8unorm-srgb":{f:au},"eac-r11unorm":{f:au},"eac-r11snorm":{f:au},"eac-rg11unorm":{f:au},"eac-rg11snorm":{f:au},"astc-4x4-unorm":{f:Rn},"astc-4x4-unorm-srgb":{f:Rn},"astc-5x4-unorm":{f:Rn},"astc-5x4-unorm-srgb":{f:Rn},"astc-5x5-unorm":{f:Rn},"astc-5x5-unorm-srgb":{f:Rn},"astc-6x5-unorm":{f:Rn},"astc-6x5-unorm-srgb":{f:Rn},"astc-6x6-unorm":{f:Rn},"astc-6x6-unorm-srgb":{f:Rn},"astc-8x5-unorm":{f:Rn},"astc-8x5-unorm-srgb":{f:Rn},"astc-8x6-unorm":{f:Rn},"astc-8x6-unorm-srgb":{f:Rn},"astc-8x8-unorm":{f:Rn},"astc-8x8-unorm-srgb":{f:Rn},"astc-10x5-unorm":{f:Rn},"astc-10x5-unorm-srgb":{f:Rn},"astc-10x6-unorm":{f:Rn},"astc-10x6-unorm-srgb":{f:Rn},"astc-10x8-unorm":{f:Rn},"astc-10x8-unorm-srgb":{f:Rn},"astc-10x10-unorm":{f:Rn},"astc-10x10-unorm-srgb":{f:Rn},"astc-12x10-unorm":{f:Rn},"astc-12x10-unorm-srgb":{f:Rn},"astc-12x12-unorm":{f:Rn},"astc-12x12-unorm-srgb":{f:Rn},"pvrtc-rgb4unorm-webgl":{f:Xy},"pvrtc-rgba4unorm-webgl":{f:Xy},"pvrtc-rbg2unorm-webgl":{f:Xy},"pvrtc-rgba2unorm-webgl":{f:Xy},"etc1-rbg-unorm-webgl":{f:NM},"atc-rgb-unorm-webgl":{f:H0},"atc-rgba-unorm-webgl":{f:H0},"atc-rgbai-unorm-webgl":{f:H0}},$M={...VM,...jM},HM=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],WM=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class qM{getInfo(e){return sw(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return HM.some(t=>e.startsWith(t))}getCapabilities(e){const t=rS(e),s={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},l=sw(e),d=e.startsWith("depth")||e.startsWith("stencil"),g=l?.signed,o=l?.integer,A=l?.webgl;return s.render&&=!g,s.filter&&=!d&&!g&&!o&&!A,s}}const Vg=new qM;function sw(i){let e=XM(i);if(Vg.isCompressed(i)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const s=GM(i);s&&(e.blockWidth=s.blockWidth,e.blockHeight=s.blockHeight)}const t=WM.exec(i);if(t){const[,s,l,d,g,o]=t,A=`${d}${l}`,M=nS(A),I=M.byteLength*8,z=s.length,W=[I,z>=2?I:0,z>=3?I:0,z>=4?I:0];e={format:i,attachment:e.attachment,dataType:M.signedType,components:z,channels:s,integer:M.integer,signed:M.signed,normalized:M.normalized,bitsPerChannel:W,bytesPerPixel:M.byteLength*s.length,packed:e.packed,srgb:e.srgb},o==="-webgl"&&(e.webgl=!0),g==="-srgb"&&(e.srgb=!0)}return i.endsWith("-webgl")&&(e.webgl=!0),i.endsWith("-srgb")&&(e.srgb=!0),e}function XM(i){const e=rS(i),t=e.bytesPerPixel||1,s=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:i,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:s,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function GM(i){const t=/.*-(\d+)x(\d+)-.*/.exec(i);if(t){const[,s,l]=t;return{blockWidth:Number(s),blockHeight:Number(l)}}return null}function ZM(i){return typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement||typeof VideoFrame<"u"&&i instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas}function YM(i){if(typeof ImageData<"u"&&i instanceof ImageData||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height};if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement)return{width:i.naturalWidth,height:i.naturalHeight};if(typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement)return{width:i.videoWidth,height:i.videoHeight};if(typeof VideoFrame<"u"&&i instanceof VideoFrame)return{width:i.displayWidth,height:i.displayHeight};throw new Error("Unknown image type")}class KM{}class QM{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Kd{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[s,l]=e.getDevicePixelSize();It.log(1,`${e} resized => ${s}x${l}px`)()},onPositionChange:(e,t)=>{const[s,l]=e.getPosition();It.log(1,`${e} repositioned => ${s},${l}`)()},onVisibilityChange:e=>It.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>It.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:It.get("debug")||void 0,debugShaders:It.get("debug-shaders")||void 0,debugFramebuffers:!!It.get("debug-framebuffers"),debugFactories:!!It.get("debug-factories"),debugWebGL:!!It.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=iS;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...Kd.defaultProps,...e},this.id=this.props.id||e0(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return Sx(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Vg.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const s=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(s),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,s=1){const l=Math.max(e,t,s);return 1+Math.floor(Math.log2(l))}isExternalImage(e){return ZM(e)}getExternalImageSize(e){return YM(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Vg.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...s){return this.props.onError(e,t)?()=>{}:It.error(e.message,t,...s)}debug(){if(this.props.debug)debugger;else It.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Vg.getCapabilities(e),s=d=>(typeof d=="string"?this.features.has(d):d)??!0,l=s(t.create);return{format:e,create:l,render:l&&s(t.render),filter:l&&s(t.filter),blend:l&&s(t.blend),store:l&&s(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&$n.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":e.data instanceof Uint8Array&&(t.data=new Uint16Array(e.data),t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const JM="set luma.log.level=1 (or higher) to trace rendering",aw="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class kv{static defaultProps={...Kd.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=iS;log=It;VERSION="9.2.6";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw It.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),It.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");It.error("This version of luma.gl has already been initialized")()}It.log(1,`${this.VERSION} - ${JM}`)(),globalThis.luma=this}async createDevice(e={}){const t={...kv.defaultProps,...e},s=this.selectAdapter(t.type,t.adapters);if(!s)throw new Error(aw);return t.waitForPageLoad&&await s.pageLoaded,await s.create(t)}async attachDevice(e,t){const s=this._getTypeFromHandle(e,t.adapters),l=s&&this.selectAdapter(s,t.adapters);if(!l)throw new Error(aw);return await l?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,s])=>s).filter(s=>s.isSupported?.()).map(s=>s.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],s=this._getAdapterMap(e);for(const l of t)if(s.get(l)?.isSupported?.())return l;return null}selectAdapter(e,t=[]){let s=e;e==="best-available"&&(s=this.getBestAvailableAdapterType(t));const l=this._getAdapterMap(t);return s&&l.get(s)||null}enforceWebGL2(e=!0,t=[]){const l=this._getAdapterMap(t).get("webgl");l||It.warn("enforceWebGL2: webgl adapter not found")(),l?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(kv.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const s of e)t.set(s.type,s);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?It.warn("WebGL1 is not supported",e)():It.warn("Unknown handle type",e)(),null)}}const kb=new kv;class eP{get pageLoaded(){return nP()}}const tP=ip()&&typeof document<"u",iP=()=>tP&&document.readyState==="complete";let Yy=null;function nP(){return Yy||(iP()||typeof window>"u"?Yy=Promise.resolve():Yy=new Promise(i=>window.addEventListener("load",()=>i()))),Yy}function rP(){let i,e;return{promise:new Promise((s,l)=>{i=s,e=l}),resolve:i,reject:e}}class Hd{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=rP();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Hd.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,ip()?e.canvas?typeof e.canvas=="string"?this.canvas=aP(e.canvas):this.canvas=e.canvas:this.canvas=oP(e):this.canvas={width:e.width||1,height:e.height||1},Hd.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Hd.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Hd.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const s=this.cssToDeviceRatio(),[l,d]=this.getDrawingBufferSize();return lP(e,s,l,d,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(l=>l.target===this.canvas);if(!t)return;const s=t.isIntersecting;this.isVisible!==s&&(this.isVisible=s,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(A=>A.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const s=this.getDevicePixelSize(),l=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,d=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[g,o]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(l,g)),this.devicePixelHeight=Math.max(1,Math.min(d,o)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:s})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const l=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:l})}}}}function sP(i){if(typeof i=="string"){const e=document.getElementById(i);if(!e)throw new Error(`${i} is not an HTML element`);return e}return i||document.body}function aP(i){const e=document.getElementById(i);if(!Hd.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function oP(i){const{width:e,height:t}=i,s=document.createElement("canvas");s.id=e0("lumagl-auto-created-canvas"),s.width=e||1,s.height=t||1,s.style.width=Number.isFinite(e)?`${e}px`:"100%",s.style.height=Number.isFinite(t)?`${t}px`:"100%",i?.visible||(s.style.visibility="hidden");const l=sP(i?.container||null);return l.insertBefore(s,l.firstChild),s}function lP(i,e,t,s,l){const d=i,g=ow(d[0],e,t);let o=lw(d[1],e,s,l),A=ow(d[0]+1,e,t);const M=A===t-1?A:A-1;A=lw(d[1]+1,e,s,l);let I;return l?(A=A===0?A:A+1,I=o,o=A):I=A===s-1?A:A-1,{x:g,y:o,width:Math.max(M-g+1,1),height:Math.max(I-o+1,1)}}function ow(i,e,t){return Math.min(Math.round(i*e),t-1)}function lw(i,e,t,s){return s?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}class Qd extends On{static defaultProps={...On.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Qd.normalizeProps(e,t),super(e,t,Qd.defaultProps)}static normalizeProps(e,t){return t}}const cP={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Kr extends On{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=Kr.normalizeProps(e,t),super(e,t,Kr.defaultProps),this.dimension=this.props.dimension,this.baseDimension=cP[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const s=e.getExternalImageSize(t.data);this.width=s?.width||1,this.height=s?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&It.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof Qd?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const s={...t},{width:l,height:d}=s;return typeof l=="number"&&(s.width=Math.max(1,Math.ceil(l))),typeof d=="number"&&(s.height=Math.max(1,Math.ceil(d))),s}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:s,depth:l}=this,d={...Kr.defaultCopyDataOptions,width:t,height:s,depth:l,...e},g=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!g.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return d.bytesPerRow=e.bytesPerRow||t*(g.bytesPerPixel||4),d.rowsPerImage=e.rowsPerImage||s,d}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),s={...Kr.defaultCopyExternalImageOptions,...t,...e};return s.width=Math.min(s.width,this.width-s.x),s.height=Math.min(s.height,this.height-s.y),s}static defaultProps={...On.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Kr.TEXTURE|Kr.RENDER_ATTACHMENT|Kr.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class t0 extends On{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,t0.defaultProps)}static defaultProps={...On.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function uP(i,e,t){let s="";const l=e.split(/\r?\n/),d=i.slice().sort((g,o)=>g.lineNum-o.lineNum);switch(t?.showSourceCode||"no"){case"all":let g=0;for(let o=1;o<=l.length;o++)for(s+=sS(l[o-1],o,t);d.length>g&&d[g].lineNum===o;){const A=d[g++];s+=G0(A,l,A.lineNum,{...t,inlineSource:!1})}for(;d.length>g;){const o=d[g++];s+=G0(o,[],0,{...t,inlineSource:!1})}return s;case"issues":case"no":for(const o of i)s+=G0(o,l,o.lineNum,{inlineSource:t?.showSourceCode!=="no"});return s}}function G0(i,e,t,s){if(s?.inlineSource){const d=hP(e,t),g=i.linePos>0?`${" ".repeat(i.linePos+5)}^^^
`:"";return`
${d}${g}${i.type.toUpperCase()}: ${i.message}

`}const l=i.type==="error"?"red":"#8B4000";return s?.html?`<div class='luma-compiler-log-error' style="color:${l};"><b> ${i.type.toUpperCase()}: ${i.message}</b></div>`:`${i.type.toUpperCase()}: ${i.message}`}function hP(i,e,t){let s="";for(let l=e-2;l<=e;l++){const d=i[l-1];d!==void 0&&(s+=sS(d,e,t))}return s}function sS(i,e,t){const s=t?.html?dP(i):i;return`${fP(String(e),4)}: ${s}${t?.html?"<br/>":`
`}`}function fP(i,e){let t="";for(let s=i.length;s<e;++s)t+=" ";return t+i}function dP(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class i0 extends On{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:pP(t),...t},i0.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const s=t,l=`${this.stage} shader "${s}"`;let d=uP(e,this.source,{showSourceCode:"all",html:!0});const g=this.getTranslatedSource();g&&(d+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${g}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Compilation error in ${l}</h1><br /><br />
<code style="user-select:text;"><pre>
${d}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const M=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(M)}}static defaultProps={...On.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function pP(i){return gP(i.source)||i.id||e0(`unnamed ${i.stage}-shader`)}function gP(i,e="unnamed"){const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(i);return s?s[1]:e}class n0 extends On{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,n0.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(l=>l.texture.clone(e)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:s})}resize(e){let t=!e;if(e){const[s,l]=Array.isArray(e)?e:[e.width,e.height];t=t||l!==this.height||s!==this.width,this.width=s,this.height=l}t&&(It.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,s)=>{if(typeof t=="string"){const l=this.createColorTexture(t,s);return this.attachResource(l),l.view}return t instanceof Kr?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof Kr?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Kr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Kr.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const l=this.colorAttachments[s].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=l.view,this.attachResource(l.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}static defaultProps={...On.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Xd extends On{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,Xd.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...On.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class jd extends On{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=jd.normalizeProps(e,t),super(e,t,jd.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...On.defaultProps,framebuffer:null,parameters:void 0,clearColor:jd.defaultClearColor,clearColors:void 0,clearDepth:jd.defaultClearDepth,clearStencil:jd.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Lv extends On{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Lv.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...On.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Ax extends On{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Ax.defaultProps)}static defaultProps={...On.defaultProps,measureExecutionTime:void 0}}class Ex extends On{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Ex.defaultProps)}static defaultProps={...On.defaultProps}}function aS(i){return vP[i]}function mP(i){const[e,t]=yP[i],s=e==="i32"||e==="u32",l=e!=="u32",d=_P[e]*t;return{primitiveType:e,components:t,byteLength:d,integer:s,signed:l}}const _P={f32:4,f16:2,i32:4,u32:4},yP={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},vP={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function oS(i,e){const t={};for(const s of i.attributes){const l=xP(i,e,s.name);l&&(t[s.name]=l)}return t}function bP(i,e,t=16){const s=oS(i,e),l=new Array(t).fill(null);for(const d of Object.values(s))l[d.location]=d;return l}function xP(i,e,t){const s=wP(i,t),l=TP(e,t);if(!s)return null;const d=mP(s.type),g=FM(d),o=l?.vertexFormat||g,A=Sx(o);return{attributeName:l?.attributeName||s.name,bufferName:l?.bufferName||s.name,location:s.location,shaderType:s.type,primitiveType:d.primitiveType,shaderComponents:d.components,vertexFormat:o,bufferDataType:A.type,bufferComponents:A.components,normalized:A.normalized,integer:d.integer,stepMode:l?.stepMode||s.stepMode||"vertex",byteOffset:l?.byteOffset||0,byteStride:l?.byteStride||0}}function wP(i,e){const t=i.attributes.find(s=>s.name===e);return t||It.warn(`shader layout attribute "${e}" not present in shader`),t||null}function TP(i,e){SP(i);let t=AP(i,e);return t||(t=EP(i,e),t)?t:(It.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function SP(i){for(const e of i)(e.attributes&&e.format||!e.attributes&&!e.format)&&It.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function AP(i,e){for(const t of i)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function EP(i,e){for(const t of i){let s=t.byteStride;if(typeof t.byteStride!="number")for(const d of t.attributes||[]){const g=Sx(d.format);s+=g.byteLength}const l=t.attributes?.find(d=>d.attribute===e);if(l)return{attributeName:l.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:l.format,byteOffset:l.byteOffset,byteStride:s}}return null}class Cx extends On{static defaultProps={...On.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Cx.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=bP(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Mx extends On{static defaultProps={...On.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Mx.defaultProps)}}class Px extends On{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Px.defaultProps)}static defaultProps={...On.defaultProps,type:void 0,count:void 0}}let Ky;function lS(i){return(!Ky||Ky.byteLength<i)&&(Ky=new ArrayBuffer(i)),Ky}function CP(i,e){const t=lS(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function MP(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Bv(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":MP(i)}const PP=1024;class IP{layout={};byteLength;constructor(e,t={}){let s=0;for(const[d,g]of Object.entries(e)){const o=aS(g),{type:A,components:M}=o,I=M*(t?.[d]??1);s=LM(s,I);const z=s;s+=I,this.layout[d]={type:A,size:I,offset:z}}s+=(4-s%4)%4;const l=s*4;this.byteLength=Math.max(l,PP)}getData(e){const t=lS(this.byteLength),s={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[l,d]of Object.entries(e)){const g=this.layout[l];if(!g){It.warn(`Supplied uniform value ${l} not present in uniform block layout`)();continue}const{type:o,size:A,offset:M}=g,I=s[o];if(A===1){if(typeof d!="number"&&typeof d!="boolean"){It.warn(`Supplied value for single component uniform ${l} is not a number: ${d}`)();continue}I[M]=Number(d)}else{if(!Bv(d)){It.warn(`Supplied value for multi component / array uniform ${l} is not a numeric array: ${d}`)();continue}I.set(d,M)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function RP(i,e,t=16){if(i!==e)return!1;const s=i,l=e;if(!Bv(s))return!1;if(Bv(l)&&s.length===l.length){for(let d=0;d<s.length;++d)if(l[d]!==s[d])return!1}return!0}function DP(i){return Bv(i)?i.slice():i}class OP{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(l=>l.type==="uniform"&&l.name===e?.name);if(!t)throw new Error(e?.name);const s=t;for(const l of s.uniforms||[])this.bindingLayout[l.name]=l}}setUniforms(e){for(const[t,s]of Object.entries(e))this._setUniform(t,s),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${s}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){RP(this.uniforms[e],t)||(this.uniforms[e]=DP(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class kP{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,s]of Object.entries(e)){const l=t,d=new IP(s.uniformTypes??{},s.uniformSizes??{});this.uniformBufferLayouts.set(l,d);const g=new OP({name:t});g.setUniforms(s.defaultUniforms||{}),this.uniformBlocks.set(l,g)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,s]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,s){s&&this.setUniforms(s);const l=this.getUniformBufferByteLength(t),d=e.createBuffer({usage:$n.UNIFORM|$n.COPY_DST,byteLength:l}),g=this.getUniformBufferData(t);return d.write(g),d}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const s=this.getUniformBufferByteLength(t),l=e.createBuffer({usage:$n.UNIFORM|$n.COPY_DST,byteLength:s});this.uniformBuffers.set(t,l)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const s=this.updateUniformBuffer(t);e||=s}return e&&It.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let s=this.uniformBuffers.get(e),l=!1;if(s&&t?.needsRedraw){l||=t.needsRedraw;const d=this.getUniformBufferData(e);s=this.uniformBuffers.get(e),s?.write(d);const g=this.uniformBlocks.get(e)?.getAllUniforms();It.log(4,`Writing to uniform buffer ${String(e)}`,d,g)()}return l}}class gl{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class cw{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Tf extends gl{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Mf extends gl{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Lb extends gl{constructor(e,t,s){super(e,s),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Jd extends gl{constructor(e,t,s,l){super(e,s),this.format=t,this.access=l}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var xf;(i=>{i[i.Uniform=0]="Uniform",i[i.Storage=1]="Storage",i[i.Texture=2]="Texture",i[i.Sampler=3]="Sampler",i[i.StorageTexture=4]="StorageTexture"})(xf||(xf={}));class Qy{constructor(e,t,s,l,d,g,o){this.name=e,this.type=t,this.group=s,this.binding=l,this.attributes=d,this.resourceType=g,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class LP{constructor(e,t){this.name=e,this.type=t}}class BP{constructor(e,t,s,l){this.name=e,this.type=t,this.locationType=s,this.location=l,this.interpolation=null}}class uw{constructor(e,t,s,l){this.name=e,this.type=t,this.locationType=s,this.location=l}}class zP{constructor(e,t,s,l){this.name=e,this.type=t,this.attributes=s,this.id=l}}class FP{constructor(e,t,s){this.name=e,this.type=t,this.attributes=s}}class NP{constructor(e,t=null,s){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=s}}class UP{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function VP(i){var e=(32768&i)>>15,t=(31744&i)>>10,s=1023&i;return t==0?(e?-1:1)*Math.pow(2,-14)*(s/Math.pow(2,10)):t==31?s?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+s/Math.pow(2,10))}const cS=new Float32Array(1),jP=new Int32Array(cS.buffer),ra=new Uint16Array(1);function $P(i){cS[0]=i;const e=jP[0],t=e>>31&1;let s=e>>23&255,l=8388607&e;if(s===255)return ra[0]=t<<15|31744|(l!==0?512:0),ra[0];if(s===0){if(l===0)return ra[0]=t<<15,ra[0];l|=8388608;let d=113;for(;!(8388608&l);)l<<=1,d--;return s=127-d,l&=8388607,s>0?(l=(l>>126-s)+(l>>127-s&1),ra[0]=t<<15|s<<10|l>>13,ra[0]):(ra[0]=t<<15,ra[0])}return s=s-127+15,s>=31?(ra[0]=t<<15|31744,ra[0]):s<=0?s<-10?(ra[0]=t<<15,ra[0]):(l=(8388608|l)>>1-s,ra[0]=t<<15|l>>13,ra[0]):(l>>=13,ra[0]=t<<15|s<<10|l,ra[0])}const Ix=new Uint32Array(1),uS=new Float32Array(Ix.buffer,0,1);function hw(i){const e=112+(i>>6&31)<<23|(63&i)<<17;return Ix[0]=e,uS[0]}function HP(i,e,t,s,l,d,g,o,A){const M=s*(g>>=l)*(d>>=l)+t*g+e*o;switch(A){case"r8unorm":return[un(i,M,"8unorm",1)[0]];case"r8snorm":return[un(i,M,"8snorm",1)[0]];case"r8uint":return[un(i,M,"8uint",1)[0]];case"r8sint":return[un(i,M,"8sint",1)[0]];case"rg8unorm":{const I=un(i,M,"8unorm",2);return[I[0],I[1]]}case"rg8snorm":{const I=un(i,M,"8snorm",2);return[I[0],I[1]]}case"rg8uint":{const I=un(i,M,"8uint",2);return[I[0],I[1]]}case"rg8sint":{const I=un(i,M,"8sint",2);return[I[0],I[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const I=un(i,M,"8unorm",4);return[I[0],I[1],I[2],I[3]]}case"rgba8snorm":{const I=un(i,M,"8snorm",4);return[I[0],I[1],I[2],I[3]]}case"rgba8uint":{const I=un(i,M,"8uint",4);return[I[0],I[1],I[2],I[3]]}case"rgba8sint":{const I=un(i,M,"8sint",4);return[I[0],I[1],I[2],I[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const I=un(i,M,"8unorm",4);return[I[2],I[1],I[0],I[3]]}case"r16uint":return[un(i,M,"16uint",1)[0]];case"r16sint":return[un(i,M,"16sint",1)[0]];case"r16float":return[un(i,M,"16float",1)[0]];case"rg16uint":{const I=un(i,M,"16uint",2);return[I[0],I[1]]}case"rg16sint":{const I=un(i,M,"16sint",2);return[I[0],I[1]]}case"rg16float":{const I=un(i,M,"16float",2);return[I[0],I[1]]}case"rgba16uint":{const I=un(i,M,"16uint",4);return[I[0],I[1],I[2],I[3]]}case"rgba16sint":{const I=un(i,M,"16sint",4);return[I[0],I[1],I[2],I[3]]}case"rgba16float":{const I=un(i,M,"16float",4);return[I[0],I[1],I[2],I[3]]}case"r32uint":return[un(i,M,"32uint",1)[0]];case"r32sint":return[un(i,M,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[un(i,M,"32float",1)[0]];case"rg32uint":{const I=un(i,M,"32uint",2);return[I[0],I[1]]}case"rg32sint":{const I=un(i,M,"32sint",2);return[I[0],I[1]]}case"rg32float":{const I=un(i,M,"32float",2);return[I[0],I[1]]}case"rgba32uint":{const I=un(i,M,"32uint",4);return[I[0],I[1],I[2],I[3]]}case"rgba32sint":{const I=un(i,M,"32sint",4);return[I[0],I[1],I[2],I[3]]}case"rgba32float":{const I=un(i,M,"32float",4);return[I[0],I[1],I[2],I[3]]}case"rg11b10ufloat":{const I=new Uint32Array(i.buffer,M,1)[0],z=(4192256&I)>>11,W=(4290772992&I)>>22;return[hw(2047&I),hw(z),(function(J){const oe=112+(J>>5&31)<<23|(31&J)<<18;return Ix[0]=oe,uS[0]})(W),1]}}return null}function un(i,e,t,s){const l=[0,0,0,0];for(let d=0;d<s;++d)switch(t){case"8unorm":l[d]=i[e]/255,e++;break;case"8snorm":l[d]=i[e]/255*2-1,e++;break;case"8uint":l[d]=i[e],e++;break;case"8sint":l[d]=i[e]-127,e++;break;case"16uint":l[d]=i[e]|i[e+1]<<8,e+=2;break;case"16sint":l[d]=(i[e]|i[e+1]<<8)-32768,e+=2;break;case"16float":l[d]=VP(i[e]|i[e+1]<<8),e+=2;break;case"32uint":case"32sint":l[d]=i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24,e+=4;break;case"32float":l[d]=new Float32Array(i.buffer,e,1)[0],e+=4}return l}function pn(i,e,t,s,l){for(let d=0;d<s;++d)switch(t){case"8unorm":i[e]=255*l[d],e++;break;case"8snorm":i[e]=.5*(l[d]+1)*255,e++;break;case"8uint":i[e]=l[d],e++;break;case"8sint":i[e]=l[d]+127,e++;break;case"16uint":new Uint16Array(i.buffer,e,1)[0]=l[d],e+=2;break;case"16sint":new Int16Array(i.buffer,e,1)[0]=l[d],e+=2;break;case"16float":{const g=$P(l[d]);new Uint16Array(i.buffer,e,1)[0]=g,e+=2;break}case"32uint":new Uint32Array(i.buffer,e,1)[0]=l[d],e+=4;break;case"32sint":new Int32Array(i.buffer,e,1)[0]=l[d],e+=4;break;case"32float":new Float32Array(i.buffer,e,1)[0]=l[d],e+=4}return l}const Z0={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class vl{constructor(){this.id=vl._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(zv.instance);for(const s of e)s instanceof Array?this.searchBlock(s,t):s.search(t);t(Fv.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}vl._id=0;class zv extends vl{}zv.instance=new zv;class Fv extends vl{}Fv.instance=new Fv;const hS=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class nr extends vl{constructor(){super()}}class M_ extends nr{constructor(e,t,s,l,d,g){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=s,this.body=l,this.startLine=d,this.endLine=g}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class WP extends nr{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class fS extends nr{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Bb extends nr{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class dS extends nr{constructor(e,t,s,l){super(),this.init=e,this.condition=t,this.increment=s,this.body=l}get astNodeType(){return"for"}search(e){var t,s,l;(t=this.init)===null||t===void 0||t.search(e),(s=this.condition)===null||s===void 0||s.search(e),(l=this.increment)===null||l===void 0||l.search(e),this.searchBlock(this.body,e)}}class mh extends nr{constructor(e,t,s,l,d){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=l,this.value=d}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Rx extends nr{constructor(e,t,s){super(),this.attributes=null,this.name=e,this.type=t,this.value=s}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class x_ extends nr{constructor(e,t,s,l,d){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=l,this.value=d}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class gv extends nr{constructor(e,t,s,l,d){super(),this.attributes=null,this.name=e,this.type=t,this.storage=s,this.access=l,this.value=d}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Lg,d_,tt,je;(i=>{i.increment="++",i.decrement="--"})(Lg||(Lg={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return i[t]}})(Lg||(Lg={}));class pS extends nr{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(i=>{i.assign="=",i.addAssign="+=",i.subtractAssin="-=",i.multiplyAssign="*=",i.divideAssign="/=",i.moduloAssign="%=",i.andAssign="&=",i.orAssign="|=",i.xorAssign="^=",i.shiftLeftAssign="<<=",i.shiftRightAssign=">>="})(d_||(d_={})),(i=>{i.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(d_||(d_={}));class gS extends nr{constructor(e,t,s){super(),this.operator=e,this.variable=t,this.value=s}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Dx extends nr{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return hS.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class mS extends nr{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class _S extends nr{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class yS extends nr{constructor(e,t,s,l){super(),this.condition=e,this.body=t,this.elseif=s,this.else=l}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class vS extends nr{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class qP extends nr{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class XP extends nr{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class bS extends nr{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Ox extends nr{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class GP extends nr{constructor(){super()}get astNodeType(){return"discard"}}class xS extends nr{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class wS extends nr{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Et extends nr{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const l=Et._priority.get(t.name);Et._priority.get(e[s].name)<l&&(t=e[s])}return t.name==="x32"?Et.i32:t}getTypeName(){return this.name}}Et.x32=new Et("x32"),Et.f32=new Et("f32"),Et.i32=new Et("i32"),Et.u32=new Et("u32"),Et.f16=new Et("f16"),Et.bool=new Et("bool"),Et.void=new Et("void"),Et._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class fw extends Et{constructor(e){super(e)}}class ph extends Et{constructor(e,t,s,l){super(e),this.members=t,this.startLine=s,this.endLine=l}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class Ge extends Et{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}Ge.vec2f=new Ge("vec2",Et.f32,null),Ge.vec3f=new Ge("vec3",Et.f32,null),Ge.vec4f=new Ge("vec4",Et.f32,null),Ge.vec2i=new Ge("vec2",Et.i32,null),Ge.vec3i=new Ge("vec3",Et.i32,null),Ge.vec4i=new Ge("vec4",Et.i32,null),Ge.vec2u=new Ge("vec2",Et.u32,null),Ge.vec3u=new Ge("vec3",Et.u32,null),Ge.vec4u=new Ge("vec4",Et.u32,null),Ge.vec2h=new Ge("vec2",Et.f16,null),Ge.vec3h=new Ge("vec3",Et.f16,null),Ge.vec4h=new Ge("vec4",Et.f16,null),Ge.vec2b=new Ge("vec2",Et.bool,null),Ge.vec3b=new Ge("vec3",Et.bool,null),Ge.vec4b=new Ge("vec4",Et.bool,null),Ge.mat2x2f=new Ge("mat2x2",Et.f32,null),Ge.mat2x3f=new Ge("mat2x3",Et.f32,null),Ge.mat2x4f=new Ge("mat2x4",Et.f32,null),Ge.mat3x2f=new Ge("mat3x2",Et.f32,null),Ge.mat3x3f=new Ge("mat3x3",Et.f32,null),Ge.mat3x4f=new Ge("mat3x4",Et.f32,null),Ge.mat4x2f=new Ge("mat4x2",Et.f32,null),Ge.mat4x3f=new Ge("mat4x3",Et.f32,null),Ge.mat4x4f=new Ge("mat4x4",Et.f32,null),Ge.mat2x2h=new Ge("mat2x2",Et.f16,null),Ge.mat2x3h=new Ge("mat2x3",Et.f16,null),Ge.mat2x4h=new Ge("mat2x4",Et.f16,null),Ge.mat3x2h=new Ge("mat3x2",Et.f16,null),Ge.mat3x3h=new Ge("mat3x3",Et.f16,null),Ge.mat3x4h=new Ge("mat3x4",Et.f16,null),Ge.mat4x2h=new Ge("mat4x2",Et.f16,null),Ge.mat4x3h=new Ge("mat4x3",Et.f16,null),Ge.mat4x4h=new Ge("mat4x4",Et.f16,null),Ge.mat2x2i=new Ge("mat2x2",Et.i32,null),Ge.mat2x3i=new Ge("mat2x3",Et.i32,null),Ge.mat2x4i=new Ge("mat2x4",Et.i32,null),Ge.mat3x2i=new Ge("mat3x2",Et.i32,null),Ge.mat3x3i=new Ge("mat3x3",Et.i32,null),Ge.mat3x4i=new Ge("mat3x4",Et.i32,null),Ge.mat4x2i=new Ge("mat4x2",Et.i32,null),Ge.mat4x3i=new Ge("mat4x3",Et.i32,null),Ge.mat4x4i=new Ge("mat4x4",Et.i32,null),Ge.mat2x2u=new Ge("mat2x2",Et.u32,null),Ge.mat2x3u=new Ge("mat2x3",Et.u32,null),Ge.mat2x4u=new Ge("mat2x4",Et.u32,null),Ge.mat3x2u=new Ge("mat3x2",Et.u32,null),Ge.mat3x3u=new Ge("mat3x3",Et.u32,null),Ge.mat3x4u=new Ge("mat3x4",Et.u32,null),Ge.mat4x2u=new Ge("mat4x2",Et.u32,null),Ge.mat4x3u=new Ge("mat4x3",Et.u32,null),Ge.mat4x4u=new Ge("mat4x4",Et.u32,null);class mv extends Et{constructor(e,t,s,l){super(e),this.storage=t,this.type=s,this.access=l}get astNodeType(){return"pointer"}}class w_ extends Et{constructor(e,t,s,l){super(e),this.attributes=t,this.format=s,this.count=l}get astNodeType(){return"array"}get isArray(){return!0}}class p_ extends Et{constructor(e,t,s){super(e),this.format=t,this.access=s}get astNodeType(){return"sampler"}}class _c extends vl{constructor(){super(),this.postfix=null}}class ep extends _c{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class lu extends _c{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class kx extends _c{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return hS.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class Ro extends _c{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class TS extends _c{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const s=e.evalExpression(this.initializer,e.context);return s!==null&&this.postfix?s.getSubData(e,this.postfix,e.context):s}return null}search(e){this.initializer.search(e)}}class Zr extends _c{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Ne}get isVector(){return this.value instanceof xe||this.value instanceof _i}get scalarValue(){return this.value instanceof Ne?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof xe||this.value instanceof _i?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class SS extends _c{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Wg extends _c{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class AS extends _c{constructor(){super()}}class zr extends AS{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class fc extends AS{constructor(e,t,s){super(),this.operator=e,this.left=t,this.right=s}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Et.f32:e.name==="u32"||t.name==="u32"?Et.u32:Et.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class ES extends vl{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class _v extends _c{constructor(){super()}get astNodeType(){return"default"}}class CS extends ES{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class MS extends ES{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class dw extends vl{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"argument"}}class ZP extends vl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pw extends vl{constructor(e,t,s){super(),this.name=e,this.type=t,this.attributes=s}get astNodeType(){return"member"}}class PS extends vl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class yl{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=yl._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,s,l){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,s){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}yl._id=0;class zb extends yl{constructor(){super(new gl("void",null),null)}toString(){return"void"}}zb.void=new zb;class Ig extends yl{constructor(e){super(new Lb("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,s,l){this.reference.setDataValue(e,t,s,l)}getSubData(e,t,s){return t?this.reference.getSubData(e,t,s):this}toString(){return`&${this.reference.toString()}`}}class Ne extends yl{constructor(e,t,s=null){super(t,s),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Ne(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ne(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ne(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,s,l){if(s)return void console.error("SetDataValue: Scalar data does not support postfix",s);if(!(t instanceof Ne))return void console.error("SetDataValue: Invalid value",t);let d=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?d=Math.floor(d):this.typeInfo.name==="bool"&&(d=d?1:0),this.data[0]=d}getSubData(e,t,s){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function YP(i,e,t){const s=e.length;return s===2?t==="f32"?new xe(new Float32Array(e),i.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new xe(new Int32Array(e),i.getTypeInfo("vec2i")):t==="u32"?new xe(new Uint32Array(e),i.getTypeInfo("vec2u")):t==="f16"?new xe(new Float32Array(e),i.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):s===3?t==="f32"?new xe(new Float32Array(e),i.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new xe(new Int32Array(e),i.getTypeInfo("vec3i")):t==="u32"?new xe(new Uint32Array(e),i.getTypeInfo("vec3u")):t==="f16"?new xe(new Float32Array(e),i.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):s===4?t==="f32"?new xe(new Float32Array(e),i.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new xe(new Int32Array(e),i.getTypeInfo("vec4i")):t==="u32"?new xe(new Uint32Array(e),i.getTypeInfo("vec4u")):t==="f16"?new xe(new Float32Array(e),i.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class xe extends yl{constructor(e,t,s=null){if(super(t,s),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?this.data=new Float32Array(e):l==="vec2i"||l==="vec3i"||l==="vec4i"?this.data=new Int32Array(e):l==="vec2u"||l==="vec3u"||l==="vec4u"?this.data=new Uint32Array(e):l==="vec2h"||l==="vec3h"||l==="vec4h"?this.data=new Float32Array(e):l==="vec2b"||l==="vec3b"||l==="vec4b"?this.data=new Int32Array(e):l==="vec2"||l==="vec3"||l==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${l}`)}}clone(){if(this.data instanceof Float32Array)return new xe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new xe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new xe(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,s,l){s instanceof ep?console.error("TODO: Set vector postfix"):t instanceof xe?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;let l=e.getTypeInfo("f32");if(this.typeInfo instanceof Jd)l=this.typeInfo.format||l;else{const g=this.typeInfo.name;g==="vec2f"||g==="vec3f"||g==="vec4f"?l=e.getTypeInfo("f32"):g==="vec2i"||g==="vec3i"||g==="vec4i"?l=e.getTypeInfo("i32"):g==="vec2b"||g==="vec3b"||g==="vec4b"?l=e.getTypeInfo("bool"):g==="vec2u"||g==="vec3u"||g==="vec4u"?l=e.getTypeInfo("u32"):g==="vec2h"||g==="vec3h"||g==="vec4h"?l=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${g}`)}let d=this;for(;t!==null&&d!==null;){if(t instanceof Wg){const g=t.index;let o=-1;if(g instanceof Zr){if(!(g.value instanceof Ne))return console.error(`GetSubData: Invalid array index ${g.value}`),null;o=g.value.value}else{const A=e.evalExpression(g,s);if(!(A instanceof Ne))return console.error("GetSubData: Unknown index type",g),null;o=A.value}if(o<0||o>=d.data.length)return console.error("GetSubData: Index out of range",o),null;if(d.data instanceof Float32Array){const A=new Float32Array(d.data.buffer,d.data.byteOffset+4*o,1);return new Ne(A,l)}if(d.data instanceof Int32Array){const A=new Int32Array(d.data.buffer,d.data.byteOffset+4*o,1);return new Ne(A,l)}if(d.data instanceof Uint32Array){const A=new Uint32Array(d.data.buffer,d.data.byteOffset+4*o,1);return new Ne(A,l)}throw"GetSubData: Invalid data type"}if(!(t instanceof ep))return console.error("GetSubData: Unknown postfix",t),null;{const g=t.value.toLowerCase();if(g.length===1){let A=0;if(g==="x"||g==="r")A=0;else if(g==="y"||g==="g")A=1;else if(g==="z"||g==="b")A=2;else{if(g!=="w"&&g!=="a")return console.error(`GetSubData: Unknown member ${g}`),null;A=3}if(this.data instanceof Float32Array){let M=new Float32Array(this.data.buffer,this.data.byteOffset+4*A,1);return new Ne(M,l,this)}if(this.data instanceof Int32Array){let M=new Int32Array(this.data.buffer,this.data.byteOffset+4*A,1);return new Ne(M,l,this)}if(this.data instanceof Uint32Array){let M=new Uint32Array(this.data.buffer,this.data.byteOffset+4*A,1);return new Ne(M,l,this)}}const o=[];for(const A of g)A==="x"||A==="r"?o.push(this.data[0]):A==="y"||A==="g"?o.push(this.data[1]):A==="z"||A==="b"?o.push(this.data[2]):A==="w"||A==="a"?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${A}`);d=YP(e,o,l.name)}t=t.postfix}return d}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class _i extends yl{constructor(e,t,s=null){super(t,s),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new _i(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,s,l){s instanceof ep?console.error("TODO: Set matrix postfix"):t instanceof _i?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,s){if(t===null)return this;const l=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Jd)this.typeInfo.format;else if(l.endsWith("f"))e.getTypeInfo("f32");else if(l.endsWith("i"))e.getTypeInfo("i32");else if(l.endsWith("u"))e.getTypeInfo("u32");else{if(!l.endsWith("h"))return console.error(`GetDataValue: Unknown type ${l}`),null;e.getTypeInfo("f16")}if(t instanceof Wg){const d=t.index;let g=-1;if(d instanceof Zr){if(!(d.value instanceof Ne))return console.error(`GetDataValue: Invalid array index ${d.value}`),null;g=d.value.value}else{const M=e.evalExpression(d,s);if(!(M instanceof Ne))return console.error("GetDataValue: Unknown index type",d),null;g=M.value}if(g<0||g>=this.data.length)return console.error("GetDataValue: Index out of range",g),null;const o=l.endsWith("h")?"h":"f";let A;if(l==="mat2x2"||l==="mat2x2f"||l==="mat2x2h"||l==="mat3x2"||l==="mat3x2f"||l==="mat3x2h"||l==="mat4x2"||l==="mat4x2f"||l==="mat4x2h")A=new xe(new Float32Array(this.data.buffer,this.data.byteOffset+2*g*4,2),e.getTypeInfo(`vec2${o}`));else if(l==="mat2x3"||l==="mat2x3f"||l==="mat2x3h"||l==="mat3x3"||l==="mat3x3f"||l==="mat3x3h"||l==="mat4x3"||l==="mat4x3f"||l==="mat4x3h")A=new xe(new Float32Array(this.data.buffer,this.data.byteOffset+3*g*4,3),e.getTypeInfo(`vec3${o}`));else{if(l!=="mat2x4"&&l!=="mat2x4f"&&l!=="mat2x4h"&&l!=="mat3x4"&&l!=="mat3x4f"&&l!=="mat3x4h"&&l!=="mat4x4"&&l!=="mat4x4f"&&l!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${l}`),null;A=new xe(new Float32Array(this.data.buffer,this.data.byteOffset+4*g*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?A.getSubData(e,t.postfix,s):A}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class wr extends yl{constructor(e,t,s=0,l=null){super(t,l),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=s}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new wr(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,s,l){if(t===null)return void console.log("setDataValue: NULL data.");let d=this.offset,g=this.typeInfo;for(;s;){if(s instanceof Wg)if(g instanceof Mf){const o=s.index;if(o instanceof Zr){if(!(o.value instanceof Ne))return void console.error(`SetDataValue: Invalid index type ${o.value}`);d+=o.value.value*g.stride}else{const A=e.evalExpression(o,l);if(!(A instanceof Ne))return void console.error("SetDataValue: Unknown index type",o);d+=A.value*g.stride}g=g.format}else console.error(`SetDataValue: Type ${g.getTypeName()} is not an array`);else{if(!(s instanceof ep))return void console.error("SetDataValue: Unknown postfix type",s);{const o=s.value;if(g instanceof Tf){let A=!1;for(const M of g.members)if(M.name===o){d+=M.offset,g=M.type,A=!0;break}if(!A)return void console.error(`SetDataValue: Member ${o} not found`)}else if(g instanceof gl){const A=g.getTypeName();let M=0;if(o==="x"||o==="r")M=0;else if(o==="y"||o==="g")M=1;else if(o==="z"||o==="b")M=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);M=3}if(!(t instanceof Ne))return void console.error("SetDataValue: Invalid value",t);const I=t.value;return A==="vec2f"?void(new Float32Array(this.buffer,d,2)[M]=I):A==="vec3f"?void(new Float32Array(this.buffer,d,3)[M]=I):A==="vec4f"?void(new Float32Array(this.buffer,d,4)[M]=I):A==="vec2i"?void(new Int32Array(this.buffer,d,2)[M]=I):A==="vec3i"?void(new Int32Array(this.buffer,d,3)[M]=I):A==="vec4i"?void(new Int32Array(this.buffer,d,4)[M]=I):A==="vec2u"?void(new Uint32Array(this.buffer,d,2)[M]=I):A==="vec3u"?void(new Uint32Array(this.buffer,d,3)[M]=I):A==="vec4u"?void(new Uint32Array(this.buffer,d,4)[M]=I):void console.error(`SetDataValue: Type ${A} is not a struct`)}}}s=s.postfix}this.setData(e,t,g,d,l)}setData(e,t,s,l,d){const g=s.getTypeName();if(g!=="f32"&&g!=="f16")if(g!=="i32"&&g!=="atomic<i32>"&&g!=="x32")if(g!=="u32"&&g!=="atomic<u32>")if(g!=="bool"){if(g==="vec2f"||g==="vec2h"){const o=new Float32Array(this.buffer,l,2);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(g==="vec3f"||g==="vec3h"){const o=new Float32Array(this.buffer,l,3);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(g==="vec4f"||g==="vec4h"){const o=new Float32Array(this.buffer,l,4);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(g==="vec2i"){const o=new Int32Array(this.buffer,l,2);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(g==="vec3i"){const o=new Int32Array(this.buffer,l,3);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(g==="vec4i"){const o=new Int32Array(this.buffer,l,4);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(g==="vec2u"){const o=new Uint32Array(this.buffer,l,2);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(g==="vec3u"){const o=new Uint32Array(this.buffer,l,3);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(g==="vec4u"){const o=new Uint32Array(this.buffer,l,4);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(g==="vec2b"){const o=new Uint32Array(this.buffer,l,2);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(g==="vec3b"){const o=new Uint32Array(this.buffer,l,3);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(g==="vec4b"){const o=new Uint32Array(this.buffer,l,4);return void(t instanceof xe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(g==="mat2x2f"||g==="mat2x2h"){const o=new Float32Array(this.buffer,l,4);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(g==="mat2x3f"||g==="mat2x3h"){const o=new Float32Array(this.buffer,l,6);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(g==="mat2x4f"||g==="mat2x4h"){const o=new Float32Array(this.buffer,l,8);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(g==="mat3x2f"||g==="mat3x2h"){const o=new Float32Array(this.buffer,l,6);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(g==="mat3x3f"||g==="mat3x3h"){const o=new Float32Array(this.buffer,l,9);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8]))}if(g==="mat3x4f"||g==="mat3x4h"){const o=new Float32Array(this.buffer,l,12);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(g==="mat4x2f"||g==="mat4x2h"){const o=new Float32Array(this.buffer,l,8);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(g==="mat4x3f"||g==="mat4x3h"){const o=new Float32Array(this.buffer,l,12);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(g==="mat4x4f"||g==="mat4x4h"){const o=new Float32Array(this.buffer,l,16);return void(t instanceof _i?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11],o[12]=t.data[12],o[13]=t.data[13],o[14]=t.data[14],o[15]=t.data[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]))}if(t instanceof wr){if(s===t.typeInfo)return void new Uint8Array(this.buffer,l,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",g,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${g}`)}else t instanceof Ne&&(new Int32Array(this.buffer,l,1)[0]=t.value);else t instanceof Ne&&(new Uint32Array(this.buffer,l,1)[0]=t.value);else t instanceof Ne&&(new Int32Array(this.buffer,l,1)[0]=t.value);else t instanceof Ne&&(new Float32Array(this.buffer,l,1)[0]=t.value)}getSubData(e,t,s){var l,d,g;if(t===null)return this;let o=this.offset,A=this.typeInfo;for(;t;){if(t instanceof Wg){const I=t.index,z=I instanceof _c?e.evalExpression(I,s):I;let W=0;if(z instanceof Ne?W=z.value:typeof z=="number"?W=z:console.error("GetDataValue: Invalid index type",I),A instanceof Mf)o+=W*A.stride,A=A.format;else{const J=A.getTypeName();J==="mat4x4"||J==="mat4x4f"||J==="mat4x4h"?(o+=16*W,A=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${A.getTypeName()} is not an array`)}}else{if(!(t instanceof ep))return console.error("GetDataValue: Unknown postfix type",t),null;{const I=t.value;if(A instanceof Tf){let z=!1;for(const W of A.members)if(W.name===I){o+=W.offset,A=W.type,z=!0;break}if(!z)return console.error(`GetDataValue: Member ${I} not found`),null}else if(A instanceof gl){const z=A.getTypeName();if(z==="vec2f"||z==="vec3f"||z==="vec4f"||z==="vec2i"||z==="vec3i"||z==="vec4i"||z==="vec2u"||z==="vec3u"||z==="vec4u"||z==="vec2b"||z==="vec3b"||z==="vec4b"||z==="vec2h"||z==="vec3h"||z==="vec4h"||z==="vec2"||z==="vec3"||z==="vec4"){if(I.length>0&&I.length<5){let W="f";const J=[];for(let oe=0;oe<I.length;++oe){const le=I[oe].toLowerCase();let ne=0;if(le==="x"||le==="r")ne=0;else if(le==="y"||le==="g")ne=1;else if(le==="z"||le==="b")ne=2;else{if(le!=="w"&&le!=="a")return console.error(`Unknown member ${I}`),null;ne=3}if(I.length===1){if(z.endsWith("f"))return this.buffer.byteLength<o+4*ne+4?(console.log("Insufficient buffer data"),null):new Ne(new Float32Array(this.buffer,o+4*ne,1),e.getTypeInfo("f32"),this);if(z.endsWith("h"))return new Ne(new Float32Array(this.buffer,o+4*ne,1),e.getTypeInfo("f16"),this);if(z.endsWith("i"))return new Ne(new Int32Array(this.buffer,o+4*ne,1),e.getTypeInfo("i32"),this);if(z.endsWith("b"))return new Ne(new Int32Array(this.buffer,o+4*ne,1),e.getTypeInfo("bool"),this);if(z.endsWith("u"))return new Ne(new Uint32Array(this.buffer,o+4*ne,1),e.getTypeInfo("i32"),this)}if(z==="vec2f")J.push(new Float32Array(this.buffer,o,2)[ne]);else if(z==="vec3f"){if(o+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const Ie=new Float32Array(this.buffer,o,3);J.push(Ie[ne])}else if(z==="vec4f")J.push(new Float32Array(this.buffer,o,4)[ne]);else if(z==="vec2i")W="i",J.push(new Int32Array(this.buffer,o,2)[ne]);else if(z==="vec3i")W="i",J.push(new Int32Array(this.buffer,o,3)[ne]);else if(z==="vec4i")W="i",J.push(new Int32Array(this.buffer,o,4)[ne]);else if(z==="vec2u"){W="u";const Ie=new Uint32Array(this.buffer,o,2);J.push(Ie[ne])}else z==="vec3u"?(W="u",J.push(new Uint32Array(this.buffer,o,3)[ne])):z==="vec4u"&&(W="u",J.push(new Uint32Array(this.buffer,o,4)[ne]))}return J.length===2?A=e.getTypeInfo(`vec2${W}`):J.length===3?A=e.getTypeInfo(`vec3${W}`):J.length===4?A=e.getTypeInfo(`vec4${W}`):console.error(`GetDataValue: Invalid vector length ${J.length}`),new xe(J,A,null)}return console.error(`GetDataValue: Unknown member ${I}`),null}return console.error(`GetDataValue: Type ${z} is not a struct`),null}}}t=t.postfix}const M=A.getTypeName();return M==="f32"?new Ne(new Float32Array(this.buffer,o,1),A,this):M==="i32"?new Ne(new Int32Array(this.buffer,o,1),A,this):M==="u32"?new Ne(new Uint32Array(this.buffer,o,1),A,this):M==="vec2f"?new xe(new Float32Array(this.buffer,o,2),A,this):M==="vec3f"?new xe(new Float32Array(this.buffer,o,3),A,this):M==="vec4f"?new xe(new Float32Array(this.buffer,o,4),A,this):M==="vec2i"?new xe(new Int32Array(this.buffer,o,2),A,this):M==="vec3i"?new xe(new Int32Array(this.buffer,o,3),A,this):M==="vec4i"?new xe(new Int32Array(this.buffer,o,4),A,this):M==="vec2u"?new xe(new Uint32Array(this.buffer,o,2),A,this):M==="vec3u"?new xe(new Uint32Array(this.buffer,o,3),A,this):M==="vec4u"?new xe(new Uint32Array(this.buffer,o,4),A,this):A instanceof Jd&&A.name==="atomic"?((l=A.format)===null||l===void 0?void 0:l.name)==="u32"?new Ne(new Uint32Array(this.buffer,o,1)[0],A.format,this):((d=A.format)===null||d===void 0?void 0:d.name)==="i32"?new Ne(new Int32Array(this.buffer,o,1)[0],A.format,this):(console.error(`GetDataValue: Invalid atomic format ${(g=A.format)===null||g===void 0?void 0:g.name}`),null):new wr(this.buffer,A,o,this)}toString(){let e="";if(this.typeInfo instanceof Mf)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let s=1;s<t.length;++s)e+=`, ${t[s]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let s=1;s<t.length/2;++s)e+=`, [${t[2*s]}, ${t[2*s+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let s=4;s<t.length;s+=4)e+=`, [${t[s]}, ${t[s+1]}, ${t[s+2]}, ${t[s+3]}]`}else e="[...]";else this.typeInfo instanceof Tf?e+="{...}":e="[...]";return e}}class gh extends yl{constructor(e,t,s,l){super(t,null),this.data=e,this.descriptor=s,this.view=l}clone(){return new gh(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>0?(e=s[0])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.width)!==null&&t!==void 0?t:0}get height(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>1?(e=s[1])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const s=this.descriptor.size;return s instanceof Array&&s.length>2?(e=s[2])!==null&&e!==void 0?e:0:s instanceof Object&&(t=s.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let s=0;s<t.length;++s)t[s]=Math.max(1,t[s]>>e);return t}get texelByteSize(){const e=this.format,t=Z0[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Z0[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Z0[e],s=this.width;if(!e||s<=0||!t)return-1;const l=this.height,d=this.depthOrArrayLayers,g=this.dimension;return s/t.blockWidth*(g==="1d"?1:l/t.blockHeight)*t.bytesPerBlock*d}getPixel(e,t,s=0,l=0){const d=this.texelByteSize,g=this.bytesPerRow,o=this.height,A=this.data[l];return HP(new Uint8Array(A),e,t,s,l,o,g,d,this.format)}setPixel(e,t,s,l,d){const g=this.texelByteSize,o=this.bytesPerRow,A=this.height,M=this.data[l];(function(I,z,W,J,oe,le,ne,Ie,Ue,Se){const Ve=J*(ne>>=oe)*(le>>=oe)+W*ne+z*Ie;switch(Ue){case"r8unorm":return void pn(I,Ve,"8unorm",1,Se);case"r8snorm":return void pn(I,Ve,"8snorm",1,Se);case"r8uint":return void pn(I,Ve,"8uint",1,Se);case"r8sint":return void pn(I,Ve,"8sint",1,Se);case"rg8unorm":return void pn(I,Ve,"8unorm",2,Se);case"rg8snorm":return void pn(I,Ve,"8snorm",2,Se);case"rg8uint":return void pn(I,Ve,"8uint",2,Se);case"rg8sint":return void pn(I,Ve,"8sint",2,Se);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void pn(I,Ve,"8unorm",4,Se);case"rgba8snorm":return void pn(I,Ve,"8snorm",4,Se);case"rgba8uint":return void pn(I,Ve,"8uint",4,Se);case"rgba8sint":return void pn(I,Ve,"8sint",4,Se);case"r16uint":return void pn(I,Ve,"16uint",1,Se);case"r16sint":return void pn(I,Ve,"16sint",1,Se);case"r16float":return void pn(I,Ve,"16float",1,Se);case"rg16uint":return void pn(I,Ve,"16uint",2,Se);case"rg16sint":return void pn(I,Ve,"16sint",2,Se);case"rg16float":return void pn(I,Ve,"16float",2,Se);case"rgba16uint":return void pn(I,Ve,"16uint",4,Se);case"rgba16sint":return void pn(I,Ve,"16sint",4,Se);case"rgba16float":return void pn(I,Ve,"16float",4,Se);case"r32uint":return void pn(I,Ve,"32uint",1,Se);case"r32sint":return void pn(I,Ve,"32sint",1,Se);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void pn(I,Ve,"32float",1,Se);case"rg32uint":return void pn(I,Ve,"32uint",2,Se);case"rg32sint":return void pn(I,Ve,"32sint",2,Se);case"rg32float":return void pn(I,Ve,"32float",2,Se);case"rgba32uint":return void pn(I,Ve,"32uint",4,Se);case"rgba32sint":return void pn(I,Ve,"32sint",4,Se);case"rgba32float":return void pn(I,Ve,"32float",4,Se);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(M),e,t,s,l,A,o,g,this.format,d)}}(i=>{i[i.token=0]="token",i[i.keyword=1]="keyword",i[i.reserved=2]="reserved"})(je||(je={}));class $e{constructor(e,t,s){this.name=e,this.type=t,this.rule=s}toString(){return this.name}}class pe{}tt=pe,pe.none=new $e("",je.reserved,""),pe.eof=new $e("EOF",je.token,""),pe.reserved={asm:new $e("asm",je.reserved,"asm"),bf16:new $e("bf16",je.reserved,"bf16"),do:new $e("do",je.reserved,"do"),enum:new $e("enum",je.reserved,"enum"),f16:new $e("f16",je.reserved,"f16"),f64:new $e("f64",je.reserved,"f64"),handle:new $e("handle",je.reserved,"handle"),i8:new $e("i8",je.reserved,"i8"),i16:new $e("i16",je.reserved,"i16"),i64:new $e("i64",je.reserved,"i64"),mat:new $e("mat",je.reserved,"mat"),premerge:new $e("premerge",je.reserved,"premerge"),regardless:new $e("regardless",je.reserved,"regardless"),typedef:new $e("typedef",je.reserved,"typedef"),u8:new $e("u8",je.reserved,"u8"),u16:new $e("u16",je.reserved,"u16"),u64:new $e("u64",je.reserved,"u64"),unless:new $e("unless",je.reserved,"unless"),using:new $e("using",je.reserved,"using"),vec:new $e("vec",je.reserved,"vec"),void:new $e("void",je.reserved,"void")},pe.keywords={array:new $e("array",je.keyword,"array"),atomic:new $e("atomic",je.keyword,"atomic"),bool:new $e("bool",je.keyword,"bool"),f32:new $e("f32",je.keyword,"f32"),i32:new $e("i32",je.keyword,"i32"),mat2x2:new $e("mat2x2",je.keyword,"mat2x2"),mat2x3:new $e("mat2x3",je.keyword,"mat2x3"),mat2x4:new $e("mat2x4",je.keyword,"mat2x4"),mat3x2:new $e("mat3x2",je.keyword,"mat3x2"),mat3x3:new $e("mat3x3",je.keyword,"mat3x3"),mat3x4:new $e("mat3x4",je.keyword,"mat3x4"),mat4x2:new $e("mat4x2",je.keyword,"mat4x2"),mat4x3:new $e("mat4x3",je.keyword,"mat4x3"),mat4x4:new $e("mat4x4",je.keyword,"mat4x4"),ptr:new $e("ptr",je.keyword,"ptr"),sampler:new $e("sampler",je.keyword,"sampler"),sampler_comparison:new $e("sampler_comparison",je.keyword,"sampler_comparison"),struct:new $e("struct",je.keyword,"struct"),texture_1d:new $e("texture_1d",je.keyword,"texture_1d"),texture_2d:new $e("texture_2d",je.keyword,"texture_2d"),texture_2d_array:new $e("texture_2d_array",je.keyword,"texture_2d_array"),texture_3d:new $e("texture_3d",je.keyword,"texture_3d"),texture_cube:new $e("texture_cube",je.keyword,"texture_cube"),texture_cube_array:new $e("texture_cube_array",je.keyword,"texture_cube_array"),texture_multisampled_2d:new $e("texture_multisampled_2d",je.keyword,"texture_multisampled_2d"),texture_storage_1d:new $e("texture_storage_1d",je.keyword,"texture_storage_1d"),texture_storage_2d:new $e("texture_storage_2d",je.keyword,"texture_storage_2d"),texture_storage_2d_array:new $e("texture_storage_2d_array",je.keyword,"texture_storage_2d_array"),texture_storage_3d:new $e("texture_storage_3d",je.keyword,"texture_storage_3d"),texture_depth_2d:new $e("texture_depth_2d",je.keyword,"texture_depth_2d"),texture_depth_2d_array:new $e("texture_depth_2d_array",je.keyword,"texture_depth_2d_array"),texture_depth_cube:new $e("texture_depth_cube",je.keyword,"texture_depth_cube"),texture_depth_cube_array:new $e("texture_depth_cube_array",je.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new $e("texture_depth_multisampled_2d",je.keyword,"texture_depth_multisampled_2d"),texture_external:new $e("texture_external",je.keyword,"texture_external"),u32:new $e("u32",je.keyword,"u32"),vec2:new $e("vec2",je.keyword,"vec2"),vec3:new $e("vec3",je.keyword,"vec3"),vec4:new $e("vec4",je.keyword,"vec4"),bitcast:new $e("bitcast",je.keyword,"bitcast"),block:new $e("block",je.keyword,"block"),break:new $e("break",je.keyword,"break"),case:new $e("case",je.keyword,"case"),continue:new $e("continue",je.keyword,"continue"),continuing:new $e("continuing",je.keyword,"continuing"),default:new $e("default",je.keyword,"default"),diagnostic:new $e("diagnostic",je.keyword,"diagnostic"),discard:new $e("discard",je.keyword,"discard"),else:new $e("else",je.keyword,"else"),enable:new $e("enable",je.keyword,"enable"),fallthrough:new $e("fallthrough",je.keyword,"fallthrough"),false:new $e("false",je.keyword,"false"),fn:new $e("fn",je.keyword,"fn"),for:new $e("for",je.keyword,"for"),function:new $e("function",je.keyword,"function"),if:new $e("if",je.keyword,"if"),let:new $e("let",je.keyword,"let"),const:new $e("const",je.keyword,"const"),loop:new $e("loop",je.keyword,"loop"),while:new $e("while",je.keyword,"while"),private:new $e("private",je.keyword,"private"),read:new $e("read",je.keyword,"read"),read_write:new $e("read_write",je.keyword,"read_write"),return:new $e("return",je.keyword,"return"),requires:new $e("requires",je.keyword,"requires"),storage:new $e("storage",je.keyword,"storage"),switch:new $e("switch",je.keyword,"switch"),true:new $e("true",je.keyword,"true"),alias:new $e("alias",je.keyword,"alias"),type:new $e("type",je.keyword,"type"),uniform:new $e("uniform",je.keyword,"uniform"),var:new $e("var",je.keyword,"var"),override:new $e("override",je.keyword,"override"),workgroup:new $e("workgroup",je.keyword,"workgroup"),write:new $e("write",je.keyword,"write"),r8unorm:new $e("r8unorm",je.keyword,"r8unorm"),r8snorm:new $e("r8snorm",je.keyword,"r8snorm"),r8uint:new $e("r8uint",je.keyword,"r8uint"),r8sint:new $e("r8sint",je.keyword,"r8sint"),r16uint:new $e("r16uint",je.keyword,"r16uint"),r16sint:new $e("r16sint",je.keyword,"r16sint"),r16float:new $e("r16float",je.keyword,"r16float"),rg8unorm:new $e("rg8unorm",je.keyword,"rg8unorm"),rg8snorm:new $e("rg8snorm",je.keyword,"rg8snorm"),rg8uint:new $e("rg8uint",je.keyword,"rg8uint"),rg8sint:new $e("rg8sint",je.keyword,"rg8sint"),r32uint:new $e("r32uint",je.keyword,"r32uint"),r32sint:new $e("r32sint",je.keyword,"r32sint"),r32float:new $e("r32float",je.keyword,"r32float"),rg16uint:new $e("rg16uint",je.keyword,"rg16uint"),rg16sint:new $e("rg16sint",je.keyword,"rg16sint"),rg16float:new $e("rg16float",je.keyword,"rg16float"),rgba8unorm:new $e("rgba8unorm",je.keyword,"rgba8unorm"),rgba8unorm_srgb:new $e("rgba8unorm_srgb",je.keyword,"rgba8unorm_srgb"),rgba8snorm:new $e("rgba8snorm",je.keyword,"rgba8snorm"),rgba8uint:new $e("rgba8uint",je.keyword,"rgba8uint"),rgba8sint:new $e("rgba8sint",je.keyword,"rgba8sint"),bgra8unorm:new $e("bgra8unorm",je.keyword,"bgra8unorm"),bgra8unorm_srgb:new $e("bgra8unorm_srgb",je.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new $e("rgb10a2unorm",je.keyword,"rgb10a2unorm"),rg11b10float:new $e("rg11b10float",je.keyword,"rg11b10float"),rg32uint:new $e("rg32uint",je.keyword,"rg32uint"),rg32sint:new $e("rg32sint",je.keyword,"rg32sint"),rg32float:new $e("rg32float",je.keyword,"rg32float"),rgba16uint:new $e("rgba16uint",je.keyword,"rgba16uint"),rgba16sint:new $e("rgba16sint",je.keyword,"rgba16sint"),rgba16float:new $e("rgba16float",je.keyword,"rgba16float"),rgba32uint:new $e("rgba32uint",je.keyword,"rgba32uint"),rgba32sint:new $e("rgba32sint",je.keyword,"rgba32sint"),rgba32float:new $e("rgba32float",je.keyword,"rgba32float"),static_assert:new $e("static_assert",je.keyword,"static_assert")},pe.tokens={decimal_float_literal:new $e("decimal_float_literal",je.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new $e("hex_float_literal",je.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new $e("int_literal",je.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new $e("uint_literal",je.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new $e("name",je.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new $e("ident",je.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new $e("and",je.token,"&"),and_and:new $e("and_and",je.token,"&&"),arrow:new $e("arrow ",je.token,"->"),attr:new $e("attr",je.token,"@"),forward_slash:new $e("forward_slash",je.token,"/"),bang:new $e("bang",je.token,"!"),bracket_left:new $e("bracket_left",je.token,"["),bracket_right:new $e("bracket_right",je.token,"]"),brace_left:new $e("brace_left",je.token,"{"),brace_right:new $e("brace_right",je.token,"}"),colon:new $e("colon",je.token,":"),comma:new $e("comma",je.token,","),equal:new $e("equal",je.token,"="),equal_equal:new $e("equal_equal",je.token,"=="),not_equal:new $e("not_equal",je.token,"!="),greater_than:new $e("greater_than",je.token,">"),greater_than_equal:new $e("greater_than_equal",je.token,">="),shift_right:new $e("shift_right",je.token,">>"),less_than:new $e("less_than",je.token,"<"),less_than_equal:new $e("less_than_equal",je.token,"<="),shift_left:new $e("shift_left",je.token,"<<"),modulo:new $e("modulo",je.token,"%"),minus:new $e("minus",je.token,"-"),minus_minus:new $e("minus_minus",je.token,"--"),period:new $e("period",je.token,"."),plus:new $e("plus",je.token,"+"),plus_plus:new $e("plus_plus",je.token,"++"),or:new $e("or",je.token,"|"),or_or:new $e("or_or",je.token,"||"),paren_left:new $e("paren_left",je.token,"("),paren_right:new $e("paren_right",je.token,")"),semicolon:new $e("semicolon",je.token,";"),star:new $e("star",je.token,"*"),tilde:new $e("tilde",je.token,"~"),underscore:new $e("underscore",je.token,"_"),xor:new $e("xor",je.token,"^"),plus_equal:new $e("plus_equal",je.token,"+="),minus_equal:new $e("minus_equal",je.token,"-="),times_equal:new $e("times_equal",je.token,"*="),division_equal:new $e("division_equal",je.token,"/="),modulo_equal:new $e("modulo_equal",je.token,"%="),and_equal:new $e("and_equal",je.token,"&="),or_equal:new $e("or_equal",je.token,"|="),xor_equal:new $e("xor_equal",je.token,"^="),shift_right_equal:new $e("shift_right_equal",je.token,">>="),shift_left_equal:new $e("shift_left_equal",je.token,"<<=")},pe.simpleTokens={"@":tt.tokens.attr,"{":tt.tokens.brace_left,"}":tt.tokens.brace_right,":":tt.tokens.colon,",":tt.tokens.comma,"(":tt.tokens.paren_left,")":tt.tokens.paren_right,";":tt.tokens.semicolon},pe.literalTokens={"&":tt.tokens.and,"&&":tt.tokens.and_and,"->":tt.tokens.arrow,"/":tt.tokens.forward_slash,"!":tt.tokens.bang,"[":tt.tokens.bracket_left,"]":tt.tokens.bracket_right,"=":tt.tokens.equal,"==":tt.tokens.equal_equal,"!=":tt.tokens.not_equal,">":tt.tokens.greater_than,">=":tt.tokens.greater_than_equal,">>":tt.tokens.shift_right,"<":tt.tokens.less_than,"<=":tt.tokens.less_than_equal,"<<":tt.tokens.shift_left,"%":tt.tokens.modulo,"-":tt.tokens.minus,"--":tt.tokens.minus_minus,".":tt.tokens.period,"+":tt.tokens.plus,"++":tt.tokens.plus_plus,"|":tt.tokens.or,"||":tt.tokens.or_or,"*":tt.tokens.star,"~":tt.tokens.tilde,_:tt.tokens.underscore,"^":tt.tokens.xor,"+=":tt.tokens.plus_equal,"-=":tt.tokens.minus_equal,"*=":tt.tokens.times_equal,"/=":tt.tokens.division_equal,"%=":tt.tokens.modulo_equal,"&=":tt.tokens.and_equal,"|=":tt.tokens.or_equal,"^=":tt.tokens.xor_equal,">>=":tt.tokens.shift_right_equal,"<<=":tt.tokens.shift_left_equal},pe.regexTokens={decimal_float_literal:tt.tokens.decimal_float_literal,hex_float_literal:tt.tokens.hex_float_literal,int_literal:tt.tokens.int_literal,uint_literal:tt.tokens.uint_literal,ident:tt.tokens.ident},pe.storage_class=[tt.keywords.function,tt.keywords.private,tt.keywords.workgroup,tt.keywords.uniform,tt.keywords.storage],pe.access_mode=[tt.keywords.read,tt.keywords.write,tt.keywords.read_write],pe.sampler_type=[tt.keywords.sampler,tt.keywords.sampler_comparison],pe.sampled_texture_type=[tt.keywords.texture_1d,tt.keywords.texture_2d,tt.keywords.texture_2d_array,tt.keywords.texture_3d,tt.keywords.texture_cube,tt.keywords.texture_cube_array],pe.multisampled_texture_type=[tt.keywords.texture_multisampled_2d],pe.storage_texture_type=[tt.keywords.texture_storage_1d,tt.keywords.texture_storage_2d,tt.keywords.texture_storage_2d_array,tt.keywords.texture_storage_3d],pe.depth_texture_type=[tt.keywords.texture_depth_2d,tt.keywords.texture_depth_2d_array,tt.keywords.texture_depth_cube,tt.keywords.texture_depth_cube_array,tt.keywords.texture_depth_multisampled_2d],pe.texture_external_type=[tt.keywords.texture_external],pe.any_texture_type=[...tt.sampled_texture_type,...tt.multisampled_texture_type,...tt.storage_texture_type,...tt.depth_texture_type,...tt.texture_external_type],pe.texel_format=[tt.keywords.r8unorm,tt.keywords.r8snorm,tt.keywords.r8uint,tt.keywords.r8sint,tt.keywords.r16uint,tt.keywords.r16sint,tt.keywords.r16float,tt.keywords.rg8unorm,tt.keywords.rg8snorm,tt.keywords.rg8uint,tt.keywords.rg8sint,tt.keywords.r32uint,tt.keywords.r32sint,tt.keywords.r32float,tt.keywords.rg16uint,tt.keywords.rg16sint,tt.keywords.rg16float,tt.keywords.rgba8unorm,tt.keywords.rgba8unorm_srgb,tt.keywords.rgba8snorm,tt.keywords.rgba8uint,tt.keywords.rgba8sint,tt.keywords.bgra8unorm,tt.keywords.bgra8unorm_srgb,tt.keywords.rgb10a2unorm,tt.keywords.rg11b10float,tt.keywords.rg32uint,tt.keywords.rg32sint,tt.keywords.rg32float,tt.keywords.rgba16uint,tt.keywords.rgba16sint,tt.keywords.rgba16float,tt.keywords.rgba32uint,tt.keywords.rgba32sint,tt.keywords.rgba32float],pe.const_literal=[tt.tokens.int_literal,tt.tokens.uint_literal,tt.tokens.decimal_float_literal,tt.tokens.hex_float_literal,tt.keywords.true,tt.keywords.false],pe.literal_or_ident=[tt.tokens.ident,tt.tokens.int_literal,tt.tokens.uint_literal,tt.tokens.decimal_float_literal,tt.tokens.hex_float_literal,tt.tokens.name],pe.element_count_expression=[tt.tokens.int_literal,tt.tokens.uint_literal,tt.tokens.ident],pe.template_types=[tt.keywords.vec2,tt.keywords.vec3,tt.keywords.vec4,tt.keywords.mat2x2,tt.keywords.mat2x3,tt.keywords.mat2x4,tt.keywords.mat3x2,tt.keywords.mat3x3,tt.keywords.mat3x4,tt.keywords.mat4x2,tt.keywords.mat4x3,tt.keywords.mat4x4,tt.keywords.atomic,tt.keywords.bitcast,...tt.any_texture_type],pe.attribute_name=[tt.tokens.ident,tt.keywords.block,tt.keywords.diagnostic],pe.assignment_operators=[tt.tokens.equal,tt.tokens.plus_equal,tt.tokens.minus_equal,tt.tokens.times_equal,tt.tokens.division_equal,tt.tokens.modulo_equal,tt.tokens.and_equal,tt.tokens.or_equal,tt.tokens.xor_equal,tt.tokens.shift_right_equal,tt.tokens.shift_left_equal],pe.increment_operators=[tt.tokens.plus_plus,tt.tokens.minus_minus];class gw{constructor(e,t,s,l,d){this.type=e,this.lexeme=t,this.line=s,this.start=l,this.end=d}toString(){return this.lexeme}isTemplateType(){return pe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==pe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class KP{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new gw(pe.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let g=1;for(;g>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),g--,g==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),g++)}return!0}}const t=pe.simpleTokens[e];if(t)return this._addToken(t),!0;let s=pe.none;const l=this._isAlpha(e),d=e==="_";if(this._isAlphaNumeric(e)){let g=this._peekAhead();for(;this._isAlphaNumeric(g);)e+=this._advance(),g=this._peekAhead()}if(l){const g=pe.keywords[e];if(g)return this._addToken(g),!0}if(l||d)return this._addToken(pe.tokens.ident),!0;for(;;){let g=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(pe.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(pe.tokens.minus_minus),!0;const A=this._tokens.length-1;if((pe.literal_or_ident.indexOf(this._tokens[A].type)!=-1||this._tokens[A].type==pe.tokens.paren_right)&&o!=">")return this._addToken(g),!0}if(e==">"&&(o==">"||o=="=")){let A=!1,M=this._tokens.length-1;for(let I=0;I<5&&M>=0&&pe.assignment_operators.indexOf(this._tokens[M].type)===-1;++I,--M)if(this._tokens[M].type===pe.tokens.less_than){M>0&&this._tokens[M-1].isArrayOrTemplateType()&&(A=!0);break}if(A)return this._addToken(g),!0}if(g===pe.none){let A=e,M=0;const I=2;for(let z=0;z<I;++z)if(A+=this._peekAhead(z),g=this._findType(A),g!==pe.none){M=z;break}if(g===pe.none)return s!==pe.none&&(this._current--,this._addToken(s),!0);e=A,this._current+=M+1}if(s=g,this._isAtEnd())break;e+=this._advance()}return s!==pe.none&&(this._addToken(s),!0)}_findType(e){for(const s in pe.regexTokens){const l=pe.regexTokens[s];if(this._match(e,l.rule))return l}return pe.literalTokens[e]||pe.none}_match(e,t){const s=t.exec(e);return s&&s.index==0&&s[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new gw(e,t,this._line,this._start,this._current))}}function jt(i){return Array.isArray(i)||i?.buffer instanceof ArrayBuffer}const Nv=new Float32Array(1),QP=new Uint32Array(Nv.buffer),JP=new Uint32Array(Nv.buffer),Uv=new Int32Array(1),eI=new Float32Array(Uv.buffer),tI=new Uint32Array(Uv.buffer),Vv=new Uint32Array(1),iI=new Float32Array(Vv.buffer),nI=new Int32Array(Vv.buffer);function mw(i,e,t){if(e===t)return i;if(e==="f32"){if(t==="i32"||t==="x32")return Nv[0]=i,QP[0];if(t==="u32")return Nv[0]=i,JP[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Uv[0]=i,eI[0];if(t==="u32")return Uv[0]=i,tI[0]}else if(e==="u32"){if(t==="f32")return Vv[0]=i,iI[0];if(t==="i32"||t==="x32")return Vv[0]=i,nI[0]}return console.error(`Unsupported cast from ${e} to ${t}`),i}class rI{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Jy{constructor(e,t){this.align=e,this.size=t}}class uu{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new UP,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof M_&&this._functions.set(t.name,new rI(t));for(const t of e)if(t instanceof ph){const s=this.getTypeInfo(t,null);s instanceof Tf&&this.structs.push(s)}for(const t of e)if(t instanceof Ox)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Rx){const s=t,l=this._getAttributeNum(s.attributes,"id",0),d=s.type!=null?this.getTypeInfo(s.type,s.attributes):null;this.overrides.push(new zP(s.name,d,s.attributes,l));continue}if(this._isUniformVar(t)){const s=t,l=this._getAttributeNum(s.attributes,"group",0),d=this._getAttributeNum(s.attributes,"binding",0),g=this.getTypeInfo(s.type,s.attributes),o=new Qy(s.name,g,l,d,s.attributes,xf.Uniform,s.access);o.access||(o.access="read"),this.uniforms.push(o);continue}if(this._isStorageVar(t)){const s=t,l=this._getAttributeNum(s.attributes,"group",0),d=this._getAttributeNum(s.attributes,"binding",0),g=this.getTypeInfo(s.type,s.attributes),o=this._isStorageTexture(g),A=new Qy(s.name,g,l,d,s.attributes,o?xf.StorageTexture:xf.Storage,s.access);A.access||(A.access="read"),this.storage.push(A);continue}if(this._isTextureVar(t)){const s=t,l=this._getAttributeNum(s.attributes,"group",0),d=this._getAttributeNum(s.attributes,"binding",0),g=this.getTypeInfo(s.type,s.attributes),o=this._isStorageTexture(g),A=new Qy(s.name,g,l,d,s.attributes,o?xf.StorageTexture:xf.Texture,s.access);A.access||(A.access="read"),o?this.storage.push(A):this.textures.push(A);continue}if(this._isSamplerVar(t)){const s=t,l=this._getAttributeNum(s.attributes,"group",0),d=this._getAttributeNum(s.attributes,"binding",0),g=this.getTypeInfo(s.type,s.attributes),o=new Qy(s.name,g,l,d,s.attributes,xf.Sampler,s.access);this.samplers.push(o);continue}}for(const t of e)if(t instanceof M_){const s=this._getAttribute(t,"vertex"),l=this._getAttribute(t,"fragment"),d=this._getAttribute(t,"compute"),g=s||l||d,o=new NP(t.name,g?.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,g&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!g),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[g.name].push(o)),o.arguments=t.args.map(A=>new FP(A.name,this.getTypeInfo(A.type,A.attributes),A.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(s=>{var l,d,g;if(s instanceof PS){if(s.value)if(jt(s.value))for(const o of s.value)for(const A of this.overrides)o===A.name&&((l=t.info)===null||l===void 0||l.overrides.push(A));else for(const o of this.overrides)s.value===o.name&&((d=t.info)===null||d===void 0||d.overrides.push(o))}else if(s instanceof Ro)for(const o of this.overrides)s.name===o.name&&((g=t.info)===null||g===void 0||g.overrides.push(o))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var s;for(const l of e.calls){const d=(s=this._functions.get(l.name))===null||s===void 0?void 0:s.info;d&&t.add(d)}}findResource(e,t,s){if(s){for(const l of this.entry.compute)if(l.name===s){for(const d of l.resources)if(d.group==e&&d.binding==t)return d}for(const l of this.entry.vertex)if(l.name===s){for(const d of l.resources)if(d.group==e&&d.binding==t)return d}for(const l of this.entry.fragment)if(l.name===s){for(const d of l.resources)if(d.group==e&&d.binding==t)return d}}for(const l of this.uniforms)if(l.group==e&&l.binding==t)return l;for(const l of this.storage)if(l.group==e&&l.binding==t)return l;for(const l of this.textures)if(l.group==e&&l.binding==t)return l;for(const l of this.samplers)if(l.group==e&&l.binding==t)return l;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const s=[],l=this,d=[];return e.search(g=>{if(g instanceof zv)d.push({});else if(g instanceof Fv)d.pop();else if(g instanceof mh){const o=g;t&&o.type!==null&&this._markStructsFromAST(o.type),d.length>0&&(d[d.length-1][o.name]=o)}else if(g instanceof lu){const o=g;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(g instanceof x_){const o=g;t&&o.type!==null&&this._markStructsFromAST(o.type),d.length>0&&(d[d.length-1][o.name]=o)}else if(g instanceof Ro){const o=g;if(d.length>0&&d[d.length-1][o.name])return;const A=l._findResource(o.name);A&&s.push(A)}else if(g instanceof kx){const o=g,A=l._functions.get(o.name);A&&(t&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=l._findResources(A.node,t)),s.push(...A.resources))}else if(g instanceof Dx){const o=g,A=l._functions.get(o.name);A&&(t&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=l._findResources(A.node,t)),s.push(...A.resources))}}),[...new Map(s.map(g=>[g.name,g])).values()]}getBindGroups(){const e=[];function t(s,l){s>=e.length&&(e.length=s+1),e[s]===void 0&&(e[s]=[]),l>=e[s].length&&(e[s].length=l+1)}for(const s of this.uniforms)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.storage)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.textures)t(s.group,s.binding),e[s.group][s.binding]=s;for(const s of this.samplers)t(s.group,s.binding),e[s.group][s.binding]=s;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof ph)this._getStructOutputs(e,t);else{const s=this._getOutputInfo(e);s!==null&&t.push(s)}return t}_getStructOutputs(e,t){for(const s of e.members)if(s.type instanceof ph)this._getStructOutputs(s.type,t);else{const l=this._getAttribute(s,"location")||this._getAttribute(s,"builtin");if(l!==null){const d=this.getTypeInfo(s.type,s.type.attributes),g=this._parseInt(l.value),o=new uw(s.name,d,l.name,g);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this.getTypeInfo(e,e.attributes),l=this._parseInt(t.value);return new uw("",s,t.name,l)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const s of e)if(s.type instanceof ph)this._getStructInputs(s.type,t);else{const l=this._getInputInfo(s);l!==null&&t.push(l)}return t}_getStructInputs(e,t){for(const s of e.members)if(s.type instanceof ph)this._getStructInputs(s.type,t);else{const l=this._getInputInfo(s);l!==null&&t.push(l)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const s=this._getAttribute(e,"interpolation"),l=this.getTypeInfo(e.type,e.attributes),d=this._parseInt(t.value),g=new BP(e.name,l,t.name,d);return s!==null&&(g.interpolation=this._parseString(s.value)),g}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new LP(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof mv){const l=e.type?this.getTypeInfo(e.type,e.attributes):null,d=new Lb(e.name,l,t);return this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof w_){const l=e,d=l.format?this.getTypeInfo(l.format,l.attributes):null,g=new Mf(l.name,t);return g.format=d,g.count=l.count,this._types.set(e,g),this._updateTypeInfo(g),g}if(e instanceof ph){const l=e,d=new Tf(l.name,t);d.startLine=l.startLine,d.endLine=l.endLine;for(const g of l.members){const o=this.getTypeInfo(g.type,g.attributes);d.members.push(new cw(g.name,o,g.attributes))}return this._types.set(e,d),this._updateTypeInfo(d),d}if(e instanceof p_){const l=e,d=l.format instanceof Et,g=l.format?d?this.getTypeInfo(l.format,null):new gl(l.format,null):null,o=new Jd(l.name,g,t,l.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Ge){const l=e,d=l.format?this.getTypeInfo(l.format,null):null,g=new Jd(l.name,d,t,l.access);return this._types.set(e,g),this._updateTypeInfo(g),g}const s=new gl(e.name,t);return this._types.set(e,s),this._updateTypeInfo(s),s}_updateTypeInfo(e){var t,s,l;const d=this._getTypeSize(e);if(e.size=(t=d?.size)!==null&&t!==void 0?t:0,e instanceof Mf&&e.format){const g=this._getTypeSize(e.format);e.stride=Math.max((s=g?.size)!==null&&s!==void 0?s:0,(l=g?.align)!==null&&l!==void 0?l:0),this._updateTypeInfo(e.format)}e instanceof Lb&&this._updateTypeInfo(e.format),e instanceof Tf&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let s=0,l=0,d=0,g=0;for(let o=0,A=e.members.length;o<A;++o){const M=e.members[o],I=this._getTypeSize(M);if(!I)continue;(t=this._getAlias(M.type.name))!==null&&t!==void 0||M.type;const z=I.align,W=I.size;s=this._roundUp(z,s+l),l=W,d=s,g=Math.max(g,z),M.offset=s,M.size=W,this._updateTypeInfo(M.type)}e.size=this._roundUp(g,d+l),e.align=g}_getTypeSize(e){var t,s;if(e==null)return null;const l=this._getAttributeNum(e.attributes,"size",0),d=this._getAttributeNum(e.attributes,"align",0);if(e instanceof cw&&(e=e.type),e instanceof gl){const g=this._getAlias(e.name);g!==null&&(e=g)}{const g=uu._typeInfo[e.name];if(g!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Jy(Math.max(d,g.align/o),Math.max(l,g.size/o))}}{const g=uu._typeInfo[e.name.substring(0,e.name.length-1)];if(g){const o=e.name[e.name.length-1]==="h"?2:1;return new Jy(Math.max(d,g.align/o),Math.max(l,g.size/o))}}if(e instanceof Mf){let g=e,o=8,A=8;const M=this._getTypeSize(g.format);return M!==null&&(A=M.size,o=M.align),A=g.count*this._getAttributeNum((s=e?.attributes)!==null&&s!==void 0?s:null,"stride",this._roundUp(o,A)),l&&(A=l),new Jy(Math.max(d,o),Math.max(l,A))}if(e instanceof Tf){let g=0,o=0,A=0,M=0,I=0;for(const z of e.members){const W=this._getTypeSize(z.type);W!==null&&(g=Math.max(W.align,g),A=this._roundUp(W.align,A+M),M=W.size,I=A)}return o=this._roundUp(g,I+M),new Jy(Math.max(d,g),Math.max(l,o))}return null}_isUniformVar(e){return e instanceof mh&&e.storage=="uniform"}_isStorageVar(e){return e instanceof mh&&e.storage=="storage"}_isTextureVar(e){return e instanceof mh&&e.type!==null&&uu._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof mh&&e.type!==null&&uu._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const s=e;if(!s||!s.attributes)return null;const l=s.attributes;for(let d of l)if(d.name==t)return d;return null}_getAttributeNum(e,t,s){if(e===null)return s;for(let l of e)if(l.name==t){let d=l!==null&&l.value!==null?l.value:s;return d instanceof Array&&(d=d[0]),typeof d=="number"?d:typeof d=="string"?parseInt(d):s}return s}_roundUp(e,t){return Math.ceil(t/e)*e}}uu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},uu._textureTypes=pe.any_texture_type.map(i=>i.name),uu._samplerTypes=pe.sampler_type.map(i=>i.name);let Lx=0;class Bx{constructor(e,t,s){this.id=Lx++,this.name=e,this.value=t,this.node=s}clone(){return new Bx(this.name,this.value,this.node)}}class zx{constructor(e){this.id=Lx++,this.name=e.name,this.node=e}clone(){return new zx(this.node)}}class Fx{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Lx++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,s){this.variables.set(e,new Bx(e,t,s??null))}setVariable(e,t,s){const l=this.getVariable(e);l!==null?l.value=t:this.createVariable(e,t,s)}getVariableValue(e){var t;const s=this.getVariable(e);return(t=s?.value)!==null&&t!==void 0?t:null}clone(){return new Fx(this)}}class sI{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class aI{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const s=this.exec.evalExpression(e.args[0],t);let l=!0;if(s instanceof xe)return s.data.forEach(d=>{d||(l=!1)}),new Ne(l?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe){const l=s.data.some(d=>d);return new Ne(l?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const s=this.exec.evalExpression(e.args[2],t);if(!(s instanceof Ne))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return s.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.evalExpression(s,t);if(l instanceof wr&&l.typeInfo.size===0){const d=l.typeInfo,g=l.buffer.byteLength/d.stride;return new Ne(g,this.getTypeInfo("u32"))}return new Ne(l.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.abs(d)),s.typeInfo);const l=s;return new Ne(Math.abs(l.value),l.typeInfo)}Acos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.acos(d)),s.typeInfo);const l=s;return new Ne(Math.acos(l.value),s.typeInfo)}Acosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.acosh(d)),s.typeInfo);const l=s;return new Ne(Math.acosh(l.value),s.typeInfo)}Asin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.asin(d)),s.typeInfo);const l=s;return new Ne(Math.asin(l.value),s.typeInfo)}Asinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.asinh(d)),s.typeInfo);const l=s;return new Ne(Math.asinh(l.value),s.typeInfo)}Atan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.atan(d)),s.typeInfo);const l=s;return new Ne(Math.atan(l.value),s.typeInfo)}Atanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.atanh(d)),s.typeInfo);const l=s;return new Ne(Math.atanh(l.value),s.typeInfo)}Atan2(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((o,A)=>Math.atan2(o,l.data[A])),s.typeInfo);const d=s,g=l;return new Ne(Math.atan2(d.value,g.value),s.typeInfo)}Ceil(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.ceil(d)),s.typeInfo);const l=s;return new Ne(Math.ceil(l.value),s.typeInfo)}_clamp(e,t,s){return Math.min(Math.max(e,t),s)}Clamp(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(s instanceof xe&&l instanceof xe&&d instanceof xe)return new xe(s.data.map((M,I)=>this._clamp(M,l.data[I],d.data[I])),s.typeInfo);const g=s,o=l,A=d;return new Ne(this._clamp(g.value,o.value,A.value),s.typeInfo)}Cos(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.cos(d)),s.typeInfo);const l=s;return new Ne(Math.cos(l.value),s.typeInfo)}Cosh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.cosh(d)),s.typeInfo);const l=s;return new Ne(Math.cos(l.value),s.typeInfo)}CountLeadingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.clz32(d)),s.typeInfo);const l=s;return new Ne(Math.clz32(l.value),s.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>this._countOneBits(d)),s.typeInfo);const l=s;return new Ne(this._countOneBits(l.value),s.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>this._countTrailingZeros(d)),s.typeInfo);const l=s;return new Ne(this._countTrailingZeros(l.value),s.typeInfo)}Cross(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe){if(s.data.length!==3||l.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const d=s.data,g=l.data;return new xe([d[1]*g[2]-g[1]*d[2],d[2]*g[0]-g[2]*d[0],d[0]*g[1]-g[0]*d[1]],s.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const s=this.exec.evalExpression(e.args[0],t),l=180/Math.PI;return s instanceof xe?new xe(s.data.map(d=>d*l),s.typeInfo):new Ne(s.value*l,this.getTypeInfo("f32"))}Determinant(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof _i){const l=s.data,d=s.typeInfo.getTypeName(),g=d.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(d==="mat2x2"||d==="mat2x2f"||d==="mat2x2h")return new Ne(l[0]*l[3]-l[1]*l[2],g);if(d==="mat2x3"||d==="mat2x3f"||d==="mat2x3h")return new Ne(l[0]*(l[4]*l[8]-l[5]*l[7])-l[1]*(l[3]*l[8]-l[5]*l[6])+l[2]*(l[3]*l[7]-l[4]*l[6]),g);if(d==="mat2x4"||d==="mat2x4f"||d==="mat2x4h")console.error(`TODO: Determinant for ${d}`);else if(d==="mat3x2"||d==="mat3x2f"||d==="mat3x2h")console.error(`TODO: Determinant for ${d}`);else{if(d==="mat3x3"||d==="mat3x3f"||d==="mat3x3h")return new Ne(l[0]*(l[4]*l[8]-l[5]*l[7])-l[1]*(l[3]*l[8]-l[5]*l[6])+l[2]*(l[3]*l[7]-l[4]*l[6]),g);d==="mat3x4"||d==="mat3x4f"||d==="mat3x4h"||d==="mat4x2"||d==="mat4x2f"||d==="mat4x2h"||d==="mat4x3"||d==="mat4x3f"||d==="mat4x3h"?console.error(`TODO: Determinant for ${d}`):d!=="mat4x4"&&d!=="mat4x4f"&&d!=="mat4x4h"||console.error(`TODO: Determinant for ${d}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe){let o=0;for(let A=0;A<s.data.length;++A)o+=(s.data[A]-l.data[A])*(s.data[A]-l.data[A]);return new Ne(Math.sqrt(o),this.getTypeInfo("f32"))}const d=s,g=l;return new Ne(Math.abs(d.value-g.value),s.typeInfo)}_dot(e,t){let s=0;for(let l=0;l<e.length;++l)s+=t[l]*e[l];return s}Dot(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);return s instanceof xe&&l instanceof xe?new Ne(this._dot(s.data,l.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.exp(d)),s.typeInfo);const l=s;return new Ne(Math.exp(l.value),s.typeInfo)}Exp2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.pow(2,d)),s.typeInfo);const l=s;return new Ne(Math.pow(2,l.value),s.typeInfo)}ExtractBits(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(l.typeInfo.name!=="u32"&&l.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(d.typeInfo.name!=="u32"&&d.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const g=l.value,o=d.value;if(s instanceof xe)return new xe(s.data.map(M=>M>>g&(1<<o)-1),s.typeInfo);if(s.typeInfo.name!=="i32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const A=s.value;return new Ne(A>>g&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(s instanceof xe&&l instanceof xe&&d instanceof xe){const g=this._dot(l.data,d.data);return new xe(g<0?Array.from(s.data):s.data.map(o=>-o),s.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>this._firstLeadingBit(d)),s.typeInfo);const l=s;return new Ne(this._firstLeadingBit(l.value),s.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>this._firstTrailingBit(d)),s.typeInfo);const l=s;return new Ne(this._firstTrailingBit(l.value),s.typeInfo)}Floor(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.floor(d)),s.typeInfo);const l=s;return new Ne(Math.floor(l.value),s.typeInfo)}Fma(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(s instanceof xe&&l instanceof xe&&d instanceof xe)return s.data.length!==l.data.length||s.data.length!==d.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new xe(s.data.map((M,I)=>M*l.data[I]+d.data[I]),s.typeInfo);const g=s,o=l,A=d;return new Ne(g.value*o.value+A.value,g.typeInfo)}Fract(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>d-Math.floor(d)),s.typeInfo);const l=s;return new Ne(l.value-Math.floor(l.value),s.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t),g=this.exec.evalExpression(e.args[3],t);if(d.typeInfo.name!=="u32"&&d.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=d.value,A=(1<<g.value)-1<<o,M=~A;if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((W,J)=>W&M|l.data[J]<<o&A),s.typeInfo);const I=s.value,z=l.value;return new Ne(I&M|z<<o&A,s.typeInfo)}InverseSqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>1/Math.sqrt(d)),s.typeInfo);const l=s;return new Ne(1/Math.sqrt(l.value),s.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe){let d=0;return s.data.forEach(g=>{d+=g*g}),new Ne(Math.sqrt(d),this.getTypeInfo("f32"))}const l=s;return new Ne(Math.abs(l.value),s.typeInfo)}Log(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.log(d)),s.typeInfo);const l=s;return new Ne(Math.log(l.value),s.typeInfo)}Log2(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.log2(d)),s.typeInfo);const l=s;return new Ne(Math.log2(l.value),s.typeInfo)}Max(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((o,A)=>Math.max(o,l.data[A])),s.typeInfo);const d=s,g=l;return new Ne(Math.max(d.value,g.value),s.typeInfo)}Min(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((o,A)=>Math.min(o,l.data[A])),s.typeInfo);const d=s,g=l;return new Ne(Math.min(d.value,g.value),s.typeInfo)}Mix(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(s instanceof xe&&l instanceof xe&&d instanceof xe)return new xe(s.data.map((A,M)=>s.data[M]*(1-d.data[M])+l.data[M]*d.data[M]),s.typeInfo);const g=l,o=d;return new Ne(s.value*(1-o.value)+g.value*o.value,s.typeInfo)}Modf(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((g,o)=>g%l.data[o]),s.typeInfo);const d=l;return new Ne(s.value%d.value,s.typeInfo)}Normalize(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe){const l=this.Length(e,t).value;return new xe(s.data.map(d=>d/l),s.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe)return new xe(s.data.map((o,A)=>Math.pow(o,l.data[A])),s.typeInfo);const d=s,g=l;return new Ne(Math.pow(d.value,g.value),s.typeInfo)}QuantizeToF16(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof xe?new xe(s.data.map(l=>l),s.typeInfo):new Ne(s.value,s.typeInfo)}Radians(e,t){const s=this.exec.evalExpression(e.args[0],t);return s instanceof xe?new xe(s.data.map(l=>l*Math.PI/180),s.typeInfo):new Ne(s.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(s instanceof xe&&l instanceof xe){const d=this._dot(s.data,l.data);return new xe(s.data.map((g,o)=>g-2*d*l.data[o]),s.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(s instanceof xe&&l instanceof xe&&d instanceof Ne){const g=this._dot(l.data,s.data);return new xe(s.data.map((o,A)=>{const M=1-d.value*d.value*(1-g*g);if(M<0)return 0;const I=Math.sqrt(M);return d.value*o-(d.value*g+I)*l.data[A]}),s.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.round(d)),s.typeInfo);const l=s;return new Ne(Math.round(l.value),s.typeInfo)}Saturate(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.min(Math.max(d,0),1)),s.typeInfo);const l=s;return new Ne(Math.min(Math.max(l.value,0),1),s.typeInfo)}Sign(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.sign(d)),s.typeInfo);const l=s;return new Ne(Math.sign(l.value),s.typeInfo)}Sin(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.sin(d)),s.typeInfo);const l=s;return new Ne(Math.sin(l.value),s.typeInfo)}Sinh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.sinh(d)),s.typeInfo);const l=s;return new Ne(Math.sinh(l.value),s.typeInfo)}_smoothstep(e,t,s){const l=Math.min(Math.max((s-e)/(t-e),0),1);return l*l*(3-2*l)}SmoothStep(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t),d=this.exec.evalExpression(e.args[2],t);if(d instanceof xe&&s instanceof xe&&l instanceof xe)return new xe(d.data.map((M,I)=>this._smoothstep(s.data[I],l.data[I],M)),d.typeInfo);const g=s,o=l,A=d;return new Ne(this._smoothstep(g.value,o.value,A.value),d.typeInfo)}Sqrt(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.sqrt(d)),s.typeInfo);const l=s;return new Ne(Math.sqrt(l.value),s.typeInfo)}Step(e,t){const s=this.exec.evalExpression(e.args[0],t),l=this.exec.evalExpression(e.args[1],t);if(l instanceof xe&&s instanceof xe)return new xe(l.data.map((g,o)=>g<s.data[o]?0:1),l.typeInfo);const d=s;return new Ne(l.value<d.value?0:1,d.typeInfo)}Tan(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.tan(d)),s.typeInfo);const l=s;return new Ne(Math.tan(l.value),s.typeInfo)}Tanh(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.tanh(d)),s.typeInfo);const l=s;return new Ne(Math.tanh(l.value),s.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const s=this.exec.evalExpression(e.args[0],t);if(!(s instanceof _i))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const l=this._getTransposeType(s.typeInfo);if(s.typeInfo.name==="mat2x2"||s.typeInfo.name==="mat2x2f"||s.typeInfo.name==="mat2x2h"){const d=s.data;return new _i([d[0],d[2],d[1],d[3]],l)}if(s.typeInfo.name==="mat2x3"||s.typeInfo.name==="mat2x3f"||s.typeInfo.name==="mat2x3h"){const d=s.data;return new _i([d[0],d[3],d[6],d[1],d[4],d[7]],l)}if(s.typeInfo.name==="mat2x4"||s.typeInfo.name==="mat2x4f"||s.typeInfo.name==="mat2x4h"){const d=s.data;return new _i([d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13]],l)}if(s.typeInfo.name==="mat3x2"||s.typeInfo.name==="mat3x2f"||s.typeInfo.name==="mat3x2h"){const d=s.data;return new _i([d[0],d[3],d[1],d[4],d[2],d[5]],l)}if(s.typeInfo.name==="mat3x3"||s.typeInfo.name==="mat3x3f"||s.typeInfo.name==="mat3x3h"){const d=s.data;return new _i([d[0],d[3],d[6],d[1],d[4],d[7],d[2],d[5],d[8]],l)}if(s.typeInfo.name==="mat3x4"||s.typeInfo.name==="mat3x4f"||s.typeInfo.name==="mat3x4h"){const d=s.data;return new _i([d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14]],l)}if(s.typeInfo.name==="mat4x2"||s.typeInfo.name==="mat4x2f"||s.typeInfo.name==="mat4x2h"){const d=s.data;return new _i([d[0],d[4],d[1],d[5],d[2],d[6]],l)}if(s.typeInfo.name==="mat4x3"||s.typeInfo.name==="mat4x3f"||s.typeInfo.name==="mat4x3h"){const d=s.data;return new _i([d[0],d[4],d[8],d[1],d[5],d[9],d[2],d[6],d[10]],l)}if(s.typeInfo.name==="mat4x4"||s.typeInfo.name==="mat4x4f"||s.typeInfo.name==="mat4x4h"){const d=s.data;return new _i([d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14],d[3],d[7],d[11],d[15]],l)}return console.error(`Invalid matrix type ${s.typeInfo.name}`),null}Trunc(e,t){const s=this.exec.evalExpression(e.args[0],t);if(s instanceof xe)return new xe(s.data.map(d=>Math.trunc(d)),s.typeInfo);const l=s;return new Ne(Math.trunc(l.value),s.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const s=e.args[0],l=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(s instanceof Ro){const d=s.name,g=t.getVariableValue(d);if(g instanceof gh){if(l<0||l>=g.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const o=g.getMipLevelSize(l),A=g.dimension;return A==="1d"?new Ne(o[0],this.getTypeInfo("u32")):A==="3d"?new xe(o,this.getTypeInfo("vec3u")):A==="2d"?new xe(o.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${A} not found. Line ${e.line}`),null)}return console.error(`Texture ${d} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const s=e.args[0],l=this.exec.evalExpression(e.args[1],t),d=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(l instanceof xe)||l.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(s instanceof Ro){const g=s.name,o=t.getVariableValue(g);if(o instanceof gh){const A=Math.floor(l.data[0]),M=Math.floor(l.data[1]);if(A<0||A>=o.width||M<0||M>=o.height)return console.error(`Texture ${g} out of bounds. Line ${e.line}`),null;const I=o.getPixel(A,M,0,d);return I===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new xe(I,this.getTypeInfo("vec4f"))}return console.error(`Texture ${g} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const s=e.args[0];if(s instanceof Ro){const l=s.name,d=t.getVariableValue(l);return d instanceof gh?new Ne(d.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${l} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const s=e.args[0];if(s instanceof Ro){const l=s.name,d=t.getVariableValue(l);return d instanceof gh?new Ne(d.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${l} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const s=e.args[0];if(s instanceof Ro){const l=s.name,d=t.getVariableValue(l);return d instanceof gh?new Ne(d.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${l} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const s=e.args[0],l=this.exec.evalExpression(e.args[1],t),d=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,g=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(g.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(l instanceof xe)||l.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(s instanceof Ro){const o=s.name,A=t.getVariableValue(o);if(A instanceof gh){const M=A.getMipLevelSize(0),I=Math.floor(l.data[0]),z=Math.floor(l.data[1]);return I<0||I>=M[0]||z<0||z>=M[1]?(console.error(`Texture ${o} out of bounds. Line ${e.line}`),null):(A.setPixel(I,z,0,d,Array.from(g)),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t);return t.getVariable(l).value.getSubData(this.exec,s.postfix,t)}AtomicStore(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t);return A instanceof Ne&&o instanceof Ne&&(A.value=o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),null}AtomicAdd(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value+=o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicSub(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value-=o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicMax(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=Math.max(A.value,o.value)),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicMin(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=Math.min(A.value,o.value)),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicAnd(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=A.value&o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicOr(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=A.value|o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicXor(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=A.value^o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicExchange(e,t){let s=e.args[0];s instanceof zr&&(s=s.right);const l=this.exec.getVariableName(s,t),d=t.getVariable(l);let g=e.args[1];const o=this.exec.evalExpression(g,t),A=d.value.getSubData(this.exec,s.postfix,t),M=new Ne(A.value,A.typeInfo);return A instanceof Ne&&o instanceof Ne&&(A.value=o.value),d.value instanceof wr&&d.value.setDataValue(this.exec,A,s.postfix,t),M}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Y0={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Aa={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class sa extends sI{constructor(e,t){var s;super(),this.ast=e??[],this.reflection=new uu,this.reflection.updateAST(this.ast),this.context=(s=t?.clone())!==null&&s!==void 0?s:new Fx,this.builtins=new aI(this),this.typeInfo={bool:this.getTypeInfo(Et.bool),i32:this.getTypeInfo(Et.i32),u32:this.getTypeInfo(Et.u32),f32:this.getTypeInfo(Et.f32),f16:this.getTypeInfo(Et.f16),vec2f:this.getTypeInfo(Ge.vec2f),vec2u:this.getTypeInfo(Ge.vec2u),vec2i:this.getTypeInfo(Ge.vec2i),vec2h:this.getTypeInfo(Ge.vec2h),vec3f:this.getTypeInfo(Ge.vec3f),vec3u:this.getTypeInfo(Ge.vec3u),vec3i:this.getTypeInfo(Ge.vec3i),vec3h:this.getTypeInfo(Ge.vec3h),vec4f:this.getTypeInfo(Ge.vec4f),vec4u:this.getTypeInfo(Ge.vec4u),vec4i:this.getTypeInfo(Ge.vec4i),vec4h:this.getTypeInfo(Ge.vec4h),mat2x2f:this.getTypeInfo(Ge.mat2x2f),mat2x3f:this.getTypeInfo(Ge.mat2x3f),mat2x4f:this.getTypeInfo(Ge.mat2x4f),mat3x2f:this.getTypeInfo(Ge.mat3x2f),mat3x3f:this.getTypeInfo(Ge.mat3x3f),mat3x4f:this.getTypeInfo(Ge.mat3x4f),mat4x2f:this.getTypeInfo(Ge.mat4x2f),mat4x3f:this.getTypeInfo(Ge.mat4x3f),mat4x4f:this.getTypeInfo(Ge.mat4x4f)}}getVariableValue(e){var t,s;const l=(s=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&s!==void 0?s:null;if(l===null)return null;if(l instanceof Ne)return l.value;if(l instanceof xe||l instanceof _i)return Array.from(l.data);if(l instanceof wr&&l.typeInfo instanceof Mf){if(l.typeInfo.format.name==="u32")return Array.from(new Uint32Array(l.buffer,l.offset,l.typeInfo.count));if(l.typeInfo.format.name==="i32")return Array.from(new Int32Array(l.buffer,l.offset,l.typeInfo.count));if(l.typeInfo.format.name==="f32")return Array.from(new Float32Array(l.buffer,l.offset,l.typeInfo.count))}return console.error(`Unsupported return variable type ${l.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,s,l){const d=this.context.clone();(l=l??{}).constants&&this._setOverrides(l.constants,d),this._execStatements(this.ast,d);const g=d.getFunction(e);if(!g)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],A=t[1],M=t[2],I=this.getTypeInfo("vec3u");d.setVariable("@num_workgroups",new xe(t,I));const z=this.reflection.getFunctionInfo(e);z===null&&console.error(`Function ${e} not found in reflection data`);for(const W in s)for(const J in s[W]){const oe=s[W][J];d.variables.forEach(le=>{var ne;const Ie=le.node;if(Ie?.attributes){let Ue=null,Se=null;for(const Ve of Ie.attributes)Ve.name==="binding"?Ue=Ve.value:Ve.name==="group"&&(Se=Ve.value);if(J==Ue&&W==Se){let Ve=!1;for(const st of z.resources)if(st.name===le.name&&st.group===parseInt(W)&&st.binding===parseInt(J)){Ve=!0;break}if(Ve)if(oe.texture!==void 0&&oe.descriptor!==void 0){const st=new gh(oe.texture,this.getTypeInfo(Ie.type),oe.descriptor,(ne=oe.texture.view)!==null&&ne!==void 0?ne:null);le.value=st}else oe.uniform!==void 0?le.value=new wr(oe.uniform,this.getTypeInfo(Ie.type)):le.value=new wr(oe,this.getTypeInfo(Ie.type))}}})}for(let W=0;W<M;++W)for(let J=0;J<A;++J)for(let oe=0;oe<o;++oe)d.setVariable("@workgroup_id",new xe([oe,J,W],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(g,[oe,J,W],d)}execStatement(e,t){if(e instanceof vS)return this.evalExpression(e.value,t);if(e instanceof xS){if(e.condition){const s=this.evalExpression(e.condition,t);if(!(s instanceof Ne))throw new Error("Invalid break-if condition");if(!s.value)return null}return sa._breakObj}if(e instanceof wS)return sa._continueObj;if(e instanceof x_)this._let(e,t);else if(e instanceof mh)this._var(e,t);else if(e instanceof gv)this._const(e,t);else if(e instanceof M_)this._function(e,t);else{if(e instanceof yS)return this._if(e,t);if(e instanceof _S)return this._switch(e,t);if(e instanceof dS)return this._for(e,t);if(e instanceof fS)return this._while(e,t);if(e instanceof mS)return this._loop(e,t);if(e instanceof Bb){const s=t.clone();return s.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,s)}if(e instanceof gS)this._assign(e,t);else if(e instanceof pS)this._increment(e,t);else{if(e instanceof ph)return null;if(e instanceof Rx){const s=e.name;t.getVariable(s)===null&&t.setVariable(s,new Ne(0,this.getTypeInfo("u32")))}else if(e instanceof Dx)this._call(e,t);else{if(e instanceof bS||e instanceof Ox)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof fc?this._evalBinaryOp(e,t):e instanceof Zr?this._evalLiteral(e,t):e instanceof Ro?this._evalVariable(e,t):e instanceof kx?this._evalCall(e,t):e instanceof lu?this._evalCreate(e,t):e instanceof TS?this._evalConst(e,t):e instanceof SS?this._evalBitcast(e,t):e instanceof zr?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Et){const l=this.reflection.getTypeInfo(e);if(l!==null)return l}let s=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return s!==null||(s=this.reflection.getTypeInfoByName(e)),s}_setOverrides(e,t){for(const s in e){const l=e[s],d=this.reflection.getOverrideInfo(s);d!==null?(d.type===null&&(d.type=this.getTypeInfo("u32")),d.type.name==="u32"||d.type.name==="i32"||d.type.name==="f32"||d.type.name==="f16"?t.setVariable(s,new Ne(l,d.type)):d.type.name==="bool"?t.setVariable(s,new Ne(l?1:0,d.type)):d.type.name==="vec2"||d.type.name==="vec3"||d.type.name==="vec4"||d.type.name==="vec2f"||d.type.name==="vec3f"||d.type.name==="vec4f"||d.type.name==="vec2i"||d.type.name==="vec3i"||d.type.name==="vec4i"||d.type.name==="vec2u"||d.type.name==="vec3u"||d.type.name==="vec4u"||d.type.name==="vec2h"||d.type.name==="vec3h"||d.type.name==="vec4h"?t.setVariable(s,new xe(l,d.type)):console.error(`Invalid constant type for ${s}`)):console.error(`Override ${s} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,s){const l=[1,1,1];for(const I of e.node.attributes)if(I.name==="workgroup_size"){if(I.value.length>0){const z=s.getVariableValue(I.value[0]);l[0]=z instanceof Ne?z.value:parseInt(I.value[0])}if(I.value.length>1){const z=s.getVariableValue(I.value[1]);l[1]=z instanceof Ne?z.value:parseInt(I.value[1])}if(I.value.length>2){const z=s.getVariableValue(I.value[2]);l[2]=z instanceof Ne?z.value:parseInt(I.value[2])}}const d=this.getTypeInfo("vec3u"),g=this.getTypeInfo("u32");s.setVariable("@workgroup_size",new xe(l,d));const o=l[0],A=l[1],M=l[2];for(let I=0,z=0;I<M;++I)for(let W=0;W<A;++W)for(let J=0;J<o;++J,++z){const oe=[J,W,I],le=[J+t[0]*l[0],W+t[1]*l[1],I+t[2]*l[2]];s.setVariable("@local_invocation_id",new xe(oe,d)),s.setVariable("@global_invocation_id",new xe(le,d)),s.setVariable("@local_invocation_index",new Ne(z,g)),this._dispatchExec(e,s)}}_dispatchExec(e,t){for(const s of e.node.args)for(const l of s.attributes)if(l.name==="builtin"){const d=`@${l.value}`,g=t.getVariable(d);g!==void 0&&t.variables.set(s.name,g)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof zr;)e=e.right;return e instanceof Ro?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const s of e){if(s instanceof Array){const d=t.clone(),g=this._execStatements(s,d);if(g)return g;continue}const l=this.execStatement(s,t);if(l)return l}return null}_call(e,t){const s=t.clone();s.currentFunctionName=e.name;const l=t.getFunction(e.name);if(l){for(let d=0;d<l.node.args.length;++d){const g=l.node.args[d],o=this.evalExpression(e.args[d],s);s.setVariable(g.name,o,g)}this._execStatements(l.node.body,s)}else e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const s=this.getVariableName(e.variable,t),l=t.getVariable(s);l?e.operator==="++"?l.value instanceof Ne?l.value.value++:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):e.operator==="--"?l.value instanceof Ne?l.value.value--:console.error(`Variable ${s} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${s} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Ro){const s=this.getVariableName(e,t),l=t.getVariable(s);return l===null?(console.error(`Variable ${s} not found. Line ${e.line}`),null):l.value.getSubData(this,e.postfix,t)}if(e instanceof zr){if(e.operator==="*"){const s=this._getVariableData(e.right,t);return s instanceof Ig?s.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const s=this._getVariableData(e.right,t);return new Ig(s)}}return null}_assign(e,t){let s=null,l="<var>",d=null;if(e.variable instanceof zr){const A=this._getVariableData(e.variable,t),M=this.evalExpression(e.value,t),I=e.operator;if(I==="="){if(A instanceof Ne||A instanceof xe||A instanceof _i){if(M instanceof Ne||M instanceof xe||M instanceof _i&&A.data.length===M.data.length)return void A.data.set(M.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(A instanceof wr&&M instanceof wr&&A.buffer.byteLength-A.offset>=M.buffer.byteLength-M.offset)return void(A.buffer.byteLength%4==0?new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4).set(new Uint32Array(M.buffer,M.offset,M.typeInfo.size/4)):new Uint8Array(A.buffer,A.offset,A.typeInfo.size).set(new Uint8Array(M.buffer,M.offset,M.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(I==="+=")return A instanceof Ne||A instanceof xe||A instanceof _i?M instanceof Ne||M instanceof xe||M instanceof _i?void A.data.set(M.data.map((z,W)=>A.data[W]+z)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(I==="-=")return(A instanceof Ne||A instanceof xe||A instanceof _i)&&(M instanceof Ne||M instanceof xe||M instanceof _i)?void A.data.set(M.data.map((z,W)=>A.data[W]-z)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof zr){if(e.variable.operator==="*"){l=this.getVariableName(e.variable.right,t);const A=t.getVariable(l);if(!(A&&A.value instanceof Ig))return void console.error(`Variable ${l} is not a pointer. Line ${e.line}`);s=A.value.reference;let M=e.variable.postfix;if(!M){let I=e.variable.right;for(;I instanceof zr;){if(I.postfix){M=I.postfix;break}I=I.right}}M&&(s=s.getSubData(this,M,t))}}else{d=e.variable.postfix,l=this.getVariableName(e.variable,t);const A=t.getVariable(l);if(A===null)return void console.error(`Variable ${l} not found. Line ${e.line}`);s=A.value}if(s instanceof Ig&&(s=s.reference),s===null)return void console.error(`Variable ${l} not found. Line ${e.line}`);const g=this.evalExpression(e.value,t),o=e.operator;if(o!=="="){const A=s.getSubData(this,d,t);if(A instanceof xe&&g instanceof Ne){const M=A.data,I=g.value;if(o==="+=")for(let z=0;z<M.length;++z)M[z]+=I;else if(o==="-=")for(let z=0;z<M.length;++z)M[z]-=I;else if(o==="*=")for(let z=0;z<M.length;++z)M[z]*=I;else if(o==="/=")for(let z=0;z<M.length;++z)M[z]/=I;else if(o==="%=")for(let z=0;z<M.length;++z)M[z]%=I;else if(o==="&=")for(let z=0;z<M.length;++z)M[z]&=I;else if(o==="|=")for(let z=0;z<M.length;++z)M[z]|=I;else if(o==="^=")for(let z=0;z<M.length;++z)M[z]^=I;else if(o==="<<=")for(let z=0;z<M.length;++z)M[z]<<=I;else if(o===">>=")for(let z=0;z<M.length;++z)M[z]>>=I;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(A instanceof xe&&g instanceof xe){const M=A.data,I=g.data;if(M.length!==I.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let z=0;z<M.length;++z)M[z]+=I[z];else if(o==="-=")for(let z=0;z<M.length;++z)M[z]-=I[z];else if(o==="*=")for(let z=0;z<M.length;++z)M[z]*=I[z];else if(o==="/=")for(let z=0;z<M.length;++z)M[z]/=I[z];else if(o==="%=")for(let z=0;z<M.length;++z)M[z]%=I[z];else if(o==="&=")for(let z=0;z<M.length;++z)M[z]&=I[z];else if(o==="|=")for(let z=0;z<M.length;++z)M[z]|=I[z];else if(o==="^=")for(let z=0;z<M.length;++z)M[z]^=I[z];else if(o==="<<=")for(let z=0;z<M.length;++z)M[z]<<=I[z];else if(o===">>=")for(let z=0;z<M.length;++z)M[z]>>=I[z];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(A instanceof Ne&&g instanceof Ne))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?A.value+=g.value:o==="-="?A.value-=g.value:o==="*="?A.value*=g.value:o==="/="?A.value/=g.value:o==="%="?A.value%=g.value:o==="&="?A.value&=g.value:o==="|="?A.value|=g.value:o==="^="?A.value^=g.value:o==="<<="?A.value<<=g.value:o===">>="?A.value>>=g.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}return void(s instanceof wr&&s.setDataValue(this,A,d,t))}if(s instanceof wr)s.setDataValue(this,g,d,t);else if(d){if(!(s instanceof xe||s instanceof _i))return void console.error(`Variable ${l} is not a vector or matrix. Line ${e.line}`);if(d instanceof Wg){const A=this.evalExpression(d.index,t).value;if(s instanceof xe){if(!(g instanceof Ne))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[A]=g.value}else{if(!(s instanceof _i))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);{const M=this.evalExpression(d.index,t).value;if(M<0)return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);if(!(g instanceof xe))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);{const I=s.typeInfo.getTypeName();if(I==="mat2x2"||I==="mat2x2f"||I==="mat2x2h"){if(!(M<2&&g.data.length===2))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[2*M]=g.data[0],s.data[2*M+1]=g.data[1]}else if(I==="mat2x3"||I==="mat2x3f"||I==="mat2x3h"){if(!(M<2&&g.data.length===3))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[3*M]=g.data[0],s.data[3*M+1]=g.data[1],s.data[3*M+2]=g.data[2]}else if(I==="mat2x4"||I==="mat2x4f"||I==="mat2x4h"){if(!(M<2&&g.data.length===4))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[4*M]=g.data[0],s.data[4*M+1]=g.data[1],s.data[4*M+2]=g.data[2],s.data[4*M+3]=g.data[3]}else if(I==="mat3x2"||I==="mat3x2f"||I==="mat3x2h"){if(!(M<3&&g.data.length===2))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[2*M]=g.data[0],s.data[2*M+1]=g.data[1]}else if(I==="mat3x3"||I==="mat3x3f"||I==="mat3x3h"){if(!(M<3&&g.data.length===3))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[3*M]=g.data[0],s.data[3*M+1]=g.data[1],s.data[3*M+2]=g.data[2]}else if(I==="mat3x4"||I==="mat3x4f"||I==="mat3x4h"){if(!(M<3&&g.data.length===4))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[4*M]=g.data[0],s.data[4*M+1]=g.data[1],s.data[4*M+2]=g.data[2],s.data[4*M+3]=g.data[3]}else if(I==="mat4x2"||I==="mat4x2f"||I==="mat4x2h"){if(!(M<4&&g.data.length===2))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[2*M]=g.data[0],s.data[2*M+1]=g.data[1]}else if(I==="mat4x3"||I==="mat4x3f"||I==="mat4x3h"){if(!(M<4&&g.data.length===3))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[3*M]=g.data[0],s.data[3*M+1]=g.data[1],s.data[3*M+2]=g.data[2]}else{if(I!=="mat4x4"&&I!=="mat4x4f"&&I!=="mat4x4h")return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);if(!(M<4&&g.data.length===4))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);s.data[4*M]=g.data[0],s.data[4*M+1]=g.data[1],s.data[4*M+2]=g.data[2],s.data[4*M+3]=g.data[3]}}}}}else if(d instanceof ep){const A=d.value;if(!(s instanceof xe))return void console.error(`Invalid assignment to ${A}. Variable ${l} is not a vector. Line ${e.line}`);if(g instanceof Ne){if(A.length>1)return void console.error(`Invalid assignment to ${A} for variable ${l}. Line ${e.line}`);if(A==="x")s.data[0]=g.value;else if(A==="y"){if(s.data.length<2)return void console.error(`Invalid assignment to ${A} for variable ${l}. Line ${e.line}`);s.data[1]=g.value}else if(A==="z"){if(s.data.length<3)return void console.error(`Invalid assignment to ${A} for variable ${l}. Line ${e.line}`);s.data[2]=g.value}else if(A==="w"){if(s.data.length<4)return void console.error(`Invalid assignment to ${A} for variable ${l}. Line ${e.line}`);s.data[3]=g.value}}else{if(!(g instanceof xe))return void console.error(`Invalid assignment to ${l}. Line ${e.line}`);if(A.length!==g.data.length)return void console.error(`Invalid assignment to ${A} for variable ${l}. Line ${e.line}`);for(let M=0;M<A.length;++M){const I=A[M];if(I==="x"||I==="r")s.data[0]=g.data[M];else if(I==="y"||I==="g"){if(g.data.length<2)return void console.error(`Invalid assignment to ${I} for variable ${l}. Line ${e.line}`);s.data[1]=g.data[M]}else if(I==="z"||I==="b"){if(g.data.length<3)return void console.error(`Invalid assignment to ${I} for variable ${l}. Line ${e.line}`);s.data[2]=g.data[M]}else{if(I!=="w"&&I!=="a")return void console.error(`Invalid assignment to ${I} for variable ${l}. Line ${e.line}`);if(g.data.length<4)return void console.error(`Invalid assignment to ${I} for variable ${l}. Line ${e.line}`);s.data[3]=g.data[M]}}}}}else s instanceof Ne&&g instanceof Ne?s.value=g.value:s instanceof xe&&g instanceof xe||s instanceof _i&&g instanceof _i?s.data.set(g.data):console.error(`Invalid assignment to ${l}. Line ${e.line}`)}_function(e,t){const s=new zx(e);t.functions.set(e.name,s)}_const(e,t){let s=null;e.value!==null&&(s=this.evalExpression(e.value,t)),t.createVariable(e.name,s,e)}_let(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof zr||(s=s.clone())}else{const l=e.type.name;if(l==="f32"||l==="i32"||l==="u32"||l==="bool"||l==="f16"||l==="vec2"||l==="vec3"||l==="vec4"||l==="vec2f"||l==="vec3f"||l==="vec4f"||l==="vec2i"||l==="vec3i"||l==="vec4i"||l==="vec2u"||l==="vec3u"||l==="vec4u"||l==="vec2h"||l==="vec3h"||l==="vec4h"||l==="vec2b"||l==="vec3b"||l==="vec4b"||l==="mat2x2"||l==="mat2x3"||l==="mat2x4"||l==="mat3x2"||l==="mat3x3"||l==="mat3x4"||l==="mat4x2"||l==="mat4x3"||l==="mat4x4"||l==="mat2x2f"||l==="mat2x3f"||l==="mat2x4f"||l==="mat3x2f"||l==="mat3x3f"||l==="mat3x4f"||l==="mat4x2f"||l==="mat4x3f"||l==="mat4x4f"||l==="mat2x2h"||l==="mat2x3h"||l==="mat2x4h"||l==="mat3x2h"||l==="mat3x3h"||l==="mat3x4h"||l==="mat4x2h"||l==="mat4x3h"||l==="mat4x4h"||l==="array"){const d=new lu(e.type,[]);s=this._evalCreate(d,t)}}t.createVariable(e.name,s,e)}_var(e,t){let s=null;if(e.value!==null){if(s=this.evalExpression(e.value,t),s===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof zr||(s=s.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const l=e.type.name;if(l==="f32"||l==="i32"||l==="u32"||l==="bool"||l==="f16"||l==="vec2"||l==="vec3"||l==="vec4"||l==="vec2f"||l==="vec3f"||l==="vec4f"||l==="vec2i"||l==="vec3i"||l==="vec4i"||l==="vec2u"||l==="vec3u"||l==="vec4u"||l==="vec2h"||l==="vec3h"||l==="vec4h"||l==="vec2b"||l==="vec3b"||l==="vec4b"||l==="mat2x2"||l==="mat2x3"||l==="mat2x4"||l==="mat3x2"||l==="mat3x3"||l==="mat3x4"||l==="mat4x2"||l==="mat4x3"||l==="mat4x4"||l==="mat2x2f"||l==="mat2x3f"||l==="mat2x4f"||l==="mat3x2f"||l==="mat3x3f"||l==="mat3x4f"||l==="mat4x2f"||l==="mat4x3f"||l==="mat4x4f"||l==="mat2x2h"||l==="mat2x3h"||l==="mat2x4h"||l==="mat3x2h"||l==="mat3x3h"||l==="mat3x4h"||l==="mat4x2h"||l==="mat4x3h"||l==="mat4x4h"||e.type instanceof w_||e.type instanceof ph||e.type instanceof Ge){const d=new lu(e.type,[]);s=this._evalCreate(d,t)}}t.createVariable(e.name,s,e)}_switch(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof Ne))return console.error(`Invalid if condition. Line ${e.line}`),null;let l=null;for(const d of e.cases)if(d instanceof CS)for(const g of d.selectors){if(g instanceof _v){l=d;continue}const o=this.evalExpression(g,t);if(!(o instanceof Ne))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===s.value)return this._execStatements(d.body,t)}else d instanceof MS&&(l=d);return l?this._execStatements(l.body,t):null}_if(e,t){t=t.clone();const s=this.evalExpression(e.condition,t);if(!(s instanceof Ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(e.body,t);for(const l of e.elseif){const d=this.evalExpression(l.condition,t);if(!(d instanceof Ne))return console.error(`Invalid if condition. Line ${e.line}`),null;if(d.value)return this._execStatements(l.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Ne?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===sa._breakObj)break;if(s!==null&&s!==sa._continueObj)return s;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const s=this._execStatements(e.body,t);if(s===sa._breakObj)break;if(s===sa._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===sa._breakObj)break}else if(s!==null)return s}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const s=this._execStatements(e.body,t);if(s===sa._breakObj)break;if(s!==sa._continueObj&&s!==null)return s}return null}_evalBitcast(e,t){const s=this.evalExpression(e.value,t),l=e.type;if(s instanceof Ne){const d=mw(s.value,s.typeInfo.name,l.name);return new Ne(d,this.getTypeInfo(l))}if(s instanceof xe){const d=s.typeInfo.getTypeName();let g="";if(d.endsWith("f"))g="f32";else if(d.endsWith("i"))g="i32";else if(d.endsWith("u"))g="u32";else if(d.endsWith("b"))g="bool";else{if(!d.endsWith("h"))return console.error(`Unknown vector type ${d}. Line ${e.line}`),null;g="f16"}const o=l.getTypeName();let A="";if(o.endsWith("f"))A="f32";else if(o.endsWith("i"))A="i32";else if(o.endsWith("u"))A="u32";else if(o.endsWith("b"))A="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${A}. Line ${e.line}`),null;A="f16"}const M=(function(I,z,W){if(z===W)return I;const J=new Array(I.length);for(let oe=0;oe<I.length;oe++)J[oe]=mw(I[oe],z,W);return J})(Array.from(s.data),g,A);return new xe(M,this.getTypeInfo(l))}return console.error(`TODO: bitcast for ${s.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var s;if(e instanceof lu){if(e.type===null)return zb.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const l=e instanceof lu?e.type.name:e.name,d=e instanceof lu?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(d===null)return console.error(`Unknown type ${l}. Line ${e.line}`),null;if(d.size===0)return null;const g=new wr(new ArrayBuffer(d.size),d,0);if(d instanceof Tf){if(e.args)for(let o=0;o<e.args.length;++o){const A=d.members[o],M=e.args[o],I=this.evalExpression(M,t);g.setData(this,I,A.type,A.offset,t)}}else if(d instanceof Mf){let o=0;if(e.args)for(let A=0;A<e.args.length;++A){const M=e.args[A],I=this.evalExpression(M,t);d.format===null&&(((s=I.typeInfo)===null||s===void 0?void 0:s.name)==="x32"?d.format=this.getTypeInfo("i32"):d.format=I.typeInfo),g.setData(this,I,d.format,o,t),o+=d.stride}}else console.error(`Unknown type "${l}". Line ${e.line}`);return e instanceof lu?g.getSubData(this,e.postfix,t):g}_evalLiteral(e,t){const s=this.getTypeInfo(e.type),l=s.name;return l==="x32"||l==="u32"||l==="f32"||l==="f16"||l==="i32"||l==="bool"?new Ne(e.scalarValue,s):l==="vec2"||l==="vec3"||l==="vec4"||l==="vec2f"||l==="vec3f"||l==="vec4f"||l==="vec2h"||l==="vec3h"||l==="vec4h"||l==="vec2i"||l==="vec3i"||l==="vec4i"||l==="vec2u"||l==="vec3u"||l==="vec4u"?this._callConstructorVec(e,t):l==="mat2x2"||l==="mat2x3"||l==="mat2x4"||l==="mat3x2"||l==="mat3x3"||l==="mat3x4"||l==="mat4x2"||l==="mat4x3"||l==="mat4x4"||l==="mat2x2f"||l==="mat2x3f"||l==="mat2x4f"||l==="mat3x2f"||l==="mat3x3f"||l==="mat3x4f"||l==="mat4x2f"||l==="mat4x3f"||l==="mat4x4f"||l==="mat2x2h"||l==="mat2x3h"||l==="mat2x4h"||l==="mat3x2h"||l==="mat3x3h"||l==="mat3x4h"||l==="mat4x2h"||l==="mat4x3h"||l==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const s=t.getVariableValue(e.name);return s===null?s:s.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let s=1;s<e.length;++s){const l=sa._priority.get(t.name);sa._priority.get(e[s].name)<l&&(t=e[s])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const s=this.evalExpression(e.right,t);if(e.operator==="&")return new Ig(s);if(e.operator==="*")return s instanceof Ig?s.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const l=s instanceof Ne?s.value:s instanceof xe?Array.from(s.data):null;switch(e.operator){case"+":{if(jt(l)){const o=l.map((A,M)=>+A);return new xe(o,s.typeInfo)}const d=l,g=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new Ne(+d,g)}case"-":{if(jt(l)){const o=l.map((A,M)=>-A);return new xe(o,s.typeInfo)}const d=l,g=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new Ne(-d,g)}case"!":{if(jt(l)){const o=l.map((A,M)=>A?0:1);return new xe(o,s.typeInfo)}const d=l,g=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new Ne(d?0:1,g)}case"~":{if(jt(l)){const o=l.map((A,M)=>~A);return new xe(o,s.typeInfo)}const d=l,g=this._maxFormatTypeInfo([s.typeInfo,s.typeInfo]);return new Ne(~d,g)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const s=this.evalExpression(e.left,t),l=this.evalExpression(e.right,t),d=s instanceof Ne?s.value:s instanceof xe||s instanceof _i?Array.from(s.data):null,g=l instanceof Ne?l.value:l instanceof xe||l instanceof _i?Array.from(l.data):null;switch(e.operator){case"+":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J+z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W+I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I+W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o+A,M)}case"-":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J-z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W-I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I-W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o-A,M)}case"*":{if(jt(d)&&jt(g)){const I=d,z=g;if(s instanceof _i&&l instanceof _i){const W=(function(ne,Ie,Ue,Se){if(Aa[Ie.name]===void 0||Aa[Se.name]===void 0)return null;const Ve=Aa[Ie.name][0],st=Aa[Ie.name][1],ot=Aa[Se.name][0];if(Ve!==Aa[Se.name][1])return null;const wt=new Array(ot*st);for(let Ft=0;Ft<st;Ft++)for(let lt=0;lt<ot;lt++){let kt=0;for(let xt=0;xt<Ve;xt++)kt+=ne[xt*st+Ft]*Ue[lt*Ve+xt];wt[Ft*ot+lt]=kt}return wt})(I,s.typeInfo,z,l.typeInfo);if(W===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const J=Aa[l.typeInfo.name][0],oe=Aa[s.typeInfo.name][1],le=this.getTypeInfo(`mat${J}x${oe}f`);return new _i(W,le)}if(s instanceof _i&&l instanceof xe){const W=(function(J,oe,le,ne){if(Aa[oe.name]===void 0||Y0[ne.name]===void 0)return null;const Ie=Aa[oe.name][0],Ue=Aa[oe.name][1];if(Ie!==le.length)return null;const Se=new Array(Ue);for(let Ve=0;Ve<Ue;Ve++){let st=0;for(let ot=0;ot<Ie;ot++)st+=J[ot*Ue+Ve]*le[ot];Se[Ve]=st}return Se})(I,s.typeInfo,z,l.typeInfo);return W===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new xe(W,l.typeInfo)}if(s instanceof xe&&l instanceof _i){const W=(function(J,oe,le,ne){if(Y0[oe.name]===void 0||Aa[ne.name]===void 0)return null;const Ie=Aa[ne.name][0],Ue=Aa[ne.name][1];if(Ue!==J.length)return null;const Se=[];for(let Ve=0;Ve<Ie;Ve++){let st=0;for(let ot=0;ot<Ue;ot++)st+=J[ot]*le[ot*Ie+Ve];Se[Ve]=st}return Se})(I,s.typeInfo,z,l.typeInfo);return W===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new xe(W,s.typeInfo)}{if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J*z[oe]);return new xe(W,s.typeInfo)}}if(jt(d)){const I=g,z=d.map((W,J)=>W*I);return s instanceof _i?new _i(z,s.typeInfo):new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I*W);return l instanceof _i?new _i(z,l.typeInfo):new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o*A,M)}case"%":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J%z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W%I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I%W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o%A,M)}case"/":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J/z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W/I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I/W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o/A,M)}case"&":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J&z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W&I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I&W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o&A,M)}case"|":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J|z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W|I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I|W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o|A,M)}case"^":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J^z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W^I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I^W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o^A,M)}case"<<":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J<<z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W<<I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I<<W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o<<A,M)}case">>":{if(jt(d)&&jt(g)){const I=d,z=g;if(I.length!==z.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const W=I.map((J,oe)=>J>>z[oe]);return new xe(W,s.typeInfo)}if(jt(d)){const I=g,z=d.map((W,J)=>W>>I);return new xe(z,s.typeInfo)}if(jt(g)){const I=d,z=g.map((W,J)=>I>>W);return new xe(z,l.typeInfo)}const o=d,A=g,M=this._maxFormatTypeInfo([s.typeInfo,l.typeInfo]);return new Ne(o>>A,M)}case">":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I>A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M>o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o>M?1:0);return new xe(A,l.typeInfo)}return new Ne(d>g?1:0,this.getTypeInfo("bool"));case"<":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I<A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M<o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o<M?1:0);return new xe(A,l.typeInfo)}return new Ne(d<g?1:0,this.getTypeInfo("bool"));case"==":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I===A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M==o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o==M?1:0);return new xe(A,l.typeInfo)}return new Ne(d===g?1:0,this.getTypeInfo("bool"));case"!=":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I!==A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M!==o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o!==M?1:0);return new xe(A,l.typeInfo)}return new Ne(d!==g?1:0,this.getTypeInfo("bool"));case">=":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I>=A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M>=o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o>=M?1:0);return new xe(A,l.typeInfo)}return new Ne(d>=g?1:0,this.getTypeInfo("bool"));case"<=":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I<=A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M<=o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o<=M?1:0);return new xe(A,l.typeInfo)}return new Ne(d<=g?1:0,this.getTypeInfo("bool"));case"&&":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I&&A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M&&o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o&&M?1:0);return new xe(A,l.typeInfo)}return new Ne(d&&g?1:0,this.getTypeInfo("bool"));case"||":if(jt(d)&&jt(g)){const o=d,A=g;if(o.length!==A.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const M=o.map((I,z)=>I||A[z]?1:0);return new xe(M,s.typeInfo)}if(jt(d)){const o=g,A=d.map((M,I)=>M||o?1:0);return new xe(A,s.typeInfo)}if(jt(g)){const o=d,A=g.map((M,I)=>o||M?1:0);return new xe(A,l.typeInfo)}return new Ne(d||g?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const s=t.clone();s.currentFunctionName=e.name;const l=t.getFunction(e.name);if(!l)return e.isBuiltin?this._callBuiltinFunction(e,s):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let d=0;d<l.node.args.length;++d){const g=l.node.args[d],o=this.evalExpression(e.args[d],s);s.createVariable(g.name,o,g)}return this._execStatements(l.node.body,s)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const s=t.getFunction(e.name);if(s){const l=t.clone();for(let d=0;d<s.node.args.length;++d){const g=s.node.args[d],o=this.evalExpression(e.args[d],l);l.setVariable(g.name,o,g)}return this._execStatements(s.node.body,l)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new Ne(0,this.getTypeInfo(e.type));const s=this.evalExpression(e.args[0],t);return s.typeInfo=this.getTypeInfo(e.type),s.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const s=this.getTypeInfo(e.type),l=e.type.getTypeName(),d=Y0[l];if(d===void 0)return console.error(`Invalid vec constructor ${l}. Line ${e.line}`),null;const g=[];if(e instanceof Zr)if(e.isVector){const o=e.vectorValue;for(const A of o)g.push(A)}else g.push(e.scalarValue);else if(e.args)for(const o of e.args){const A=this.evalExpression(o,t);if(A instanceof xe){const M=A.data;for(let I=0;I<M.length;++I){let z=M[I];g.push(z)}}else if(A instanceof Ne){let M=A.value;g.push(M)}}if(e.type instanceof Ge&&e.type.format===null&&(e.type.format=Ge.f32),g.length===0){const o=new Array(d).fill(0);return new xe(o,s).getSubData(this,e.postfix,t)}if(g.length===1)for(;g.length<d;)g.push(g[0]);return g.length<d?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new xe(g.length>d?g.slice(0,d):g,s).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const s=this.getTypeInfo(e.type),l=e.type.getTypeName(),d=Aa[l];if(d===void 0)return console.error(`Invalid matrix constructor ${l}. Line ${e.line}`),null;const g=[];if(e instanceof Zr)if(e.isVector){const o=e.vectorValue;for(const A of o)g.push(A)}else g.push(e.scalarValue);else if(e.args)for(const o of e.args){const A=this.evalExpression(o,t);A instanceof xe?g.push(...A.data):A instanceof Ne?g.push(A.value):A instanceof _i&&g.push(...A.data)}if(s instanceof Jd&&s.format===null&&(s.format=this.getTypeInfo("f32")),g.length===0){const o=new Array(d[2]).fill(0);return new _i(o,s).getSubData(this,e.postfix,t)}return g.length!==d[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new _i(g,s).getSubData(this,e.postfix,t)}}sa._breakObj=new yl(new gl("BREAK",null),null),sa._continueObj=new yl(new gl("CONTINUE",null),null),sa._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class oI{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class lI{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new oI,this._exec=new sa,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const s=this._global_decl_or_directive();if(!s)break;t.push(s)}if(this._deferArrayCountEval.length>0){for(const s of this._deferArrayCountEval){const l=s.arrayType,d=s.countNode;if(d instanceof Ro){const g=d.name,o=this._context.constants.get(g);if(o)try{const A=o.constEvaluate(this._exec);l.count=A}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const s of t)s.search(l=>{l instanceof pw||l instanceof mv?l.type=this._forwardType(l.type):l instanceof w_?l.format=this._forwardType(l.format):l instanceof mh||l instanceof x_||l instanceof gv?l.type=this._forwardType(l.type):l instanceof M_?l.returnType=this._forwardType(l.returnType):l instanceof dw&&(l.type=this._forwardType(l.type))});return t}_forwardType(e){if(e instanceof fw){const t=this._getType(e.name);if(t)return t}else e instanceof mv?e.type=this._forwardType(e.type):e instanceof w_&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new KP(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==pe.eof}_match(e){if(e instanceof $e)return!!this._check(e)&&(this._advance(),!0);for(let t=0,s=e.length;t<s;++t){const l=e[t];if(this._check(l))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const s=t.type;let l=!1;for(const d of e){if(s===d)return!0;d===pe.tokens.name&&(l=!0)}if(l){const d=pe.tokens.name.rule.exec(t.lexeme);if(d&&d.index==0&&d[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===pe.tokens.name){const s=pe.tokens.name.rule.exec(t.lexeme);return s&&s.index==0&&s[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(pe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(pe.keywords.alias)){const t=this._type_alias();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.diagnostic)){const t=this._diagnostic();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.requires)){const t=this._requires_directive();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(pe.keywords.enable)){const t=this._enable_directive();return this._consume(pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(pe.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(pe.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(pe.keywords.fn))return null;const e=this._currentLine,t=this._consume(pe.tokens.ident,"Expected function name.").toString();this._consume(pe.tokens.paren_left,"Expected '(' for function arguments.");const s=[];if(!this._check(pe.tokens.paren_right))do{if(this._check(pe.tokens.paren_right))break;const o=this._attribute(),A=this._consume(pe.tokens.name,"Expected argument name.").toString();this._consume(pe.tokens.colon,"Expected ':' for argument type.");const M=this._attribute(),I=this._type_decl();I!=null&&(I.attributes=M,s.push(this._updateNode(new dw(A,I,o))))}while(this._match(pe.tokens.comma));this._consume(pe.tokens.paren_right,"Expected ')' after function arguments.");let l=null;if(this._match(pe.tokens.arrow)){const o=this._attribute();l=this._type_decl(),l!=null&&(l.attributes=o)}const d=this._compound_statement(),g=this._currentLine;return this._updateNode(new M_(t,s,l,d,e,g),e)}_compound_statement(){const e=[];for(this._consume(pe.tokens.brace_left,"Expected '{' for block.");!this._check(pe.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(pe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(pe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(pe.tokens.attr)&&this._attribute(),this._check(pe.keywords.if))return this._if_statement();if(this._check(pe.keywords.switch))return this._switch_statement();if(this._check(pe.keywords.loop))return this._loop_statement();if(this._check(pe.keywords.for))return this._for_statement();if(this._check(pe.keywords.while))return this._while_statement();if(this._check(pe.keywords.continuing))return this._continuing_statement();if(this._check(pe.keywords.static_assert))return this._static_assert_statement();if(this._check(pe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(pe.keywords.return))e=this._return_statement();else if(this._check([pe.keywords.var,pe.keywords.let,pe.keywords.const]))e=this._variable_statement();else if(this._match(pe.keywords.discard))e=this._updateNode(new GP);else if(this._match(pe.keywords.break)){const t=this._updateNode(new xS);if(this._currentLoop.length>0){const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t,this._check(pe.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(pe.keywords.continue)){const t=this._updateNode(new wS);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const s=this._currentLoop[this._currentLoop.length-1];t.loopId=s.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(pe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(pe.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new WP(t),e)}_while_statement(){if(!this._match(pe.keywords.while))return null;const e=this._updateNode(new fS(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(pe.keywords.continuing))return null;const t=this._currentLine,s=this._compound_statement();return this._updateNode(new Bb(s,e),t)}_for_statement(){if(!this._match(pe.keywords.for))return null;this._consume(pe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new dS(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(pe.tokens.semicolon)?null:this._for_init(),this._consume(pe.tokens.semicolon,"Expected ';'."),e.condition=this._check(pe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(pe.tokens.semicolon,"Expected ';'."),e.increment=this._check(pe.tokens.paren_right)?null:this._for_increment(),this._consume(pe.tokens.paren_right,"Expected ')'."),this._check(pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(pe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(pe.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new mh(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(pe.keywords.let)){const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected name for let.").toString();let s=null;if(this._match(pe.tokens.colon)){const d=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=d)}this._consume(pe.tokens.equal,"Expected '=' for let.");const l=this._short_circuit_or_expression();return this._updateNode(new x_(t,s,null,null,l),e)}if(this._match(pe.keywords.const)){const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected name for const.").toString();let s=null;if(this._match(pe.tokens.colon)){const d=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=d)}this._consume(pe.tokens.equal,"Expected '=' for const.");const l=this._short_circuit_or_expression();return s===null&&l instanceof Zr&&(s=l.type),this._updateNode(new gv(t,s,null,null,l),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(pe.increment_operators))return this._current=e,null;const s=this._consume(pe.increment_operators,"Expected increment operator");return this._updateNode(new pS(s.type===pe.tokens.plus_plus?Lg.increment:Lg.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(pe.tokens.brace_right))return null;let s=this._match(pe.tokens.underscore);if(s||(e=this._unary_expression()),!s&&e==null)return null;const l=this._consume(pe.assignment_operators,"Expected assignment operator."),d=this._short_circuit_or_expression();return this._updateNode(new gS(d_.parse(l.lexeme),e,d),t)}_func_call_statement(){if(!this._check(pe.tokens.ident))return null;const e=this._currentLine,t=this._current,s=this._consume(pe.tokens.ident,"Expected function name."),l=this._argument_expression_list();return l===null?(this._current=t,null):this._updateNode(new Dx(s.lexeme,l),e)}_loop_statement(){if(!this._match(pe.keywords.loop))return null;this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new mS([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let s of t)e.body.push(s);else e.body.push(t);if(t instanceof Bb){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(pe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(pe.keywords.switch))return null;const e=this._updateNode(new _S(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(pe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([pe.keywords.default,pe.keywords.case]);){if(this._match(pe.keywords.case)){const s=this._case_selectors();for(const d of s)if(d instanceof _v){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(pe.tokens.colon),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Exected '{' for switch case.");const l=this._case_body();this._consume(pe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new CS(s,l)))}if(this._match(pe.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(pe.tokens.colon),this._check(pe.tokens.attr)&&this._attribute(),this._consume(pe.tokens.brace_left,"Exected '{' for switch default.");const s=this._case_body();this._consume(pe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new MS(s)))}}return e}_case_selectors(){const e=[];for(this._match(pe.keywords.default)?e.push(this._updateNode(new _v)):e.push(this._shift_expression());this._match(pe.tokens.comma);)this._match(pe.keywords.default)?e.push(this._updateNode(new _v)):e.push(this._shift_expression());return e}_case_body(){if(this._match(pe.keywords.fallthrough))return this._consume(pe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(pe.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(pe.tokens.attr)&&this._attribute();const s=this._compound_statement();let l=[];this._match_elseif()&&(this._check(pe.tokens.attr)&&this._attribute(),l=this._elseif_statement(l));let d=null;return this._match(pe.keywords.else)&&(this._check(pe.tokens.attr)&&this._attribute(),d=this._compound_statement()),this._updateNode(new yS(t,s,l,d),e)}_match_elseif(){return this._tokens[this._current].type===pe.keywords.else&&this._tokens[this._current+1].type===pe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),s=this._compound_statement();return e.push(this._updateNode(new ZP(t,s))),this._match_elseif()&&(this._check(pe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(pe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new vS(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(pe.tokens.or_or);)e=this._updateNode(new fc(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(pe.tokens.and_and);)e=this._updateNode(new fc(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(pe.tokens.or);)e=this._updateNode(new fc(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(pe.tokens.xor);)e=this._updateNode(new fc(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(pe.tokens.and);)e=this._updateNode(new fc(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([pe.tokens.equal_equal,pe.tokens.not_equal])?this._updateNode(new fc(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([pe.tokens.less_than,pe.tokens.greater_than,pe.tokens.less_than_equal,pe.tokens.greater_than_equal]);)e=this._updateNode(new fc(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([pe.tokens.shift_left,pe.tokens.shift_right]);)e=this._updateNode(new fc(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([pe.tokens.plus,pe.tokens.minus]);)e=this._updateNode(new fc(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([pe.tokens.star,pe.tokens.forward_slash,pe.tokens.modulo]);)e=this._updateNode(new fc(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([pe.tokens.minus,pe.tokens.bang,pe.tokens.tilde,pe.tokens.star,pe.tokens.and])?this._updateNode(new zr(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(pe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(pe.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Wg(e)),s=this._postfix_expression();return s&&(t.postfix=s),t}if(this._match(pe.tokens.period)){const e=this._consume(pe.tokens.name,"Expected member name."),t=this._postfix_expression(),s=this._updateNode(new ep(e.lexeme));return t&&(s.postfix=t),s}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Et.void;case"bool":return Et.bool;case"i32":return Et.i32;case"u32":return Et.u32;case"f32":return Et.f32;case"f16":return Et.f16;case"vec2f":return Ge.vec2f;case"vec3f":return Ge.vec3f;case"vec4f":return Ge.vec4f;case"vec2i":return Ge.vec2i;case"vec3i":return Ge.vec3i;case"vec4i":return Ge.vec4i;case"vec2u":return Ge.vec2u;case"vec3u":return Ge.vec3u;case"vec4u":return Ge.vec4u;case"vec2h":return Ge.vec2h;case"vec3h":return Ge.vec3h;case"vec4h":return Ge.vec4h;case"mat2x2f":return Ge.mat2x2f;case"mat2x3f":return Ge.mat2x3f;case"mat2x4f":return Ge.mat2x4f;case"mat3x2f":return Ge.mat3x2f;case"mat3x3f":return Ge.mat3x3f;case"mat3x4f":return Ge.mat3x4f;case"mat4x2f":return Ge.mat4x2f;case"mat4x3f":return Ge.mat4x3f;case"mat4x4f":return Ge.mat4x4f;case"mat2x2h":return Ge.mat2x2h;case"mat2x3h":return Ge.mat2x3h;case"mat2x4h":return Ge.mat2x4h;case"mat3x2h":return Ge.mat3x2h;case"mat3x3h":return Ge.mat3x3h;case"mat3x4h":return Ge.mat3x4h;case"mat4x2h":return Ge.mat4x2h;case"mat4x3h":return Ge.mat4x3h;case"mat4x4h":return Ge.mat4x4h;case"mat2x2i":return Ge.mat2x2i;case"mat2x3i":return Ge.mat2x3i;case"mat2x4i":return Ge.mat2x4i;case"mat3x2i":return Ge.mat3x2i;case"mat3x3i":return Ge.mat3x3i;case"mat3x4i":return Ge.mat3x4i;case"mat4x2i":return Ge.mat4x2i;case"mat4x3i":return Ge.mat4x3i;case"mat4x4i":return Ge.mat4x4i;case"mat2x2u":return Ge.mat2x2u;case"mat2x3u":return Ge.mat2x3u;case"mat2x4u":return Ge.mat2x4u;case"mat3x2u":return Ge.mat3x2u;case"mat3x3u":return Ge.mat3x3u;case"mat3x4u":return Ge.mat3x4u;case"mat4x2u":return Ge.mat4x2u;case"mat4x3u":return Ge.mat4x3u;case"mat4x4u":return Ge.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(pe.tokens.ident)){const s=this._previous().toString();if(this._check(pe.tokens.paren_left)){const l=this._argument_expression_list(),d=this._getType(s);return d!==null?this._updateNode(new lu(d,l)):this._updateNode(new kx(s,l))}if(this._context.constants.has(s)){const l=this._context.constants.get(s);return this._updateNode(new TS(s,l.value))}return this._updateNode(new Ro(s))}if(this._match(pe.tokens.int_literal)){const s=this._previous().toString();let l=s.endsWith("i")||s.endsWith("i")?Et.i32:s.endsWith("u")||s.endsWith("U")?Et.u32:Et.x32;const d=parseInt(s);return this._validateTypeRange(d,l),this._updateNode(new Zr(new Ne(d,this._exec.getTypeInfo(l)),l))}if(this._match(pe.tokens.uint_literal)){const s=parseInt(this._previous().toString());return this._validateTypeRange(s,Et.u32),this._updateNode(new Zr(new Ne(s,this._exec.getTypeInfo(Et.u32)),Et.u32))}if(this._match([pe.tokens.decimal_float_literal,pe.tokens.hex_float_literal])){let s=this._previous().toString(),l=s.endsWith("h");l&&(s=s.substring(0,s.length-1));const d=parseFloat(s);this._validateTypeRange(d,l?Et.f16:Et.f32);const g=l?Et.f16:Et.f32;return this._updateNode(new Zr(new Ne(d,this._exec.getTypeInfo(g)),g))}if(this._match([pe.keywords.true,pe.keywords.false])){let s=this._previous().toString()===pe.keywords.true.rule;return this._updateNode(new Zr(new Ne(s?1:0,this._exec.getTypeInfo(Et.bool)),Et.bool))}if(this._check(pe.tokens.paren_left))return this._paren_expression();if(this._match(pe.keywords.bitcast)){this._consume(pe.tokens.less_than,"Expected '<'.");const s=this._type_decl();this._consume(pe.tokens.greater_than,"Expected '>'.");const l=this._paren_expression();return this._updateNode(new SS(s,l))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new lu(e,t))}_argument_expression_list(){if(!this._match(pe.tokens.paren_left))return null;const e=[];do{if(this._check(pe.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(pe.tokens.comma));return this._consume(pe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(pe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(pe.tokens.paren_right),e}_paren_expression(){this._consume(pe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(pe.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(pe.keywords.struct))return null;const e=this._currentLine,t=this._consume(pe.tokens.ident,"Expected name for struct.").toString();this._consume(pe.tokens.brace_left,"Expected '{' for struct body.");const s=[];for(;!this._check(pe.tokens.brace_right);){const g=this._attribute(),o=this._consume(pe.tokens.name,"Expected variable name.").toString();this._consume(pe.tokens.colon,"Expected ':' for struct member type.");const A=this._attribute(),M=this._type_decl();M!=null&&(M.attributes=A),this._check(pe.tokens.brace_right)?this._match(pe.tokens.comma):this._consume(pe.tokens.comma,"Expected ',' for struct member."),s.push(this._updateNode(new pw(o,M,g)))}this._consume(pe.tokens.brace_right,"Expected '}' after struct body.");const l=this._currentLine,d=this._updateNode(new ph(t,s,e,l),e);return this._context.structs.set(t,d),d}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(pe.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Zr){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Zr&&(e.type=e.value.type.name==="x32"?Et.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(pe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(pe.keywords.const))return null;const t=this._consume(pe.tokens.name,"Expected variable name"),s=this._currentLine;let l=null;if(this._match(pe.tokens.colon)){const A=this._attribute();l=this._type_decl(),l!=null&&(l.attributes=A)}let d=null;this._consume(pe.tokens.equal,"const declarations require an assignment");const g=this._short_circuit_or_expression();try{let A=[Et.f32],M=g.constEvaluate(this._exec,A);M instanceof Ne&&this._validateTypeRange(M.value,A[0]),A[0]instanceof Ge&&A[0].format===null&&M.typeInfo instanceof Jd&&M.typeInfo.format!==null&&(M.typeInfo.format.name==="f16"?A[0].format=Et.f16:M.typeInfo.format.name==="f32"?A[0].format=Et.f32:M.typeInfo.format.name==="i32"?A[0].format=Et.i32:M.typeInfo.format.name==="u32"?A[0].format=Et.u32:M.typeInfo.format.name==="bool"?A[0].format=Et.bool:console.error(`TODO: impelement template format type ${M.typeInfo.format.name}`)),d=this._updateNode(new Zr(M,A[0])),this._exec.context.setVariable(t.toString(),M)}catch{d=g}if(l!==null&&d instanceof Zr){if(d.type.name!=="x32"&&l.getTypeName()!==d.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${d.type.name} to ${l.name}. Line:${this._currentLine}`);d.type=l,d.isScalar&&this._validateTypeRange(d.scalarValue,d.type)}else l===null&&d instanceof Zr&&(l=(e=d?.type)!==null&&e!==void 0?e:Et.f32,l===Et.x32&&(l=Et.i32));const o=this._updateNode(new gv(t.toString(),l,"","",d),s);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(pe.keywords.let))return null;const e=this._currentLine,t=this._consume(pe.tokens.name,"Expected variable name");let s=null;if(this._match(pe.tokens.colon)){const d=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=d)}let l=null;if(this._match(pe.tokens.equal)&&(l=this._const_expression()),s!==null&&l instanceof Zr){if(l.type.name!=="x32"&&s.getTypeName()!==l.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${l.type.name} to ${s.name}. Line:${this._currentLine}`);l.type=s}else s===null&&l instanceof Zr&&(s=l.type.name==="x32"?Et.i32:l.type);return l instanceof Zr&&l.isScalar&&this._validateTypeRange(l.scalarValue,s),this._updateNode(new x_(t.toString(),s,"","",l),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(pe.keywords.var))return null;const e=this._currentLine;let t="",s="";this._match(pe.tokens.less_than)&&(t=this._consume(pe.storage_class,"Expected storage_class.").toString(),this._match(pe.tokens.comma)&&(s=this._consume(pe.access_mode,"Expected access_mode.").toString()),this._consume(pe.tokens.greater_than,"Expected '>'."));const l=this._consume(pe.tokens.name,"Expected variable name");let d=null;if(this._match(pe.tokens.colon)){const g=this._attribute();d=this._type_decl(),d!=null&&(d.attributes=g)}return this._updateNode(new mh(l.toString(),d,t,s,null),e)}_override_decl(){if(!this._match(pe.keywords.override))return null;const e=this._consume(pe.tokens.name,"Expected variable name");let t=null;if(this._match(pe.tokens.colon)){const s=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=s)}return this._updateNode(new Rx(e.toString(),t,null))}_diagnostic(){this._consume(pe.tokens.paren_left,"Expected '('");const e=this._consume(pe.tokens.ident,"Expected severity control name.");this._consume(pe.tokens.comma,"Expected ','");let t=this._consume(pe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(pe.tokens.period)&&(t+=`.${this._consume(pe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(pe.tokens.paren_right,"Expected ')'"),this._updateNode(new bS(e.toString(),t))}_enable_directive(){const e=this._consume(pe.tokens.ident,"identity expected.");return this._updateNode(new qP(e.toString()))}_requires_directive(){const e=[this._consume(pe.tokens.ident,"identity expected.").toString()];for(;this._match(pe.tokens.comma);){const t=this._consume(pe.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new XP(e))}_type_alias(){const e=this._consume(pe.tokens.ident,"identity expected.");this._consume(pe.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const s=this._updateNode(new Ox(e.toString(),t));return this._context.aliases.set(s.name,s),s}_type_decl(){if(this._check([pe.tokens.ident,...pe.texel_format,pe.keywords.bool,pe.keywords.f32,pe.keywords.i32,pe.keywords.u32])){const s=this._advance().toString();if(this._context.structs.has(s))return this._context.structs.get(s);if(this._context.aliases.has(s))return this._context.aliases.get(s).type;if(!this._getType(s)){const l=this._updateNode(new fw(s));return this._forwardTypeCount++,l}return this._updateNode(new Et(s))}let e=this._texture_sampler_types();if(e)return e;if(this._check(pe.template_types)){let s=this._advance().toString(),l=null,d=null;return this._match(pe.tokens.less_than)&&(l=this._type_decl(),d=null,this._match(pe.tokens.comma)&&(d=this._consume(pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(pe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new Ge(s,l,d))}if(this._match(pe.keywords.ptr)){let s=this._previous().toString();this._consume(pe.tokens.less_than,"Expected '<' for pointer.");const l=this._consume(pe.storage_class,"Expected storage_class for pointer");this._consume(pe.tokens.comma,"Expected ',' for pointer.");const d=this._type_decl();let g=null;return this._match(pe.tokens.comma)&&(g=this._consume(pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(pe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new mv(s,l.toString(),d,g))}const t=this._attribute();if(this._match(pe.keywords.array)){let s=null,l=-1;const d=this._previous();let g=null;if(this._match(pe.tokens.less_than)){s=this._type_decl(),this._context.aliases.has(s.name)&&(s=this._context.aliases.get(s.name).type);let A="";if(this._match(pe.tokens.comma)){g=this._shift_expression();try{A=g.constEvaluate(this._exec).toString(),g=null}catch{A="1"}}this._consume(pe.tokens.greater_than,"Expected '>' for array."),l=A?parseInt(A):0}const o=this._updateNode(new w_(d.toString(),t,s,l));return g&&this._deferArrayCountEval.push({arrayType:o,countNode:g}),o}return null}_texture_sampler_types(){if(this._match(pe.sampler_type))return this._updateNode(new p_(this._previous().toString(),null,null));if(this._match(pe.depth_texture_type))return this._updateNode(new p_(this._previous().toString(),null,null));if(this._match(pe.sampled_texture_type)||this._match(pe.multisampled_texture_type)){const e=this._previous();this._consume(pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new p_(e.toString(),t,null))}if(this._match(pe.storage_texture_type)){const e=this._previous();this._consume(pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(pe.texel_format,"Invalid texel format.").toString();this._consume(pe.tokens.comma,"Expected ',' after texel format.");const s=this._consume(pe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new p_(e.toString(),t,s))}return null}_attribute(){let e=[];for(;this._match(pe.tokens.attr);){const t=this._consume(pe.attribute_name,"Expected attribute name"),s=this._updateNode(new PS(t.toString(),null));if(this._match(pe.tokens.paren_left)){if(s.value=this._consume(pe.literal_or_ident,"Expected attribute value").toString(),this._check(pe.tokens.comma)){this._advance();do{const l=this._consume(pe.literal_or_ident,"Expected attribute value").toString();s.value instanceof Array||(s.value=[s.value]),s.value.push(l)}while(this._match(pe.tokens.comma))}this._consume(pe.tokens.paren_right,"Expected ')'")}e.push(s)}return e.length==0?null:e}}class cI extends uu{constructor(e){super(),e&&this.update(e)}update(e){const t=new lI().parse(e);this.updateAST(t)}}function uI(i){const e={attributes:[],bindings:[]};let t;try{t=hI(i)}catch(d){return It.error(d.message)(),e}for(const d of t.uniforms){const g=[];for(const o of d.type?.members||[])g.push({name:o.name,type:_w(o.type)});e.bindings.push({type:"uniform",name:d.name,group:d.group,location:d.binding,members:g})}for(const d of t.textures)e.bindings.push({type:"texture",name:d.name,group:d.group,location:d.binding});for(const d of t.samplers)e.bindings.push({type:"sampler",name:d.name,group:d.group,location:d.binding});const s=t.entry.vertex[0],l=s?.inputs.length||0;for(let d=0;d<l;d++){const g=s.inputs[d];if(g.locationType==="location"){const o=_w(g.type);e.attributes.push({name:g.name,location:Number(g.location),type:o})}}return e}function _w(i){return i?.format?`${i.name}<${i.format.name}>`:i.name}function hI(i){try{return new cI(i)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const fI={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...fI}};const ml=globalThis.mathgl.config;function dI(i,{precision:e=ml.precision}={}){return i=pI(i),`${parseFloat(i.toPrecision(e))}`}function qg(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Sf(i,e,t){return mI(i,s=>Math.max(e,Math.min(t,s)))}function jv(i,e,t){return qg(i)?i.map((s,l)=>jv(s,e[l],t)):t*e+(1-t)*i}function P_(i,e,t){const s=ml.EPSILON;try{if(i===e)return!0;if(qg(i)&&qg(e)){if(i.length!==e.length)return!1;for(let l=0;l<i.length;++l)if(!P_(i[l],e[l]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=ml.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{ml.EPSILON=s}}function pI(i){return Math.round(i/ml.EPSILON)*ml.EPSILON}function gI(i){return i.clone?i.clone():new Array(i.length)}function mI(i,e,t){if(qg(i)){const s=i;t=t||gI(s);for(let l=0;l<t.length&&l<s.length;++l){const d=typeof i=="number"?i:i[l];t[l]=e(d,l,t)}return t}return e(i)}class IS extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+t];return this.check()}toArray(e=[],t=0){for(let s=0;s<this.ELEMENTS;++s)e[t+s]=this[s];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:qg(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ml)}formatString(e){let t="";for(let s=0;s<this.ELEMENTS;++s)t+=(s>0?", ":"")+dI(this[s],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!P_(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,s){if(s===void 0)return this.lerp(this,e,t);for(let l=0;l<this.ELEMENTS;++l){const d=e[l],g=typeof t=="number"?t:t[l];this[l]=d+s*(g-d)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),t[s]);return this.check()}add(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]+=t[s];return this.check()}subtract(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]-=t[s];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ml.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),t);return this.check()}get elements(){return this}}function _I(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function Io(i){if(!Number.isFinite(i))throw new Error(`Invalid number ${JSON.stringify(i)}`);return i}function K0(i,e,t=""){if(ml.debug&&!_I(i,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return i}function yw(i,e){if(!i)throw new Error(`math.gl assertion ${e}`)}class yI extends IS{get x(){return this[0]}set x(e){this[0]=Io(e)}get y(){return this[1]}set y(e){this[1]=Io(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let s=0;s<this.ELEMENTS;++s){const l=this[s]-e[s];t+=l*l}return Io(t)}dot(e){let t=0;for(let s=0;s<this.ELEMENTS;++s)t+=this[s]*e[s];return Io(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]*=t[s];return this.check()}divide(...e){for(const t of e)for(let s=0;s<this.ELEMENTS;++s)this[s]/=t[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return yw(e>=0&&e<this.ELEMENTS,"index is out of range"),Io(this[e])}setComponent(e,t){return yw(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const yv=1e-6;let Xg=typeof Float32Array<"u"?Float32Array:Array;function vI(){const i=new Xg(2);return Xg!=Float32Array&&(i[0]=0,i[1]=0),i}function vw(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function bI(i,e){return i[0]=-e[0],i[1]=-e[1],i}function RS(i,e,t,s){const l=e[0],d=e[1];return i[0]=l+s*(t[0]-l),i[1]=d+s*(t[1]-d),i}function xI(i,e,t){const s=e[0],l=e[1];return i[0]=t[0]*s+t[4]*l+t[12],i[1]=t[1]*s+t[5]*l+t[13],i}(function(){const i=vI();return function(e,t,s,l,d,g){let o,A;for(t||(t=2),s||(s=0),l?A=Math.min(l*t+s,e.length):A=e.length,o=s;o<A;o+=t)i[0]=e[o],i[1]=e[o+1],d(i,i,g),e[o]=i[0],e[o+1]=i[1];return e}})();function wI(i,e,t){const s=e[0],l=e[1],d=t[3]*s+t[7]*l||1;return i[0]=(t[0]*s+t[4]*l)/d,i[1]=(t[1]*s+t[5]*l)/d,i}function DS(i,e,t){const s=e[0],l=e[1],d=e[2],g=t[3]*s+t[7]*l+t[11]*d||1;return i[0]=(t[0]*s+t[4]*l+t[8]*d)/g,i[1]=(t[1]*s+t[5]*l+t[9]*d)/g,i[2]=(t[2]*s+t[6]*l+t[10]*d)/g,i}function TI(i,e,t){const s=e[0],l=e[1];return i[0]=t[0]*s+t[2]*l,i[1]=t[1]*s+t[3]*l,i[2]=e[2],i}function SI(){const i=new Xg(3);return Xg!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function AI(i){const e=i[0],t=i[1],s=i[2];return Math.sqrt(e*e+t*t+s*s)}function EI(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function CI(i){const e=i[0],t=i[1],s=i[2];return e*e+t*t+s*s}function MI(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function PI(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function II(i,e,t){const s=e[0],l=e[1],d=e[2],g=t[0],o=t[1],A=t[2];return i[0]=l*A-d*o,i[1]=d*g-s*A,i[2]=s*o-l*g,i}function RI(i,e,t,s){const l=e[0],d=e[1],g=e[2];return i[0]=l+s*(t[0]-l),i[1]=d+s*(t[1]-d),i[2]=g+s*(t[2]-g),i}function OS(i,e,t){const s=e[0],l=e[1],d=e[2];let g=t[3]*s+t[7]*l+t[11]*d+t[15];return g=g||1,i[0]=(t[0]*s+t[4]*l+t[8]*d+t[12])/g,i[1]=(t[1]*s+t[5]*l+t[9]*d+t[13])/g,i[2]=(t[2]*s+t[6]*l+t[10]*d+t[14])/g,i}function DI(i,e,t){const s=e[0],l=e[1],d=e[2];return i[0]=s*t[0]+l*t[3]+d*t[6],i[1]=s*t[1]+l*t[4]+d*t[7],i[2]=s*t[2]+l*t[5]+d*t[8],i}function OI(i,e,t){const s=t[0],l=t[1],d=t[2],g=t[3],o=e[0],A=e[1],M=e[2];let I=l*M-d*A,z=d*o-s*M,W=s*A-l*o,J=l*W-d*z,oe=d*I-s*W,le=s*z-l*I;const ne=g*2;return I*=ne,z*=ne,W*=ne,J*=2,oe*=2,le*=2,i[0]=o+I+J,i[1]=A+z+oe,i[2]=M+W+le,i}function kI(i,e,t,s){const l=[],d=[];return l[0]=e[0]-t[0],l[1]=e[1]-t[1],l[2]=e[2]-t[2],d[0]=l[0],d[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),d[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),i[0]=d[0]+t[0],i[1]=d[1]+t[1],i[2]=d[2]+t[2],i}function LI(i,e,t,s){const l=[],d=[];return l[0]=e[0]-t[0],l[1]=e[1]-t[1],l[2]=e[2]-t[2],d[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),d[1]=l[1],d[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),i[0]=d[0]+t[0],i[1]=d[1]+t[1],i[2]=d[2]+t[2],i}function BI(i,e,t,s){const l=[],d=[];return l[0]=e[0]-t[0],l[1]=e[1]-t[1],l[2]=e[2]-t[2],d[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),d[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),d[2]=l[2],i[0]=d[0]+t[0],i[1]=d[1]+t[1],i[2]=d[2]+t[2],i}function zI(i,e){const t=i[0],s=i[1],l=i[2],d=e[0],g=e[1],o=e[2],A=Math.sqrt((t*t+s*s+l*l)*(d*d+g*g+o*o)),M=A&&PI(i,e)/A;return Math.acos(Math.min(Math.max(M,-1),1))}const kS=EI,FI=AI,Q0=CI;(function(){const i=SI();return function(e,t,s,l,d,g){let o,A;for(t||(t=3),s||(s=0),l?A=Math.min(l*t+s,e.length):A=e.length,o=s;o<A;o+=t)i[0]=e[o],i[1]=e[o+1],i[2]=e[o+2],d(i,i,g),e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2];return e}})();const J0=[0,0,0];let ev;class hu extends yI{static get ZERO(){return ev||(ev=new hu(0,0,0),Object.freeze(ev)),ev}constructor(e=0,t=0,s=0){super(-0,-0,-0),arguments.length===1&&qg(e)?this.copy(e):(ml.debug&&(Io(e),Io(t),Io(s)),this[0]=e,this[1]=t,this[2]=s)}set(e,t,s){return this[0]=e,this[1]=t,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ml.debug&&(Io(e.x),Io(e.y),Io(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Io(e)}angle(e){return zI(this,e)}cross(e){return II(this,this,e),this.check()}rotateX({radians:e,origin:t=J0}){return kI(this,this,t,e),this.check()}rotateY({radians:e,origin:t=J0}){return LI(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=J0}){return BI(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return OS(this,this,e),this.check()}transformAsVector(e){return DS(this,this,e),this.check()}transformByMatrix3(e){return DI(this,this,e),this.check()}transformByMatrix2(e){return TI(this,this,e),this.check()}transformByQuaternion(e){return OI(this,this,e),this.check()}}class NI extends IS{toString(){let e="[";if(ml.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let s=0;s<this.RANK;++s)e+=` ${this[s*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,s){return this[t*this.RANK+e]=Io(s),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let l=0;l<this.RANK;++l)t[l]=this[s+l];return t}setColumn(e,t){const s=e*this.RANK;for(let l=0;l<this.RANK;++l)this[s+l]=t[l];return this}}function UI(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function VI(i,e){if(i===e){const t=e[1],s=e[2],l=e[3],d=e[6],g=e[7],o=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=s,i[9]=d,i[11]=e[14],i[12]=l,i[13]=g,i[14]=o}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function Fb(i,e){const t=e[0],s=e[1],l=e[2],d=e[3],g=e[4],o=e[5],A=e[6],M=e[7],I=e[8],z=e[9],W=e[10],J=e[11],oe=e[12],le=e[13],ne=e[14],Ie=e[15],Ue=t*o-s*g,Se=t*A-l*g,Ve=t*M-d*g,st=s*A-l*o,ot=s*M-d*o,wt=l*M-d*A,Ft=I*le-z*oe,lt=I*ne-W*oe,kt=I*Ie-J*oe,xt=z*ne-W*le,Lt=z*Ie-J*le,Dt=W*Ie-J*ne;let Pt=Ue*Dt-Se*Lt+Ve*xt+st*kt-ot*lt+wt*Ft;return Pt?(Pt=1/Pt,i[0]=(o*Dt-A*Lt+M*xt)*Pt,i[1]=(l*Lt-s*Dt-d*xt)*Pt,i[2]=(le*wt-ne*ot+Ie*st)*Pt,i[3]=(W*ot-z*wt-J*st)*Pt,i[4]=(A*kt-g*Dt-M*lt)*Pt,i[5]=(t*Dt-l*kt+d*lt)*Pt,i[6]=(ne*Ve-oe*wt-Ie*Se)*Pt,i[7]=(I*wt-W*Ve+J*Se)*Pt,i[8]=(g*Lt-o*kt+M*Ft)*Pt,i[9]=(s*kt-t*Lt-d*Ft)*Pt,i[10]=(oe*ot-le*Ve+Ie*Ue)*Pt,i[11]=(z*Ve-I*ot-J*Ue)*Pt,i[12]=(o*lt-g*xt-A*Ft)*Pt,i[13]=(t*xt-s*lt+l*Ft)*Pt,i[14]=(le*Se-oe*st-ne*Ue)*Pt,i[15]=(I*st-z*Se+W*Ue)*Pt,i):null}function jI(i){const e=i[0],t=i[1],s=i[2],l=i[3],d=i[4],g=i[5],o=i[6],A=i[7],M=i[8],I=i[9],z=i[10],W=i[11],J=i[12],oe=i[13],le=i[14],ne=i[15],Ie=e*g-t*d,Ue=e*o-s*d,Se=t*o-s*g,Ve=M*oe-I*J,st=M*le-z*J,ot=I*le-z*oe,wt=e*ot-t*st+s*Ve,Ft=d*ot-g*st+o*Ve,lt=M*Se-I*Ue+z*Ie,kt=J*Se-oe*Ue+le*Ie;return A*wt-l*Ft+ne*lt-W*kt}function Gd(i,e,t){const s=e[0],l=e[1],d=e[2],g=e[3],o=e[4],A=e[5],M=e[6],I=e[7],z=e[8],W=e[9],J=e[10],oe=e[11],le=e[12],ne=e[13],Ie=e[14],Ue=e[15];let Se=t[0],Ve=t[1],st=t[2],ot=t[3];return i[0]=Se*s+Ve*o+st*z+ot*le,i[1]=Se*l+Ve*A+st*W+ot*ne,i[2]=Se*d+Ve*M+st*J+ot*Ie,i[3]=Se*g+Ve*I+st*oe+ot*Ue,Se=t[4],Ve=t[5],st=t[6],ot=t[7],i[4]=Se*s+Ve*o+st*z+ot*le,i[5]=Se*l+Ve*A+st*W+ot*ne,i[6]=Se*d+Ve*M+st*J+ot*Ie,i[7]=Se*g+Ve*I+st*oe+ot*Ue,Se=t[8],Ve=t[9],st=t[10],ot=t[11],i[8]=Se*s+Ve*o+st*z+ot*le,i[9]=Se*l+Ve*A+st*W+ot*ne,i[10]=Se*d+Ve*M+st*J+ot*Ie,i[11]=Se*g+Ve*I+st*oe+ot*Ue,Se=t[12],Ve=t[13],st=t[14],ot=t[15],i[12]=Se*s+Ve*o+st*z+ot*le,i[13]=Se*l+Ve*A+st*W+ot*ne,i[14]=Se*d+Ve*M+st*J+ot*Ie,i[15]=Se*g+Ve*I+st*oe+ot*Ue,i}function $v(i,e,t){const s=t[0],l=t[1],d=t[2];let g,o,A,M,I,z,W,J,oe,le,ne,Ie;return e===i?(i[12]=e[0]*s+e[4]*l+e[8]*d+e[12],i[13]=e[1]*s+e[5]*l+e[9]*d+e[13],i[14]=e[2]*s+e[6]*l+e[10]*d+e[14],i[15]=e[3]*s+e[7]*l+e[11]*d+e[15]):(g=e[0],o=e[1],A=e[2],M=e[3],I=e[4],z=e[5],W=e[6],J=e[7],oe=e[8],le=e[9],ne=e[10],Ie=e[11],i[0]=g,i[1]=o,i[2]=A,i[3]=M,i[4]=I,i[5]=z,i[6]=W,i[7]=J,i[8]=oe,i[9]=le,i[10]=ne,i[11]=Ie,i[12]=g*s+I*l+oe*d+e[12],i[13]=o*s+z*l+le*d+e[13],i[14]=A*s+W*l+ne*d+e[14],i[15]=M*s+J*l+Ie*d+e[15]),i}function Nx(i,e,t){const s=t[0],l=t[1],d=t[2];return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function $I(i,e,t,s){let l=s[0],d=s[1],g=s[2],o=Math.sqrt(l*l+d*d+g*g),A,M,I,z,W,J,oe,le,ne,Ie,Ue,Se,Ve,st,ot,wt,Ft,lt,kt,xt,Lt,Dt,Pt,Yt;return o<yv?null:(o=1/o,l*=o,d*=o,g*=o,M=Math.sin(t),A=Math.cos(t),I=1-A,z=e[0],W=e[1],J=e[2],oe=e[3],le=e[4],ne=e[5],Ie=e[6],Ue=e[7],Se=e[8],Ve=e[9],st=e[10],ot=e[11],wt=l*l*I+A,Ft=d*l*I+g*M,lt=g*l*I-d*M,kt=l*d*I-g*M,xt=d*d*I+A,Lt=g*d*I+l*M,Dt=l*g*I+d*M,Pt=d*g*I-l*M,Yt=g*g*I+A,i[0]=z*wt+le*Ft+Se*lt,i[1]=W*wt+ne*Ft+Ve*lt,i[2]=J*wt+Ie*Ft+st*lt,i[3]=oe*wt+Ue*Ft+ot*lt,i[4]=z*kt+le*xt+Se*Lt,i[5]=W*kt+ne*xt+Ve*Lt,i[6]=J*kt+Ie*xt+st*Lt,i[7]=oe*kt+Ue*xt+ot*Lt,i[8]=z*Dt+le*Pt+Se*Yt,i[9]=W*Dt+ne*Pt+Ve*Yt,i[10]=J*Dt+Ie*Pt+st*Yt,i[11]=oe*Dt+Ue*Pt+ot*Yt,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function LS(i,e,t){const s=Math.sin(t),l=Math.cos(t),d=e[4],g=e[5],o=e[6],A=e[7],M=e[8],I=e[9],z=e[10],W=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*l+M*s,i[5]=g*l+I*s,i[6]=o*l+z*s,i[7]=A*l+W*s,i[8]=M*l-d*s,i[9]=I*l-g*s,i[10]=z*l-o*s,i[11]=W*l-A*s,i}function HI(i,e,t){const s=Math.sin(t),l=Math.cos(t),d=e[0],g=e[1],o=e[2],A=e[3],M=e[8],I=e[9],z=e[10],W=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*l-M*s,i[1]=g*l-I*s,i[2]=o*l-z*s,i[3]=A*l-W*s,i[8]=d*s+M*l,i[9]=g*s+I*l,i[10]=o*s+z*l,i[11]=A*s+W*l,i}function BS(i,e,t){const s=Math.sin(t),l=Math.cos(t),d=e[0],g=e[1],o=e[2],A=e[3],M=e[4],I=e[5],z=e[6],W=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*l+M*s,i[1]=g*l+I*s,i[2]=o*l+z*s,i[3]=A*l+W*s,i[4]=M*l-d*s,i[5]=I*l-g*s,i[6]=z*l-o*s,i[7]=W*l-A*s,i}function WI(i,e){const t=e[0],s=e[1],l=e[2],d=e[3],g=t+t,o=s+s,A=l+l,M=t*g,I=s*g,z=s*o,W=l*g,J=l*o,oe=l*A,le=d*g,ne=d*o,Ie=d*A;return i[0]=1-z-oe,i[1]=I+Ie,i[2]=W-ne,i[3]=0,i[4]=I-Ie,i[5]=1-M-oe,i[6]=J+le,i[7]=0,i[8]=W+ne,i[9]=J-le,i[10]=1-M-z,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qI(i,e,t,s,l,d,g){const o=1/(t-e),A=1/(l-s),M=1/(d-g);return i[0]=d*2*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d*2*A,i[6]=0,i[7]=0,i[8]=(t+e)*o,i[9]=(l+s)*A,i[10]=(g+d)*M,i[11]=-1,i[12]=0,i[13]=0,i[14]=g*d*2*M,i[15]=0,i}function XI(i,e,t,s,l){const d=1/Math.tan(e/2);if(i[0]=d/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0){const g=1/(s-l);i[10]=(l+s)*g,i[14]=2*l*s*g}else i[10]=-1,i[14]=-2*s;return i}const GI=XI;function ZI(i,e,t,s,l,d,g){const o=1/(e-t),A=1/(s-l),M=1/(d-g);return i[0]=-2*o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*A,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(e+t)*o,i[13]=(l+s)*A,i[14]=(g+d)*M,i[15]=1,i}const YI=ZI;function KI(i,e,t,s){let l,d,g,o,A,M,I,z,W,J;const oe=e[0],le=e[1],ne=e[2],Ie=s[0],Ue=s[1],Se=s[2],Ve=t[0],st=t[1],ot=t[2];return Math.abs(oe-Ve)<yv&&Math.abs(le-st)<yv&&Math.abs(ne-ot)<yv?UI(i):(z=oe-Ve,W=le-st,J=ne-ot,l=1/Math.sqrt(z*z+W*W+J*J),z*=l,W*=l,J*=l,d=Ue*J-Se*W,g=Se*z-Ie*J,o=Ie*W-Ue*z,l=Math.sqrt(d*d+g*g+o*o),l?(l=1/l,d*=l,g*=l,o*=l):(d=0,g=0,o=0),A=W*o-J*g,M=J*d-z*o,I=z*g-W*d,l=Math.sqrt(A*A+M*M+I*I),l?(l=1/l,A*=l,M*=l,I*=l):(A=0,M=0,I=0),i[0]=d,i[1]=A,i[2]=z,i[3]=0,i[4]=g,i[5]=M,i[6]=W,i[7]=0,i[8]=o,i[9]=I,i[10]=J,i[11]=0,i[12]=-(d*oe+g*le+o*ne),i[13]=-(A*oe+M*le+I*ne),i[14]=-(z*oe+W*le+J*ne),i[15]=1,i)}function QI(){const i=new Xg(4);return Xg!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function zS(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function im(i,e,t){const s=e[0],l=e[1],d=e[2],g=e[3];return i[0]=t[0]*s+t[4]*l+t[8]*d+t[12]*g,i[1]=t[1]*s+t[5]*l+t[9]*d+t[13]*g,i[2]=t[2]*s+t[6]*l+t[10]*d+t[14]*g,i[3]=t[3]*s+t[7]*l+t[11]*d+t[15]*g,i}(function(){const i=QI();return function(e,t,s,l,d,g){let o,A;for(t||(t=4),s||(s=0),l?A=Math.min(l*t+s,e.length):A=e.length,o=s;o<A;o+=t)i[0]=e[o],i[1]=e[o+1],i[2]=e[o+2],i[3]=e[o+3],d(i,i,g),e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2],e[o+3]=i[3];return e}})();var Nb;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(Nb||(Nb={}));const JI=45*Math.PI/180,eR=1,eb=.1,tb=500,tR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class mc extends NI{static get IDENTITY(){return nR()}static get ZERO(){return iR()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Nb}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,s,l,d,g,o,A,M,I,z,W,J,oe,le,ne){return this[0]=e,this[1]=t,this[2]=s,this[3]=l,this[4]=d,this[5]=g,this[6]=o,this[7]=A,this[8]=M,this[9]=I,this[10]=z,this[11]=W,this[12]=J,this[13]=oe,this[14]=le,this[15]=ne,this.check()}setRowMajor(e,t,s,l,d,g,o,A,M,I,z,W,J,oe,le,ne){return this[0]=e,this[1]=d,this[2]=M,this[3]=J,this[4]=t,this[5]=g,this[6]=I,this[7]=oe,this[8]=s,this[9]=o,this[10]=z,this[11]=le,this[12]=l,this[13]=A,this[14]=W,this[15]=ne,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(tR)}fromObject(e){return this.check()}fromQuaternion(e){return WI(this,e),this.check()}frustum(e){const{left:t,right:s,bottom:l,top:d,near:g=eb,far:o=tb}=e;return o===1/0?rR(this,t,s,l,d,g):qI(this,t,s,l,d,g,o),this.check()}lookAt(e){const{eye:t,center:s=[0,0,0],up:l=[0,1,0]}=e;return KI(this,t,s,l),this.check()}ortho(e){const{left:t,right:s,bottom:l,top:d,near:g=eb,far:o=tb}=e;return YI(this,t,s,l,d,g,o),this.check()}orthographic(e){const{fovy:t=JI,aspect:s=eR,focalDistance:l=1,near:d=eb,far:g=tb}=e;bw(t);const o=t/2,A=l*Math.tan(o),M=A*s;return this.ortho({left:-M,right:M,bottom:-A,top:A,near:d,far:g})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:s=1,near:l=.1,far:d=500}=e;return bw(t),GI(this,t,s,l,d),this.check()}determinant(){return jI(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),l=1/s[0],d=1/s[1],g=1/s[2];return e[0]=this[0]*l,e[1]=this[1]*d,e[2]=this[2]*g,e[3]=0,e[4]=this[4]*l,e[5]=this[5]*d,e[6]=this[6]*g,e[7]=0,e[8]=this[8]*l,e[9]=this[9]*d,e[10]=this[10]*g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const s=this.getScale(t),l=1/s[0],d=1/s[1],g=1/s[2];return e[0]=this[0]*l,e[1]=this[1]*d,e[2]=this[2]*g,e[3]=this[4]*l,e[4]=this[5]*d,e[5]=this[6]*g,e[6]=this[8]*l,e[7]=this[9]*d,e[8]=this[10]*g,e}transpose(){return VI(this,this),this.check()}invert(){return Fb(this,this),this.check()}multiplyLeft(e){return Gd(this,e,this),this.check()}multiplyRight(e){return Gd(this,this,e),this.check()}rotateX(e){return LS(this,this,e),this.check()}rotateY(e){return HI(this,this,e),this.check()}rotateZ(e){return BS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return $I(this,this,e,t),this.check()}scale(e){return Nx(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return $v(this,this,e),this.check()}transform(e,t){return e.length===4?(t=im(t||[-0,-0,-0,-0],e,this),K0(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:s}=e;let l;switch(s){case 2:l=xI(t||[-0,-0],e,this);break;case 3:l=OS(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return K0(l,e.length),l}transformAsVector(e,t){let s;switch(e.length){case 2:s=wI(t||[-0,-0],e,this);break;case 3:s=DS(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return K0(s,e.length),s}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,s){return this.identity().translate([e,t,s])}}let tv,iv;function iR(){return tv||(tv=new mc([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(tv)),tv}function nR(){return iv||(iv=new mc,Object.freeze(iv)),iv}function bw(i){if(i>Math.PI*2)throw Error("expected radians")}function rR(i,e,t,s,l,d){const g=2*d/(t-e),o=2*d/(l-s),A=(t+e)/(t-e),M=(l+s)/(l-s),I=-1,z=-1,W=-2*d;return i[0]=g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=A,i[9]=M,i[10]=I,i[11]=z,i[12]=0,i[13]=0,i[14]=W,i[15]=0,i}function FS(i,e=[],t=0){const s=Math.fround(i),l=i-s;return e[t]=s,e[t+1]=l,e}function sR(i){return i-Math.fround(i)}function aR(i){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let s=0;s<4;++s){const l=t*4+s;FS(i[s*4+t],e,l*2)}return e}const oR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,lR={name:"fp32",vs:oR},cR=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,uR={ONE:1},hR={name:"fp64arithmetic",vs:cR,defaultUniforms:uR,uniformTypes:{ONE:"f32"},fp64ify:FS,fp64LowPart:sR,fp64ifyMatrix4:aR},fR=[0,1,1,1],dR=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,pR=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,xw={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:fR},vs:dR,fs:pR,getUniforms:gR};function gR(i={},e){const t={};if(i.highlightedObjectColor!==void 0)if(i.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const s=i.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=s}if(i.highlightColor){const s=Array.from(i.highlightColor,l=>l/255);Number.isFinite(s[3])||(s[3]=1),t.highlightColor=s}return i.isActive!==void 0&&(t.isActive=!!i.isActive,t.isAttribute=!!i.isAttribute),i.useFloatColors!==void 0&&(t.useFloatColors=!!i.useFloatColors),t}const ww=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,mR=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,_R=5,yR=255;var I_;(function(i){i[i.POINT=0]="POINT",i[i.DIRECTIONAL=1]="DIRECTIONAL"})(I_||(I_={}));const vv={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:I_.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:mR,vs:ww,fs:ww,getUniforms:vR};function vR(i,e={}){if(i=i&&{...i},!i)return{...vv.defaultUniforms};i.lights&&(i={...i,...xR(i.lights),lights:void 0});const{ambientLight:t,pointLights:s,directionalLights:l}=i||{};if(!(t||s&&s.length>0||l&&l.length>0))return{...vv.defaultUniforms,enabled:0};const g={...vv.defaultUniforms,...e,...bR({ambientLight:t,pointLights:s,directionalLights:l})};return i.enabled!==void 0&&(g.enabled=i.enabled?1:0),g}function bR({ambientLight:i,pointLights:e=[],directionalLights:t=[]}){const s={};s.ambientColor=ib(i);let l=0;for(const d of e){s.lightType=I_.POINT;const g=l;s[`lightColor${g}`]=ib(d),s[`lightPosition${g}`]=d.position,s[`lightAttenuation${g}`]=d.attenuation||[1,0,0],l++}for(const d of t){s.lightType=I_.DIRECTIONAL;const g=l;s[`lightColor${g}`]=ib(d),s[`lightDirection${g}`]=d.direction,l++}return l>_R&&It.warn("MAX_LIGHTS exceeded")(),s.directionalLightCount=t.length,s.pointLightCount=e.length,s}function xR(i){const e={pointLights:[],directionalLights:[]};for(const t of i||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function ib(i={}){const{color:e=[0,0,0],intensity:t=1}=i;return e.map(s=>s*t/yR)}const wR=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,TR=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,SR=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,NS={props:{},name:"gouraudMaterial",vs:TR.replace("phongMaterial","gouraudMaterial"),fs:wR.replace("phongMaterial","gouraudMaterial"),source:SR.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[vv],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(i){const e={...i};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...NS.defaultUniforms,...e}}},Tw=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,AR={name:"layer",vs:Tw,fs:Tw,getUniforms:i=>({opacity:Math.pow(i.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},ER=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,CR={name:"color",dependencies:[],source:ER,getUniforms:i=>({}),uniformTypes:{opacity:"f32"}},MR=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,US="#define SMOOTH_EDGE_RADIUS 0.5",PR=`${US}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,IR=`${US}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,VS={name:"geometry",source:MR,vs:PR,fs:IR},RR=25;var Fr;(function(i){i[i.Start=1]="Start",i[i.Move=2]="Move",i[i.End=4]="End",i[i.Cancel=8]="Cancel"})(Fr||(Fr={}));var Yr;(function(i){i[i.None=0]="None",i[i.Left=1]="Left",i[i.Right=2]="Right",i[i.Up=4]="Up",i[i.Down=8]="Down",i[i.Horizontal=3]="Horizontal",i[i.Vertical=12]="Vertical",i[i.All=15]="All"})(Yr||(Yr={}));var Ci;(function(i){i[i.Possible=1]="Possible",i[i.Began=2]="Began",i[i.Changed=4]="Changed",i[i.Ended=8]="Ended",i[i.Recognized=8]="Recognized",i[i.Cancelled=16]="Cancelled",i[i.Failed=32]="Failed"})(Ci||(Ci={}));const DR="compute",OR="auto",Ub="manipulation",bv="none",Vb="pan-x",jb="pan-y";function kR(i){if(i.includes(bv))return bv;const e=i.includes(Vb),t=i.includes(jb);return e&&t?bv:e||t?e?Vb:jb:i.includes(Ub)?Ub:OR}class LR{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===DR&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return kR(e.join(" "))}}function Hv(i){return i.trim().split(/\s+/g)}function nb(i,e,t){if(i)for(const s of Hv(e))i.addEventListener(s,t,!1)}function rb(i,e,t){if(i)for(const s of Hv(e))i.removeEventListener(s,t,!1)}function Sw(i){return(i.ownerDocument||i).defaultView}function BR(i,e){let t=i;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function jS(i){const e=i.length;if(e===1)return{x:Math.round(i[0].clientX),y:Math.round(i[0].clientY)};let t=0,s=0,l=0;for(;l<e;)t+=i[l].clientX,s+=i[l].clientY,l++;return{x:Math.round(t/e),y:Math.round(s/e)}}function Aw(i){const e=[];let t=0;for(;t<i.pointers.length;)e[t]={clientX:Math.round(i.pointers[t].clientX),clientY:Math.round(i.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:jS(e),deltaX:i.deltaX,deltaY:i.deltaY}}function $S(i,e){const t=e.x-i.x,s=e.y-i.y;return Math.sqrt(t*t+s*s)}function Ew(i,e){const t=e.clientX-i.clientX,s=e.clientY-i.clientY;return Math.sqrt(t*t+s*s)}function zR(i,e){const t=e.x-i.x,s=e.y-i.y;return Math.atan2(s,t)*180/Math.PI}function Cw(i,e){const t=e.clientX-i.clientX,s=e.clientY-i.clientY;return Math.atan2(s,t)*180/Math.PI}function HS(i,e){return i===e?Yr.None:Math.abs(i)>=Math.abs(e)?i<0?Yr.Left:Yr.Right:e<0?Yr.Up:Yr.Down}function FR(i,e){const t=e.center;let s=i.offsetDelta,l=i.prevDelta;const d=i.prevInput;return(e.eventType===Fr.Start||d?.eventType===Fr.End)&&(l=i.prevDelta={x:d?.deltaX||0,y:d?.deltaY||0},s=i.offsetDelta={x:t.x,y:t.y}),{deltaX:l.x+(t.x-s.x),deltaY:l.y+(t.y-s.y)}}function WS(i,e,t){return{x:e/i||0,y:t/i||0}}function NR(i,e){return Ew(e[0],e[1])/Ew(i[0],i[1])}function UR(i,e){return Cw(e[1],e[0])-Cw(i[1],i[0])}function VR(i,e){const t=i.lastInterval||e,s=e.timeStamp-t.timeStamp;let l,d,g,o;if(e.eventType!==Fr.Cancel&&(s>RR||t.velocity===void 0)){const A=e.deltaX-t.deltaX,M=e.deltaY-t.deltaY,I=WS(s,A,M);d=I.x,g=I.y,l=Math.abs(I.x)>Math.abs(I.y)?I.x:I.y,o=HS(A,M),i.lastInterval=e}else l=t.velocity,d=t.velocityX,g=t.velocityY,o=t.direction;e.velocity=l,e.velocityX=d,e.velocityY=g,e.direction=o}function jR(i,e){const{session:t}=i,{pointers:s}=e,{length:l}=s;t.firstInput||(t.firstInput=Aw(e)),l>1&&!t.firstMultiple?t.firstMultiple=Aw(e):l===1&&(t.firstMultiple=!1);const{firstInput:d,firstMultiple:g}=t,o=g?g.center:d.center,A=e.center=jS(s);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-d.timeStamp,e.angle=zR(o,A),e.distance=$S(o,A);const{deltaX:M,deltaY:I}=FR(t,e);e.deltaX=M,e.deltaY=I,e.offsetDirection=HS(e.deltaX,e.deltaY);const z=WS(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=z.x,e.overallVelocityY=z.y,e.overallVelocity=Math.abs(z.x)>Math.abs(z.y)?z.x:z.y,e.scale=g?NR(g.pointers,s):1,e.rotation=g?UR(g.pointers,s):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let W=i.element;return BR(e.srcEvent.target,W)&&(W=e.srcEvent.target),e.target=W,VR(t,e),e}function $R(i,e,t){const s=t.pointers.length,l=t.changedPointers.length,d=e&Fr.Start&&s-l===0,g=e&(Fr.End|Fr.Cancel)&&s-l===0;t.isFirst=!!d,t.isFinal=!!g,d&&(i.session={}),t.eventType=e;const o=jR(i,t);i.emit("hammer.input",o),i.recognize(o),i.session.prevInput=o}let HR=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){$R(this.manager,e,t)}init(){nb(this.element,this.evEl,this.domHandler),nb(this.target,this.evTarget,this.domHandler),nb(Sw(this.element),this.evWin,this.domHandler)}destroy(){rb(this.element,this.evEl,this.domHandler),rb(this.target,this.evTarget,this.domHandler),rb(Sw(this.element),this.evWin,this.domHandler)}};const WR={pointerdown:Fr.Start,pointermove:Fr.Move,pointerup:Fr.End,pointercancel:Fr.Cancel,pointerout:Fr.Cancel},qR="pointerdown",XR="pointermove pointerup pointercancel";class GR extends HR{constructor(e){super(e),this.evEl=qR,this.evWin=XR,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let s=!1;const l=WR[e.type],d=e.pointerType,g=d==="touch";let o=t.findIndex(A=>A.pointerId===e.pointerId);l&Fr.Start&&(e.buttons||g)?o<0&&(t.push(e),o=t.length-1):l&(Fr.End|Fr.Cancel)&&(s=!0),!(o<0)&&(t[o]=e,this.callback(l,{pointers:t,changedPointers:[e],eventType:l,pointerType:d,srcEvent:e}),s&&t.splice(o,1))}}const ZR=["","webkit","Moz","MS","ms","o"];function YR(i,e){const t=e[0].toUpperCase()+e.slice(1);for(const s of ZR){const l=s?s+t:e;if(l in i)return l}}const KR=1,Mw=2,Pw={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class QR{constructor(e,t){this.options={...Pw,...t,cssProps:{...Pw.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new GR(this),this.touchAction=new LR(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Mw:KR}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let s;const{recognizers:l}=this;let{curRecognizer:d}=t;(!d||d&&d.state&Ci.Recognized)&&(d=t.curRecognizer=null);let g=0;for(;g<l.length;)s=l[g],t.stopped!==Mw&&(!d||s===d||s.canRecognizeWith(d))?s.recognize(e):s.reset(),!d&&s.state&(Ci.Began|Ci.Changed|Ci.Ended)&&(d=t.curRecognizer=s),g++}get(e){const{recognizers:t}=this;for(let s=0;s<t.length;s++)if(t[s].options.event===e)return t[s];return null}add(e){if(Array.isArray(e)){for(const s of e)this.add(s);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const s of e)this.remove(s);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:s}=this,l=s.indexOf(t);l!==-1&&(s.splice(l,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:s}=this;for(const l of Hv(e))s[l]=s[l]||[],s[l].push(t)}off(e,t){if(!e)return;const{handlers:s}=this;for(const l of Hv(e))t?s[l]&&s[l].splice(s[l].indexOf(t),1):delete s[l]}emit(e,t){const s=this.handlers[e]&&this.handlers[e].slice();if(!s||!s.length)return;const l=t;l.type=e,l.preventDefault=function(){t.srcEvent.preventDefault()};let d=0;for(;d<s.length;)s[d](l),d++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[s,l]of Object.entries(this.options.cssProps)){const d=YR(t.style,s);e?(this.oldCssProps[d]=t.style[d],t.style[d]=l):t.style[d]=this.oldCssProps[d]||""}e||(this.oldCssProps={})}}}let JR=1;function eD(){return JR++}function Iw(i){return i&Ci.Cancelled?"cancel":i&Ci.Ended?"end":i&Ci.Changed?"move":i&Ci.Began?"start":""}class qS{constructor(e){this.options=e,this.id=eD(),this.state=Ci.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const l of e)this.recognizeWith(l);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:s}=this;return s[t.id]||(s[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const s of e)this.dropRecognizeWith(s);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const l of e)this.requireFailure(l);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:s}=this;return s.indexOf(t)===-1&&(s.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const s of e)this.dropRequireFailure(s);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const s=this.requireFail.indexOf(t);s>-1&&this.requireFail.splice(s,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ci.Ended&&this.manager.emit(this.options.event+Iw(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ci.Ended&&this.manager.emit(this.options.event+Iw(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ci.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ci.Failed|Ci.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ci.Failed;return}this.state&(Ci.Recognized|Ci.Cancelled|Ci.Failed)&&(this.state=Ci.Possible),this.state=this.process(t),this.state&(Ci.Began|Ci.Changed|Ci.Ended|Ci.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class XS extends qS{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:s}=e,l=t&(Ci.Began|Ci.Changed),d=this.attrTest(e);return l&&(s&Fr.Cancel||!d)?t|Ci.Cancelled:l||d?s&Fr.End?t|Ci.Ended:t&Ci.Began?t|Ci.Changed:Ci.Began:Ci.Failed}}class Rw extends qS{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Ub]}process(e){const{options:t}=this,s=e.pointers.length===t.pointers,l=e.distance<t.threshold,d=e.deltaTime<t.time;if(this.reset(),e.eventType&Fr.Start&&this.count===0)return this.failTimeout();if(l&&d&&s){if(e.eventType!==Fr.End)return this.failTimeout();const g=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||$S(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!g?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ci.Recognized,this.tryEmit(this._input)},t.interval),Ci.Began):Ci.Recognized}return Ci.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ci.Failed},this.options.interval),Ci.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ci.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const tD=["","start","move","end","cancel","up","down","left","right"];class Dw extends XS{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Yr.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Yr.Horizontal&&t.push(jb),e&Yr.Vertical&&t.push(Vb),t}getEventNames(){return tD.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let s=!0,{distance:l}=e,{direction:d}=e;const g=e.deltaX,o=e.deltaY;return d&t.direction||(t.direction&Yr.Horizontal?(d=g===0?Yr.None:g<0?Yr.Left:Yr.Right,s=g!==this.pX,l=Math.abs(e.deltaX)):(d=o===0?Yr.None:o<0?Yr.Up:Yr.Down,s=o!==this.pY,l=Math.abs(e.deltaY))),e.direction=d,s&&l>t.threshold&&!!(d&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ci.Began)||!(this.state&Ci.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Yr[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const iD=["","start","move","end","cancel","in","out"];class nD extends XS{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[bv]}getEventNames(){return iD.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ci.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class r0{constructor(e,t,s){this.element=e,this.callback=t,this.options=s}}const rD=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",sD=rD.indexOf("firefox")!==-1,Ow=4.000244140625,aD=40,oD=.25;class lD extends r0{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=l=>{if(!this.options.enable)return;let d=l.deltaY;globalThis.WheelEvent&&(sD&&l.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(d/=globalThis.devicePixelRatio),l.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(d*=aD)),d!==0&&d%Ow===0&&(d=Math.floor(d/Ow)),l.shiftKey&&d&&(d=d*oD),this.callback({type:"wheel",center:{x:l.clientX,y:l.clientY},delta:-d,srcEvent:l,pointerType:"mouse",target:l.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const kw=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class cD extends r0{constructor(e,t,s){super(e,t,{enable:!0,...s}),this.handleEvent=d=>{this.handleOverEvent(d),this.handleOutEvent(d),this.handleEnterEvent(d),this.handleLeaveEvent(d),this.handleMoveEvent(d)},this.pressed=!1;const{enable:l}=this.options;this.enableMoveEvent=l,this.enableLeaveEvent=l,this.enableEnterEvent=l,this.enableOutEvent=l,this.enableOverEvent=l,kw.forEach(d=>e.addEventListener(d,this.handleEvent))}destroy(){kw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Lw=["keydown","keyup"];class uD extends r0{constructor(e,t,s){super(e,t,{enable:!0,tabIndex:0,...s}),this.handleEvent=l=>{const d=l.target||l.srcElement;d.tagName==="INPUT"&&d.type==="text"||d.tagName==="TEXTAREA"||(this.enableDownEvent&&l.type==="keydown"&&this.callback({type:"keydown",srcEvent:l,key:l.key,target:l.target}),this.enableUpEvent&&l.type==="keyup"&&this.callback({type:"keyup",srcEvent:l,key:l.key,target:l.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Lw.forEach(l=>e.addEventListener(l,this.handleEvent))}destroy(){Lw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class hD extends r0{constructor(e,t,s){super(e,t,s),this.handleEvent=l=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:l.clientX,y:l.clientY},srcEvent:l,pointerType:"mouse",target:l.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Bw=1,$b=2,zw=4,fD={pointerdown:Bw,pointermove:$b,pointerup:zw,mousedown:Bw,mousemove:$b,mouseup:zw},dD=0,pD=1,gD=2,mD=1,_D=2,yD=4;function vD(i){const e=fD[i.srcEvent.type];if(!e)return null;const{buttons:t,button:s}=i.srcEvent;let l=!1,d=!1,g=!1;return e===$b?(l=!!(t&mD),d=!!(t&yD),g=!!(t&_D)):(l=s===dD,d=s===pD,g=s===gD),{leftButton:l,middleButton:d,rightButton:g}}function bD(i,e){const t=i.center;if(!t)return null;const s=e.getBoundingClientRect(),l=s.width/e.offsetWidth||1,d=s.height/e.offsetHeight||1,g={x:(t.x-s.left-e.clientLeft)/l,y:(t.y-s.top-e.clientTop)/d};return{center:t,offsetCenter:g}}const xD={srcElement:"root",priority:0};class wD{constructor(e,t){this.handleEvent=s=>{if(this.isEmpty())return;const l=this._normalizeEvent(s);let d=s.srcEvent.target;for(;d&&d!==l.rootElement;){if(this._emit(l,d),l.handled)return;d=d.parentNode}this._emit(l,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,s,l=!1,d=!1){const{handlers:g,handlersByElement:o}=this,A={...xD,...s};let M=o.get(A.srcElement);M||(M=[],o.set(A.srcElement,M));const I={type:e,handler:t,srcElement:A.srcElement,priority:A.priority};l&&(I.once=!0),d&&(I.passive=!0),g.push(I),this._active=this._active||!I.passive;let z=M.length-1;for(;z>=0&&!(M[z].priority>=I.priority);)z--;M.splice(z+1,0,I)}remove(e,t){const{handlers:s,handlersByElement:l}=this;for(let d=s.length-1;d>=0;d--){const g=s[d];if(g.type===e&&g.handler===t){s.splice(d,1);const o=l.get(g.srcElement);o.splice(o.indexOf(g),1),o.length===0&&l.delete(g.srcElement)}}this._active=s.some(d=>!d.passive)}_emit(e,t){const s=this.handlersByElement.get(t);if(s){let l=!1;const d=()=>{e.handled=!0},g=()=>{e.handled=!0,l=!0},o=[];for(let A=0;A<s.length;A++){const{type:M,handler:I,once:z}=s[A];if(I({...e,type:M,stopPropagation:d,stopImmediatePropagation:g}),z&&o.push(s[A]),l)break}for(let A=0;A<o.length;A++){const{type:M,handler:I}=o[A];this.remove(M,I)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...vD(e),...bD(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function TD(i){if("recognizer"in i)return i;let e;const t=Array.isArray(i)?[...i]:[i];if(typeof t[0]=="function"){const s=t.shift(),l=t.shift()||{};e=new s(l)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class SD{constructor(e=null,t={}){if(this._onBasicInput=s=>{this.manager.emit(s.srcEvent.type,s)},this._onOtherEvent=s=>{this.manager.emit(s.type,s)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new QR(e,this.options);for(const s of this.options.recognizers){const{recognizer:l,recognizeWith:d,requireFailure:g}=TD(s);this.manager.add(l),d&&l.recognizeWith(d),g&&l.requireFailure(g)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new lD(e,this._onOtherEvent,{enable:!1}),this.moveInput=new cD(e,this._onOtherEvent,{enable:!1}),this.keyInput=new uD(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new hD(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,s){this._addEventHandler(e,t,s,!1)}once(e,t,s){this._addEventHandler(e,t,s,!0)}watch(e,t,s){this._addEventHandler(e,t,s,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:s}=this;if(!s)return;const l=s.get(e);l&&(l.set({enable:t}),s.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,s,l,d){if(typeof e!="string"){s=t;for(const[M,I]of Object.entries(e))this._addEventHandler(M,I,s,l,d);return}const{manager:g,events:o}=this;if(!g)return;let A=o.get(e);if(!A){const M=this._getRecognizerName(e)||e;A=new wD(this,M),o.set(e,A),g&&g.on(e,A.handleEvent)}A.add(e,t,s,l,d),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[d,g]of Object.entries(e))this._removeEventHandler(d,g);return}const{events:s}=this,l=s.get(e);if(l&&(l.remove(e,t),l.isEmpty())){const{recognizerName:d}=l;let g=!1;for(const o of s.values())if(o.recognizerName===d&&!o.isEmpty()){g=!0;break}g||this._toggleRecognizer(d,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Qi={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qi,"IDENTITY",{get:()=>(Ui.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Do={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},_h={common:0,meters:1,pixels:2},Hb={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Fw={multipan:[Dw,{threshold:10,direction:Yr.Vertical,pointers:2}],pinch:[nD,{},null,["multipan"]],pan:[Dw,{threshold:1},["pinch"],["multipan"]],dblclick:[Rw,{event:"dblclick",taps:2}],click:[Rw,{event:"click"},null,["dblclick"]]};function AD(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let s=0;s<t;s++)if(i[s]!==e[s])return!1;return!0}return!1}function N_(i){let e={},t;return s=>{for(const l in s)if(!AD(s[l],e[l])){t=i(s),e=s;break}return t}}const Nw=[0,0,0,0],ED=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],GS=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],CD=[0,0,0],ZS=[0,0,0],MD=N_(RD);function YS(i,e,t=ZS){t.length<3&&(t=[t[0],t[1],0]);let s=t,l,d=!0;switch(e===Qi.LNGLAT_OFFSETS||e===Qi.METER_OFFSETS?l=t:l=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Do.WEB_MERCATOR:(e===Qi.LNGLAT||e===Qi.CARTESIAN)&&(l=[0,0,0],d=!1);break;case Do.WEB_MERCATOR_AUTO_OFFSET:e===Qi.LNGLAT?s=l:e===Qi.CARTESIAN&&(s=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],l=i.unprojectPosition(s),s[0]-=t[0],s[1]-=t[1],s[2]-=t[2]);break;case Do.IDENTITY:s=i.position.map(Math.fround),s[2]=s[2]||0;break;case Do.GLOBE:d=!1,l=null;break;default:d=!1}return{geospatialOrigin:l,shaderCoordinateOrigin:s,offsetMode:d}}function PD(i,e,t){const{viewMatrixUncentered:s,projectionMatrix:l}=i;let{viewMatrix:d,viewProjectionMatrix:g}=i,o=Nw,A=Nw,M=i.cameraPosition;const{geospatialOrigin:I,shaderCoordinateOrigin:z,offsetMode:W}=YS(i,e,t);return W&&(A=i.projectPosition(I||z),M=[M[0]-A[0],M[1]-A[1],M[2]-A[2]],A[3]=1,o=im([],A,g),d=s||d,g=Gd([],l,d),g=Gd([],g,ED)),{viewMatrix:d,viewProjectionMatrix:g,projectionCenter:o,originCommon:A,cameraPosCommon:M,shaderCoordinateOrigin:z,geospatialOrigin:I}}function ID({viewport:i,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:s=Qi.DEFAULT,coordinateOrigin:l=ZS,autoWrapLongitude:d=!1}){s===Qi.DEFAULT&&(s=i.isGeospatial?Qi.LNGLAT:Qi.CARTESIAN);const g=MD({viewport:i,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:l});return g.wrapLongitude=d,g.modelMatrix=t||GS,g}function RD({viewport:i,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:s}){const{projectionCenter:l,viewProjectionMatrix:d,originCommon:g,cameraPosCommon:o,shaderCoordinateOrigin:A,geospatialOrigin:M}=PD(i,t,s),I=i.getDistanceScales(),z=[i.width*e,i.height*e],W=im([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,J={coordinateSystem:t,projectionMode:i.projectionMode,coordinateOrigin:A,commonOrigin:g.slice(0,3),center:l,pseudoMeters:!!i._pseudoMeters,viewportSize:z,devicePixelRatio:e,focalDistance:W,commonUnitsPerMeter:I.unitsPerMeter,commonUnitsPerWorldUnit:I.unitsPerMeter,commonUnitsPerWorldUnit2:CD,scale:i.scale,wrapLongitude:!1,viewProjectionMatrix:d,modelMatrix:GS,cameraPosition:o};if(M){const oe=i.getDistanceScales(M);switch(t){case Qi.METER_OFFSETS:J.commonUnitsPerWorldUnit=oe.unitsPerMeter,J.commonUnitsPerWorldUnit2=oe.unitsPerMeter2;break;case Qi.LNGLAT:case Qi.LNGLAT_OFFSETS:i._pseudoMeters||(J.commonUnitsPerMeter=oe.unitsPerMeter),J.commonUnitsPerWorldUnit=oe.unitsPerDegree,J.commonUnitsPerWorldUnit2=oe.unitsPerDegree2;break;case Qi.CARTESIAN:J.commonUnitsPerWorldUnit=[1,1,oe.unitsPerMeter[2]],J.commonUnitsPerWorldUnit2=[0,0,oe.unitsPerMeter2[2]];break}}return J}const DD=Object.keys(Qi).map(i=>`const COORDINATE_SYSTEM_${i}: i32 = ${Qi[i]};`).join(""),OD=Object.keys(Do).map(i=>`const PROJECTION_MODE_${i}: i32 = ${Do[i]};`).join(""),kD=Object.keys(_h).map(i=>`const UNIT_${i.toUpperCase()}: i32 = ${_h[i]};`).join(""),LD=`${DD}
${OD}
${kD}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,BD=`${LD}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,zD=Object.keys(Qi).map(i=>`const int COORDINATE_SYSTEM_${i} = ${Qi[i]};`).join(""),FD=Object.keys(Do).map(i=>`const int PROJECTION_MODE_${i} = ${Do[i]};`).join(""),ND=Object.keys(_h).map(i=>`const int UNIT_${i.toUpperCase()} = ${_h[i]};`).join(""),UD=`${zD}
${FD}
${ND}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,VD={};function jD(i=VD){return"viewport"in i?ID(i):{}}const Ux={name:"project",dependencies:[lR,VS],source:BD,vs:UD,getUniforms:jD,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},$D=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,HD=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,U_={name:"project32",dependencies:[Ux],source:$D,vs:HD};function WD(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jg(i,e){const t=im([],e,i);return zS(t,t,1/t[3]),t}function Uw(i,e){const t=i%e;return t<0?e+t:t}function Wb(i,e,t){return i<e?e:i>t?t:i}function qD(i){return Math.log(i)*Math.LOG2E}const Vx=Math.log2||qD;function yh(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const dc=Math.PI,KS=dc/4,_l=dc/180,qb=180/dc,Gg=512,Wv=4003e4,Af=85.051129,XD=1.5;function GD(i){return Vx(i)}function qv(i){const[e,t]=i;yh(Number.isFinite(e)),yh(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const s=e*_l,l=t*_l,d=Gg*(s+dc)/(2*dc),g=Gg*(dc+Math.log(Math.tan(KS+l*.5)))/(2*dc);return[d,g]}function Zg(i){const[e,t]=i,s=e/Gg*(2*dc)-dc,l=2*(Math.atan(Math.exp(t/Gg*(2*dc)-dc))-KS);return[s*qb,l*qb]}function ZD(i){const{latitude:e}=i;yh(Number.isFinite(e));const t=Math.cos(e*_l);return GD(Wv*t)-9}function sb(i){const e=Math.cos(i*_l);return Gg/Wv/e}function Xb(i){const{latitude:e,longitude:t,highPrecision:s=!1}=i;yh(Number.isFinite(e)&&Number.isFinite(t));const l=Gg,d=Math.cos(e*_l),g=l/360,o=g/d,A=l/Wv/d,M={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[g,o,A],degreesPerUnit:[1/g,1/o,1/A]};if(s){const I=_l*Math.tan(e*_l)/d,z=g*I/2,W=l/Wv*I,J=W/o*A;M.unitsPerDegree2=[0,z,W],M.unitsPerMeter2=[J,0,J]}return M}function QS(i,e){const[t,s,l]=i,[d,g,o]=e,{unitsPerMeter:A,unitsPerMeter2:M}=Xb({longitude:t,latitude:s,highPrecision:!0}),I=qv(i);I[0]+=d*(A[0]+M[0]*g),I[1]+=g*(A[1]+M[1]*g);const z=Zg(I),W=(l||0)+(o||0);return Number.isFinite(l)||Number.isFinite(o)?[z[0],z[1],W]:z}function YD(i){const{height:e,pitch:t,bearing:s,altitude:l,scale:d,center:g}=i,o=WD();$v(o,o,[0,0,-l]),LS(o,o,-t*_l),BS(o,o,s*_l);const A=d/e;return Nx(o,o,[A,A,A]),g&&$v(o,o,MI([],g)),o}function KD(i){const{width:e,height:t,altitude:s,pitch:l=0,offset:d,center:g,scale:o,nearZMultiplier:A=1,farZMultiplier:M=1}=i;let{fovy:I=R_(XD)}=i;s!==void 0&&(I=R_(s));const z=I*_l,W=l*_l,J=jx(I);let oe=J;g&&(oe+=g[2]*o/Math.cos(W)/t);const le=z*(.5+(d?d[1]:0)/t),ne=Math.sin(le)*oe/Math.sin(Wb(Math.PI/2-W-le,.01,Math.PI-.01)),Ie=Math.sin(W)*ne+oe,Ue=oe*10,Se=Math.min(Ie*M,Ue);return{fov:z,aspect:e/t,focalDistance:J,near:A,far:Se}}function R_(i){return 2*Math.atan(.5/i)*qb}function jx(i){return .5/Math.tan(.5*i*_l)}function JS(i,e){const[t,s,l=0]=i;return yh(Number.isFinite(t)&&Number.isFinite(s)&&Number.isFinite(l)),jg(e,[t,s,l,1])}function $x(i,e,t=0){const[s,l,d]=i;if(yh(Number.isFinite(s)&&Number.isFinite(l),"invalid pixel coordinate"),Number.isFinite(d))return jg(e,[s,l,d,1]);const g=jg(e,[s,l,0,1]),o=jg(e,[s,l,1,1]),A=g[2],M=o[2],I=A===M?0:((t||0)-A)/(M-A);return RS([],g,o,I)}function QD(i){const{width:e,height:t,bounds:s,minExtent:l=0,maxZoom:d=24,offset:g=[0,0]}=i,[[o,A],[M,I]]=s,z=JD(i.padding),W=qv([o,Wb(I,-Af,Af)]),J=qv([M,Wb(A,-Af,Af)]),oe=[Math.max(Math.abs(J[0]-W[0]),l),Math.max(Math.abs(J[1]-W[1]),l)],le=[e-z.left-z.right-Math.abs(g[0])*2,t-z.top-z.bottom-Math.abs(g[1])*2];yh(le[0]>0&&le[1]>0);const ne=le[0]/oe[0],Ie=le[1]/oe[1],Ue=(z.right-z.left)/2/ne,Se=(z.top-z.bottom)/2/Ie,Ve=[(J[0]+W[0])/2+Ue,(J[1]+W[1])/2+Se],st=Zg(Ve),ot=Math.min(d,Vx(Math.abs(Math.min(ne,Ie))));return yh(Number.isFinite(ot)),{longitude:st[0],latitude:st[1],zoom:ot}}function JD(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(yh(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const Vw=Math.PI/180;function eO(i,e=0){const{width:t,height:s,unproject:l}=i,d={targetZ:e},g=l([0,s],d),o=l([t,s],d);let A,M;const I=i.fovy?.5*i.fovy*Vw:Math.atan(.5/i.altitude),z=(90-i.pitch)*Vw;return I>z-.01?(A=jw(i,0,e),M=jw(i,t,e)):(A=l([0,0],d),M=l([t,0],d)),[g,o,M,A]}function jw(i,e,t){const{pixelUnprojectionMatrix:s}=i,l=jg(s,[e,0,1,1]),d=jg(s,[e,i.height,1,1]),o=(t*i.distanceScales.unitsPerMeter[2]-l[2])/(d[2]-l[2]),A=RS([],l,d,o),M=Zg(A);return M.push(t),M}const $w=512;function tO(i){const{width:e,height:t,pitch:s=0}=i;let{longitude:l,latitude:d,zoom:g,bearing:o=0}=i;(l<-180||l>180)&&(l=Uw(l+180,360)-180),(o<-180||o>180)&&(o=Uw(o+180,360)-180);const A=Vx(t/$w);if(g<=A)g=A,d=0;else{const M=t/2/Math.pow(2,g),I=Zg([0,M])[1];if(d<I)d=I;else{const z=Zg([0,$w-M])[1];d>z&&(d=z)}}return{width:e,height:t,longitude:l,latitude:d,zoom:g,pitch:s,bearing:o}}const eA=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,iO=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,nO=`
${eA}
${iO}
`,rO=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,sO=`
${eA}
${rO}
`,aO=N_(hO),oO=N_(fO),lO=[0,0,0,1],cO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function uO(i,e){const[t,s,l]=i,d=$x([t,s,l],e);return Number.isFinite(l)?d:[d[0],d[1],0]}function hO({viewport:i,center:e}){return new mc(i.viewProjectionMatrix).invert().transform(e)}function fO({viewport:i,shadowMatrices:e}){const t=[],s=i.pixelUnprojectionMatrix,l=i.isGeospatial?void 0:1,d=[[0,0,l],[i.width,0,l],[0,i.height,l],[i.width,i.height,l],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(g=>uO(g,s));for(const g of e){const o=g.clone().translate(new hu(i.center).negate()),A=d.map(I=>o.transform(I)),M=new mc().ortho({left:Math.min(...A.map(I=>I[0])),right:Math.max(...A.map(I=>I[0])),bottom:Math.min(...A.map(I=>I[1])),top:Math.max(...A.map(I=>I[1])),near:Math.min(...A.map(I=>-I[2])),far:Math.max(...A.map(I=>-I[2]))});t.push(M.multiplyRight(g))}return t}function dO(i){const{shadowEnabled:e=!0,project:t}=i;if(!e||!t||!i.shadowMatrices||!i.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};const s=Ux.getUniforms(t),l=aO({viewport:t.viewport,center:s.center}),d=[],g=oO({shadowMatrices:i.shadowMatrices,viewport:t.viewport}).slice();for(let A=0;A<i.shadowMatrices.length;A++){const M=g[A],I=M.clone().translate(new hu(t.viewport.center).negate());s.coordinateSystem===Qi.LNGLAT&&s.projectionMode===Do.WEB_MERCATOR?(g[A]=I,d[A]=l):(g[A]=M.clone().multiplyRight(cO),d[A]=I.transform(l))}const o={drawShadowMap:!!i.drawToShadowMap,useShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,color:i.shadowColor||lO,lightId:i.shadowLightId||0,lightCount:i.shadowMatrices.length,shadow_uShadowMap0:i.dummyShadowMap,shadow_uShadowMap1:i.dummyShadowMap};for(let A=0;A<g.length;A++)o[`viewProjectionMatrix${A}`]=g[A],o[`projectCenter${A}`]=d[A];for(let A=0;A<2;A++)o[`shadow_uShadowMap${A}`]=i.shadowMaps&&i.shadowMaps[A]||i.dummyShadowMap;return o}const Hw={name:"shadow",dependencies:[Ux],vs:nO,fs:sO,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:dO,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},V_={...xw,defaultUniforms:{...xw.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},pO=[VS],gO=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],mO=[];function _O(i){const e=$d.getDefaultShaderAssembler();for(const s of pO)e.addDefaultModule(s);e._hookFunctions.length=0;const t=i==="glsl"?gO:mO;for(const s of t)e.addShaderHook(s);return e}const yO=[255,255,255],vO=1;let bO=0;class xO{constructor(e={}){this.type="ambient";const{color:t=yO}=e,{intensity:s=vO}=e;this.id=e.id||`ambient-${bO++}`,this.color=t,this.intensity=s}}const wO=[255,255,255],TO=1,SO=[0,0,-1];let AO=0;class Ww{constructor(e={}){this.type="directional";const{color:t=wO}=e,{intensity:s=TO}=e,{direction:l=SO}=e,{_shadow:d=!1}=e;this.id=e.id||`directional-${AO++}`,this.color=t,this.intensity=s,this.type="directional",this.direction=new hu(l).normalize().toArray(),this.shadow=d}getProjectedLight(e){return this}}class EO{constructor(e,t={id:"pass"}){const{id:s}=t;this.id=s,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Hx extends EO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,s]=this.device.canvasContext.getDrawingBufferSize(),l=e.clearCanvas??!0,d=e.clearColor??(l?[0,0,0,0]:!1),g=l?1:!1,o=l?0:!1,A=e.colorMask??15,M={viewport:[0,0,t,s]};e.colorMask&&(M.colorMask=A),e.scissorRect&&(M.scissorRect=e.scissorRect);const I=this.device.beginRenderPass({framebuffer:e.target,parameters:M,clearColor:d,clearDepth:g,clearStencil:o});try{return this._drawLayers(I,e)}finally{I.end(),this.device.submit()}}_drawLayers(e,t){const{target:s,shaderModuleProps:l,viewports:d,views:g,onViewportActive:o,clearStack:A=!0}=t;t.pass=t.pass||"unknown",A&&(this._lastRenderIndex=-1);const M=[];for(const I of d){const z=g&&g[I.id];o?.(I);const W=this._getDrawLayerParams(I,t),J=I.subViewports||[I];for(const oe of J){const le=this._drawLayersInViewport(e,{target:s,shaderModuleProps:l,viewport:oe,view:z,pass:t.pass,layers:t.layers},W);M.push(le)}}return M}_getDrawLayerParams(e,{layers:t,pass:s,isPicking:l=!1,layerFilter:d,cullRect:g,effects:o,shaderModuleProps:A},M=!1){const I=[],z=tA(this._lastRenderIndex+1),W={layer:t[0],viewport:e,isPicking:l,renderPass:s,cullRect:g},J={};for(let oe=0;oe<t.length;oe++){const le=t[oe],ne=this._shouldDrawLayer(le,W,d,J),Ie={shouldDrawLayer:ne};ne&&!M&&(Ie.shouldDrawLayer=!0,Ie.layerRenderIndex=z(le,ne),Ie.shaderModuleProps=this._getShaderModuleProps(le,o,s,A),Ie.layerParameters={...le.context.deck?.props.parameters,...this.getLayerParameters(le,oe,e)}),I[oe]=Ie}return I}_drawLayersInViewport(e,{layers:t,shaderModuleProps:s,pass:l,target:d,viewport:g,view:o},A){const M=CO(this.device,{shaderModuleProps:s,target:d,viewport:g});if(o){const{clear:z,clearColor:W,clearDepth:J,clearStencil:oe}=o.props;if(z){let le=[0,0,0,0],ne=1,Ie=0;Array.isArray(W)?le=[...W.slice(0,3),W[3]||255].map(Se=>Se/255):W===!1&&(le=!1),J!==void 0&&(ne=J),oe!==void 0&&(Ie=oe),this.device.beginRenderPass({framebuffer:d,parameters:{viewport:M,scissorRect:M},clearColor:le,clearDepth:ne,clearStencil:Ie}).end()}}const I={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:M});for(let z=0;z<t.length;z++){const W=t[z],J=A[z],{shouldDrawLayer:oe}=J;if(oe&&W.props.pickable&&I.pickableCount++,W.isComposite&&I.compositeCount++,W.isDrawable&&J.shouldDrawLayer){const{layerRenderIndex:le,shaderModuleProps:ne,layerParameters:Ie}=J;I.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,le),ne.project&&(ne.project.viewport=g),W.context.renderPass=e;try{W._drawLayer({renderPass:e,shaderModuleProps:ne,uniforms:{layerIndex:le},parameters:Ie})}catch(Ue){W.raiseError(Ue,`drawing ${W} to ${l}`)}}}return I}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,s){return null}getLayerParameters(e,t,s){return e.props.parameters}_shouldDrawLayer(e,t,s,l){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let g=e.parent;for(;g;){if(!g.props.visible||!g.filterSubLayer(t))return!1;t.layer=g,g=g.parent}if(s){const o=t.layer.id;if(o in l||(l[o]=s(t)),!l[o])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,s,l){const d=this.device.canvasContext.cssToDeviceRatio(),g=e.internalState?.propsInTransition||e.props,o={layer:g,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:d,modelMatrix:g.modelMatrix,coordinateSystem:g.coordinateSystem,coordinateOrigin:g.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const A of t)qw(o,A.getShaderModuleProps?.(e,o));return qw(o,this.getShaderModuleProps(e,t,o),l)}}function tA(i=0,e={}){const t={},s=(l,d)=>{const g=l.props._offset,o=l.id,A=l.parent&&l.parent.id;let M;if(A&&!(A in e)&&s(l.parent,!1),A in t){const I=t[A]=t[A]||tA(e[A],e);M=I(l,d),t[o]=I}else Number.isFinite(g)?(M=g+(e[A]||0),t[o]=null):M=i;return d&&M>=i&&(i=M+1),e[o]=M,M};return s}function CO(i,{shaderModuleProps:e,target:t,viewport:s}){const l=e?.project?.devicePixelRatio??i.canvasContext.cssToDeviceRatio(),[,d]=i.canvasContext.getDrawingBufferSize(),g=t?t.height:d,o=s;return[o.x*l,g-(o.y+o.height)*l,o.width*l,o.height*l]}function qw(i,...e){for(const t of e)if(t)for(const s in t)i[s]?Object.assign(i[s],t[s]):i[s]=t[s];return i}class MO extends Hx{constructor(e,t){super(e,t);const s=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),l=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[s],depthStencilAttachment:l})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,s=this.device.canvasContext.cssToDeviceRatio(),l=e.viewports[0],d=l.width*s,g=l.height*s,o=[1,1,1,1];(d!==t.width||g!==t.height)&&t.resize({width:d,height:g}),super.render({...e,clearColor:o,target:t,pass:"shadow"})}getLayerParameters(e,t,s){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,s){return{shadow:{project:s.project,drawToShadowMap:!0}}}}const PO={color:[255,255,255],intensity:1},Xw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],IO=[0,0,0,200/255];class iA{constructor(e={}){this.id="lighting-effect",this.shadowColor=IO,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:s}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),s._addDefaultShaderModule(Hw),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const s=e[t];switch(s.type){case"ambient":this.ambientLight=s;break;case"directional":this.directionalLights.push(s);break;case"point":this.pointLights.push(s);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:s,onViewportActive:l,views:d}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let g=0;g<this.shadowPasses.length;g++)this.shadowPasses[g].render({layers:e,layerFilter:t,viewports:s,onViewportActive:l,views:d,shaderModuleProps:{shadow:{shadowLightId:g,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const s=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(g=>g.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},l={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(g=>g.getProjectedLight({layer:e})),pointLights:this.pointLights.map(g=>g.getProjectedLight({layer:e}))},d=e.props.material;return{shadow:s,lighting:l,phongMaterial:d,gouraudMaterial:d}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Hw))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const s=new mc().lookAt({eye:new hu(t.direction).negate()});e.push(s)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const s=new MO(e);this.shadowPasses[t]=s}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:s}=this;!e&&t.length===0&&s.length===0&&(this.ambientLight=new xO(PO),this.directionalLights.push(new Ww(Xw[0]),new Ww(Xw[1])))}}class RO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:s=1,type:l,padding:d=0,copy:g=!1,initialize:o=!1,maxCount:A}){const M=l||e&&e.constructor||Float32Array,I=t*s+d;if(ArrayBuffer.isView(e)){if(I<=e.length)return e;if(I*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new M(e.buffer,0,I)}let z=1/0;A&&(z=A*s+d);const W=this._allocate(M,I,o,z);return e&&g?W.set(e):o||W.fill(0,0,4),this._release(e),W}release(e){this._release(e)}_allocate(e,t,s,l){let d=Math.max(Math.ceil(t*this.opts.overAlloc),1);d>l&&(d=l);const g=this._pool,o=e.BYTES_PER_ELEMENT*d,A=g.findIndex(M=>M.byteLength>=o);if(A>=0){const M=new e(g.splice(A,1)[0],0,d);return s&&M.fill(0),M}return new e(d)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:s}=e,{byteLength:l}=s,d=t.findIndex(g=>g.byteLength>=l);d<0?t.push(s):(d>0||t.length<this.opts.poolSize)&&t.splice(d,0,s),t.length>this.opts.poolSize&&t.shift()}}const Yg=new RO;function g_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function DO(i){return[i[12],i[13],i[14]]}function OO(i){return{left:Rg(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:Rg(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:Rg(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:Rg(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:Rg(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:Rg(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const Gw=new hu;function Rg(i,e,t,s){Gw.set(i,e,t);const l=Gw.len();return{distance:s/l,normal:new hu(-i/l,-e/l,-t/l)}}function kO(i){return i-Math.fround(i)}let c_;function ab(i,e){const{size:t=1,startIndex:s=0}=e,l=e.endIndex!==void 0?e.endIndex:i.length,d=(l-s)/t;c_=Yg.allocate(c_,d,{type:Float32Array,size:t*2});let g=s,o=0;for(;g<l;){for(let A=0;A<t;A++){const M=i[g++];c_[o+A]=M,c_[o+A+t]=kO(M)}o+=t*2}return c_.subarray(0,d*t*2)}function LO(i){let e=null,t=!1;for(const s of i)s&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],s[0][0]),e[0][1]=Math.min(e[0][1],s[0][1]),e[1][0]=Math.max(e[1][0],s[1][0]),e[1][1]=Math.max(e[1][1],s[1][1])):e=s);return e}const BO=Math.PI/180,zO=g_(),Zw=[0,0,0],FO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function NO({width:i,height:e,orthographic:t,fovyRadians:s,focalDistance:l,padding:d,near:g,far:o}){const A=i/e,M=t?new mc().orthographic({fovy:s,aspect:A,focalDistance:l,near:g,far:o}):new mc().perspective({fovy:s,aspect:A,near:g,far:o});if(d){const{left:I=0,right:z=0,top:W=0,bottom:J=0}=d,oe=Sf((I+i-z)/2,0,i)-i/2,le=Sf((W+e-J)/2,0,e)-e/2;M[8]-=oe*2/i,M[9]+=le*2/e}return M}class nm{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||FO,this.focalDistance=e.focalDistance||1,this.position=e.position||Zw,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:s}=e;this.isGeospatial=Number.isFinite(s)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Do.WEB_MERCATOR:Do.WEB_MERCATOR_AUTO_OFFSET:Do.IDENTITY}equals(e){return e instanceof nm?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&P_(e.projectionMatrix,this.projectionMatrix)&&P_(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const s=this.projectPosition(e),l=JS(s,this.pixelProjectionMatrix),[d,g]=l,o=t?g:this.height-g;return e.length===2?[d,o]:[d,o,l[2]]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[l,d,g]=e,o=t?d:this.height-d,A=s&&s*this.distanceScales.unitsPerMeter[2],M=$x([l,o,g],this.pixelUnprojectionMatrix,A),[I,z,W]=this.unprojectPosition(M);return Number.isFinite(g)?[I,z,W]:Number.isFinite(s)?[I,z,s]:[I,z]}projectPosition(e){const[t,s]=this.projectFlat(e),l=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,s,l]}unprojectPosition(e){const[t,s]=this.unprojectFlat(e),l=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,s,l]}projectFlat(e){if(this.isGeospatial){const t=qv(e);return t[1]=Sf(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Zg(e):e}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,0],t),l=this.unproject([this.width,0],t),d=this.unproject([0,this.height],t),g=this.unproject([this.width,this.height],t);return[Math.min(s[0],l[0],d[0],g[0]),Math.min(s[1],l[1],d[1],g[1]),Math.max(s[0],l[0],d[0],g[0]),Math.max(s[1],l[1],d[1],g[1])]}getDistanceScales(e){return e&&this.isGeospatial?Xb({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:s=1,height:l=1}){return e<this.x+this.width&&this.x<e+s&&t<this.y+this.height&&this.y<t+l}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,OO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t,s){return null}_initProps(e){const t=e.longitude,s=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=ZD({latitude:s})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Xb({latitude:s,longitude:t}));const l=Math.pow(2,this.zoom);this.scale=l;const{position:d,modelMatrix:g}=e;let o=Zw;if(d&&(o=g?new mc(g).transformAsVector(d,[]):d),this.isGeospatial){const A=this.projectPosition([t,s,0]);this.center=new hu(o).scale(this.distanceScales.unitsPerMeter).add(A)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=zO,projectionMatrix:s=null,orthographic:l=!1,fovyRadians:d,fovy:g=75,near:o=.1,far:A=1e3,padding:M=null,focalDistance:I=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new mc().multiplyRight(t).translate(new hu(this.center).negate()),this.projectionMatrix=s||NO({width:this.width,height:this.height,orthographic:l,fovyRadians:d||g*BO,focalDistance:I,padding:M,near:o,far:A});const z=g_();Gd(z,z,this.projectionMatrix),Gd(z,z,this.viewMatrix),this.viewProjectionMatrix=z,this.viewMatrixInverse=Fb([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=DO(this.viewMatrixInverse);const W=g_(),J=g_();Nx(W,W,[this.width/2,-this.height/2,1]),$v(W,W,[1,-1,0]),Gd(J,W,this.viewProjectionMatrix),this.pixelProjectionMatrix=J,this.pixelUnprojectionMatrix=Fb(g_(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ui.warn("Pixel project matrix not invertible")()}}nm.displayName="Viewport";class Kg extends nm{constructor(e={}){const{latitude:t=0,longitude:s=0,zoom:l=0,pitch:d=0,bearing:g=0,nearZMultiplier:o=.1,farZMultiplier:A=1.01,nearZ:M,farZ:I,orthographic:z=!1,projectionMatrix:W,repeat:J=!1,worldOffset:oe=0,position:le,padding:ne,legacyMeterSizes:Ie=!1}=e;let{width:Ue,height:Se,altitude:Ve=1.5}=e;const st=Math.pow(2,l);Ue=Ue||1,Se=Se||1;let ot,wt=null;if(W)Ve=W[5]/2,ot=R_(Ve);else{e.fovy?(ot=e.fovy,Ve=jx(ot)):ot=R_(Ve);let lt;if(ne){const{top:kt=0,bottom:xt=0}=ne;lt=[0,Sf((kt+Se-xt)/2,0,Se)-Se/2]}wt=KD({width:Ue,height:Se,scale:st,center:le&&[0,0,le[2]*sb(t)],offset:lt,pitch:d,fovy:ot,nearZMultiplier:o,farZMultiplier:A}),Number.isFinite(M)&&(wt.near=M),Number.isFinite(I)&&(wt.far=I)}let Ft=YD({height:Se,pitch:d,bearing:g,scale:st,altitude:Ve});oe&&(Ft=new mc().translate([512*oe,0,0]).multiplyLeft(Ft)),super({...e,width:Ue,height:Se,viewMatrix:Ft,longitude:s,latitude:t,zoom:l,...wt,fovy:ot,focalDistance:Ve}),this.latitude=t,this.longitude=s,this.zoom=l,this.pitch=d,this.bearing=g,this.altitude=Ve,this.fovy=ot,this.orthographic=z,this._subViewports=J?[]:null,this._pseudoMeters=Ie,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),s=Math.ceil((e[2]-180)/360);for(let l=t;l<=s;l++){const d=l?new Kg({...this,worldOffset:l}):this;this._subViewports.push(d)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,s]=this.projectFlat(e),l=(e[2]||0)*sb(e[1]);return[t,s,l]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,s]=this.unprojectFlat(e),l=(e[2]||0)/sb(s);return[t,s,l]}addMetersToLngLat(e,t){return QS(e,t)}panByPosition(e,t,s){const l=$x(t,this.pixelUnprojectionMatrix),d=this.projectFlat(e),g=vw([],d,bI([],l)),o=vw([],this.center,g),[A,M]=this.unprojectFlat(o);return{longitude:A,latitude:M}}getBounds(e={}){const t=eO(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:s,height:l}=this,{longitude:d,latitude:g,zoom:o}=QD({width:s,height:l,bounds:e,...t});return new Kg({width:s,height:l,longitude:d,latitude:g,zoom:o})}}Kg.displayName="WebMercatorViewport";const Yw=[0,0,0];function ob(i,e,t=!1){const s=e.projectPosition(i);if(t&&e instanceof Kg){const[l,d,g=0]=i,o=e.getDistanceScales([l,d]);s[2]=g*o.unitsPerMeter[2]}return s}function UO(i){const{viewport:e,modelMatrix:t,coordinateOrigin:s}=i;let{coordinateSystem:l,fromCoordinateSystem:d,fromCoordinateOrigin:g}=i;return l===Qi.DEFAULT&&(l=e.isGeospatial?Qi.LNGLAT:Qi.CARTESIAN),d===void 0&&(d=l),g===void 0&&(g=s),{viewport:e,coordinateSystem:l,coordinateOrigin:s,modelMatrix:t,fromCoordinateSystem:d,fromCoordinateOrigin:g}}function nA(i,{viewport:e,modelMatrix:t,coordinateSystem:s,coordinateOrigin:l,offsetMode:d}){let[g,o,A=0]=i;switch(t&&([g,o,A]=im([],[g,o,A,1],t)),s){case Qi.LNGLAT:return ob([g,o,A],e,d);case Qi.LNGLAT_OFFSETS:return ob([g+l[0],o+l[1],A+(l[2]||0)],e,d);case Qi.METER_OFFSETS:return ob(QS(l,[g,o,A]),e,d);case Qi.CARTESIAN:default:return e.isGeospatial?[g+l[0],o+l[1],A+l[2]]:e.projectPosition([g,o,A])}}function VO(i,e){const{viewport:t,coordinateSystem:s,coordinateOrigin:l,modelMatrix:d,fromCoordinateSystem:g,fromCoordinateOrigin:o}=UO(e),{autoOffset:A=!0}=e,{geospatialOrigin:M=Yw,shaderCoordinateOrigin:I=Yw,offsetMode:z=!1}=A?YS(t,s,l):{},W=nA(i,{viewport:t,modelMatrix:d,coordinateSystem:g,coordinateOrigin:o,offsetMode:z});if(z){const J=t.projectPosition(M||I);kS(W,W,J)}return W}let jO=1,$O=1;class rA{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:s=Number.POSITIVE_INFINITY,rate:l=1,repeat:d=1}=e,g=jO++,o={time:0,delay:t,duration:s,rate:l,repeat:d};return this._setChannelTime(o,this.time),this.channels.set(g,o),g}removeChannel(e){this.channels.delete(e);for(const[t,s]of this.animations)s.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const l of t)this._setChannelTime(l,this.time);const s=this.animations.values();for(const l of s){const{animation:d,channel:g}=l;d.setTime(this.getTime(g))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const s=$O++;return this.animations.set(s,{animation:e,channel:t}),e.setTime(this.getTime(t)),s}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const s=t-e.delay,l=e.duration*e.repeat;s>=l?e.time=e.duration*e.rate:(e.time=Math.max(0,s)%e.duration,e.time*=e.rate)}}function HO(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function WO(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}let qO=0;class Wx{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:kb.stats.get(`animation-loop-${qO++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Wx.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new Qv({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=HO(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(WO(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,s=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:s,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:s}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),s!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=s,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const s=this.props.onAddHTML(t);s&&(t.innerHTML=s)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let s=1;const l=this.device?.getDefaultCanvasContext().canvas;return l&&l.clientHeight?s=l.clientWidth/l.clientHeight:e>0&&t>0&&(s=e/t),{width:e,height:t,aspect:s}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const lb={};function j_(i="id"){lb[i]=lb[i]||1;const e=lb[i]++;return`${i}-${e}`}class Kw{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||j_("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&$n.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function XO(i,e){if(e instanceof Kw)return e;const t=GO(i,e),{attributes:s,bufferLayout:l}=ZO(i,e);return new Kw({topology:e.topology||"triangle-list",bufferLayout:l,vertexCount:e.vertexCount,indices:t,attributes:s})}function GO(i,e){if(!e.indices)return;const t=e.indices.value;return i.createBuffer({usage:$n.INDEX,data:t})}function ZO(i,e){const t=[],s={};for(const[d,g]of Object.entries(e.attributes)){let o=d;switch(d){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}if(g){s[o]=i.createBuffer({data:g.value,id:`${d}-buffer`});const{value:A,size:M,normalized:I}=g;t.push({name:o,format:zM(A,M,I)})}}const l=e._calculateVertexCount(e.attributes,e.indices);return{attributes:s,bufferLayout:t,vertexCount:l}}class qx{static defaultProps={...Xd.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new qx(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...Xd.defaultProps,...e},s=this._renderPipelineCache,l=this._hashRenderPipeline(t);let d=s[l]?.pipeline;return d?(s[l].useCount++,this.debug&&It.log(3,`${this}: ${s[l].pipeline} reused, count=${s[l].useCount}, (id=${e.id})`)()):(d=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:j_("unnamed-cached")}),d.hash=l,s[l]={pipeline:d,useCount:1},this.debug&&It.log(3,`${this}: ${d} created, count=${s[l].useCount}`)()),d}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...Lv.defaultProps,...e},s=this._computePipelineCache,l=this._hashComputePipeline(t);let d=s[l]?.pipeline;return d?(s[l].useCount++,this.debug&&It.log(3,`${this}: ${s[l].pipeline} reused, count=${s[l].useCount}, (id=${e.id})`)()):(d=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),d.hash=l,s[l]={pipeline:d,useCount:1},this.debug&&It.log(3,`${this}: ${d} created, count=${s[l].useCount}`)()),d}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),s=e.hash;t[s].useCount--,t[s].useCount===0?(this._destroyPipeline(e),this.debug&&It.log(3,`${this}: ${e} released and destroyed`)()):t[s].useCount<0?(It.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[s].useCount=0):this.debug&&It.log(3,`${this}: ${e} released, count=${t[s].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Lv&&(t=this._computePipelineCache),e instanceof Xd&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,s=this._getHash(e.shader.source);return`${t}/C/${s}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,s=e.fs?this._getHash(e.fs.source):0,l="-",d=this._getHash(JSON.stringify(e.bufferLayout)),{type:g}=this.device;if(g==="webgl")return`${g}/R/${t}/${s}V${l}BL${d}`;{const o=this._getHash(JSON.stringify(e.parameters));return`${g}/R/${t}/${s}V${l}T${e.topology}P${o}BL${d}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Xx{static defaultProps={...i0.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Xx(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let s=this._cache[t];if(s)s.useCount++,this.debug&&It.log(3,`${this}: Reusing shader ${s.shader.id} count=${s.useCount}`)();else{const l=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=s={shader:l,useCount:1},this.debug&&It.log(3,`${this}: Created new shader ${l.id}`)()}return s.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),s=this._cache[t];if(s)if(s.useCount--,s.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],s.shader.destroy(),this.debug&&It.log(3,`${this}: Releasing shader ${e.id}, destroyed`)());else{if(s.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&It.log(3,`${this}: Releasing shader ${e.id} count=${s.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function YO(i,e){const t={},s="Values";if(i.attributes.length===0&&!i.varyings?.length)return{"No attributes or varyings":{[s]:"N/A"}};for(const l of i.attributes)if(l){const d=`${l.location} ${l.name}: ${l.type}`;t[`in ${d}`]={[s]:l.stepMode||"vertex"}}for(const l of i.varyings||[]){const d=`${l.location} ${l.name}`;t[`out ${d}`]={[s]:JSON.stringify(l)}}return t}let ds=null,cb=null;function KO(i,{id:e,minimap:t,opaque:s,top:l="0",left:d="0",rgbaScale:g=1}){ds||(ds=document.createElement("canvas"),ds.id=e,ds.title=e,ds.style.zIndex="100",ds.style.position="absolute",ds.style.top=l,ds.style.left=d,ds.style.border="blue 5px solid",ds.style.transform="scaleY(-1)",document.body.appendChild(ds),cb=ds.getContext("2d")),(ds.width!==i.width||ds.height!==i.height)&&(ds.width=i.width/2,ds.height=i.height/2,ds.style.width="400px",ds.style.height="400px");const o=i.device.readPixelsToArrayWebGL(i),A=cb?.createImageData(i.width,i.height);if(A){for(let I=0;I<o.length;I+=4)A.data[0+I+0]=o[I+0]*g,A.data[0+I+1]=o[I+1]*g,A.data[0+I+2]=o[I+2]*g,A.data[0+I+3]=s?255:o[I+3]*g;cb?.putImageData(A,0,0)}}function Gb(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let s=0;s<i.length;s++)if(!Gb(i[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const s=Object.keys(i),l=Object.keys(e);if(s.length!==l.length)return!1;for(const d of s)if(!e.hasOwnProperty(d)||!Gb(i[d],e[d],t-1))return!1;return!0}return!1}class ub{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const s=[...e];for(const l of t){const d=s.findIndex(g=>g.name===l.name);d<0?s.push(l):s[d]=l}return s}getBufferIndex(e){const t=this.bufferLayouts.findIndex(s=>s.name===e);return t===-1&&It.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function QO(i,e){const t=Object.fromEntries(i.attributes.map(l=>[l.name,l.location])),s=e.slice();return s.sort((l,d)=>{const g=l.attributes?l.attributes.map(I=>I.attribute):[l.name],o=d.attributes?d.attributes.map(I=>I.attribute):[d.name],A=Math.min(...g.map(I=>t[I])),M=Math.min(...o.map(I=>t[I]));return A-M}),s}function JO(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function ek(i){return Array.isArray(i)?i.length===0||typeof i[0]=="number":!1}function tk(i){return JO(i)||ek(i)}function ik(i){return tk(i)||typeof i=="number"||typeof i=="boolean"}function nk(i){const e={bindings:{},uniforms:{}};return Object.keys(i).forEach(t=>{const s=i[t];ik(s)?e.uniforms[t]=s:e.bindings[t]=s}),e}class rk{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const s=bx(Object.values(e).filter(l=>l.dependencies));for(const l of s)e[l.name]=l;It.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[l,d]of Object.entries(e))this._addModule(d),d.name&&l!==d.name&&!this.options.disableWarnings&&It.warn(`Module name: ${l} vs ${d.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const s=t,l=e[s]||{},d=this.modules[s];if(!d){this.options.disableWarnings||It.warn(`Module ${t} not found`)();continue}const g=this.moduleUniforms[s],o=this.moduleBindings[s],A=d.getUniforms?.(l,g)||l,{uniforms:M,bindings:I}=nk(A);this.moduleUniforms[s]={...g,...M},this.moduleBindings[s]={...o,...I}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,s]of Object.entries(this.moduleUniforms))for(const[l,d]of Object.entries(s))e[`${t}.${l}`]={type:this.modules[t].uniformTypes?.[l],value:String(d)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let sk="";async function ak(i,e){const t=new Image;return t.crossOrigin="anonymous",t.src=i.startsWith("http")?i:sk+i,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const ok=["+X","-X","+Y","-Y","+Z","-Z"],lk=["+X","-X","+Y","-Y","+Z","-Z"];class T_{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const s=j_("async-texture");this.props={...T_.defaultProps,id:s,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=ak(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((l,d)=>{this.resolveReady=()=>{this.isReady=!0,l()},this.rejectReady=d}),this.initAsync(t)}async initAsync(e){const t=e.data,s=await sA(t).then(void 0,this.rejectReady);if(this.destroyed)return;const l=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(s);if(!l)throw new Error("Texture size could not be determined");const d={...l,...e,data:void 0,mipLevels:1},g=this.device.getMipLevelCount(d.width,d.height);if(d.mipLevels=this.props.mipLevels==="auto"?g:Math.min(g,this.props.mipLevels),this.texture=this.device.createTexture(d),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,s);break;case"2d":this._setTexture2DData(s);break;case"3d":this._setTexture3DData(this.texture,s);break;case"2d-array":this._setTextureArrayData(this.texture,s);break;case"cube":this._setTextureCubeData(this.texture,s);break;case"cube-array":this._setTextureCubeArrayData(this.texture,s);break}this.props.mipmaps&&this.generateMipmaps(),It.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Qd?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const s=Object.values(e)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const s=this._normalizeTextureData(e);s.length>1&&this.props.mipmaps!==!1&&It.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let l=0;l<s.length;l++){const d=s[l];this.device.isExternalImage(d)?this.texture.copyExternalImage({image:d,depth:t,mipLevel:l,flipY:!0}):this.texture.copyImageData({data:d.data,mipLevel:l})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let s=0;s<t.length;s++)this._setTexture2DData(t[s],s)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[s,l]of Object.entries(t)){const d=lk.indexOf(s);this._setTexture2DData(l,d)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let s=0;s<t.length;s++)this._setTexture2DData(t[s],s)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,s,l=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&It.warn(`${this.id} has mipmap and multiple LODs.`)();const d=ok.indexOf(s);this._setTexture2DData(t,d)}_normalizeTextureData(e){const t=this.texture;let s;return ArrayBuffer.isView(e)?s=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?s=e:s=[e],s}static defaultProps={...Kr.defaultProps,data:null,mipmaps:!1}}async function sA(i){if(i=await i,Array.isArray(i))return await Promise.all(i.map(sA));if(i&&typeof i=="object"&&i.constructor===Object){const e=i,t=await Promise.all(Object.values(e)),s=Object.keys(e),l={};for(let d=0;d<s.length;d++)l[s[d]]=t[d];return l}return i}const Ud=2,ck=1e4;class gc{static defaultProps={...Xd.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:$d.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...gc.defaultProps,...t},t=this.props,this.id=t.id||j_("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries(this.props.modules?.map(A=>[A.name,A])||[]),l=t.shaderInputs||new rk(s,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(l);const d=hk(e),g=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:A,getUniforms:M}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:d,...this.props,modules:g});this.source=A,this._getModuleUniforms=M,this.props.shaderLayout||=uI(this.source)}else{const{vs:A,fs:M,getUniforms:I}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:d,...this.props,modules:g});this.vs=A,this.fs=M,this._getModuleUniforms=I}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||qx.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Xx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return It.info(Ud,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let s;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const l=this._getBindings();this.pipeline.setBindings(l,{disableWarnings:this.props.disableWarnings});const{indexBuffer:d}=this.vertexArray,g=d?d.byteLength/(d.indexType==="uint32"?4:2):void 0;s=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:g,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),s?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",s}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&XO(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new ub(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ub(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Gb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new kP(this.shaderInputs.modules);for(const[t,s]of Object.entries(this.shaderInputs.modules))if(uk(s)){const l=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=l}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const s=t?.disableWarnings??this.props.disableWarnings;e.indices&&It.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=QO(this.pipeline.shaderLayout,this.bufferLayout);const l=new ub(this.bufferLayout);for(const[d,g]of Object.entries(e)){const o=l.getBufferLayout(d);if(!o){s||It.warn(`Model(${this.id}): Missing layout for buffer "${d}".`)();continue}const A=l.getAttributeNamesForBuffer(o);let M=!1;for(const I of A){const z=this._attributeInfos[I];if(z){const W=this.device.type==="webgpu"?l.getBufferIndex(z.bufferName):z.location;this.vertexArray.setBuffer(W,g),M=!0}}!M&&!s&&It.warn(`Model(${this.id}): Ignoring buffer "${g.id}" for unknown attribute "${d}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[s,l]of Object.entries(e)){const d=this._attributeInfos[s];d?this.vertexArray.setConstantWebGL(d.location,l):(t?.disableWarnings??this.props.disableWarnings)||It.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${s}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof T_&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,s]of Object.entries(this.bindings))s instanceof T_?s.isReady&&(e[t]=s.texture):e[t]=s;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof t0?e=Math.max(e,t.texture.updateTimestamp):t instanceof $n||t instanceof Kr?e=Math.max(e,t.updateTimestamp):t instanceof T_?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Qd||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[s]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(l=>l.name===s)&&s!=="positions"&&delete t[s];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(It.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const s=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let l=null;this.source?l=s:this.fs&&(l=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:s,fs:l}),this._attributeInfos=oS(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=It.level>3?0:ck;It.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,It.group(Ud,`>>> DRAWING MODEL ${this.id}`,{collapsed:It.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=YO(this.pipeline.shaderLayout,this.id);It.table(Ud,e)();const t=this.shaderInputs.getDebugTable();It.table(Ud,t)();const s=this._getAttributeDebugTable();It.table(Ud,this._attributeInfos)(),It.table(Ud,s)(),It.groupEnd(Ud)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const s=e.props.framebuffer;s&&KO(s,{id:s.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,s]of Object.entries(this._attributeInfos)){const l=this.vertexArray.attributes[s.location];e[s.location]={name:t,type:s.shaderType,values:l?this._getBufferOrConstantValues(l,s.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,s=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:s.toString()}}return e}_getBufferOrConstantValues(e,t){const s=wx(t);return(e instanceof $n?new s(e.debugData):e).toString()}}function uk(i){return!!(i.uniformTypes&&!fk(i.uniformTypes))}function hk(i){return{type:i.type,shaderLanguage:i.info.shadingLanguage,shaderLanguageVersion:i.info.shadingLanguageVersion,gpu:i.info.gpu,features:i.features}}function fk(i){for(const e in i)return!1;return!0}class Qg{device;model;transformFeedback;static defaultProps={...gc.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Qg.defaultProps){if(!Qg.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new gc(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||PM(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof $n)return t.readAsync();const{buffer:s,byteOffset:l=0,byteLength:d=s.byteLength}=t;return s.readAsync(l,d)}}class Jg{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:s=null,vertexCount:l=null}=e;this.id=e.id||j_("geometry"),this.topology=e.topology,s&&(this.indices=ArrayBuffer.isView(s)?{value:s,size:1}:s),this.attributes={};for(const[d,g]of Object.entries(t)){const o=ArrayBuffer.isView(g)?{value:g}:g;if(!ArrayBuffer.isView(o.value))throw new Error(`${this._print(d)}: must be typed array or object with value as typed array`);if((d==="POSITION"||d==="positions")&&!o.size&&(o.size=3),d==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=o}else this.attributes[d]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=l||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let s=1/0;for(const l of Object.values(e)){const{value:d,size:g,constant:o}=l;!o&&d&&g!==void 0&&g>=1&&(s=Math.min(s,d.length/g))}return s}}const dk={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class aA extends Hx{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:s,viewports:l,onViewportActive:d,pickingFBO:g,deviceRect:{x:o,y:A,width:M,height:I},cullRect:z,effects:W,pass:J="picking",pickZ:oe,shaderModuleProps:le}){this.pickZ=oe;const ne=this._resetColorEncoder(oe),Ie=[o,A,M,I],Ue=super.render({target:g,layers:e,layerFilter:t,views:s,viewports:l,onViewportActive:d,cullRect:z,effects:W?.filter(Ve=>Ve.useInPicking),pass:J,isPicking:!0,shaderModuleProps:le,clearColor:[0,0,0,0],colorMask:15,scissorRect:Ie});return this._colorEncoderState=null,{decodePickingColor:ne&&gk.bind(null,ne),stats:Ue}}shouldDrawLayer(e){const{pickable:t,operation:s}=e.props;return t&&s.includes("draw")||s.includes("terrain")||s.includes("mask")}getShaderModuleProps(e,t,s){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,s){const l={...e.props.parameters},{pickable:d,operation:g}=e.props;return this._colorEncoderState?d&&g.includes("draw")?(Object.assign(l,dk),l.blend=!0,l.blendColor=pk(this._colorEncoderState,e,s)):g.includes("terrain")&&(l.blend=!1):l.blend=!1,l}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function pk(i,e,t){const{byLayer:s,byAlpha:l}=i;let d,g=s.get(e);return g?(g.viewports.push(t),d=g.a):(d=s.size+1,d<=255?(g={a:d,layer:e,viewports:[t]},s.set(e,g),l[d]=g):(Ui.warn("Too many pickable layers, only picking the first 255")(),d=0)),[0,0,0,d/255]}function gk(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Og={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Xv=Symbol.for("component"),Pf=Symbol.for("propTypes"),hb=Symbol.for("deprecatedProps"),$g=Symbol.for("asyncPropDefaults"),tp=Symbol.for("asyncPropOriginal"),Ef=Symbol.for("asyncPropResolved");function Gx(i,e=()=>!0){return Array.isArray(i)?oA(i,e,[]):e(i)?[i]:[]}function oA(i,e,t){let s=-1;for(;++s<i.length;){const l=i[s];Array.isArray(l)?oA(l,e,t):e(l)&&t.push(l)}return t}function mk({target:i,source:e,start:t=0,count:s=1}){const l=e.length,d=s*l;let g=0;for(let o=t;g<l;g++)i[o++]=e[g];for(;g<d;)g<d-g?(i.copyWithin(t+g,t,t+g),g*=2):(i.copyWithin(t+g,t,t+d-g),g=d);return i}class _k{constructor(e,t,s){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=s,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const s=++this._loadCount;let l=e;typeof e=="string"&&(l=Rv(e)),l instanceof Promise?(this.isLoaded=!1,this._loader=l.then(d=>{this._loadCount===s&&(this.isLoaded=!0,this._error=void 0,this._content=d)}).catch(d=>{this._loadCount===s&&(this.isLoaded=!0,this._error=d||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const d of this._subscribers)d.onChange(this.getData())}}class yk{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:s=!1,persistent:l=!0}){let d=this._resources[e];d?d.setData(t,s):(d=new _k(e,t,this._context),this._resources[e]=d),d.persistent=l}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const s in t){const l=t[s],d=this._resources[l.resourceId];d&&d.unsubscribe(l)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:s,requestId:l="default"}){const{_resources:d,protocol:g}=this;e.startsWith(g)&&(e=e.replace(g,""),d[e]||this.add({resourceId:e,data:null,persistent:!1}));const o=d[e];if(this._track(s,l,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,s,l){const d=this._consumers,g=d[e]=d[e]||{};let o=g[t];const A=o&&o.resourceId&&this._resources[o.resourceId];A&&(A.unsubscribe(o),this.prune()),s&&(o?(o.onChange=l,o.resourceId=s.id):o={onChange:l,resourceId:s.id},g[t]=o,s.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const vk="layerManager.setLayers",bk="layerManager.activateViewport";class xk{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{aa(bk,this,o),o&&(this.context.viewport=o)};const{deck:s,stats:l,viewport:d,timeline:g}=t||{};this.layers=[],this.resourceManager=new yk({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:s,shaderAssembler:_O(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[AR],renderPass:void 0,stats:l||new Qv({id:"deck.gl"}),viewport:d||new nm({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:g||new rA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const s of this.layers){const l=s.getNeedsRedraw(e);t=t||l}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(s=>t.id.indexOf(s)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){aa(vk,this,t,e),this._lastRenderedLayers=e;const s=Gx(e,Boolean);for(const l of s)l.context=this.context;this._updateLayers(this.layers,s)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(s=>s.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,s=t.findIndex(l=>l.name===e.name);s>=0&&(t.splice(s,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,s){s.raiseError(t,`${e} of ${s}`)}_updateLayers(e,t){const s={};for(const g of e)s[g.id]?Ui.warn(`Multiple old layers with same id ${g.id}`)():s[g.id]=g;if(this._defaultShaderModulesChanged){for(const g of e)g.setNeedsUpdate(),g.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const l=[];this._updateSublayersRecursively(t,s,l),this._finalizeOldLayers(s);let d=!1;for(const g of l)if(g.hasUniformTransition()){d=`Uniform transition in ${g}`;break}this._needsUpdate=d,this.layers=l}_updateSublayersRecursively(e,t,s){for(const l of e){l.context=this.context;const d=t[l.id];d===null&&Ui.warn(`Multiple new layers with same id ${l.id}`)(),t[l.id]=null;let g=null;try{this._debug&&d!==l&&l.validateProps(),d?(this._transferLayerState(d,l),this._updateLayer(l)):this._initializeLayer(l),s.push(l),g=l.isComposite?l.getSubLayers():null}catch(o){this._handleError("matching",o,l)}g&&this._updateSublayersRecursively(g,t,s)}}_finalizeOldLayers(e){for(const t in e){const s=e[t];s&&this._finalizeLayer(s)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Og.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Og.MATCHED,t!==e&&(e.lifecycle=Og.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Og.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Og.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function pl(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let s=0;s<i.length;s++)if(!pl(i[s],e[s],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const s=Object.keys(i),l=Object.keys(e);if(s.length!==l.length)return!1;for(const d of s)if(!e.hasOwnProperty(d)||!pl(i[d],e[d],t-1))return!1;return!0}return!1}class wk{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,s=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(s):s}getViewport(e){return this._viewportMap[e]}unproject(e,t){const s=this.getViewports(),l={x:e[0],y:e[1]};for(let d=s.length-1;d>=0;--d){const g=s[d];if(g.containsPixel(l)){const o=e.slice();return o[0]-=g.x,o[1]-=g.y,g.unproject(o,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Gx(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!pl(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ui.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const s=t.type;return new s({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:d=>this.getView(e.id)?.makeViewport({viewState:d,width:this.width,height:this.height})})}_updateController(e,t,s,l){const d=e.controller;if(d&&s){const g={...t,...d,id:e.id,x:s.x,y:s.y,width:s.width,height:s.height};return(!l||l.constructor!==d.type)&&(l=this._createController(e,g)),l&&l.setProps(g),l}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let l=e.length;l--;){const d=e[l],g=this.getViewState(d),o=d.makeViewport({viewState:g,width:this.width,height:this.height});let A=t[d.id];const M=!!d.controller;M&&!A&&(s=!0),(s||!M)&&A&&(A.finalize(),A=null),this.controllers[d.id]=this._updateController(d,g,o,A),o&&this._viewports.unshift(o)}for(const l in t){const d=t[l];d&&!this.controllers[l]&&d.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((s,l)=>!e[l].equals(t[l]))}}const Tk=/^(?:\d+\.?\d*|\.\d+)$/;function yf(i){switch(typeof i){case"number":if(!Number.isFinite(i))throw new Error(`Could not parse position string ${i}`);return{type:"literal",value:i};case"string":try{const e=Sk(i);return new Ak(e).parseExpression()}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Could not parse position string ${i}: ${t}`)}default:throw new Error(`Could not parse position string ${i}`)}}function Zb(i,e){switch(i.type){case"literal":return i.value;case"percentage":return Math.round(i.value*e);case"binary":const t=Zb(i.left,e),s=Zb(i.right,e);return i.operator==="+"?t+s:t-s;default:throw new Error("Unknown layout expression type")}}function vf(i,e){return Zb(i,e)}function Sk(i){const e=[];let t=0;for(;t<i.length;){const s=i[t];if(/\s/.test(s)){t++;continue}if(s==="+"||s==="-"||s==="("||s===")"||s==="%"){e.push({type:"symbol",value:s}),t++;continue}if(Qw(s)||s==="."){const l=t;let d=s===".";for(t++;t<i.length;){const o=i[t];if(Qw(o)){t++;continue}if(o==="."&&!d){d=!0,t++;continue}break}const g=i.slice(l,t);if(!Tk.test(g))throw new Error("Invalid number token");e.push({type:"number",value:parseFloat(g)});continue}if(Jw(s)){const l=t;for(;t<i.length&&Jw(i[t]);)t++;const d=i.slice(l,t).toLowerCase();e.push({type:"word",value:d});continue}throw new Error("Invalid token in position string")}return e}class Ak{constructor(e){this.index=0,this.tokens=e}parseExpression(){const e=this.parseBinaryExpression();if(this.index<this.tokens.length)throw new Error("Unexpected token at end of expression");return e}parseBinaryExpression(){let e=this.parseFactor(),t=this.peek();for(;Ek(t);){this.index++;const s=this.parseFactor();e={type:"binary",operator:t.value,left:e,right:s},t=this.peek()}return e}parseFactor(){const e=this.peek();if(!e)throw new Error("Unexpected end of expression");if(e.type==="symbol"&&e.value==="+")return this.index++,this.parseFactor();if(e.type==="symbol"&&e.value==="-"){this.index++;const t=this.parseFactor();return{type:"binary",operator:"-",left:{type:"literal",value:0},right:t}}if(e.type==="symbol"&&e.value==="("){this.index++;const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="word"&&e.value==="calc"){if(this.index++,!this.consumeSymbol("("))throw new Error("Missing opening parenthesis after calc");const t=this.parseBinaryExpression();if(!this.consumeSymbol(")"))throw new Error("Missing closing parenthesis");return t}if(e.type==="number"){this.index++;const t=e.value,s=this.peek();return s&&s.type==="symbol"&&s.value==="%"?(this.index++,{type:"percentage",value:t/100}):s&&s.type==="word"&&s.value==="px"?(this.index++,{type:"literal",value:t}):{type:"literal",value:t}}throw new Error("Unexpected token in expression")}consumeSymbol(e){const t=this.peek();return t&&t.type==="symbol"&&t.value===e?(this.index++,!0):!1}peek(){return this.tokens[this.index]||null}}function Qw(i){return i>="0"&&i<="9"}function Jw(i){return i>="a"&&i<="z"||i>="A"&&i<="Z"}function Ek(i){return!!(i&&i.type==="symbol"&&(i.value==="+"||i.value==="-"))}class em{constructor(e){const{id:t,x:s=0,y:l=0,width:d="100%",height:g="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=yf(s),this._y=yf(l),this._width=yf(d),this._height=yf(g),this._padding=o&&{left:yf(o.left||0),right:yf(o.right||0),top:yf(o.top||0),bottom:yf(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&pl(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:s}){s=this.filterViewState(s);const l=this.getDimensions({width:e,height:t});if(!l.height||!l.width)return null;const d=this.getViewportType(s);return new d({...s,...this.props,...l})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const s in this.props.viewState)s!=="id"&&(t[s]=this.props.viewState[s]);return t}return e}getDimensions({width:e,height:t}){const s={x:vf(this._x,e),y:vf(this._y,t),width:vf(this._width,e),height:vf(this._height,t)};return this._padding&&(s.padding={left:vf(this._padding.left,e),top:vf(this._padding.top,t),right:vf(this._padding.right,e),bottom:vf(this._padding.bottom,t)}),s}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class s0{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const eT=()=>{},Yb={BREAK:1,SNAP_TO_END:2,IGNORE:3},Ck=i=>i,Mk=Yb.BREAK;class Pk{constructor(e){this._onTransitionUpdate=t=>{const{time:s,settings:{interpolator:l,startProps:d,endProps:g,duration:o,easing:A}}=t,M=A(s/o),I=l.interpolateProps(d,g,M);this.propsInTransition=this.getControllerState({...this.props,...I}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new s0(e.timeline),this.onViewStateChange=e.onViewStateChange||eT,this.onStateChange=e.onStateChange||eT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const s=this.props;if(this.props=e,!s||this._shouldIgnoreViewportChange(s,e))return!1;if(this._isTransitionEnabled(e)){let l=s;if(this.transition.inProgress){const{interruption:d,endProps:g}=this.transition.settings;l={...s,...d===Yb.SNAP_TO_END?g:this.propsInTransition||s}}this._triggerTransition(l,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:s}=e;return(t>0||t==="auto")&&!!s}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Yb.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const s=this.getControllerState(e),l=this.getControllerState(t).shortestPathFrom(s),d=t.transitionInterpolator,g=d.getDuration?d.getDuration(e,t):t.transitionDuration;if(g===0)return;const o=d.initializeProps(e,l);this.propsInTransition={};const A={duration:g,easing:t.transitionEasing||Ck,interpolator:d,interruption:t.transitionInterruption||Mk,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(A),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function ps(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class Ik{constructor(e){const{compare:t,extract:s,required:l}=e;this._propsToCompare=t,this._propsToExtract=s||t,this._requiredProps=l}arePropsEqual(e,t){for(const s of this._propsToCompare)if(!(s in e)||!(s in t)||!P_(e[s],t[s]))return!1;return!0}initializeProps(e,t){const s={},l={};for(const d of this._propsToExtract)(d in e||d in t)&&(s[d]=e[d],l[d]=t[d]);return this._checkRequiredProps(s),this._checkRequiredProps(l),{start:s,end:l}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const s=e[t];ps(Number.isFinite(s)||Array.isArray(s),`${t} is required for transition`)})}}const nv=Math.PI/180,tT=180/Math.PI,xv=6370972,Bg=256;function Rk(){const i=Bg/xv,e=Math.PI/180*Bg;return{unitsPerMeter:[i,i,i],unitsPerMeter2:[0,0,0],metersPerUnit:[1/i,1/i,1/i],unitsPerDegree:[e,e,i],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/i]}}class lA extends nm{constructor(e={}){const{longitude:t=0,zoom:s=0,nearZMultiplier:l=.5,farZMultiplier:d=1,resolution:g=10}=e;let{latitude:o=0,height:A,altitude:M=1.5,fovy:I}=e;o=Math.max(Math.min(o,Af),-Af),A=A||1,I?M=jx(I):I=R_(M);const z=Math.pow(2,s-rv(o)),W=e.nearZ??l,J=e.farZ??(M+Bg*2*z/A)*d,oe=new mc().lookAt({eye:[0,-M,0],up:[0,0,1]});oe.rotateX(o*nv),oe.rotateZ(-t*nv),oe.scale(z/A),super({...e,height:A,viewMatrix:oe,longitude:t,latitude:o,zoom:s,distanceScales:Rk(),fovy:I,focalDistance:M,near:W,far:J}),this.scale=z,this.latitude=o,this.longitude=t,this.fovy=I,this.resolution=g}get projectionMode(){return Do.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},s=this.unproject([0,this.height/2],t),l=this.unproject([this.width/2,0],t),d=this.unproject([this.width,this.height/2],t),g=this.unproject([this.width/2,this.height],t);return d[0]<this.longitude&&(d[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],d[0],l[0],g[0]),Math.min(s[1],d[1],l[1],g[1]),Math.max(s[0],d[0],l[0],g[0]),Math.max(s[1],d[1],l[1],g[1])]}unproject(e,{topLeft:t=!0,targetZ:s}={}){const[l,d,g]=e,o=t?d:this.height-d,{pixelUnprojectionMatrix:A}=this;let M;if(Number.isFinite(g))M=fb(A,[l,o,g,1]);else{const J=fb(A,[l,o,-1,1]),oe=fb(A,[l,o,1,1]),le=((s||0)/xv+1)*Bg,ne=Q0(kS([],J,oe)),Ie=Q0(J),Ue=Q0(oe),Ve=4*((4*Ie*Ue-(ne-Ie-Ue)**2)/16)/ne,st=Math.sqrt(Ie-Ve),ot=Math.sqrt(Math.max(0,le*le-Ve)),wt=(st-ot)/Math.sqrt(ne);M=RI([],J,oe,wt)}const[I,z,W]=this.unprojectPosition(M);return Number.isFinite(g)?[I,z,W]:Number.isFinite(s)?[I,z,s]:[I,z]}projectPosition(e){const[t,s,l=0]=e,d=t*nv,g=s*nv,o=Math.cos(g),A=(l/xv+1)*Bg;return[Math.sin(d)*o*A,-Math.cos(d)*o*A,Math.sin(g)*A]}unprojectPosition(e){const[t,s,l]=e,d=FI(e),g=Math.asin(l/d),A=Math.atan2(t,-s)*tT,M=g*tT,I=(d/Bg-1)*xv;return[A,M,I]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition([e,t,s],l,d){const o=.25/Math.pow(2,this.zoom-rv(this.latitude)),A=e+o*(d[0]-l[0]);let M=t-o*(d[1]-l[1]);M=Math.max(Math.min(M,Af),-Af);const I={longitude:A,latitude:M,zoom:s-rv(t)};return I.zoom+=rv(I.latitude),I}}lA.displayName="GlobeViewport";function rv(i){const e=Math.PI*Math.cos(i*Math.PI/180);return Math.log2(e)}function fb(i,e){const t=im([],e,i);return zS(t,t,1/t[3]),t}const Dk=["longitude","latitude","zoom","bearing","pitch"],Ok=["longitude","latitude","zoom"];class cA extends Ik{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,s=Array.isArray(e)?{}:e;s.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Dk,required:Ok},super(s.transitionProps),this.opts=s}initializeProps(e,t){const s=super.initializeProps(e,t),{makeViewport:l,around:d}=this.opts;if(l&&d)if(l(e)instanceof lA)Ui.warn("around not supported in GlobeView")();else{const o=l(e),A=l(t),M=o.unproject(d);s.start.around=d,Object.assign(s.end,{around:A.project(M),aroundPosition:M,width:t.width,height:t.height})}return s}interpolateProps(e,t,s){const l={};for(const d of this._propsToExtract)l[d]=jv(e[d]||0,t[d]||0,s);if(t.aroundPosition&&this.opts.makeViewport){const d=this.opts.makeViewport({...t,...l});Object.assign(l,d.panByPosition(t.aroundPosition,jv(e.around,t.around,s)))}return l}}const dh={transitionDuration:0},kk=300,sv=i=>1-(1-i)*(1-i),Dg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Vd={};class Lk{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Pk({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:s}=this.props,{offsetCenter:l}=e;return[l.x-t,l.y-s]}isPointInBounds(e,t){const{width:s,height:l}=this.props;if(t&&t.handled)return!1;const d=e[0]>=0&&e[0]<=s&&e[1]>=0&&e[1]<=l;return d&&t&&t.stopPropagation(),d}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?kk:0;const{scrollZoom:s=!0,dragPan:l=!0,dragRotate:d=!0,doubleClickZoom:g=!0,touchZoom:o=!0,touchRotate:A=!1,keyboard:M=!0}=e,I=!!this.onViewStateChange;this.toggleEvents(Dg.WHEEL,I&&s),this.toggleEvents(Dg.PAN,I),this.toggleEvents(Dg.PINCH,I&&(o||A)),this.toggleEvents(Dg.MULTI_PAN,I&&A),this.toggleEvents(Dg.DOUBLE_CLICK,I&&g),this.toggleEvents(Dg.KEYBOARD,I&&M),this.scrollZoom=s,this.dragPan=l,this.dragRotate=d,this.doubleClickZoom=g,this.touchZoom=o,this.touchRotate=A,this.keyboard=M}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(s=>{this._events[s]!==t&&(this._events[s]=t,t?this.eventManager.on(s,this.handleEvent):this.eventManager.off(s,this.handleEvent))})}updateViewport(e,t=null,s={}){const l={...e.getViewportProps(),...t},d=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(s),d){const g=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:l,interactionState:this._interactionState,oldViewState:g,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let s=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(s=!s);const l=this.controllerState[s?"panStart":"rotateStart"]({pos:t});return this._panMove=s,this.updateViewport(l,dh,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),s=this.controllerState.pan({pos:t});return this.updateViewport(s,dh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const s=this.getCenter(e),l=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],d=this.controllerState.pan({pos:l}).panEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sv},{isDragging:!1,isPanning:!0})}else{const s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),s=this.controllerState.rotate({pos:t});return this.updateViewport(s,dh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const s=this.getCenter(e),l=[s[0]+e.velocityX*t/2,s[1]+e.velocityY*t/2],d=this.controllerState.rotate({pos:l}).rotateEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sv},{isDragging:!1,isRotating:!0})}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:s=.01,smooth:l=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:d}=e;let g=2/(1+Math.exp(-Math.abs(d*s)));d<0&&g!==0&&(g=1/g);const o=l?{...this._getTransitionProps({around:t}),transitionDuration:250}:dh,A=this.controllerState.zoom({pos:t,scale:g});return this.updateViewport(A,o,{isZooming:!0,isPanning:!0}),l||this._setInteractionState({isZooming:!1,isPanning:!1}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.rotateStart({pos:t});return this.updateViewport(s,dh,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const s=this.controllerState.rotate({pos:t});return this.updateViewport(s,dh,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const s=this.getCenter(e),l=[s[0],s[1]+=e.velocityY*t/2],d=this.controllerState.rotate({pos:l});this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:sv},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Vd._startPinchRotation=e.rotation,Vd._lastPinchEvent=e,this.updateViewport(s,dh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:s}=e,l=this.getCenter(e);t=t.zoom({pos:l,scale:s})}if(this.touchRotate){const{rotation:s}=e;t=t.rotate({deltaAngleX:Vd._startPinchRotation-s})}return this.updateViewport(t,dh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Vd._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:s}=Vd;if(this.touchZoom&&t&&s&&e.scale!==s.scale){const l=this.getCenter(e);let d=this.controllerState.rotateEnd();const g=Math.log2(e.scale),o=(g-Math.log2(s.scale))/(e.deltaTime-s.deltaTime),A=Math.pow(2,g+o*t/2);d=d.zoom({pos:l,scale:A}).zoomEnd(),this.updateViewport(d,{...this._getTransitionProps({around:l}),transitionDuration:t,transitionEasing:sv},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const l=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(l,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Vd._startPinchRotation=null,Vd._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const s=this.isFunctionKeyPressed(e),l=this.controllerState.zoom({pos:t,scale:s?.5:2});return this.updateViewport(l,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:s,moveSpeed:l,rotateSpeedX:d,rotateSpeedY:g}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let A;const M={};switch(e.srcEvent.code){case"Minus":A=t?o.zoomOut(s).zoomOut(s):o.zoomOut(s),M.isZooming=!0;break;case"Equal":A=t?o.zoomIn(s).zoomIn(s):o.zoomIn(s),M.isZooming=!0;break;case"ArrowLeft":t?(A=o.rotateLeft(d),M.isRotating=!0):(A=o.moveLeft(l),M.isPanning=!0);break;case"ArrowRight":t?(A=o.rotateRight(d),M.isRotating=!0):(A=o.moveRight(l),M.isPanning=!0);break;case"ArrowUp":t?(A=o.rotateUp(g),M.isRotating=!0):(A=o.moveUp(l),M.isPanning=!0);break;case"ArrowDown":t?(A=o.rotateDown(g),M.isRotating=!0):(A=o.moveDown(l),M.isPanning=!0);break;default:return!1}return this.updateViewport(A,this._getTransitionProps(),M),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?dh:e?{...t,transitionInterpolator:new cA({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class Bk{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const iT=5,zk=1.2;class Fk extends Bk{constructor(e){const{width:t,height:s,latitude:l,longitude:d,zoom:g,bearing:o=0,pitch:A=0,altitude:M=1.5,position:I=[0,0,0],maxZoom:z=20,minZoom:W=0,maxPitch:J=60,minPitch:oe=0,startPanLngLat:le,startZoomLngLat:ne,startRotatePos:Ie,startBearing:Ue,startPitch:Se,startZoom:Ve,normalize:st=!0}=e;ps(Number.isFinite(d)),ps(Number.isFinite(l)),ps(Number.isFinite(g)),super({width:t,height:s,latitude:l,longitude:d,zoom:g,bearing:o,pitch:A,altitude:M,maxZoom:z,minZoom:W,maxPitch:J,minPitch:oe,normalize:st,position:I},{startPanLngLat:le,startZoomLngLat:ne,startRotatePos:Ie,startBearing:Ue,startPitch:Se,startZoom:Ve}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const s=this.getState().startPanLngLat||this._unproject(t);if(!s)return this;const d=this.makeViewport(this.getViewportProps()).panByPosition(s,e);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:s=0}){const{startRotatePos:l,startBearing:d,startPitch:g}=this.getState();if(!l||d===void 0||g===void 0)return this;let o;return e?o=this._getNewRotation(e,l,g,d):o={bearing:d+t,pitch:g+s},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:s}){let{startZoom:l,startZoomLngLat:d}=this.getState();if(d||(l=this.getViewportProps().zoom,d=this._unproject(t)||this._unproject(e)),!d)return this;const{maxZoom:g,minZoom:o}=this.getViewportProps();let A=l+Math.log2(s);A=Sf(A,o,g);const M=this.makeViewport({...this.getViewportProps(),zoom:A});return this._getUpdatedState({zoom:A,...M.panByPosition(d,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),s={...this.getViewportProps()},{bearing:l,longitude:d}=s;return Math.abs(l-t.bearing)>180&&(s.bearing=l<0?l+360:l-360),Math.abs(d-t.longitude)>180&&(s.longitude=d<0?d+360:d-360),s}applyConstraints(e){const{maxZoom:t,minZoom:s,zoom:l}=e;e.zoom=Sf(l,s,t);const{maxPitch:d,minPitch:g,pitch:o}=e;e.pitch=Sf(o,g,d);const{normalize:A=!0}=e;return A&&Object.assign(e,tO(e)),e}_zoomFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.zoom({pos:[t/2,s/2],scale:e})}_panFromCenter(e){const{width:t,height:s}=this.getViewportProps();return this.pan({startPos:[t/2,s/2],pos:[t/2+e[0],s/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,s,l){const d=e[0]-t[0],g=e[1]-t[1],o=e[1],A=t[1],{width:M,height:I}=this.getViewportProps(),z=d/M;let W=0;g>0?Math.abs(I-A)>iT&&(W=g/(A-I)*zk):g<0&&A>iT&&(W=1-o/A),W=Sf(W,-1,1);const{minPitch:J,maxPitch:oe}=this.getViewportProps(),le=l+180*z;let ne=s;return W>0?ne=s+W*(oe-s):W<0&&(ne=s-W*(J-s)),{pitch:ne,bearing:le}}}class Nk extends Lk{constructor(){super(...arguments),this.ControllerState=Fk,this.transition={transitionDuration:300,transitionInterpolator:new cA({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let uA=class extends em{constructor(e={}){super(e)}getViewportType(){return Kg}get ControllerType(){return Nk}};uA.displayName="MapView";const Uk=new iA;function Vk(i,e){const t=i.order??1/0,s=e.order??1/0;return t-s}class jk{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(s=>s.id===e.id)){const s=t.findIndex(l=>Vk(l,e)>0);s<0?t.push(e):t.splice(s,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(pl(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const l of this.effects)t[l.id]=l;const s=[];for(const l of e){const d=t[l.id];let g=l;d&&d!==l?d.setProps?(d.setProps(l.props),g=d):d.cleanup(this._context):d||l.setup(this._context),s.push(g),delete t[l.id]}for(const l in t)t[l].cleanup(this._context);this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(l=>l instanceof iA)||this._resolvedEffects.push(Uk),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class $k extends Hx{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const Hk="deckRenderer.renderLayers";class Wk{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new $k(e),this.pickLayersPass=new aA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,s={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};s.effects&&this._preRender(s.effects,s);const l=this.lastPostProcessEffect?this.renderBuffers[0]:s.target;this.lastPostProcessEffect&&(s.clearColor=[0,0,0,0],s.clearCanvas=!0);const d=t.render({...s,target:l});s.effects&&(this.lastPostProcessEffect&&(s.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(s.effects,s)),this.renderCount++,aa(Hk,this,d,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const s of e)t.preRenderStats[s.id]=s.preRender(t),s.postRender&&(this.lastPostProcessEffect=s.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[s,l]=t;e.length===0&&[0,1].map(d=>{const g=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:s,height:l});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${d}`,colorAttachments:[g]}))});for(const d of e)d.resize(t)}_postRender(e,t){const{renderBuffers:s}=this,l={...t,inputBuffer:s[0],swapBuffer:s[1]};for(const d of e)if(d.postRender){l.target=d.id===this.lastPostProcessEffect?t.target:void 0;const g=d.postRender(l);l.inputBuffer=g,l.swapBuffer=g===s[0]?s[1]:s[0]}}}const qk={pickedColor:null,pickedObjectIndex:-1};function nT({pickedColors:i,decodePickingColor:e,deviceX:t,deviceY:s,deviceRadius:l,deviceRect:d}){const{x:g,y:o,width:A,height:M}=d;let I=l*l,z=-1,W=0;for(let J=0;J<M;J++){const oe=J+o-s,le=oe*oe;if(le>I)W+=4*A;else for(let ne=0;ne<A;ne++){if(i[W+3]-1>=0){const Ue=ne+g-t,Se=Ue*Ue+le;Se<=I&&(I=Se,z=W)}W+=4}}if(z>=0){const J=i.slice(z,z+4),oe=e(J);if(oe){const le=Math.floor(z/4/A),ne=z/4-le*A;return{...oe,pickedColor:J,pickedX:g+ne,pickedY:o+le}}Ui.error("Picked non-existent layer. Is picking buffer corrupt?")()}return qk}function rT({pickedColors:i,decodePickingColor:e}){const t=new Map;if(i){for(let s=0;s<i.length;s+=4)if(i[s+3]-1>=0){const d=i.slice(s,s+4),g=d.join(",");if(!t.has(g)){const o=e(d);o?t.set(g,{...o,color:d}):Ui.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Kb({pickInfo:i,viewports:e,pixelRatio:t,x:s,y:l,z:d}){let g=e[0];e.length>1&&(g=Xk(i?.pickedViewports||e,{x:s,y:l}));let o;if(g){const A=[s-g.x,l-g.y];d!==void 0&&(A[2]=d),o=g.unproject(A)}return{color:null,layer:null,viewport:g,index:-1,picked:!1,x:s,y:l,pixel:[s,l],coordinate:o,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:t}}function sT(i){const{pickInfo:e,lastPickedInfo:t,mode:s,layers:l}=i,{pickedColor:d,pickedLayer:g,pickedObjectIndex:o}=e,A=g?[g]:[];if(s==="hover"){const z=t.index,W=t.layerId,J=g?g.props.id:null;if(J!==W||o!==z){if(J!==W){const oe=l.find(le=>le.props.id===W);oe&&A.unshift(oe)}t.layerId=J,t.index=o,t.info=null}}const M=Kb(i),I=new Map;return I.set(null,M),A.forEach(z=>{let W={...M};z===g&&(W.color=d,W.index=o,W.picked=!0),W=Qb({layer:z,info:W,mode:s});const J=W.layer;z===g&&s==="hover"&&(t.info=W),I.set(J.id,W),s==="hover"&&J.updateAutoHighlight(W)}),I}function Qb({layer:i,info:e,mode:t}){for(;i&&e;){const s=e.layer||null;e.sourceLayer=s,e.layer=i,e=i.getPickingInfo({info:e,mode:t,sourceLayer:s}),i=i.parent}return e}function Xk(i,e){for(let t=i.length-1;t>=0;t--){const s=i[t];if(s.containsPixel(e))return s}return i[0]}class Gk{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new aA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:s,viewports:l},d=this.lastPickedInfo.info){const g=d&&d.layer&&d.layer.id,o=d&&d.viewport&&d.viewport.id,A=g?s.find(W=>W.id===g):null,M=o&&l.find(W=>W.id===o)||l[0],I=M&&M.unproject([e-M.x,t-M.y]);return{...d,...{x:e,y:t,viewport:M,coordinate:I,layer:A}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(s=>this.pickLayersPass.shouldDrawLayer(s)&&!s.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:s,x:l,y:d,radius:g=0,depth:o=1,mode:A="query",unproject3D:M,onViewportActive:I,effects:z}){const W=this.device.canvasContext.cssToDeviceRatio(),J=this._getPickable(e);if(!J||s.length===0)return{result:[],emptyInfo:Kb({viewports:s,x:l,y:d,pixelRatio:W})};this._resizeBuffer();const oe=this.device.canvasContext.cssToDevicePixels([l,d],!0),le=[oe.x+Math.floor(oe.width/2),oe.y+Math.floor(oe.height/2)],ne=Math.round(g*W),{width:Ie,height:Ue}=this.pickingFBO,Se=this._getPickingRect({deviceX:le[0],deviceY:le[1],deviceRadius:ne,deviceWidth:Ie,deviceHeight:Ue}),Ve={x:l-g,y:d-g,width:g*2+1,height:g*2+1};let st;const ot=[],wt=new Set;for(let Ft=0;Ft<o;Ft++){let lt;if(Se){const xt=this._drawAndSample({layers:J,views:t,viewports:s,onViewportActive:I,deviceRect:Se,cullRect:Ve,effects:z,pass:`picking:${A}`});lt=nT({...xt,deviceX:le[0],deviceY:le[1],deviceRadius:ne,deviceRect:Se})}else lt={pickedColor:null,pickedObjectIndex:-1};let kt;if(lt.pickedLayer&&M&&this.depthFBO){const{pickedColors:xt}=this._drawAndSample({layers:[lt.pickedLayer],views:t,viewports:s,onViewportActive:I,deviceRect:{x:lt.pickedX,y:lt.pickedY,width:1,height:1},cullRect:Ve,effects:z,pass:`picking:${A}:z`},!0);xt[3]&&(kt=xt[0])}lt.pickedLayer&&Ft+1<o&&(wt.add(lt.pickedLayer),lt.pickedLayer.disablePickingIndex(lt.pickedObjectIndex)),st=sT({pickInfo:lt,lastPickedInfo:this.lastPickedInfo,mode:A,layers:J,viewports:s,x:l,y:d,z:kt,pixelRatio:W});for(const xt of st.values())xt.layer&&ot.push(xt);if(!lt.pickedColor)break}for(const Ft of wt)Ft.restorePickingColors();return{result:ot,emptyInfo:st.get(null)}}_pickClosestObject({layers:e,views:t,viewports:s,x:l,y:d,radius:g=0,depth:o=1,mode:A="query",unproject3D:M,onViewportActive:I,effects:z}){const W=this.device.canvasContext.cssToDeviceRatio(),J=this._getPickable(e);if(!J||s.length===0)return{result:[],emptyInfo:Kb({viewports:s,x:l,y:d,pixelRatio:W})};this._resizeBuffer();const oe=this.device.canvasContext.cssToDevicePixels([l,d],!0),le=[oe.x+Math.floor(oe.width/2),oe.y+Math.floor(oe.height/2)],ne=Math.round(g*W),{width:Ie,height:Ue}=this.pickingFBO,Se=this._getPickingRect({deviceX:le[0],deviceY:le[1],deviceRadius:ne,deviceWidth:Ie,deviceHeight:Ue}),Ve={x:l-g,y:d-g,width:g*2+1,height:g*2+1};let st;const ot=[],wt=new Set;for(let Ft=0;Ft<o;Ft++){let lt;if(Se){const xt=this._drawAndSample({layers:J,views:t,viewports:s,onViewportActive:I,deviceRect:Se,cullRect:Ve,effects:z,pass:`picking:${A}`});lt=nT({...xt,deviceX:le[0],deviceY:le[1],deviceRadius:ne,deviceRect:Se})}else lt={pickedColor:null,pickedObjectIndex:-1};let kt;if(lt.pickedLayer&&M&&this.depthFBO){const{pickedColors:xt}=this._drawAndSample({layers:[lt.pickedLayer],views:t,viewports:s,onViewportActive:I,deviceRect:{x:lt.pickedX,y:lt.pickedY,width:1,height:1},cullRect:Ve,effects:z,pass:`picking:${A}:z`},!0);xt[3]&&(kt=xt[0])}lt.pickedLayer&&Ft+1<o&&(wt.add(lt.pickedLayer),lt.pickedLayer.disablePickingIndex(lt.pickedObjectIndex)),st=sT({pickInfo:lt,lastPickedInfo:this.lastPickedInfo,mode:A,layers:J,viewports:s,x:l,y:d,z:kt,pixelRatio:W});for(const xt of st.values())xt.layer&&ot.push(xt);if(!lt.pickedColor)break}for(const Ft of wt)Ft.restorePickingColors();return{result:ot,emptyInfo:st.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:s,x:l,y:d,width:g=1,height:o=1,mode:A="query",maxObjects:M=null,onViewportActive:I,effects:z}){const W=this._getPickable(e);if(!W||s.length===0)return[];this._resizeBuffer();const J=this.device.canvasContext.cssToDeviceRatio(),oe=this.device.canvasContext.cssToDevicePixels([l,d],!0),le=oe.x,ne=oe.y+oe.height,Ie=this.device.canvasContext.cssToDevicePixels([l+g,d+o],!0),Ue=Ie.x+Ie.width,Se=Ie.y,Ve={x:le,y:Se,width:Ue-le,height:ne-Se},st=this._drawAndSample({layers:W,views:t,viewports:s,onViewportActive:I,deviceRect:Ve,cullRect:{x:l,y:d,width:g,height:o},effects:z,pass:`picking:${A}`}),ot=rT(st),wt=new Map,Ft=[],lt=Number.isFinite(M);for(let kt=0;kt<ot.length&&!(lt&&Ft.length>=M);kt++){const xt=ot[kt];let Lt={color:xt.pickedColor,layer:null,index:xt.pickedObjectIndex,picked:!0,x:l,y:d,pixelRatio:J};Lt=Qb({layer:xt.pickedLayer,info:Lt,mode:A});const Dt=Lt.layer.id;wt.has(Dt)||wt.set(Dt,new Set);const Pt=wt.get(Dt),Yt=Lt.object??Lt.index;Pt.has(Yt)||(Pt.add(Yt),Ft.push(Lt))}return Ft}_pickVisibleObjects({layers:e,views:t,viewports:s,x:l,y:d,width:g=1,height:o=1,mode:A="query",maxObjects:M=null,onViewportActive:I,effects:z}){const W=this._getPickable(e);if(!W||s.length===0)return[];this._resizeBuffer();const J=this.device.canvasContext.cssToDeviceRatio(),oe=this.device.canvasContext.cssToDevicePixels([l,d],!0),le=oe.x,ne=oe.y+oe.height,Ie=this.device.canvasContext.cssToDevicePixels([l+g,d+o],!0),Ue=Ie.x+Ie.width,Se=Ie.y,Ve={x:le,y:Se,width:Ue-le,height:ne-Se},st=this._drawAndSample({layers:W,views:t,viewports:s,onViewportActive:I,deviceRect:Ve,cullRect:{x:l,y:d,width:g,height:o},effects:z,pass:`picking:${A}`}),ot=rT(st),wt=new Map,Ft=[],lt=Number.isFinite(M);for(let kt=0;kt<ot.length&&!(lt&&Ft.length>=M);kt++){const xt=ot[kt];let Lt={color:xt.pickedColor,layer:null,index:xt.pickedObjectIndex,picked:!0,x:l,y:d,pixelRatio:J};Lt=Qb({layer:xt.pickedLayer,info:Lt,mode:A});const Dt=Lt.layer.id;wt.has(Dt)||wt.set(Dt,new Set);const Pt=wt.get(Dt),Yt=Lt.object??Lt.index;Pt.has(Yt)||(Pt.add(Yt),Ft.push(Lt))}return Ft}async _drawAndSampleAsync({layers:e,views:t,viewports:s,onViewportActive:l,deviceRect:d,cullRect:g,effects:o,pass:A},M=!1){const I=M?this.depthFBO:this.pickingFBO,z={layers:e,layerFilter:this.layerFilter,views:t,viewports:s,onViewportActive:l,pickingFBO:I,deviceRect:d,cullRect:g,effects:o,pass:A,pickZ:M,preRenderStats:{},isPicking:!0};for(const Ue of o)Ue.useInPicking&&(z.preRenderStats[Ue.id]=Ue.preRender(z));const{decodePickingColor:W}=this.pickLayersPass.render(z),{x:J,y:oe,width:le,height:ne}=d,Ie=new(M?Float32Array:Uint8Array)(le*ne*4);return this.device.readPixelsToArrayWebGL(I,{sourceX:J,sourceY:oe,sourceWidth:le,sourceHeight:ne,target:Ie}),{pickedColors:Ie,decodePickingColor:W}}_drawAndSample({layers:e,views:t,viewports:s,onViewportActive:l,deviceRect:d,cullRect:g,effects:o,pass:A},M=!1){const I=M?this.depthFBO:this.pickingFBO,z={layers:e,layerFilter:this.layerFilter,views:t,viewports:s,onViewportActive:l,pickingFBO:I,deviceRect:d,cullRect:g,effects:o,pass:A,pickZ:M,preRenderStats:{},isPicking:!0};for(const Ue of o)Ue.useInPicking&&(z.preRenderStats[Ue.id]=Ue.preRender(z));const{decodePickingColor:W}=this.pickLayersPass.render(z),{x:J,y:oe,width:le,height:ne}=d,Ie=new(M?Float32Array:Uint8Array)(le*ne*4);return this.device.readPixelsToArrayWebGL(I,{sourceX:J,sourceY:oe,sourceWidth:le,sourceHeight:ne,target:Ie}),{pickedColors:Ie,decodePickingColor:W}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:s,deviceWidth:l,deviceHeight:d}){const g=Math.max(0,e-s),o=Math.max(0,t-s),A=Math.min(l,e+s+1)-g,M=Math.min(d,t+s+1)-o;return A<=0||M<=0?null:{x:g,y:o,width:A,height:M}}}const Zk={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Yk="top-left",aT="root";class Kk{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!pl(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const s=e.reduce((l,d)=>(l[d.id]=d,l),{});for(const l of this.getWidgets()){const{viewId:d}=l;if(d){const g=s[d];g&&(l.onViewportChange&&l.onViewportChange(g),l.onRedraw?.({viewports:[g],layers:t}))}else{if(l.onViewportChange)for(const g of e)l.onViewportChange(g);l.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=s,this._updateContainers()}onHover(e,t){for(const s of this.getWidgets()){const{viewId:l}=s;(!l||l===e.viewport?.id)&&s.onHover?.(e,t)}}onEvent(e,t){const s=Hb[t.type];if(s)for(const l of this.getWidgets()){const{viewId:d}=l;(!d||d===e.viewport?.id)&&l[s]?.(e,t)}}_setWidgets(e){const t={};for(const s of this.resolvedWidgets)t[s.id]=s;this.resolvedWidgets.length=0;for(const s of this.defaultWidgets)t[s.id]=null,this.resolvedWidgets.push(s);for(let s of e){const l=t[s.id];l?l.viewId!==s.viewId||l.placement!==s.placement?(this._removeWidget(l),this._addWidget(s)):s!==l&&(l.setProps(s.props),s=l):this._addWidget(s),t[s.id]=null,this.resolvedWidgets.push(s)}for(const s in t){const l=t[s];l&&this._removeWidget(l)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:s=Yk}=e,l=e.props._container??t;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(l,s).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){if(e&&typeof e!="string")return e;const s=e||aT;let l=this.containers[s];l||(l=document.createElement("div"),l.style.pointerEvents="none",l.style.position="absolute",l.style.overflow="hidden",this.parentElement?.append(l),this.containers[s]=l);let d=l.querySelector(`.${t}`);return d||(d=globalThis.document.createElement("div"),d.className=t,d.style.position="absolute",d.style.zIndex="2",Object.assign(d.style,Zk[t]),l.append(d)),d}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const s in this.containers){const l=this.lastViewports[s]||null,d=s===aT||l,g=this.containers[s];d?(g.style.display="block",g.style.left=`${l?l.x:0}px`,g.style.top=`${l?l.y:0}px`,g.style.width=`${l?l.width:e}px`,g.style.height=`${l?l.height:t}px`):g.style.display="none"}}}function oT(i,e){e&&Object.entries(e).map(([t,s])=>{t.startsWith("--")?i.style.setProperty(t,s):i.style[t]=s})}function Qk(i,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?i.style.removeProperty(t):i.style[t]=""})}class Zx{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,s=this.rootElement;s&&t.className!==e.className&&(t.className&&s.classList.remove(t.className),e.className&&s.classList.add(e.className)),s&&!pl(t.style,e.style,1)&&(Qk(s,t.style),oT(s,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(s=>typeof s=="string"&&s.length>0).forEach(s=>t.classList.add(s)),oT(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}Zx.defaultProps={id:"widget",style:{},_container:null,className:""};const Jk={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class hA extends Zx{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,Jk),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&!e.equals(this.lastViewport)&&this.setTooltip(null),this.lastViewport=e}onHover(e){const{deck:t}=this,s=t&&t.props.getTooltip;if(!s)return;const l=s(e);this.setTooltip(l,e.x,e.y)}setTooltip(e,t,s){const l=this.rootElement;if(l){if(typeof e=="string")l.innerText=e;else if(e)e.text&&(l.innerText=e.text),e.html&&(l.innerHTML=e.html),e.className&&(l.className=e.className);else{this.isVisible=!1,l.style.display="none";return}this.isVisible=!0,l.style.display="block",l.style.transform=`translate(${t}px, ${s}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(l.style,e.style)}}}hA.defaultProps={...Zx.defaultProps};const e4="modulepreload",t4=function(i){return"/geospatial-index-viz/"+i},lT={},cT=function(e,t,s){let l=Promise.resolve();if(t&&t.length>0){let M=function(I){return Promise.all(I.map(z=>Promise.resolve(z).then(W=>({status:"fulfilled",value:W}),W=>({status:"rejected",reason:W}))))};var g=M;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),A=o?.nonce||o?.getAttribute("nonce");l=M(t.map(I=>{if(I=t4(I),I in lT)return;lT[I]=!0;const z=I.endsWith(".css"),W=z?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${I}"]${W}`))return;const J=document.createElement("link");if(J.rel=z?"stylesheet":e4,z||(J.as="script"),J.crossOrigin="",J.href=I,A&&J.setAttribute("nonce",A),document.head.appendChild(J),z)return new Promise((oe,le)=>{J.addEventListener("load",oe),J.addEventListener("error",()=>le(new Error(`Unable to preload CSS for ${I}`)))})}))}function d(o){const A=new Event("vite:preloadError",{cancelable:!0});if(A.payload=o,window.dispatchEvent(A),!A.defaultPrevented)throw o}return l.then(o=>{for(const A of o||[])A.status==="rejected"&&d(A.reason);return e().catch(d)})};var zg;(function(i){i[i.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",i[i.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",i[i.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i[i.ZERO=0]="ZERO",i[i.ONE=1]="ONE",i[i.SRC_COLOR=768]="SRC_COLOR",i[i.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",i[i.SRC_ALPHA=770]="SRC_ALPHA",i[i.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",i[i.DST_ALPHA=772]="DST_ALPHA",i[i.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",i[i.DST_COLOR=774]="DST_COLOR",i[i.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",i[i.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",i[i.CONSTANT_COLOR=32769]="CONSTANT_COLOR",i[i.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",i[i.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",i[i.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",i[i.FUNC_ADD=32774]="FUNC_ADD",i[i.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",i[i.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",i[i.BLEND_EQUATION=32777]="BLEND_EQUATION",i[i.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",i[i.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",i[i.BLEND_DST_RGB=32968]="BLEND_DST_RGB",i[i.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",i[i.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",i[i.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",i[i.BLEND_COLOR=32773]="BLEND_COLOR",i[i.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",i[i.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",i[i.LINE_WIDTH=2849]="LINE_WIDTH",i[i.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",i[i.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",i[i.CULL_FACE_MODE=2885]="CULL_FACE_MODE",i[i.FRONT_FACE=2886]="FRONT_FACE",i[i.DEPTH_RANGE=2928]="DEPTH_RANGE",i[i.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",i[i.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",i[i.DEPTH_FUNC=2932]="DEPTH_FUNC",i[i.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",i[i.STENCIL_FUNC=2962]="STENCIL_FUNC",i[i.STENCIL_FAIL=2964]="STENCIL_FAIL",i[i.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",i[i.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",i[i.STENCIL_REF=2967]="STENCIL_REF",i[i.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",i[i.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",i[i.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",i[i.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",i[i.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",i[i.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",i[i.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",i[i.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",i[i.VIEWPORT=2978]="VIEWPORT",i[i.SCISSOR_BOX=3088]="SCISSOR_BOX",i[i.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",i[i.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",i[i.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",i[i.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",i[i.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",i[i.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",i[i.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",i[i.RED_BITS=3410]="RED_BITS",i[i.GREEN_BITS=3411]="GREEN_BITS",i[i.BLUE_BITS=3412]="BLUE_BITS",i[i.ALPHA_BITS=3413]="ALPHA_BITS",i[i.DEPTH_BITS=3414]="DEPTH_BITS",i[i.STENCIL_BITS=3415]="STENCIL_BITS",i[i.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",i[i.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",i[i.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",i[i.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",i[i.SAMPLES=32937]="SAMPLES",i[i.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",i[i.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",i[i.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",i[i.VENDOR=7936]="VENDOR",i[i.RENDERER=7937]="RENDERER",i[i.VERSION=7938]="VERSION",i[i.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",i[i.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",i[i.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",i[i.STATIC_DRAW=35044]="STATIC_DRAW",i[i.STREAM_DRAW=35040]="STREAM_DRAW",i[i.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.BUFFER_SIZE=34660]="BUFFER_SIZE",i[i.BUFFER_USAGE=34661]="BUFFER_USAGE",i[i.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",i[i.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",i[i.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",i[i.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",i[i.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",i[i.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",i[i.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",i[i.CULL_FACE=2884]="CULL_FACE",i[i.FRONT=1028]="FRONT",i[i.BACK=1029]="BACK",i[i.FRONT_AND_BACK=1032]="FRONT_AND_BACK",i[i.BLEND=3042]="BLEND",i[i.DEPTH_TEST=2929]="DEPTH_TEST",i[i.DITHER=3024]="DITHER",i[i.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",i[i.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",i[i.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",i[i.SCISSOR_TEST=3089]="SCISSOR_TEST",i[i.STENCIL_TEST=2960]="STENCIL_TEST",i[i.NO_ERROR=0]="NO_ERROR",i[i.INVALID_ENUM=1280]="INVALID_ENUM",i[i.INVALID_VALUE=1281]="INVALID_VALUE",i[i.INVALID_OPERATION=1282]="INVALID_OPERATION",i[i.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",i[i.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",i[i.CW=2304]="CW",i[i.CCW=2305]="CCW",i[i.DONT_CARE=4352]="DONT_CARE",i[i.FASTEST=4353]="FASTEST",i[i.NICEST=4354]="NICEST",i[i.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",i[i.BYTE=5120]="BYTE",i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.SHORT=5122]="SHORT",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.INT=5124]="INT",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.FLOAT=5126]="FLOAT",i[i.DOUBLE=5130]="DOUBLE",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.ALPHA=6406]="ALPHA",i[i.RGB=6407]="RGB",i[i.RGBA=6408]="RGBA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",i[i.VERTEX_SHADER=35633]="VERTEX_SHADER",i[i.COMPILE_STATUS=35713]="COMPILE_STATUS",i[i.DELETE_STATUS=35712]="DELETE_STATUS",i[i.LINK_STATUS=35714]="LINK_STATUS",i[i.VALIDATE_STATUS=35715]="VALIDATE_STATUS",i[i.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",i[i.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",i[i.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",i[i.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",i[i.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",i[i.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",i[i.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",i[i.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",i[i.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",i[i.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",i[i.SHADER_TYPE=35663]="SHADER_TYPE",i[i.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",i[i.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",i[i.NEVER=512]="NEVER",i[i.LESS=513]="LESS",i[i.EQUAL=514]="EQUAL",i[i.LEQUAL=515]="LEQUAL",i[i.GREATER=516]="GREATER",i[i.NOTEQUAL=517]="NOTEQUAL",i[i.GEQUAL=518]="GEQUAL",i[i.ALWAYS=519]="ALWAYS",i[i.KEEP=7680]="KEEP",i[i.REPLACE=7681]="REPLACE",i[i.INCR=7682]="INCR",i[i.DECR=7683]="DECR",i[i.INVERT=5386]="INVERT",i[i.INCR_WRAP=34055]="INCR_WRAP",i[i.DECR_WRAP=34056]="DECR_WRAP",i[i.NEAREST=9728]="NEAREST",i[i.LINEAR=9729]="LINEAR",i[i.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",i[i.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",i[i.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",i[i.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",i[i.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",i[i.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",i[i.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",i[i.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE=5890]="TEXTURE",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i[i.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",i[i.TEXTURE0=33984]="TEXTURE0",i[i.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",i[i.REPEAT=10497]="REPEAT",i[i.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i[i.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",i[i.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",i[i.FLOAT_VEC2=35664]="FLOAT_VEC2",i[i.FLOAT_VEC3=35665]="FLOAT_VEC3",i[i.FLOAT_VEC4=35666]="FLOAT_VEC4",i[i.INT_VEC2=35667]="INT_VEC2",i[i.INT_VEC3=35668]="INT_VEC3",i[i.INT_VEC4=35669]="INT_VEC4",i[i.BOOL=35670]="BOOL",i[i.BOOL_VEC2=35671]="BOOL_VEC2",i[i.BOOL_VEC3=35672]="BOOL_VEC3",i[i.BOOL_VEC4=35673]="BOOL_VEC4",i[i.FLOAT_MAT2=35674]="FLOAT_MAT2",i[i.FLOAT_MAT3=35675]="FLOAT_MAT3",i[i.FLOAT_MAT4=35676]="FLOAT_MAT4",i[i.SAMPLER_2D=35678]="SAMPLER_2D",i[i.SAMPLER_CUBE=35680]="SAMPLER_CUBE",i[i.LOW_FLOAT=36336]="LOW_FLOAT",i[i.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",i[i.HIGH_FLOAT=36338]="HIGH_FLOAT",i[i.LOW_INT=36339]="LOW_INT",i[i.MEDIUM_INT=36340]="MEDIUM_INT",i[i.HIGH_INT=36341]="HIGH_INT",i[i.FRAMEBUFFER=36160]="FRAMEBUFFER",i[i.RENDERBUFFER=36161]="RENDERBUFFER",i[i.RGBA4=32854]="RGBA4",i[i.RGB5_A1=32855]="RGB5_A1",i[i.RGB565=36194]="RGB565",i[i.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",i[i.STENCIL_INDEX=6401]="STENCIL_INDEX",i[i.STENCIL_INDEX8=36168]="STENCIL_INDEX8",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i[i.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",i[i.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",i[i.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",i[i.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",i[i.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",i[i.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",i[i.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",i[i.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",i[i.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",i[i.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",i[i.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",i[i.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",i[i.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",i[i.NONE=0]="NONE",i[i.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",i[i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",i[i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",i[i.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",i[i.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",i[i.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",i[i.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",i[i.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",i[i.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",i[i.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",i[i.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",i[i.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",i[i.READ_BUFFER=3074]="READ_BUFFER",i[i.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",i[i.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",i[i.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",i[i.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",i[i.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",i[i.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",i[i.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",i[i.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",i[i.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",i[i.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",i[i.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",i[i.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",i[i.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",i[i.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",i[i.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",i[i.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",i[i.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",i[i.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",i[i.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",i[i.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",i[i.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",i[i.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",i[i.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",i[i.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",i[i.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",i[i.RED=6403]="RED",i[i.RGB8=32849]="RGB8",i[i.RGBA8=32856]="RGBA8",i[i.RGB10_A2=32857]="RGB10_A2",i[i.TEXTURE_3D=32879]="TEXTURE_3D",i[i.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",i[i.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",i[i.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",i[i.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",i[i.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",i[i.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",i[i.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",i[i.SRGB=35904]="SRGB",i[i.SRGB8=35905]="SRGB8",i[i.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",i[i.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",i[i.RGBA32F=34836]="RGBA32F",i[i.RGB32F=34837]="RGB32F",i[i.RGBA16F=34842]="RGBA16F",i[i.RGB16F=34843]="RGB16F",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",i[i.R11F_G11F_B10F=35898]="R11F_G11F_B10F",i[i.RGB9_E5=35901]="RGB9_E5",i[i.RGBA32UI=36208]="RGBA32UI",i[i.RGB32UI=36209]="RGB32UI",i[i.RGBA16UI=36214]="RGBA16UI",i[i.RGB16UI=36215]="RGB16UI",i[i.RGBA8UI=36220]="RGBA8UI",i[i.RGB8UI=36221]="RGB8UI",i[i.RGBA32I=36226]="RGBA32I",i[i.RGB32I=36227]="RGB32I",i[i.RGBA16I=36232]="RGBA16I",i[i.RGB16I=36233]="RGB16I",i[i.RGBA8I=36238]="RGBA8I",i[i.RGB8I=36239]="RGB8I",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.R8=33321]="R8",i[i.RG8=33323]="RG8",i[i.R16F=33325]="R16F",i[i.R32F=33326]="R32F",i[i.RG16F=33327]="RG16F",i[i.RG32F=33328]="RG32F",i[i.R8I=33329]="R8I",i[i.R8UI=33330]="R8UI",i[i.R16I=33331]="R16I",i[i.R16UI=33332]="R16UI",i[i.R32I=33333]="R32I",i[i.R32UI=33334]="R32UI",i[i.RG8I=33335]="RG8I",i[i.RG8UI=33336]="RG8UI",i[i.RG16I=33337]="RG16I",i[i.RG16UI=33338]="RG16UI",i[i.RG32I=33339]="RG32I",i[i.RG32UI=33340]="RG32UI",i[i.R8_SNORM=36756]="R8_SNORM",i[i.RG8_SNORM=36757]="RG8_SNORM",i[i.RGB8_SNORM=36758]="RGB8_SNORM",i[i.RGBA8_SNORM=36759]="RGBA8_SNORM",i[i.RGB10_A2UI=36975]="RGB10_A2UI",i[i.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",i[i.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.HALF_FLOAT=5131]="HALF_FLOAT",i[i.RG=33319]="RG",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",i[i.CURRENT_QUERY=34917]="CURRENT_QUERY",i[i.QUERY_RESULT=34918]="QUERY_RESULT",i[i.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",i[i.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",i[i.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",i[i.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",i[i.DRAW_BUFFER0=34853]="DRAW_BUFFER0",i[i.DRAW_BUFFER1=34854]="DRAW_BUFFER1",i[i.DRAW_BUFFER2=34855]="DRAW_BUFFER2",i[i.DRAW_BUFFER3=34856]="DRAW_BUFFER3",i[i.DRAW_BUFFER4=34857]="DRAW_BUFFER4",i[i.DRAW_BUFFER5=34858]="DRAW_BUFFER5",i[i.DRAW_BUFFER6=34859]="DRAW_BUFFER6",i[i.DRAW_BUFFER7=34860]="DRAW_BUFFER7",i[i.DRAW_BUFFER8=34861]="DRAW_BUFFER8",i[i.DRAW_BUFFER9=34862]="DRAW_BUFFER9",i[i.DRAW_BUFFER10=34863]="DRAW_BUFFER10",i[i.DRAW_BUFFER11=34864]="DRAW_BUFFER11",i[i.DRAW_BUFFER12=34865]="DRAW_BUFFER12",i[i.DRAW_BUFFER13=34866]="DRAW_BUFFER13",i[i.DRAW_BUFFER14=34867]="DRAW_BUFFER14",i[i.DRAW_BUFFER15=34868]="DRAW_BUFFER15",i[i.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",i[i.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",i[i.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",i[i.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",i[i.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",i[i.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",i[i.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",i[i.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",i[i.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",i[i.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",i[i.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",i[i.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",i[i.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",i[i.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",i[i.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",i[i.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",i[i.SAMPLER_3D=35679]="SAMPLER_3D",i[i.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",i[i.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",i[i.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",i[i.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",i[i.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",i[i.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",i[i.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",i[i.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",i[i.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",i[i.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",i[i.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",i[i.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",i[i.MAX_SAMPLES=36183]="MAX_SAMPLES",i[i.SAMPLER_BINDING=35097]="SAMPLER_BINDING",i[i.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",i[i.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",i[i.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",i[i.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",i[i.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",i[i.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",i[i.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",i[i.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",i[i.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",i[i.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",i[i.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",i[i.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",i[i.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",i[i.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",i[i.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",i[i.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",i[i.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",i[i.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",i[i.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",i[i.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",i[i.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",i[i.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",i[i.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",i[i.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",i[i.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",i[i.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",i[i.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",i[i.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",i[i.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",i[i.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",i[i.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",i[i.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",i[i.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",i[i.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",i[i.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",i[i.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",i[i.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",i[i.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",i[i.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",i[i.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",i[i.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",i[i.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",i[i.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",i[i.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",i[i.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",i[i.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",i[i.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i[i.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",i[i.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",i[i.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",i[i.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",i[i.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",i[i.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",i[i.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",i[i.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",i[i.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",i[i.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",i[i.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",i[i.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",i[i.UNIFORM_TYPE=35383]="UNIFORM_TYPE",i[i.UNIFORM_SIZE=35384]="UNIFORM_SIZE",i[i.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",i[i.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",i[i.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",i[i.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",i[i.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",i[i.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",i[i.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",i[i.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",i[i.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",i[i.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",i[i.OBJECT_TYPE=37138]="OBJECT_TYPE",i[i.SYNC_CONDITION=37139]="SYNC_CONDITION",i[i.SYNC_STATUS=37140]="SYNC_STATUS",i[i.SYNC_FLAGS=37141]="SYNC_FLAGS",i[i.SYNC_FENCE=37142]="SYNC_FENCE",i[i.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",i[i.UNSIGNALED=37144]="UNSIGNALED",i[i.SIGNALED=37145]="SIGNALED",i[i.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",i[i.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",i[i.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",i[i.WAIT_FAILED=37149]="WAIT_FAILED",i[i.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",i[i.COLOR=6144]="COLOR",i[i.DEPTH=6145]="DEPTH",i[i.STENCIL=6146]="STENCIL",i[i.MIN=32775]="MIN",i[i.MAX=32776]="MAX",i[i.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",i[i.STREAM_READ=35041]="STREAM_READ",i[i.STREAM_COPY=35042]="STREAM_COPY",i[i.STATIC_READ=35045]="STATIC_READ",i[i.STATIC_COPY=35046]="STATIC_COPY",i[i.DYNAMIC_READ=35049]="DYNAMIC_READ",i[i.DYNAMIC_COPY=35050]="DYNAMIC_COPY",i[i.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",i[i.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",i[i.INVALID_INDEX=4294967295]="INVALID_INDEX",i[i.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",i[i.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",i[i.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",i[i.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",i[i.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",i[i.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",i[i.R16_EXT=33322]="R16_EXT",i[i.RG16_EXT=33324]="RG16_EXT",i[i.RGB16_EXT=32852]="RGB16_EXT",i[i.RGBA16_EXT=32859]="RGBA16_EXT",i[i.R16_SNORM_EXT=36760]="R16_SNORM_EXT",i[i.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",i[i.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",i[i.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",i[i.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",i[i.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",i[i.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",i[i.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",i[i.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",i[i.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",i[i.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",i[i.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",i[i.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",i[i.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",i[i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",i[i.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",i[i.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",i[i.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",i[i.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",i[i.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",i[i.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",i[i.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",i[i.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",i[i.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",i[i.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",i[i.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",i[i.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",i[i.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",i[i.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",i[i.LINE_WEBGL=6913]="LINE_WEBGL",i[i.FILL_WEBGL=6914]="FILL_WEBGL",i[i.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",i[i.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",i[i.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",i[i.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",i[i.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",i[i.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",i[i.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",i[i.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",i[i.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",i[i.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",i[i.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",i[i.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",i[i.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",i[i.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",i[i.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",i[i.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",i[i.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",i[i.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",i[i.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",i[i.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",i[i.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",i[i.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",i[i.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",i[i.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(zg||(zg={}));const i4={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},n4=i=>({drawBuffersWEBGL(e){return i.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),r4=i=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return i.createVertexArray()},deleteVertexArrayOES(e){return i.deleteVertexArray(e)},isVertexArrayOES(e){return i.isVertexArray(e)},bindVertexArrayOES(e){return i.bindVertexArray(e)}}),s4=i=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return i.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return i.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return i.vertexAttribDivisor(...e)}});function a4(i=!0){const e=HTMLCanvasElement.prototype;if(!i&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,s){if(t==="webgl"||t==="experimental-webgl"){const l=this.originalGetContext("webgl2",s);return l instanceof HTMLElement&&o4(l),l}return this.originalGetContext(t,s)}}function o4(i){i.getExtension("EXT_color_buffer_float");const e={...i4,WEBGL_disjoint_timer_query:i.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:n4(i),OES_vertex_array_object:r4(i),ANGLE_instanced_arrays:s4(i)},t=i.getExtension;i.getExtension=function(l){const d=t.call(i,l);return d||(l in e?e[l]:null)};const s=i.getSupportedExtensions;i.getSupportedExtensions=function(){return(s.apply(i)||[])?.concat(Object.keys(e))}}async function fA(i,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const s=document.createElement("script");return s.setAttribute("type","text/javascript"),s.setAttribute("src",i),new Promise((l,d)=>{s.onload=l,s.onerror=g=>d(new Error(`Unable to load script '${i}': ${g}`)),t.appendChild(s)})}const l4=1;let Mo=null,uT=!1;const Yx={debugSpectorJS:It.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function c4(i){if(!globalThis.SPECTOR)try{await fA(i.debugSpectorJSUrl||Yx.debugSpectorJSUrl)}catch(e){It.warn(String(e))}}function u4(i){if(i={...Yx,...i},!i.debugSpectorJS)return null;if(!Mo&&globalThis.SPECTOR&&!globalThis.luma?.spector){It.probe(l4,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;Mo=new e,globalThis.luma&&(globalThis.luma.spector=Mo)}if(!Mo)return null;if(uT||(uT=!0,Mo.spyCanvases(),Mo?.onCaptureStarted.add(e=>It.info("Spector capture started:",e)()),Mo?.onCapture.add(e=>{It.info("Spector capture complete:",e)(),Mo?.getResultUI(),Mo?.resultView.display(),Mo?.resultView.addCapture(e)})),i.gl){const e=i.gl,t=e.device;Mo?.startCapture(i.gl,500),e.device=t,new Promise(s=>setTimeout(s,2e3)).then(s=>{It.info("Spector capture stopped after 2 seconds")(),Mo?.stopCapture()})}return Mo}const h4="https://unpkg.com/webgl-debug@2.0.1/index.js";function dA(i){return i.luma=i.luma||{},i.luma}async function f4(){ip()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await fA(h4))}function d4(i,e={}){return e.debugWebGL||e.traceWebGL?g4(i,e):p4(i)}function p4(i){const e=dA(i);return e.realContext?e.realContext:i}function g4(i,e){if(!globalThis.WebGLDebugUtils)return It.warn("webgl-debug not loaded")(),i;const t=dA(i);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...zg,...i});const s=globalThis.WebGLDebugUtils.makeDebugContext(i,m4.bind(null,e),_4.bind(null,e));for(const g in zg)!(g in s)&&typeof zg[g]=="number"&&(s[g]=zg[g]);class l{}Object.setPrototypeOf(s,Object.getPrototypeOf(i)),Object.setPrototypeOf(l,s);const d=Object.create(l);return t.realContext=i,t.debugContext=d,d.debug=!0,d}function hT(i,e){e=Array.from(e).map(s=>s===void 0?"undefined":s);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${i}(${t})`}function m4(i,e,t,s){s=Array.from(s).map(o=>o===void 0?"undefined":o);const l=globalThis.WebGLDebugUtils.glEnumToString(e),d=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,s),g=`${l} in gl.${t}(${d})`;It.error(g)();debugger}function _4(i,e,t){let s="";It.level>=1&&(s=hT(e,t),i.traceWebGL&&It.log(1,s)());for(const l of t)if(l===void 0){s=s||hT(e,t);debugger}}const av=1;class y4 extends eP{type="webgl";constructor(){super(),Kd.defaultProps={...Kd.defaultProps,...Yx}}enforceWebGL2(e){a4(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&It.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:s}=await cT(async()=>{const{WebGLDevice:d}=await Promise.resolve().then(()=>CT);return{WebGLDevice:d}},void 0);if(e instanceof s)return e;if(e?.device instanceof s)return e.device;if(!v4(e))throw new Error("Invalid WebGL2RenderingContext");const l=t.createCanvasContext===!0?{}:t.createCanvasContext;return new s({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...l}})}async create(e={}){const{WebGLDevice:t}=await cT(async()=>{const{WebGLDevice:s}=await Promise.resolve().then(()=>CT);return{WebGLDevice:s}},void 0);It.groupCollapsed(av,"WebGLDevice created")();try{const s=[];(e.debugWebGL||e.debug)&&s.push(f4()),e.debugSpectorJS&&s.push(c4(e));const l=await Promise.allSettled(s);for(const o of l)o.status==="rejected"&&It.error(`Failed to initialize debug libraries ${o.reason}`)();const d=new t(e),g=`${d._reused?"Reusing":"Created"} device with WebGL2 ${d.props.debug?"debug ":""}context: ${d.info.vendor}, ${d.info.renderer} for canvas: ${d.canvasContext.id}`;return It.probe(av,g)(),It.table(av,d.info)(),d}finally{It.groupEnd(av)()}}}function v4(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}const db=new y4,Kx={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Br=(i,e,t)=>e?i.enable(t):i.disable(t),fT=(i,e,t)=>i.hint(t,e),Po=(i,e,t)=>i.pixelStorei(t,e),dT=(i,e,t)=>{const s=t===36006?36009:36008;return i.bindFramebuffer(s,e)},u_=(i,e,t)=>{const l={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];i.bindBuffer(l,e)};function pb(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}const b4={3042:Br,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:Br,2885:(i,e)=>i.cullFace(e),2929:Br,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:Br,35723:fT,35725:(i,e)=>i.useProgram(e),36007:(i,e)=>i.bindRenderbuffer(36161,e),36389:(i,e)=>i.bindTransformFeedback?.(36386,e),34229:(i,e)=>i.bindVertexArray(e),36006:dT,36010:dT,34964:u_,36662:u_,36663:u_,35053:u_,35055:u_,2886:(i,e)=>i.frontFace(e),33170:fT,2849:(i,e)=>i.lineWidth(e),32823:Br,32824:"polygonOffset",10752:"polygonOffset",35977:Br,32926:Br,32928:Br,32938:"sampleCoverage",32939:"sampleCoverage",3089:Br,3088:(i,e)=>i.scissor(...e),2960:Br,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),34383:Br,10754:Br,12288:Br,12289:Br,12290:Br,12291:Br,12292:Br,12293:Br,12294:Br,12295:Br,3333:Po,3317:Po,37440:Po,37441:Po,37443:Po,3330:Po,3332:Po,3331:Po,3314:Po,32878:Po,3316:Po,3315:Po,32877:Po,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{const t=typeof e=="number"?[e,e]:e;i.blendEquationSeparate(...t)},blendFunc:(i,e)=>{const t=e?.length===2?[...e,...e]:e;i.blendFuncSeparate(...t)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(e[0],e[1]||!1),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=pb(e)?e:[e,e];const[t,s]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,s)},stencilFunc:(i,e)=>{e=pb(e)&&e.length===3?[...e,...e]:e;const[t,s,l,d,g,o]=e;i.stencilFuncSeparate(1028,t,s,l),i.stencilFuncSeparate(1029,d,g,o)},stencilOp:(i,e)=>{e=pb(e)&&e.length===3?[...e,...e]:e;const[t,s,l,d,g,o]=e;i.stencilOpSeparate(1028,t,s,l),i.stencilOpSeparate(1029,d,g,o)},viewport:(i,e)=>i.viewport(...e)};function xr(i,e,t){return e[i]!==void 0?e[i]:t[i]}const x4={blendEquation:(i,e,t)=>i.blendEquationSeparate(xr(32777,e,t),xr(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(xr(32969,e,t),xr(32968,e,t),xr(32971,e,t),xr(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(xr(32824,e,t),xr(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(xr(32938,e,t),xr(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,xr(2962,e,t),xr(2967,e,t),xr(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,xr(34816,e,t),xr(36003,e,t),xr(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,xr(2964,e,t),xr(2965,e,t),xr(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,xr(34817,e,t),xr(34818,e,t),xr(34819,e,t))},pT={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),useProgram:(i,e)=>i({35725:e}),bindRenderbuffer:(i,e,t)=>i({36007:t}),bindTransformFeedback:(i,e,t)=>i({36389:t}),bindVertexArray:(i,e)=>i({34229:e}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},bindBuffer:(i,e,t)=>{const s={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return s?i({[s]:t}):{valueChanged:!0}},blendColor:(i,e,t,s,l)=>i({32773:new Float32Array([e,t,s,l])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,s,l)=>i({32969:e,32968:t,32971:s,32970:l}),clearColor:(i,e,t,s,l)=>i({3106:new Float32Array([e,t,s,l])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,s,l)=>i({3107:[e,t,s,l]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,s,l)=>i({3088:new Int32Array([e,t,s,l])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,s)=>i({2962:e,2967:t,2963:s,34816:e,36003:t,36004:s}),stencilFuncSeparate:(i,e,t,s,l)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:s,[e===1028?2963:36004]:l}),stencilOp:(i,e,t,s)=>i({2964:e,2965:t,2966:s,34817:e,34818:t,34819:s}),stencilOpSeparate:(i,e,t,s,l)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:s,[e===1028?2966:34819]:l}),viewport:(i,e,t,s,l)=>i({2978:[e,t,s,l]})},ou=(i,e)=>i.isEnabled(e),gT={3042:ou,2884:ou,2929:ou,3024:ou,32823:ou,32926:ou,32928:ou,3089:ou,2960:ou,35977:ou},w4=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function rm(i,e){if(S4(e))return;const t={};for(const l in e){const d=Number(l),g=b4[l];g&&(typeof g=="string"?t[g]=!0:g(i,e[l],d))}const s=i.state&&i.state.cache;if(s)for(const l in t){const d=x4[l];d(i,e,s)}}function pA(i,e=Kx){if(typeof e=="number"){const l=e,d=gT[l];return d?d(i,l):i.getParameter(l)}const t=Array.isArray(e)?e:Object.keys(e),s={};for(const l of t){const d=gT[l];s[l]=d?d(i,Number(l)):i.getParameter(Number(l))}return s}function T4(i){rm(i,Kx)}function S4(i){for(const e in i)return!1;return!0}function A4(i,e){if(i===e)return!0;if(mT(i)&&mT(e)&&i.length===e.length){for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}return!1}function mT(i){return Array.isArray(i)||ArrayBuffer.isView(i)}class Zd{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];rm(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?pA(e):Object.assign({},Kx),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,C4(e);for(const s in pT){const l=pT[s];E4(e,s,l)}_T(e,"getParameter"),_T(e,"isEnabled")}_updateCache(e){let t=!1,s;const l=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const d in e){const g=e[d],o=this.cache[d];A4(g,o)||(t=!0,s=o,l&&!(d in l)&&(l[d]=o),this.cache[d]=g)}return{valueChanged:t,oldValue:s}}}function _T(i,e){const t=i[e].bind(i);i[e]=function(l){if(l===void 0||w4.has(l))return t(l);const d=Zd.get(i);return l in d.cache||(d.cache[l]=t(l)),d.enable?d.cache[l]:t(l)},Object.defineProperty(i[e],"name",{value:`${e}-from-cache`,configurable:!1})}function E4(i,e,t){if(!i[e])return;const s=i[e].bind(i);i[e]=function(...d){const g=Zd.get(i),{valueChanged:o,oldValue:A}=t(g._updateCache,...d);return o&&s(...d),A},Object.defineProperty(i[e],"name",{value:`${e}-to-cache`,configurable:!1})}function C4(i){const e=i.useProgram.bind(i);i.useProgram=function(s){const l=Zd.get(i);l.program!==s&&(e(s),l.program=s)}}function M4(i,e,t){let s="";const l={preserveDrawingBuffer:!0,...t};let d=null;if(d||=i.getContext("webgl2",l),l.failIfMajorPerformanceCaveat&&(s||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!d&&!t.failIfMajorPerformanceCaveat&&(l.failIfMajorPerformanceCaveat=!1,d=i.getContext("webgl2",l),d.luma||={},d.luma.softwareRenderer=!0),d||(d=i.getContext("webgl",{}),d&&(d=null,s||="Your browser only supports WebGL1")),!d)throw s||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${s}`);const{onContextLost:g,onContextRestored:o}=e;return i.addEventListener("webglcontextlost",A=>g(A),!1),i.addEventListener("webglcontextrestored",A=>o(A),!1),d.luma||={},d}function tm(i,e,t){return t[e]===void 0&&(t[e]=i.getExtension(e)||null),t[e]}function P4(i,e){const t=i.getParameter(7936),s=i.getParameter(7937);tm(i,"WEBGL_debug_renderer_info",e);const l=e.WEBGL_debug_renderer_info,d=i.getParameter(l?l.UNMASKED_VENDOR_WEBGL:7936),g=i.getParameter(l?l.UNMASKED_RENDERER_WEBGL:7937),o=d||t,A=g||s,M=i.getParameter(7938),I=gA(o,A),z=I4(o,A),W=R4(o,A);return{type:"webgl",gpu:I,gpuType:W,gpuBackend:z,vendor:o,renderer:A,version:M,shadingLanguage:"glsl",shadingLanguageVersion:300}}function gA(i,e){return/NVIDIA/i.exec(i)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(i)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(i)||/Apple/i.exec(e)?"apple":/AMD/i.exec(i)||/AMD/i.exec(e)||/ATI/i.exec(i)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e)?"software":"unknown"}function I4(i,e){return/Metal/i.exec(i)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(i)||/ANGLE/i.exec(e)?"opengl":"unknown"}function R4(i,e){if(/SwiftShader/i.exec(i)||/SwiftShader/i.exec(e))return"cpu";switch(gA(i,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function mA(i){switch(i){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(i))}const m_="WEBGL_compressed_texture_s3tc",__="WEBGL_compressed_texture_s3tc_srgb",Fg="EXT_texture_compression_rgtc",Ng="EXT_texture_compression_bptc",D4="WEBGL_compressed_texture_etc",O4="WEBGL_compressed_texture_astc",k4="WEBGL_compressed_texture_etc1",L4="WEBGL_compressed_texture_pvrtc",B4="WEBGL_compressed_texture_atc",yT="EXT_texture_norm16",vT="EXT_render_snorm",z4="EXT_color_buffer_float",Qx={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[vT],"norm16-renderable-webgl":[yT],"snorm16-renderable-webgl":[yT,vT],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[m_,__,Fg,Ng],"texture-compression-bc5-webgl":[Fg],"texture-compression-bc7-webgl":[Ng],"texture-compression-etc2":[D4],"texture-compression-astc":[O4],"texture-compression-etc1-webgl":[k4],"texture-compression-pvrtc-webgl":[L4],"texture-compression-atc-webgl":[B4]};function F4(i){return i in Qx}function N4(i,e,t){return(Qx[e]||[]).every(l=>tm(i,l,t))}const Jx={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:z4,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:m_},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:__},"bc1-rgba-unorm":{gl:33777,x:m_},"bc1-rgba-unorm-srgb":{gl:35916,x:__},"bc2-rgba-unorm":{gl:33778,x:m_},"bc2-rgba-unorm-srgb":{gl:35918,x:__},"bc3-rgba-unorm":{gl:33779,x:m_},"bc3-rgba-unorm-srgb":{gl:35919,x:__},"bc4-r-unorm":{gl:36283,x:Fg},"bc4-r-snorm":{gl:36284,x:Fg},"bc5-rg-unorm":{gl:36285,x:Fg},"bc5-rg-snorm":{gl:36286,x:Fg},"bc6h-rgb-ufloat":{gl:36495,x:Ng},"bc6h-rgb-float":{gl:36494,x:Ng},"bc7-rgba-unorm":{gl:36492,x:Ng},"bc7-rgba-unorm-srgb":{gl:36493,x:Ng},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function U4(i,e,t){let s=e.create;const l=Jx[e.format];return l?.gl===void 0&&(s=!1),l?.x&&(s=s&&!!tm(i,l.x,t)),{format:e.format,create:s&&e.create,render:s&&e.render,filter:s&&e.filter,blend:s&&e.blend,store:s&&e.store}}function _A(i){const e=Jx[i],t=$4(i),s=Vg.getInfo(i);return s.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||j4(s.channels,s.integer,s.normalized,t),type:s.dataType?mA(s.dataType):e?.types?.[0]||5121,compressed:s.compressed||!1}}function V4(i){switch(Vg.getInfo(i).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${i}`)}}function j4(i,e,t,s){if(s===6408||s===6407)return s;switch(i){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function $4(i){const t=Jx[i]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${i}`);return t}const bT={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class H4 extends QM{gl;extensions;testedFeatures=new Set;constructor(e,t,s){super([],s),this.gl=e,this.extensions=t,tm(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),F4(e)&&N4(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(bT),...Object.keys(Qx)]}getWebGLFeature(e){const t=bT[e];return typeof t=="string"?!!tm(this.gl,t,this.extensions):!!t}}class W4 extends KM{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class S_ extends n0{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const s=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const s=this.colorAttachments[t];if(s){const l=36064+t;this._attachTextureView(l,s)}}if(this.depthStencilAttachment){const t=V4(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${X4(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:s}=this.device,{texture:l}=t,d=t.props.baseMipLevel,g=t.props.baseArrayLayer;switch(s.bindTexture(l.glTarget,l.handle),l.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,e,l.handle,d,g);break;case 34067:const o=q4(g);s.framebufferTexture2D(36160,e,o,l.handle,d);break;case 3553:s.framebufferTexture2D(36160,e,3553,l.handle,d);break;default:throw new Error("Illegal texture type")}s.bindTexture(l.glTarget,null)}}function q4(i){return i<34069?i+34069:i}function X4(i){switch(i){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${i}`}}class G4 extends Hd{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new S_(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const gb={};function Z4(i="id"){gb[i]=gb[i]||1;const e=gb[i]++;return`${i}-${e}`}class A_ extends $n{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const s=typeof t=="object"?t.handle:void 0;this.handle=s||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=Y4(this.props.usage),this.glUsage=K4(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,s=e.byteLength+t){const l=this.glTarget;this.gl.bindBuffer(l,this.handle),this.gl.bufferData(l,s,this.glUsage),this.gl.bufferSubData(l,t,e),this.gl.bindBuffer(l,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(e,t,s),this.trackAllocatedMemory(s)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,t,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const s=ArrayBuffer.isView(e)?e:new Uint8Array(e),l=36663;this.gl.bindBuffer(l,this.handle),this.gl.bufferSubData(l,t,s),this.gl.bindBuffer(l,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,s=this.byteLength-t){const l=new ArrayBuffer(s);await e(l,"copied"),this.write(l,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,s){const l=await this.readAsync(t,s);return await e(l.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const s=new Uint8Array(t),l=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,s,l,t),this.gl.bindBuffer(36662,null),this._setDebugData(s,e,t),s}}function Y4(i){return i&$n.INDEX?34963:i&$n.VERTEX?34962:i&$n.UNIFORM?35345:34962}function K4(i){return i&$n.INDEX||i&$n.VERTEX?35044:i&$n.UNIFORM?35048:35044}function Q4(i){const e=i.split(/\r?\n/),t=[];for(const s of e){if(s.length<=1)continue;const l=s.split(":");if(l.length===2){const[z,W]=l;t.push({message:W.trim(),type:xT(z),lineNum:0,linePos:0});continue}const[d,g,o,...A]=l;let M=parseInt(o,10);isNaN(M)&&(M=0);let I=parseInt(g,10);isNaN(I)&&(I=0),t.push({message:A.join(":").trim(),type:xT(d),lineNum:M,linePos:I})}return t}function xT(i){const e=["warning","error","info"],t=i.toLowerCase();return e.includes(t)?t:"info"}class J4 extends i0{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Q4(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}It.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),It.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async l=>await new Promise(d=>setTimeout(d,l));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function eL(i,e,t,s){if(rL(e))return s(i);const l=i;l.pushState();try{return tL(i,e),rm(l.gl,t),s(i)}finally{l.popState()}}function tL(i,e){const t=i,{gl:s}=t;if(e.cullMode)switch(e.cullMode){case"none":s.disable(2884);break;case"front":s.enable(2884),s.cullFace(1028);break;case"back":s.enable(2884),s.cullFace(1029);break}if(e.frontFace&&s.frontFace(Yd("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&i.features.has("depth-clip-control")&&s.enable(34383),e.depthBias!==void 0&&(s.enable(32823),s.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&i.features.has("provoking-vertex-webgl")){const d=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,g=Yd("provokingVertex",e.provokingVertex,{first:36429,last:36430});d?.provokingVertexWEBGL(g)}if((e.polygonMode||e.polygonOffsetLine)&&i.features.has("polygon-mode-webgl")){if(e.polygonMode){const d=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,g=Yd("polygonMode",e.polygonMode,{fill:6914,line:6913});d?.polygonModeWEBGL(1028,g),d?.polygonModeWEBGL(1029,g)}e.polygonOffsetLine&&s.enable(10754)}if(i.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&s.enable(12288),e.clipDistance1&&s.enable(12289),e.clipDistance2&&s.enable(12290),e.clipDistance3&&s.enable(12291),e.clipDistance4&&s.enable(12292),e.clipDistance5&&s.enable(12293),e.clipDistance6&&s.enable(12294),e.clipDistance7&&s.enable(12295)),e.depthWriteEnabled!==void 0&&s.depthMask(nL("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?s.enable(2929):s.disable(2929),s.depthFunc(Jb("depthCompare",e.depthCompare))),e.stencilWriteMask){const l=e.stencilWriteMask;s.stencilMaskSeparate(1028,l),s.stencilMaskSeparate(1029,l)}if(e.stencilReadMask&&It.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const l=e.stencilReadMask||4294967295,d=Jb("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?s.enable(2960):s.disable(2960),s.stencilFuncSeparate(1028,d,0,l),s.stencilFuncSeparate(1029,d,0,l)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const l=mb("stencilPassOperation",e.stencilPassOperation),d=mb("stencilFailOperation",e.stencilFailOperation),g=mb("stencilDepthFailOperation",e.stencilDepthFailOperation);s.stencilOpSeparate(1028,d,g,l),s.stencilOpSeparate(1029,d,g,l)}switch(e.blend){case!0:s.enable(3042);break;case!1:s.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const l=wT("blendColorOperation",e.blendColorOperation||"add"),d=wT("blendAlphaOperation",e.blendAlphaOperation||"add");s.blendEquationSeparate(l,d);const g=ov("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=ov("blendColorDstFactor",e.blendColorDstFactor||"zero"),A=ov("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),M=ov("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");s.blendFuncSeparate(g,o,A,M)}}function Jb(i,e){return Yd(i,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function mb(i,e){return Yd(i,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function wT(i,e){return Yd(i,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ov(i,e,t="color"){return Yd(i,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function iL(i,e){return`Illegal parameter ${e} for ${i}`}function Yd(i,e,t){if(!(e in t))throw new Error(iL(i,e));return t[e]}function nL(i,e){return e}function rL(i){let e=!0;for(const t in i){e=!1;break}return e}function yA(i){const e={};return i.addressModeU&&(e[10242]=_b(i.addressModeU)),i.addressModeV&&(e[10243]=_b(i.addressModeV)),i.addressModeW&&(e[32882]=_b(i.addressModeW)),i.magFilter&&(e[10240]=ex(i.magFilter)),(i.minFilter||i.mipmapFilter)&&(e[10241]=sL(i.minFilter||"linear",i.mipmapFilter)),i.lodMinClamp!==void 0&&(e[33082]=i.lodMinClamp),i.lodMaxClamp!==void 0&&(e[33083]=i.lodMaxClamp),i.type==="comparison-sampler"&&(e[34892]=34894),i.compare&&(e[34893]=Jb("compare",i.compare)),i.maxAnisotropy&&(e[34046]=i.maxAnisotropy),e}function _b(i){switch(i){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function ex(i){switch(i){case"nearest":return 9728;case"linear":return 9729}}function sL(i,e="none"){if(!e)return ex(i);switch(e){case"none":return ex(i);case"nearest":switch(i){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(i){case"nearest":return 9986;case"linear":return 9987}}}class aL extends Qd{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=yA(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,s]of Object.entries(e)){const l=Number(t);switch(l){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,l,s);break;default:this.device.gl.samplerParameteri(this.handle,l,s);break}}}}function D_(i,e,t){if(oL(e))return t(i);const{nocatch:s=!0}=e,l=Zd.get(i);l.push(),rm(i,e);let d;if(s)d=t(i),l.pop();else try{d=t(i)}finally{l.pop()}return d}function oL(i){for(const e in i)return!1;return!0}class Ug extends t0{device;gl;handle;texture;constructor(e,t){super(e,{...Kr.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class E_ extends Kr{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const s=_A(this.props.format);this.glTarget=lL(this.props.dimension),this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:l,width:d,height:g,depth:o,mipLevels:A,glTarget:M,glInternalFormat:I}=this;switch(l){case"2d":case"cube":this.gl.texStorage2D(M,A,I,d,g);break;case"2d-array":case"3d":this.gl.texStorage3D(M,A,I,d,g,o);break;default:throw new Error(l)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new Ug(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Ug(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=yA(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),s=t.data,{width:l,height:d,depth:g}=this,{mipLevel:o=0,byteOffset:A=0,x:M=0,y:I=0,z=0}=t,{glFormat:W,glType:J,compressed:oe}=this,le=TT(this.glTarget,this.dimension,z);let ne;if(!this.compressed){const{bytesPerPixel:Ue}=this.device.getTextureFormatInfo(this.format);if(Ue){if(t.bytesPerRow%Ue!==0)throw new Error(`bytesPerRow (${t.bytesPerRow}) must be a multiple of bytesPerPixel (${Ue}) for ${this.format}`);ne=t.bytesPerRow/Ue}}const Ie=this.compressed?{}:{...ne!==void 0?{3314:ne}:{},32878:t.rowsPerImage};this.gl.bindTexture(le,this.handle),D_(this.gl,Ie,()=>{switch(this.dimension){case"2d":case"cube":oe?this.gl.compressedTexSubImage2D(le,o,M,I,l,d,W,s,A):this.gl.texSubImage2D(le,o,M,I,l,d,W,J,s,A);break;case"2d-array":case"3d":oe?this.gl.compressedTexSubImage3D(le,o,M,I,z,l,d,g,W,s,A):this.gl.texSubImage3D(le,o,M,I,z,l,d,g,W,J,s,A);break;default:}}),this.gl.bindTexture(le,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:s,glType:l}=this,{image:d,depth:g,mipLevel:o,x:A,y:M,z:I,width:z,height:W}=t,J=TT(this.glTarget,this.dimension,g),oe=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),D_(this.gl,oe,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(J,o,A,M,z,W,s,l,d);break;case"2d-array":case"3d":this.gl.texSubImage3D(J,o,A,M,I,z,W,g,s,l,d);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(It.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){It.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){It.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,s]of Object.entries(e)){const l=Number(t),d=s;switch(l){case 33082:case 33083:this.gl.texParameterf(this.glTarget,l,d);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,l,d);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,l,d);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,l,d);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,l,d);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function lL(i){switch(i){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(i)}function TT(i,e,t){return e==="cube"?34069+t:i}function cL(i){return dL[i]}function e1(i){return fL[i]}function uL(i){return!!vA[i]}function hL(i){return vA[i]}const fL={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},vA={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},dL={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function pL(i,e){const t={attributes:[],bindings:[]};t.attributes=gL(i,e);const s=yL(i,e);for(const o of s){const A=o.uniforms.map(M=>({name:M.name,format:M.format,byteOffset:M.byteOffset,byteStride:M.byteStride,arrayLength:M.arrayLength}));t.bindings.push({type:"uniform",name:o.name,group:0,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:A})}const l=_L(i,e);let d=0;for(const o of l)if(uL(o.type)){const{viewDimension:A,sampleType:M}=hL(o.type);t.bindings.push({type:"texture",name:o.name,group:0,location:d,viewDimension:A,sampleType:M}),o.textureUnit=d,d+=1}l.length&&(t.uniforms=l);const g=mL(i,e);return g?.length&&(t.varyings=g),t}function gL(i,e){const t=[],s=i.getProgramParameter(e,35721);for(let l=0;l<s;l++){const d=i.getActiveAttrib(e,l);if(!d)throw new Error("activeInfo");const{name:g,type:o}=d,A=i.getAttribLocation(e,g);if(A>=0){const M=e1(o),I=/instance/i.test(g)?"instance":"vertex";t.push({name:g,location:A,stepMode:I,type:M})}}return t.sort((l,d)=>l.location-d.location),t}function mL(i,e){const t=[],s=i.getProgramParameter(e,35971);for(let l=0;l<s;l++){const d=i.getTransformFeedbackVarying(e,l);if(!d)throw new Error("activeInfo");const{name:g,type:o,size:A}=d,M=e1(o),{type:I,components:z}=aS(M);t.push({location:l,name:g,type:I,size:A*z})}return t.sort((l,d)=>l.location-d.location),t}function _L(i,e){const t=[],s=i.getProgramParameter(e,35718);for(let l=0;l<s;l++){const d=i.getActiveUniform(e,l);if(!d)throw new Error("activeInfo");const{name:g,size:o,type:A}=d,{name:M,isArray:I}=vL(g);let z=i.getUniformLocation(e,M);const W={location:z,name:M,size:o,type:A,isArray:I};if(t.push(W),W.size>1)for(let J=0;J<W.size;J++){const oe=`${M}[${J}]`;z=i.getUniformLocation(e,oe);const le={...W,name:oe,location:z};t.push(le)}}return t}function yL(i,e){const t=(d,g)=>i.getActiveUniformBlockParameter(e,d,g),s=[],l=i.getProgramParameter(e,35382);for(let d=0;d<l;d++){const g={name:i.getActiveUniformBlockName(e,d)||"",location:t(d,35391),byteLength:t(d,35392),vertex:t(d,35396),fragment:t(d,35398),uniformCount:t(d,35394),uniforms:[]},o=t(d,35395)||[],A=i.getActiveUniforms(e,o,35383),M=i.getActiveUniforms(e,o,35384),I=i.getActiveUniforms(e,o,35387),z=i.getActiveUniforms(e,o,35388);for(let W=0;W<g.uniformCount;++W){const J=i.getActiveUniform(e,o[W]);if(!J)throw new Error("activeInfo");const oe=e1(A[W]);g.uniforms.push({name:J.name,format:oe,type:A[W],arrayLength:M[W],byteOffset:I[W],byteStride:z[W]})}s.push(g)}return s.sort((d,g)=>d.location-g.location),s}function vL(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(i);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${i}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function bL(i,e,t,s){const l=i;let d=s;d===!0&&(d=1),d===!1&&(d=0);const g=typeof d=="number"?[d]:d;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof s!="number")throw new Error("samplers must be set to integers");return i.uniform1i(e,s);case 5126:return i.uniform1fv(e,g);case 35664:return i.uniform2fv(e,g);case 35665:return i.uniform3fv(e,g);case 35666:return i.uniform4fv(e,g);case 5124:return i.uniform1iv(e,g);case 35667:return i.uniform2iv(e,g);case 35668:return i.uniform3iv(e,g);case 35669:return i.uniform4iv(e,g);case 35670:return i.uniform1iv(e,g);case 35671:return i.uniform2iv(e,g);case 35672:return i.uniform3iv(e,g);case 35673:return i.uniform4iv(e,g);case 5125:return l.uniform1uiv(e,g,1);case 36294:return l.uniform2uiv(e,g,2);case 36295:return l.uniform3uiv(e,g,3);case 36296:return l.uniform4uiv(e,g,4);case 35674:return i.uniformMatrix2fv(e,!1,g);case 35675:return i.uniformMatrix3fv(e,!1,g);case 35676:return i.uniformMatrix4fv(e,!1,g);case 35685:return l.uniformMatrix2x3fv(e,!1,g);case 35686:return l.uniformMatrix2x4fv(e,!1,g);case 35687:return l.uniformMatrix3x2fv(e,!1,g);case 35688:return l.uniformMatrix3x4fv(e,!1,g);case 35689:return l.uniformMatrix4x2fv(e,!1,g);case 35690:return l.uniformMatrix4x3fv(e,!1,g)}throw new Error("Illegal uniform")}function xL(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(i)}}function wL(i){switch(i){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(i)}}const ST=4;class TL extends Xd{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:s,bufferMode:l=35981}=t;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,l)),this._linkShaders(),It.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=pL(this.device.gl,this.handle),It.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?SL(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[s,l]of Object.entries(e)){const d=this.shaderLayout.bindings.find(g=>g.name===s)||this.shaderLayout.bindings.find(g=>g.name===`${s}Uniforms`);if(!d){const g=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");t?.disableWarnings||It.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${g}`,l)();continue}switch(l||It.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),d.type){case"uniform":if(!(l instanceof A_)&&!(l.buffer instanceof A_))throw new Error("buffer value");break;case"texture":if(!(l instanceof Ug||l instanceof E_||l instanceof S_))throw new Error(`${this} Bad texture binding for ${s}`);break;case"sampler":It.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(d.type)}this.bindings[s]=l}}draw(e){const{renderPass:t,parameters:s=this.props.parameters,topology:l=this.props.topology,vertexArray:d,vertexCount:g,instanceCount:o,isInstanced:A=!1,firstVertex:M=0,transformFeedback:I}=e,z=xL(l),W=!!d.indexBuffer,J=d.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return It.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return It.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),d.bindBeforeRender(t),I&&I.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const oe=t;return eL(this.device,s,oe.glParameters,()=>{W&&A?this.device.gl.drawElementsInstanced(z,g||0,J,M,o||0):W?this.device.gl.drawElements(z,g||0,J,M):A?this.device.gl.drawArraysInstanced(z,M,g||0,o||0):this.device.gl.drawArrays(z,M,g||0),I&&I.end()}),d.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),It.time(ST,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),It.timeEnd(ST,`linkProgram for ${this.id}`)(),It.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}It.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),It.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const s=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${s}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async l=>await new Promise(d=>setTimeout(d,l));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(It.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,s=0;for(const l of this.shaderLayout.bindings){const d=this.bindings[l.name]||this.bindings[l.name.replace(/Uniforms$/,"")];if(!d)throw new Error(`No value for binding ${l.name} in ${this.id}`);switch(l.type){case"uniform":const{name:g}=l,o=e.getUniformBlockIndex(this.handle,g);if(o===4294967295)throw new Error(`Invalid uniform block name ${g}`);e.uniformBlockBinding(this.handle,s,o),d instanceof A_?e.bindBufferBase(35345,s,d.handle):e.bindBufferRange(35345,s,d.buffer.handle,d.offset||0,d.size||d.buffer.byteLength-d.offset),s+=1;break;case"texture":if(!(d instanceof Ug||d instanceof E_||d instanceof S_))throw new Error("texture");let A;if(d instanceof Ug)A=d.texture;else if(d instanceof E_)A=d;else if(d instanceof S_&&d.colorAttachments[0]instanceof Ug)It.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),A=d.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(A.glTarget,A.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${l.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:s,type:l,textureUnit:d}=e,g=this.uniforms[t]??d;g!==void 0&&bL(this.device.gl,s,l,g)}}}function SL(i,e){const t={...i,attributes:i.attributes.map(s=>({...s}))};for(const s of e?.attributes||[]){const l=t.attributes.find(d=>d.name===s.name);l?(l.type=s.type||l.type,l.stepMode=s.stepMode||l.stepMode):It.warn(`shader layout attribute ${s.name} not present in shader`)}return t}class AL extends Ex{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":EL(this.device,t.options);break;case"copy-buffer-to-texture":CL(this.device,t.options);break;case"copy-texture-to-buffer":ML(this.device,t.options);break;case"copy-texture-to-texture":PL(this.device,t.options);break;default:throw new Error(t.name)}}}function EL(i,e){const t=e.sourceBuffer,s=e.destinationBuffer;i.gl.bindBuffer(36662,t.handle),i.gl.bindBuffer(36663,s.handle),i.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),i.gl.bindBuffer(36662,null),i.gl.bindBuffer(36663,null)}function CL(i,e){throw new Error("Not implemented")}function ML(i,e){const{sourceTexture:t,mipLevel:s=0,aspect:l="all",width:d=e.sourceTexture.width,height:g=e.sourceTexture.height,depthOrArrayLayers:o=0,origin:A=[0,0],destinationBuffer:M,byteOffset:I=0,bytesPerRow:z,rowsPerImage:W}=e;if(l!=="all")throw new Error("aspect not supported in WebGL");if(s!==0||o!==0||z||W)throw new Error("not implemented");const{framebuffer:J,destroyFramebuffer:oe}=bA(t);let le;try{const ne=M,Ie=d||J.width,Ue=g||J.height,Se=_A(J.colorAttachments[0].texture.props.format),Ve=Se.format,st=Se.type;i.gl.bindBuffer(35051,ne.handle),le=i.gl.bindFramebuffer(36160,J.handle),i.gl.readPixels(A[0],A[1],Ie,Ue,Ve,st,I)}finally{i.gl.bindBuffer(35051,null),le!==void 0&&i.gl.bindFramebuffer(36160,le),oe&&J.destroy()}}function PL(i,e){const{sourceTexture:t,destinationMipLevel:s=0,origin:l=[0,0],destinationOrigin:d=[0,0],destinationTexture:g}=e;let{width:o=e.destinationTexture.width,height:A=e.destinationTexture.height}=e;const{framebuffer:M,destroyFramebuffer:I}=bA(t),[z,W]=l,[J,oe,le]=d,ne=i.gl.bindFramebuffer(36160,M.handle);let Ie,Ue;if(g instanceof E_)Ie=g,o=Number.isFinite(o)?o:Ie.width,A=Number.isFinite(A)?A:Ie.height,Ie._bind(0),Ue=Ie.glTarget;else throw new Error("invalid destination");switch(Ue){case 3553:case 34067:i.gl.copyTexSubImage2D(Ue,s,J,oe,z,W,o,A);break;case 35866:case 32879:i.gl.copyTexSubImage3D(Ue,s,J,oe,le,z,W,o,A);break}Ie&&Ie._unbind(),i.gl.bindFramebuffer(36160,ne),I&&M.destroy()}function bA(i){if(i instanceof Kr){const{width:e,height:t,id:s}=i;return{framebuffer:i.device.createFramebuffer({id:`framebuffer-for-${s}`,width:e,height:t,colorAttachments:[i]}),destroyFramebuffer:!0}}return{framebuffer:i,destroyFramebuffer:!1}}const IL=[1,2,4,8];class RL extends jd{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let s;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:d,height:g}=t.framebuffer;s=[0,0,d,g]}else{const[d,g]=e.getDefaultCanvasContext().getDrawingBufferSize();s=[0,0,d,g]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const l=this.props.framebuffer;if(this.props.framebuffer&&l?.handle){const d=this.props.framebuffer.colorAttachments.map((g,o)=>36064+o);this.device.gl.drawBuffers(d)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=IL.map(s=>!!(s&e.colorMask))),this.glParameters=t,rm(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((s,l)=>{s&&this.clearColorBuffer(l,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&D_(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){D_(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class AT extends Ax{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new AL(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new RL(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,s){}}function DL(i){const{target:e,source:t,start:s=0,count:l=1}=i,d=t.length,g=l*d;let o=0;for(let A=s;o<d;o++)e[A++]=t[o];for(;o<g;)o<g-o?(e.copyWithin(s+o,s,s+o),o*=2):(e.copyWithin(s+o,s,s+g-o),o=g);return i.target}class t1 extends Cx{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return kE()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const s=t;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:l,type:d,stride:g,offset:o,normalized:A,integer:M,divisor:I}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),M?this.device.gl.vertexAttribIPointer(e,l,d,g,o):this.device.gl.vertexAttribPointer(e,l,d,A,g,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,I||0),this.attributes[e]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const s=mA(t.bufferDataType);return{size:t.bufferComponents,type:s,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const l=t1.isConstantAttributeZeroSupported(this.device)||e!==0;(t||l)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const s=OL(t),l=s.byteLength*e,d=s.length*e;if(this.buffer&&l!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${l} !== ${this.buffer.byteLength}.`);let g=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:l}),g||=!kL(s,this.bufferValue),g){const o=CP(t.constructor,d);DL({target:o,source:s,start:0,count:d}),this.buffer.write(o),this.bufferValue=t}return this.buffer}}function OL(i){return Array.isArray(i)?new Float32Array(i):i}function kL(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}class LL extends Mx{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(wL(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const s=this._getVaryingIndex(e),{buffer:l,byteLength:d,byteOffset:g}=this._getBufferRange(t);if(s<0){this.unusedBuffers[e]=l,It.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[s]={buffer:l,byteLength:d,byteOffset:g},this.bindOnUse||this._bindBuffer(s,l,g,d)}getBuffer(e){if(ET(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof A_)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:s=0,byteLength:l=e.buffer.byteLength}=e;return{buffer:t,byteOffset:s,byteLength:l}}_getVaryingIndex(e){if(ET(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:s,byteOffset:l}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,l,s)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,s=0,l){const d=t&&t.handle;!d||l===void 0?this.gl.bindBufferBase(35982,e,d):this.gl.bindBufferRange(35982,e,d,s,l)}}function ET(i){return typeof i=="number"?Number.isInteger(i):/^\d+$/.test(i)}class BL extends Px{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const s=this.device.gl.createQuery();if(!s)throw new Error("WebGL query not supported");this.handle=s,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((s,l)=>{const d=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):t++>e?(l("Timed out"),this._pollingPromise=null):requestAnimationFrame(d)};requestAnimationFrame(d)}),this._pollingPromise}}function xA(i){switch(i){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function zL(i){switch(i){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function FL(i){return NL[i]}const NL={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function UL(i,e){const{sourceX:t=0,sourceY:s=0,sourceAttachment:l=0}=e||{};let{target:d=null,sourceWidth:g,sourceHeight:o,sourceDepth:A,sourceFormat:M,sourceType:I}=e||{};const{framebuffer:z,deleteFramebuffer:W}=wA(i),{gl:J,handle:oe}=z;g||=z.width,o||=z.height;const le=z.colorAttachments[l]?.texture;if(!le)throw new Error(`Invalid framebuffer attachment ${l}`);A=le?.depth||1,M||=le?.glFormat||6408,I||=le?.glType||5121,d=$L(d,I,M,g,o);const ne=xx(d);I=I||cL(ne);const Ie=J.bindFramebuffer(36160,oe);return J.readBuffer(36064+l),J.readPixels(t,s,g,o,M,I,d),J.readBuffer(36064),J.bindFramebuffer(36160,Ie||null),W&&z.destroy(),d}function VL(i,e){const{target:t,sourceX:s=0,sourceY:l=0,sourceFormat:d=6408,targetByteOffset:g=0}=e||{};let{sourceWidth:o,sourceHeight:A,sourceType:M}=e||{};const{framebuffer:I,deleteFramebuffer:z}=wA(i);o=o||I.width,A=A||I.height;const W=I;M=M||5121;let J=t;if(!J){const le=xA(d),ne=zL(M),Ie=g+o*A*le*ne;J=W.device.createBuffer({byteLength:Ie})}const oe=i.device.createCommandEncoder();return oe.copyTextureToBuffer({sourceTexture:i,width:o,height:A,origin:[s,l],destinationBuffer:J,byteOffset:g}),oe.destroy(),z&&I.destroy(),J}function wA(i){return i instanceof n0?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:jL(i),deleteFramebuffer:!0}}function jL(i,e){const{device:t,width:s,height:l,id:d}=i;return t.createFramebuffer({...e,id:`framebuffer-for-${d}`,width:s,height:l,colorAttachments:[i]})}function $L(i,e,t,s,l,d){if(i)return i;e||=5121;const g=FL(e),o=wx(g),A=xA(t);return new o(s*l*A)}class tx extends Kd{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){return e!=="unorm8x4-bgra"}constructor(e){super({...e,id:e.id||Z4("webgl-device")});const t=Kd._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=t.canvas?.gl?.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new G4(this,t),this.lost=new Promise(I=>{this._resolveContextLost=I});const l={...e.webgl};t.alphaMode==="premultiplied"&&(l.premultipliedAlpha=!0),e.powerPreference!==void 0&&(l.powerPreference=e.powerPreference);const g=this.props._handle||M4(this.canvasContext.canvas,{onContextLost:I=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:I=>console.log("WebGL context restored")},l);if(!g)throw new Error("WebGL context creation failed");if(s=g.device,s){if(e._reuseDevices)return It.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=g,this.gl=g,this.spectorJS=u4({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=P4(this.gl,this._extensions),this.limits=new W4(this.gl),this.features=new H4(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Zd(this.gl,{log:(...I)=>It.log(1,...I)()}).trackState(this.gl,{copyState:!1});const A=e.debugWebGL||e.debug,M=e.debugWebGL;A&&(this.gl=d4(this.gl,{debugWebGL:A,traceWebGL:M}),It.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(It.level=Math.max(It.level,1))),this.commandEncoder=new AT(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new A_(this,t)}createTexture(e){return new E_(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new aL(this,e)}createShader(e){return new J4(this,e)}createFramebuffer(e){return new S_(this,e)}createVertexArray(e){return new t1(this,e)}createTransformFeedback(e){return new LL(this,e)}createQuerySet(e){return new BL(this,e)}createRenderPipeline(e){return new TL(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new AT(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return UL(e,t)}readPixelsToBufferWebGL(e,t){return VL(e,t)}setParametersWebGL(e){rm(this.gl,e)}getParametersWebGL(e){return pA(this.gl,e)}withParametersWebGL(e,t){return D_(this.gl,e,t)}resetWebGL(){It.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),T4(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return U4(this.gl,e,this._extensions)}loseDevice(){let e=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(e=!0,s.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Zd.get(this.gl).push()}popState(){Zd.get(this.gl).pop()}getGLKey(e,t){const s=Number(e);for(const l in this.gl)if(this.gl[l]===s)return`GL.${l}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((s,[l,d])=>(s[`${l}:${this.getGLKey(l,t)}`]=`${d}:${this.getGLKey(d,t)}`,s),{})}setConstantAttributeWebGL(e,t){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const l=this._constants[e];switch(l&&XL(l,t)&&It.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:HL(this,e,t);break;case Int32Array:WL(this,e,t);break;case Uint32Array:qL(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return tm(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,s){e.luma=t;const l={props:s.spector,id:s.spector.id};e.__SPECTOR_Metadata=l}}function HL(i,e,t){switch(t.length){case 1:i.gl.vertexAttrib1fv(e,t);break;case 2:i.gl.vertexAttrib2fv(e,t);break;case 3:i.gl.vertexAttrib3fv(e,t);break;case 4:i.gl.vertexAttrib4fv(e,t);break}}function WL(i,e,t){i.gl.vertexAttribI4iv(e,t)}function qL(i,e,t){i.gl.vertexAttribI4uiv(e,t)}function XL(i,e){if(!i||!e||i.length!==e.length||i.constructor!==e.constructor)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}const CT=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:tx},Symbol.toStringTag,{value:"Module"}));function bf(){}const GL=({isDragging:i})=>i?"grabbing":"grab",TA={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:bf,onWebGLInitialized:bf,onResize:bf,onViewStateChange:bf,onInteractionStateChange:bf,onBeforeRender:bf,onAfterRender:bf,onLoad:bf,onError:i=>Ui.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:GL,getTooltip:null,debug:!1,drawPickingColors:!1};class i1{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Qv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null,unproject3D:!1},this._lastPointerDownInfo=null,this._onPointerMove=s=>{const{_pickRequest:l}=this;if(s.type==="pointerleave")l.x=-1,l.y=-1,l.radius=0;else{if(s.leftButton||s.rightButton)return;{const d=s.offsetCenter;if(!d)return;l.x=d.x,l.y=d.y,l.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:l.x,y:l.y}),l.event=s},this._onEvent=s=>{const l=Hb[s.type],d=s.offsetCenter;if(!l||!d||!this.layerManager)return;let g;const o=this.layerManager.getLayers(),A=o.some(J=>J.props.pickable==="3d");if(s.type==="click"&&A){const J=this._pick("pickObject","pickObject Time",{x:d.x,y:d.y,radius:this.props.pickingRadius,unproject3D:!0});g=J.result[0]||J.emptyInfo}else g=this.deckPicker.getLastPickedObject({x:d.x,y:d.y,layers:o,viewports:this.getViewports(d)},this._lastPointerDownInfo);const{layer:M}=g,I=M&&(M[l]||M.props[l]),z=this.props[l];let W=!1;I&&(W=I.call(M,g,s)),W||(z?.(g,s),this.widgetManager.onEvent(g,s))},this._onPointerDown=s=>{if(this.device?.type==="webgpu")return;const l=s.offsetCenter,d=this._pick("pickObject","pickObject Time",{x:l.x,y:l.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=d.result[0]||d.emptyInfo},this.props={...TA,...e},e=this.props,e.viewState&&e.initialViewState&&Ui.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;if(!t&&e.gl){e.gl instanceof WebGLRenderingContext&&Ui.error("WebGL1 context not supported.")();const s=this.props.deviceProps?.onResize;t=db.attach(e.gl,{_cacheShaders:!0,_cachePipelines:!0,...this.props.deviceProps,onResize:(l,d)=>{const{width:g,height:o}=l.canvas;l.drawingBufferWidth=g,l.drawingBufferHeight=o,this._needsRedraw="Canvas resized",s?.(l,d)}})}t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Yg.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ui.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ui.removed("onLayerClick","onClick")(),e.initialViewState&&!pl(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Ui.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.setProps&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const s=this.viewManager.needsRedraw(e),l=this.layerManager.needsRedraw(e),d=this.effectManager.needsRedraw(e),g=this.deckRenderer.needsRedraw(e);return t=t||s||l||d||g,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return ps(this.viewManager),this.viewManager.views}getView(e){return ps(this.viewManager),this.viewManager.getView(e)}getViewports(e){return ps(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const s in e)this.layerManager.resourceManager.add({resourceId:s,data:e[s],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,s){ps(this.deckPicker);const{stats:l}=this;l.get("Pick Count").incrementCount(),l.get(t).timeStart();const d=this.deckPicker[e]({layers:this.layerManager.getLayers(s),views:this.viewManager.getViews(),viewports:this.getViewports(s),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...s});return l.get(t).timeEnd(),d}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),ps(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:s}=e;if(t||t===0){const l=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=l}if(s||s===0){const l=Number.isFinite(s)?`${s}px`:s;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=l}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,s=e.clientHeight??e.height;(t!==this.width||s!==this.height)&&(this.width=t,this.height=s,this.viewManager?.setProps({width:t,height:s}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:s}))}_createAnimationLoop(e,t){const{gl:s,onError:l}=t;return new Wx({device:e,autoResizeDrawingBuffer:!s,autoResizeViewport:!1,onInitialize:d=>this._setDevice(d.device),onRender:this._onRenderFrame.bind(this),onError:l})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,s=typeof t=="object"?t:void 0,l={adapters:[],_cacheShaders:!0,_cachePipelines:!0,...e.deviceProps};l.adapters.includes(db)||l.adapters.push(db);const d={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},g=this.props.deviceProps?.onResize;return kb.createDevice({_reuseDevices:!0,type:"webgl",...l,createCanvasContext:{...d,...s,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(o,A)=>{this._needsRedraw="Canvas resized",g?.(o,A)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new uA({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const s=(this.layerManager?.getLayers()||[]).some(A=>A.props.pickable==="3d");e.unproject3D=s;const{result:l,emptyInfo:d}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let g=d,o=!1;for(const A of l)g=A,o=A.layer?.onHover(A,e.event)||o;o||(this.props.onHover?.(g,e.event),this.widgetManager.onHover(g,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new rA;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new SD(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Fw).map(l=>{const[d,g,o,A]=Fw[l],M=this.props.eventRecognizerOptions?.[l],I={...g,...M,event:l};return{recognizer:new d(I),recognizeWith:o,requestFailure:A}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in Hb)this.eventManager.on(l,this._onEvent);this.viewManager=new wk({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new xk(this.device,{deck:this,stats:this.stats,viewport:s,timeline:t}),this.effectManager=new jk({deck:this,device:this.device}),this.deckRenderer=new Wk(this.device),this.deckPicker=new Gk(this.device),this.widgetManager=new Kk({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new hA),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:s,gl:l}=this.layerManager.context;this.props.onBeforeRender({device:s,gl:l});const d={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(d),d.pass==="screen"&&this.widgetManager.onRedraw({viewports:d.viewports,layers:d.layers}),this.props.onAfterRender({device:s,gl:l})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ui.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const s=kb.stats.get("Memory Usage");e.bufferMemory=s.get("Buffer Memory").count,e.textureMemory=s.get("Texture Memory").count,e.renderbufferMemory=s.get("Renderbuffer Memory").count,e.gpuMemory=s.get("GPU Memory").count}}i1.defaultProps=TA;i1.VERSION=iM;function ZL(i){switch(i){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return wx(i)}}const YL=xx;function lv(i,e,t){const s=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:i,format:e.size>1?`${s}x${e.size}`:e.type,byteOffset:e.offset||0}}function Wd(i){return i.stride||i.size*i.bytesPerElement}function KL(i,e){return i.type===e.type&&i.size===e.size&&Wd(i)===Wd(e)&&(i.offset||0)===(e.offset||0)}function ix(i,e){e.offset&&Ui.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Wd(i),s=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,l=e.elementOffset||0,d=s*t+l*i.bytesPerElement+(i.offset||0);return{...e,offset:d,stride:t}}function QL(i,e){const t=ix(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class JL{constructor(e,t,s){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const l=t.logicalType||t.type,d=l==="float64";let{defaultValue:g}=t;g=Number.isFinite(g)?[g]:g||new Array(this.size).fill(0);let o;d?o="float32":!l&&t.isIndexed?o="uint32":o=l||"float32";let A=ZL(l||o);this.doublePrecision=d,d&&t.fp64===!1&&(A=Float32Array),this.value=null,this.settings={...t,defaultType:A,defaultValue:g,logicalType:l,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:A.BYTES_PER_ELEMENT},this.state={...s,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Wd(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Yg.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const s={};if(this.state.constant){const l=this.value;if(t){const d=ix(this.getAccessor(),t),g=d.offset/l.BYTES_PER_ELEMENT,o=d.size||this.size;s[e]=l.subarray(g,g+o)}else s[e]=l}else s[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?s[`${e}64Low`]=s[e]:s[`${e}64Low`]=new Float32Array(this.size)),s}_getBufferLayout(e=this.id,t=null){const s=this.getAccessor(),l=[],d={name:this.id,byteStride:Wd(s),attributes:l};if(this.doublePrecision){const g=QL(s,t||{});l.push(lv(e,{...s,...g.high},this.device.type),lv(`${e}64Low`,{...s,...g.low},this.device.type))}else if(t){const g=ix(s,t);l.push(lv(e,{...s,...g},this.device.type))}else l.push(lv(e,s,this.device.type));return d}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:s,size:l}=this,d=s*l;if(t&&d&&t.length>=d){const g=new Array(l).fill(1/0),o=new Array(l).fill(-1/0);for(let A=0;A<d;)for(let M=0;M<l;M++){const I=t[A++];I<g[M]&&(g[M]=I),I>o[M]&&(o[M]=I)}e=[g,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let s;ArrayBuffer.isView(e)?s={value:e}:e instanceof $n?s={buffer:e}:s=e;const l={...this.settings,...s};if(ArrayBuffer.isView(s.value)){if(!s.type)if(this.doublePrecision&&s.value instanceof Float64Array)l.type="float32";else{const g=YL(s.value);l.type=l.normalized?g.replace("int","norm"):g}l.bytesPerElement=s.value.BYTES_PER_ELEMENT,l.stride=Wd(l)}if(t.bounds=null,s.constant){let d=s.value;if(d=this._normalizeValue(d,[],0),this.settings.normalized&&(d=this.normalizeConstant(d)),!(!t.constant||!this._areValuesEqual(d,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(d)?d:new Float32Array(d)}else if(s.buffer){const d=s.buffer;t.externalBuffer=d,t.constant=!1,this.value=s.value||null}else if(s.value){this._checkExternalBuffer(s);let d=s.value;t.externalBuffer=null,t.constant=!1,this.value=d;let{buffer:g}=this;const o=Wd(l),A=(l.vertexOffset||0)*o;if(this.doublePrecision&&d instanceof Float64Array&&(d=ab(d,l)),this.settings.isIndexed){const I=this.settings.defaultType;d.constructor!==I&&(d=new I(d))}const M=d.byteLength+A+o*2;(!g||g.byteLength<M)&&(g=this._createBuffer(M)),g.write(d,A)}return this.setAccessor(l),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:s=0,endOffset:l}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?ab(t,{size:this.size,startIndex:s,endIndex:l}):t.subarray(s,l),s*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:s}=this,l=s.allocatedValue,d=Yg.allocate(l,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=d;const{byteOffset:g}=this;let{buffer:o}=this;return(!o||o.byteLength<d.byteLength+g)&&(o=this._createBuffer(d.byteLength+g),t&&l&&o.write(l instanceof Float64Array?ab(l,this):l,g)),s.allocatedValue=d,s.constant=!1,s.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const s=this.settings.defaultType;let l=!1;if(this.doublePrecision&&(l=t.BYTES_PER_ELEMENT<4),l)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof s)&&this.settings.normalized&&!("normalized"in e)&&Ui.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,s){const{defaultValue:l,size:d}=this.settings;if(Number.isFinite(e))return t[s]=e,t;if(!e){let g=d;for(;--g>=0;)t[s+g]=l[g];return t}switch(d){case 4:t[s+3]=Number.isFinite(e[3])?e[3]:l[3];case 3:t[s+2]=Number.isFinite(e[2])?e[2]:l[2];case 2:t[s+1]=Number.isFinite(e[1])?e[1]:l[1];case 1:t[s+0]=Number.isFinite(e[0])?e[0]:l[0];break;default:let g=d;for(;--g>=0;)t[s+g]=Number.isFinite(e[g])?e[g]:l[g]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:s}=this;for(let l=0;l<s;l++)if(e[l]!==t[l])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:s}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?$n.INDEX:$n.VERTEX)|$n.COPY_DST,indexType:t?s:void 0,byteLength:e}),this._buffer}}const MT=[],PT=[];function a0(i,e=0,t=1/0){let s=MT;const l={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?s=i:i.length>0&&(PT.length=i.length,s=PT):s=MT,(e>0||Number.isFinite(t))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(e,t),l.index=e-1),{iterable:s,objectInfo:l}}function SA(i){return i&&i[Symbol.asyncIterator]}function AA(i,e){const{size:t,stride:s,offset:l,startIndices:d,nested:g}=e,o=i.BYTES_PER_ELEMENT,A=s?s/o:t,M=l?l/o:0,I=Math.floor((i.length-M)/A);return(z,{index:W,target:J})=>{if(!d){const Ie=W*A+M;for(let Ue=0;Ue<t;Ue++)J[Ue]=i[Ie+Ue];return J}const oe=d[W],le=d[W+1]||I;let ne;if(g){ne=new Array(le-oe);for(let Ie=oe;Ie<le;Ie++){const Ue=Ie*A+M;J=new Array(t);for(let Se=0;Se<t;Se++)J[Se]=i[Ue+Se];ne[Ie-oe]=J}}else if(A===t)ne=i.subarray(oe*t+M,le*t+M);else{ne=new i.constructor((le-oe)*t);let Ie=0;for(let Ue=oe;Ue<le;Ue++){const Se=Ue*A+M;for(let Ve=0;Ve<t;Ve++)ne[Ie++]=i[Se+Ve]}}return ne}}const eB=[],wv=[[0,1/0]];function tB(i,e){if(i===wv||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],s=i.length;let l=0;for(let d=0;d<s;d++){const g=i[d];g[1]<e[0]?(t.push(g),l=d+1):g[0]>e[1]?t.push(g):e=[Math.min(g[0],e[0]),Math.max(g[1],e[1])]}return t.splice(l,0,e),t}const iB={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function EA(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...iB[t],...e,...i,type:t}}class CA extends JL{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:wv}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!KL(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,s=this.settings.transition,l=Array.isArray(t)?e[t.find(d=>e[d])]:e[t];return EA(l,s)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:s=0,endRow:l=1/0}=t;this.state.updateRanges=tB(this.state.updateRanges,[s,l])}else this.state.updateRanges=wv}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=eB}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:s}=this;return s.noAlloc?!1:s.update?(super.allocate(e,t.updateRanges!==wv),!0):!1}updateBuffer({numInstances:e,data:t,props:s,context:l}){if(!this.needsUpdate())return!1;const{state:{updateRanges:d},settings:{update:g,noAlloc:o}}=this;let A=!0;if(g){for(const[M,I]of d)g.call(l,this,{data:t,startRow:M,endRow:I,props:s,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[M,I]of d){const z=Number.isFinite(M)?this.getVertexOffset(M):0,W=Number.isFinite(I)?this.getVertexOffset(I):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:z,endOffset:W})}this._checkAttributeArray()}else A=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),A}setConstantValue(e,t){const s=this.device.type==="webgpu";if(s||t===void 0||typeof t=="function"){if(s&&typeof t!="function"){const g=this._normalizeValue(t,[],0);this._areValuesEqual(g,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const l=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:l})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:s,settings:l}=this;if(!e)return s.binaryValue=null,s.binaryAccessor=null,!1;if(l.noAlloc)return!1;if(s.binaryValue===e)return this.clearNeedsUpdate(),!0;if(s.binaryValue=e,this.setNeedsRedraw(),l.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const g=e;ps(ArrayBuffer.isView(g.value),`invalid ${l.accessor}`);const o=!!g.size&&g.size!==this.size;return s.binaryAccessor=AA(g.value,{size:g.size||this.size,stride:g.stride,offset:g.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const s in e)Object.assign(t,super.getValue(s,e[s]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,s=super._getBufferLayout(),{stepMode:l}=this.settings;if(l==="dynamic"?s.stepMode=e?e.isInstanced?"instance":"vertex":"instance":s.stepMode=l??"vertex",!t)return s;for(const d in t){const g=super._getBufferLayout(d,t[d]);s.attributes.push(...g.attributes)}return s}_autoUpdater(e,{data:t,startRow:s,endRow:l,props:d,numInstances:g}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:o,state:A,value:M,size:I,startIndices:z}=e,{accessor:W,transform:J}=o;let oe=A.binaryAccessor||(typeof W=="function"?W:d[W]);typeof oe!="function"&&typeof W=="string"&&(oe=()=>d[W]),ps(typeof oe=="function",`accessor "${W}" is not a function`);let le=e.getVertexOffset(s);const{iterable:ne,objectInfo:Ie}=a0(t,s,l);for(const Ue of ne){Ie.index++;let Se=oe(Ue,Ie);if(J&&(Se=J.call(this,Se)),z){const Ve=(Ie.index<z.length-1?z[Ie.index+1]:g)-z[Ie.index];if(Se&&Array.isArray(Se[0])){let st=le;for(const ot of Se)e._normalizeValue(ot,M,st),st+=I}else Se&&Se.length>I?M.set(Se,le):(e._normalizeValue(Se,Ie.target,0),mk({target:M,source:Ie.target,start:le,count:Ve}));le+=Ve*I}else e._normalizeValue(Se,M,le),le+=I}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let s=!0;switch(t){case 4:s=s&&Number.isFinite(e[3]);case 3:s=s&&Number.isFinite(e[2]);case 2:s=s&&Number.isFinite(e[1]);case 1:s=s&&Number.isFinite(e[0]);break;default:s=!1}if(!s)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function yb(i){const{source:e,target:t,start:s=0,size:l,getData:d}=i,g=i.end||t.length,o=e.length,A=g-s;if(o>A){t.set(e.subarray(0,A),s);return}if(t.set(e,s),!d)return;let M=o;for(;M<A;){const I=d(M,e);for(let z=0;z<l;z++)t[s+M]=I[z]||0,M++}}function nB({source:i,target:e,size:t,getData:s,sourceStartIndices:l,targetStartIndices:d}){if(!l||!d)return yb({source:i,target:e,size:t,getData:s}),e;let g=0,o=0;const A=s&&((I,z)=>s(I+o,z)),M=Math.min(l.length,d.length);for(let I=1;I<M;I++){const z=l[I]*t,W=d[I]*t;yb({source:i.subarray(g,z),target:e,start:o,end:W,size:t,getData:A}),g=z,o=W}return o<e.length&&yb({source:[],target:e,start:o,size:t,getData:A}),e}function rB(i){const{device:e,settings:t,value:s}=i,l=new CA(e,t);return l.setData({value:s instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),l}function MA(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${i}"`)}}function PA(i){switch(i){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function IA(i){i.push(i.shift())}function sB(i,e){const{doublePrecision:t,settings:s,value:l,size:d}=i,g=t&&l instanceof Float64Array?2:1;let o=0;const{shaderAttributes:A}=i.settings;if(A)for(const M of Object.values(A))o=Math.max(o,M.vertexOffset??0);return(s.noAlloc?l.length:(e+o)*d)*g}function RA({device:i,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=i.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function DA({device:i,buffer:e,attribute:t,fromLength:s,toLength:l,fromStartIndices:d,getData:g=o=>o}){const o=t.doublePrecision&&t.value instanceof Float64Array?2:1,A=t.size*o,M=t.byteOffset,I=t.settings.bytesPerElement<4?M/t.settings.bytesPerElement*4:M,z=t.startIndices,W=d&&z,J=t.isConstant;if(!W&&e&&s>=l)return e;const oe=t.value instanceof Float64Array?Float32Array:t.value.constructor,le=J?t.value:new oe(t.getBuffer().readSyncWebGL(M,l*oe.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!J){const Se=g;g=(Ve,st)=>t.normalizeConstant(Se(Ve,st))}const ne=J?(Se,Ve)=>g(le,Ve):(Se,Ve)=>g(le.subarray(Se+M,Se+M+A),Ve),Ie=e?new Float32Array(e.readSyncWebGL(I,s*4).buffer):new Float32Array(0),Ue=new Float32Array(l);return nB({source:Ie,target:Ue,sourceStartIndices:d,targetStartIndices:z,size:A,getData:ne}),(!e||e.byteLength<Ue.byteLength+I)&&(e?.destroy(),e=i.createBuffer({byteLength:Ue.byteLength+I,usage:35050})),e.write(Ue,I),e}class OA{constructor({device:e,attribute:t,timeline:s}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new s0(s),this.attribute=t,this.attributeInTransition=rB(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,s=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=sB(this.attribute,t),this.transition.start({...e,duration:s})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class aB extends OA{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="interpolation",this.transform=uB(e,t)}start(e,t){const s=this.currentLength,l=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:d,attribute:g}=this;IA(d),d[0]=DA({device:this.device,buffer:d[0],attribute:g,fromLength:s,toLength:this.currentLength,fromStartIndices:l,getData:e.enter}),d[1]=RA({device:this.device,source:d[0],target:d[1]}),this.setBuffer(d[1]);const{transform:o}=this,A=o.model;let M=Math.floor(this.currentLength/g.size);kA(g)&&(M/=2),A.setVertexCount(M),g.isConstant?(A.setAttributes({aFrom:d[0]}),A.setConstantAttributes({aTo:g.value})):A.setAttributes({aFrom:d[0],aTo:g.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:d[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:s}=this.transition;let l=s/e;t&&(l=t(l));const{model:d}=this.transform,g={time:l};d.shaderInputs.setProps({interpolation:g}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const oB=`uniform interpolationUniforms {
  float time;
} interpolation;
`,IT={name:"interpolation",vs:oB,uniformTypes:{time:"f32"}},lB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,cB=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function kA(i){return i.doublePrecision&&i.value instanceof Float64Array}function uB(i,e){const t=e.size,s=MA(t),l=PA(t),d=e.getBufferLayout();return kA(e)?new Qg(i,{vs:cB,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:l,byteOffset:0},{attribute:"aFrom64Low",format:l,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:l,byteOffset:0},{attribute:"aTo64Low",format:l,byteOffset:4*t}]}],modules:[hR,IT],defines:{ATTRIBUTE_TYPE:s,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Qg(i,{vs:lB,bufferLayout:[{name:"aFrom",format:l},{name:"aTo",format:d.attributes[0].format}],modules:[IT],defines:{ATTRIBUTE_TYPE:s},varyings:["vCurrent"],disableWarnings:!0})}class hB extends OA{constructor({device:e,attribute:t,timeline:s}){super({device:e,attribute:t,timeline:s}),this.type="spring",this.texture=_B(e),this.framebuffer=yB(e,this.texture),this.transform=mB(e,t)}start(e,t){const s=this.currentLength,l=this.currentStartIndices;super.start(e,t);const{buffers:d,attribute:g}=this;for(let A=0;A<2;A++)d[A]=DA({device:this.device,buffer:d[A],attribute:g,fromLength:s,toLength:this.currentLength,fromStartIndices:l,getData:e.enter});d[2]=RA({device:this.device,source:d[0],target:d[2]}),this.setBuffer(d[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/g.size)),g.isConstant?o.setConstantAttributes({aTo:g.value}):o.setAttributes({aTo:g.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:s,transition:l}=this,d=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const g={stiffness:d.stiffness,damping:d.damping};t.model.shaderInputs.setProps({spring:g}),t.run({framebuffer:s,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),IA(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(s)[0]>0||l.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const fB=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,dB={name:"spring",vs:fB,uniformTypes:{damping:"f32",stiffness:"f32"}},pB=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,gB=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function mB(i,e){const t=MA(e.size),s=PA(e.size);return new Qg(i,{vs:pB,fs:gB,bufferLayout:[{name:"aPrev",format:s},{name:"aCur",format:s},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[dB],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function _B(i){return i.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function yB(i,e){return i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const vB={interpolation:aB,spring:hB};class bB{constructor(e,{id:t,timeline:s}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=s,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:s}){this.numInstances=s||1;for(const l in e){const d=e[l],g=d.getTransitionSetting(t);g&&this._updateAttribute(l,d,g)}for(const l in this.transitions){const d=e[l];(!d||!d.getTransitionSetting(t))&&this._removeTransition(l)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const s=this.transitions[t];s.inProgress&&(e[t]=s.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,s){const l=this.transitions[e];let d=!l||l.type!==s.type;if(d){l&&this._removeTransition(e);const g=vB[s.type];g?this.transitions[e]=new g({attribute:t,timeline:this.timeline,device:this.device}):(Ui.error(`unsupported transition type '${s.type}'`)(),d=!1)}(d||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(s,this.numInstances))}}const RT="attributeManager.invalidate",xB="attributeManager.updateStart",wB="attributeManager.updateEnd",TB="attribute.updateStart",SB="attribute.allocate",AB="attribute.updateEnd";class EB{constructor(e,{id:t="attribute-manager",stats:s,timeline:l}={}){this.mergeBoundsMemoized=N_(LO),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=s,this.attributeTransitionManager=new bB(e,{id:`${t}-transitions`,timeline:l}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const s=this._invalidateTrigger(e,t);aa(RT,this,e,s)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);aa(RT,this,"all")}update({data:e,numInstances:t,startIndices:s=null,transitions:l,props:d={},buffers:g={},context:o={}}){let A=!1;aa(xB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const M in this.attributes){const I=this.attributes[M],z=I.settings.accessor;I.startIndices=s,I.numInstances=t,d[M]&&Ui.removed(`props.${M}`,`data.attributes.${M}`)(),I.setExternalBuffer(g[M])||I.setBinaryValue(typeof z=="string"?g[z]:void 0,e.startIndices)||typeof z=="string"&&!g[z]&&I.setConstantValue(o,d[z])||I.needsUpdate()&&(A=!0,this._updateAttribute({attribute:I,numInstances:t,data:e,props:d,context:o})),this.needsRedraw=this.needsRedraw||I.needsRedraw()}A&&aa(wB,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:l})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(s=>this.attributes[s]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:s}=this,l={...s.getAttributes()};for(const d in t){const g=t[d];g.needsRedraw(e)&&!s.hasAttribute(d)&&(l[d]=g)}return l}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const s in e){const l=e[s],d={...l,id:s,size:l.isIndexed&&1||l.size||1,...t};this.attributes[s]=new CA(this.device,d)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(l=>{e[l]||(e[l]=[]),e[l].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:s,updateTriggers:l}=this,d=l[e];return d&&d.forEach(g=>{const o=s[g];o&&o.setNeedsUpdate(o.id,t)}),d}_updateAttribute(e){const{attribute:t,numInstances:s}=e;if(aa(TB,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(s)&&aa(SB,t,s),t.updateBuffer(e)&&(this.needsRedraw=!0,aa(AB,t,s))}}class CB extends s0{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:s,duration:l,easing:d}}=this,g=d(e/l);this._value=jv(t,s,g)}}const DT=1e-5;function OT(i,e,t,s,l){const d=e-i,o=(t-e)*l,A=-d*s;return o+A+d+e}function MB(i,e,t,s,l){if(Array.isArray(t)){const d=[];for(let g=0;g<t.length;g++)d[g]=OT(i[g],e[g],t[g],s,l);return d}return OT(i,e,t,s,l)}function kT(i,e){if(Array.isArray(i)){let t=0;for(let s=0;s<i.length;s++){const l=i[s]-e[s];t+=l*l}return Math.sqrt(t)}return Math.abs(i-e)}class PB extends s0{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:s,stiffness:l}=this.settings,{_prevValue:d=e,_currValue:g=e}=this;let o=MB(d,g,t,s,l);const A=kT(o,t),M=kT(o,g);A<DT&&M<DT&&(o=t,this.end()),this._prevValue=g,this._currValue=o}}const IB={interpolation:CB,spring:PB};class RB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,s,l){const{transitions:d}=this;if(d.has(e)){const A=d.get(e),{value:M=A.settings.fromValue}=A;t=M,this.remove(e)}if(l=EA(l),!l)return;const g=IB[l.type];if(!g){Ui.error(`unsupported transition type '${l.type}'`)();return}const o=new g(this.timeline);o.start({...l,fromValue:t,toValue:s}),d.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,s]of this.transitions)s.update(),e[t]=s.value,s.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function DB(i){const e=i[Pf];for(const t in e){const s=e[t],{validate:l}=s;if(l&&!l(i[t],s))throw new Error(`Invalid prop ${t}: ${i[t]}`)}}function OB(i,e){const t=LA({newProps:i,oldProps:e,propTypes:i[Pf],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),s=LB(i,e);let l=!1;return s||(l=BB(i,e)),{dataChanged:s,propsChanged:t,updateTriggersChanged:l,extensionsChanged:zB(i,e),transitionsChanged:kB(i,e)}}function kB(i,e){if(!i.transitions)return!1;const t={},s=i[Pf];let l=!1;for(const d in i.transitions){const g=s[d],o=g&&g.type;(o==="number"||o==="color"||o==="array")&&nx(i[d],e[d],g)&&(t[d]=!0,l=!0)}return l?t:!1}function LA({newProps:i,oldProps:e,ignoreProps:t={},propTypes:s={},triggerName:l="props"}){if(e===i)return!1;if(typeof i!="object"||i===null)return`${l} changed shallowly`;if(typeof e!="object"||e===null)return`${l} changed shallowly`;for(const d of Object.keys(i))if(!(d in t)){if(!(d in e))return`${l}.${d} added`;const g=nx(i[d],e[d],s[d]);if(g)return`${l}.${d} ${g}`}for(const d of Object.keys(e))if(!(d in t)){if(!(d in i))return`${l}.${d} dropped`;if(!Object.hasOwnProperty.call(i,d)){const g=nx(i[d],e[d],s[d]);if(g)return`${l}.${d} ${g}`}}return!1}function nx(i,e,t){let s=t&&t.equal;return s&&!s(i,e,t)||!s&&(s=i&&e&&i.equals,s&&!s.call(i,e))?"changed deeply":!s&&e!==i?"changed shallowly":null}function LB(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:s,_dataDiff:l}=i;return s?s(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&l&&(t=l(i.data,e.data)||t),t}function BB(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&LT(i,e,"all"))return{all:!0};const t={};let s=!1;for(const l in i.updateTriggers)l!=="all"&&LT(i,e,l)&&(t[l]=!0,s=!0);return s?t:!1}function zB(i,e){if(e===null)return!0;const t=e.extensions,{extensions:s}=i;if(s===t)return!1;if(!t||!s||s.length!==t.length)return!0;for(let l=0;l<s.length;l++)if(!s[l].equals(t[l]))return!0;return!1}function LT(i,e,t){let s=i.updateTriggers[t];s=s??{};let l=e.updateTriggers[t];return l=l??{},LA({oldProps:l,newProps:s,triggerName:t})}const FB="count(): argument not an object",NB="count(): argument not a container";function UB(i){if(!jB(i))throw new Error(FB);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(VB(i))return Object.keys(i).length;throw new Error(NB)}function VB(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function jB(i){return i!==null&&typeof i=="object"}function BT(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(s=>s.name==="project64"))){const s=t.modules.findIndex(l=>l.name==="project32");s>=0&&t.modules.splice(s,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const s={...i.inject};for(const l in e.inject)s[l]=(s[l]||"")+e.inject[l];t.inject=s}return t}const $B={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},rx={};function HB(i,e,t,s){if(t instanceof Kr)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let l=null;t.compressed&&(l={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:d,height:g}=t.data,o=e.createTexture({...t,sampler:{...$B,...l,...s},mipLevels:e.getMipLevelCount(d,g)});return o.generateMipmapsWebGL(),rx[o.id]=i,o}function WB(i,e){!e||!(e instanceof Kr)||rx[e.id]===i&&(e.delete(),delete rx[e.id])}const qB={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||sx(i)&&(i.length===3||i.length===4)},equal(i,e,t){return pl(i,e,1)}},accessor:{validate(i,e){const t=Gv(i);return t==="function"||t===Gv(e.value)},equal(i,e,t){return typeof e=="function"?!0:pl(i,e,1)}},array:{validate(i,e){return e.optional&&!i||sx(i)},equal(i,e,t){const{compare:s}=t,l=Number.isInteger(s)?s:s?1:0;return s?pl(i,e,l):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:s}=t,l=Number.isInteger(s)?s:s?1:0;return s?pl(i,e,l):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{if(!i)return i;const{dataTransform:s}=t.props;return s?s(i):typeof i.shape=="string"&&i.shape.endsWith("-table")&&Array.isArray(i.data)?i.data:i}},image:{transform:(i,e,t)=>{const s=t.context;return!s||!s.device?null:HB(t.id,s.device,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{WB(t.id,i)}}};function XB(i){const e={},t={},s={};for(const[l,d]of Object.entries(i)){const g=d?.deprecatedFor;if(g)s[l]=Array.isArray(g)?g:[g];else{const o=GB(l,d);e[l]=o,t[l]=o.value}}return{propTypes:e,defaultProps:t,deprecatedProps:s}}function GB(i,e){switch(Gv(e)){case"object":return h_(i,e);case"array":return h_(i,{type:"array",value:e,compare:!1});case"boolean":return h_(i,{type:"boolean",value:e});case"number":return h_(i,{type:"number",value:e});case"function":return h_(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function h_(i,e){return"type"in e?{name:i,...qB[e.type],...e}:"value"in e?{name:i,type:Gv(e.value),...e}:{name:i,type:"object",value:e}}function sx(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function Gv(i){return sx(i)?"array":i===null?"null":typeof i}function ZB(i,e){let t;for(let d=e.length-1;d>=0;d--){const g=e[d];"extensions"in g&&(t=g.extensions)}const s=ax(i.constructor,t),l=Object.create(s);l[Xv]=i,l[tp]={},l[Ef]={};for(let d=0;d<e.length;++d){const g=e[d];for(const o in g)l[o]=g[o]}return Object.freeze(l),l}const YB="_mergedDefaultProps";function ax(i,e){if(!(i instanceof o0.constructor))return{};let t=YB;if(e)for(const l of e){const d=l.constructor;d&&(t+=`:${d.extensionName||d.name}`)}const s=BA(i,t);return s||(i[t]=KB(i,e||[]))}function KB(i,e){if(!i.prototype)return null;const s=Object.getPrototypeOf(i),l=ax(s),d=BA(i,"defaultProps")||{},g=XB(d),o=Object.assign(Object.create(null),l,g.defaultProps),A=Object.assign(Object.create(null),l?.[Pf],g.propTypes),M=Object.assign(Object.create(null),l?.[hb],g.deprecatedProps);for(const I of e){const z=ax(I.constructor);z&&(Object.assign(o,z),Object.assign(A,z[Pf]),Object.assign(M,z[hb]))}return QB(o,i),ez(o,A),JB(o,M),o[Pf]=A,o[hb]=M,e.length===0&&!n1(i,"_propTypes")&&(i._propTypes=A),o}function QB(i,e){const t=iz(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function JB(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(s){const l=`${this.id}: ${t}`;for(const d of e[t])n1(this,d)||(this[d]=s);Ui.deprecated(l,e[t].join("/"))()}})}function ez(i,e){const t={},s={};for(const l in e){const d=e[l],{name:g,value:o}=d;d.async&&(t[g]=o,s[g]=tz(g))}i[$g]=t,i[tp]={},Object.defineProperties(i,s)}function tz(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||SA(e)?this[tp][i]=e:this[Ef][i]=e},get(){if(this[Ef]){if(i in this[Ef])return this[Ef][i]||this[$g][i];if(i in this[tp]){const e=this[Xv]&&this[Xv].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[$g][i]}}return this[$g][i]}}}function n1(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function BA(i,e){return n1(i,e)&&i[e]}function iz(i){const e=i.componentName;return e||Ui.warn(`${i.name}.componentName not specified`)(),e||i.name}let nz=0;class o0{constructor(...e){this.props=ZB(this,e),this.id=this.props.id,this.count=nz++}clone(e){const{props:t}=this,s={};for(const l in t[$g])l in t[Ef]?s[l]=t[Ef][l]:l in t[tp]&&(s[l]=t[tp][l]);return new this.constructor({...t,...s,...e})}}o0.componentName="Component";o0.defaultProps={};const rz=Object.freeze({});class sz{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||rz}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Xv]||this.component;const t=e[Ef]||{},s=e[tp]||e,l=e[$g]||{};for(const d in t){const g=t[d];this._createAsyncPropData(d,l[d]),this._updateAsyncProp(d,g),t[d]=this.getAsyncProp(d)}for(const d in s){const g=s[d];this._createAsyncPropData(d,l[d]),this._updateAsyncProp(d,g)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(SA(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const s=this.asyncProps[e];return t===s.resolvedValue||t===s.lastValue?!1:(s.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const s=this.asyncProps[e];s&&(t=this._postProcessValue(s,t),s.resolvedValue=t,s.pendingLoadCount++,s.resolvedLoadCount=s.pendingLoadCount)}_setAsyncPropValue(e,t,s){const l=this.asyncProps[e];l&&s>=l.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),l.resolvedValue=t,l.resolvedLoadCount=s,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const s=this.asyncProps[e];if(s){s.pendingLoadCount++;const l=s.pendingLoadCount;t.then(d=>{this.component&&(d=this._postProcessValue(s,d),this._setAsyncPropValue(e,d,l),this._onResolve(e,d))}).catch(d=>{this._onError(e,d)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const s=this.asyncProps[e];if(!s)return;s.pendingLoadCount++;const l=s.pendingLoadCount;let d=[],g=0;for await(const o of t){if(!this.component)return;const{dataTransform:A}=this.component.props;A?d=A(o,d):d=d.concat(o),Object.defineProperty(d,"__diff",{enumerable:!1,value:[{startRow:g,endRow:d.length}]}),g=d.length,this._setAsyncPropValue(e,d,l)}this._onResolve(e,d)}_postProcessValue(e,t){const s=e.type;return s&&this.component&&(s.release&&s.release(e.resolvedValue,s,this.component),s.transform)?s.transform(t,s,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const l=this.component&&this.component.props[Pf];this.asyncProps[e]={type:l&&l[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class az extends sz{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const s=this.layer,l=s?.props.fetch;return l?l(t,{propName:e,layer:s}):super._fetch(e,t)}_onResolve(e,t){const s=this.layer;if(s){const l=s.props.onDataLoad;e==="data"&&l&&l(t,{propName:e,layer:s})}}_onError(e,t){const s=this.layer;s&&s.raiseError(t,`loading ${e} of ${this.layer}`)}}const oz="layer.changeFlag",lz="layer.initialize",cz="layer.update",uz="layer.finalize",hz="layer.matched",zT=2**24-1,fz=Object.freeze([]),dz=N_(({oldViewport:i,viewport:e})=>i.equals(e));let hc=new Uint8ClampedArray(0);const pz={data:{type:"data",value:fz,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:t,loaders:s,loadOptions:l,signal:d})=>{const{resourceManager:g}=t.context;l=l||t.getLoadOptions(),s=s||t.props.loaders,d&&(l={...l,fetch:{...l?.fetch,signal:d}});let o=g.contains(i);return!o&&!l&&(g.add({resourceId:i,data:Rv(i,s),persistent:!1}),o=!0),o?g.subscribe({resourceId:i,onChange:A=>t.internalState?.reloadAsyncProp(e,A),consumerId:t.id,requestId:e}):Rv(i,s,l)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qi.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class vh extends o0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Og.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){ps(this.internalState);const t=this.internalState.viewport||this.context.viewport,s=nA(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[l,d,g]=JS(s,t.pixelProjectionMatrix);return e.length===2?[l,d]:[l,d,g]}unproject(e){return ps(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){ps(this.internalState);const s=this.internalState.viewport||this.context.viewport;return VO(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qi.DEFAULT||e===Qi.LNGLAT||e===Qi.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){ps(e instanceof Uint8Array);const[t,s,l]=e;return t+s*256+l*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:UB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=BT(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=BT(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:s}=e.changeFlags;if(s&&t)if(Array.isArray(s))for(const l of s)t.invalidateAll(l);else t.invalidateAll();if(t){const{props:l}=e,d=this.internalState.hasPickingBuffer,g=Number.isInteger(l.highlightedObjectIndex)||!!l.pickable||l.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(d!==g){this.internalState.hasPickingBuffer=g;const{pickingColors:o,instancePickingColors:A}=t.attributes,M=o||A;M&&(g&&M.constant&&(M.constant=!1,t.invalidate(M.id)),!M.value&&!g&&(M.constant=!0,M.value=[0,0,0]))}}}finalizeState(e){for(const s of this.getModels())s.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:s}){const{index:l}=e;return l>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[l]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!dz({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const s in e)e[s].layoutChanged()&&(t=!0);for(const s of this.getModels())this._setModelAttributes(s,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,s=this.getNumInstances(),l=this.getStartIndices();e.update({data:t.data,numInstances:s,startIndices:l,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const d=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(d)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),s=Object.create(this.props);for(const l in t)Object.defineProperty(s,l,{value:t[l]});return s}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const s=Math.floor(hc.length/4);if(this.internalState.usesPickingColorCache=!0,s<t){t>zT&&Ui.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),hc=Yg.allocate(hc,t,{size:4,copy:!0,maxCount:Math.max(t,zT)});const l=Math.floor(hc.length/4),d=[0,0,0];for(let g=s;g<l;g++)this.encodePickingColor(g,d),hc[g*4+0]=d[0],hc[g*4+1]=d[1],hc[g*4+2]=d[2],hc[g*4+3]=0}e.value=hc.subarray(0,t*4)}_setModelAttributes(e,t,s=!1){if(!Object.keys(t).length)return;if(s){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),t=o.getAttributes()}const l=e.userData?.excludeAttributes||{},d={},g={};for(const o in t){if(l[o])continue;const A=t[o].getValue();for(const M in A){const I=A[M];I instanceof $n?t[o].settings.isIndexed?e.setIndexBuffer(I):d[M]=I:I&&(g[M]=I)}}e.setAttributes(d),e.setConstantAttributes(g)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:s,instancePickingColors:l}=this.getAttributeManager().attributes,d=s||l,g=d&&t.attributes&&t.attributes[d.id];if(g&&g.value){const o=g.value,A=this.encodePickingColor(e);for(let M=0;M<t.length;M++){const I=d.getVertexOffset(M);o[I]===A[0]&&o[I+1]===A[1]&&o[I+2]===A[2]&&this._disablePickingIndex(M)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:s}=this.getAttributeManager().attributes,l=t||s;if(!l)return;const d=l.getVertexOffset(e),g=l.getVertexOffset(e+1);l.buffer.write(new Uint8Array(g-d),d)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,s=e||t;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==hc.buffer&&(s.value=hc.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}_initialize(){ps(!this.internalState),ps(Number.isFinite(this.props.coordinateSystem)),aa(lz,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new az({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ui.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new RB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){aa(hz,this,this===e);const{state:t,internalState:s}=e;this!==e&&(this.internalState=s,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(aa(cz,this,e),!e)return;const t=this.props,s=this.context,l=this.internalState,d=s.viewport,g=this._updateUniformTransition();l.propsInTransition=g,s.viewport=l.viewport||d,this.props=g;try{const o=this._getUpdateParams(),A=this.getModels();if(s.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const I of this.props.extensions)I.updateState.call(this,o,I);this.setNeedsRedraw(),this._updateAttributes();const M=this.getModels()[0]!==A[0];this._postUpdate(o,M)}finally{s.viewport=d,this.props=t,this._clearChangeFlags(),l.needsUpdate=!1,l.resetOldProps()}}_finalize(){aa(uz,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:s={},parameters:l={}}){this._updateAttributeTransition();const d=this.props,g=this.context;this.props=this.internalState.propsInTransition||d;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:o}=this.props,A=o&&o(s)||[0,0];g.device instanceof tx&&g.device.setParametersWebGL({polygonOffset:A});for(const M of this.getModels())M.device.type==="webgpu"?M.setParameters({...M.parameters,...l}):M.setParameters(l);if(g.device instanceof tx)g.device.withParametersWebGL(l,()=>{const M={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:l,context:g};for(const I of this.props.extensions)I.draw.call(this,M,I);this.draw(M)});else{const M={renderPass:e,shaderModuleProps:t,uniforms:s,parameters:l,context:g};for(const I of this.props.extensions)I.draw.call(this,M,I);this.draw(M)}}finally{this.props=d}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const l in e)if(e[l]){let d=!1;switch(l){case"dataChanged":const g=e[l],o=t[l];g&&Array.isArray(o)&&(t.dataChanged=Array.isArray(g)?o.concat(g):g,d=!0);default:t[l]||(t[l]=e[l],d=!0)}d&&aa(oz,this,l,e)}const s=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=s,t.somethingChanged=s||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const s=OB(e,t);if(s.updateTriggersChanged)for(const l in s.updateTriggersChanged)s.updateTriggersChanged[l]&&this.invalidateAttribute(l);if(s.transitionsChanged)for(const l in s.transitionsChanged)this.internalState.uniformTransitions.add(l,t[l],e[l],e.transitions?.[l]);return this.setChangeFlags(s)}validateProps(){DB(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:s}=this.props;e.picked&&typeof s=="function"&&(t.highlightColor=s(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new EB(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:s,oldProps:l}=e,d=this.state.model;d?.isInstanced&&d.setInstanceCount(this.getNumInstances());const{autoHighlight:g,highlightedObjectIndex:o,highlightColor:A}=s;if(t||l.autoHighlight!==g||l.highlightedObjectIndex!==o||l.highlightColor!==A){const M={};Array.isArray(A)&&(M.highlightColor=A),(t||l.autoHighlight!==g||o!==l.highlightedObjectIndex)&&(M.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:M})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const s=this.getAttributeManager(),l=s?s.getNeedsRedraw(e):!1;if(t=t||l,t)for(const d of this.props.extensions)d.onNeedsRedraw.call(this,d);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}vh.defaultProps=pz;vh.layerName="Layer";const gz="compositeLayer.renderLayers";class r1 extends vh{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:s}=this.props;return s&&s[e]&&s[e].type||t}getSubLayerRow(e,t,s){return e.__source={parent:this,object:t,index:s},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(s,l)=>s&&s.__source?(t.index=s.__source.index,e(s.__source.object,t)):e(s,l)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:s,visible:l,parameters:d,getPolygonOffset:g,highlightedObjectIndex:o,autoHighlight:A,highlightColor:M,coordinateSystem:I,coordinateOrigin:z,wrapLongitude:W,positionFormat:J,modelMatrix:oe,extensions:le,fetch:ne,operation:Ie,_subLayerProps:Ue}=this.props,Se={id:"",updateTriggers:{},opacity:t,pickable:s,visible:l,parameters:d,getPolygonOffset:g,highlightedObjectIndex:o,autoHighlight:A,highlightColor:M,coordinateSystem:I,coordinateOrigin:z,wrapLongitude:W,positionFormat:J,modelMatrix:oe,extensions:le,fetch:ne,operation:Ie},Ve=Ue&&e.id&&Ue[e.id],st=Ve&&Ve.updateTriggers,ot=e.id||"sublayer";if(Ve){const wt=this.props[Pf],Ft=e.type?e.type._propTypes:{};for(const lt in Ve){const kt=Ft[lt]||wt[lt];kt&&kt.type==="accessor"&&(Ve[lt]=this.getSubLayerAccessor(Ve[lt]))}}Object.assign(Se,e,Ve),Se.id=`${this.props.id}-${ot}`,Se.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...st};for(const wt of le){const Ft=wt.getSubLayerProps.call(this,wt);Ft&&Object.assign(Se,Ft,{updateTriggers:Object.assign(Se.updateTriggers,Ft.updateTriggers)})}return Se}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let s=this.internalState.subLayers;const l=!s||this.needsUpdate();if(l){const d=this.renderLayers();s=Gx(d,Boolean),this.internalState.subLayers=s}aa(gz,this,l,s);for(const d of s)d.parent=this}}r1.layerName="CompositeLayer";class zA{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=Yg,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:s={},getGeometry:l,geometryBuffer:d,positionFormat:g,dataChanged:o,normalize:A=!0}=this.opts;if(this.data=t,this.getGeometry=l,this.positionSize=d&&d.size||(g==="XY"?2:3),this.buffers=s,this.normalize=A,d&&(ps(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(d),A||(s.vertexPositions=d)),this.geometryBuffer=s.vertexPositions,Array.isArray(o))for(const M of o)this._rebuildGeometry(M);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?AA(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:s,buffers:l,_attributeDefs:d,typedArrayManager:g}=this;for(const o in d)if(o in l)g.release(s[o]),s[o]=null;else{const A=d[o];A.copy=t,s[o]=g.allocate(s[o],e,A)}}_forEachGeometry(e,t,s){const{data:l,getGeometry:d}=this,{iterable:g,objectInfo:o}=a0(l,t,s);for(const A of g){o.index++;const M=d?d(A,o):null;e(M,o.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:s,instanceCount:l}=this;const{data:d,geometryBuffer:g}=this,{startRow:o=0,endRow:A=1/0}=e||{},M={};if(e||(t=[0],s=[0]),this.normalize||!g)this._forEachGeometry((z,W)=>{const J=z&&this.normalizeGeometry(z);M[W]=J,s[W+1]=s[W]+(J?this.getGeometrySize(J):0)},o,A),l=s[s.length-1];else if(s=d.startIndices,l=s[d.length]||0,ArrayBuffer.isView(g))l=l||g.length/this.positionSize;else if(g instanceof $n){const z=this.positionSize*4;l=l||g.byteLength/z}else if(g.buffer){const z=g.stride||this.positionSize*4;l=l||g.buffer.byteLength/z}else if(g.value){const z=g.value,W=g.stride/z.BYTES_PER_ELEMENT||this.positionSize;l=l||z.length/W}this._allocate(l,!!e),this.indexStarts=t,this.vertexStarts=s,this.instanceCount=l;const I={};this._forEachGeometry((z,W)=>{const J=M[W]||z;I.vertexStart=s[W],I.indexStart=t[W];const oe=W<s.length-1?s[W+1]:l;I.geometrySize=oe-s[W],I.geometryIndex=W,this.updateGeometryAttributes(J,I)},o,A),this.vertexCount=t[t.length-1]}}const mz=typeof window<"u"?Si.useLayoutEffect:Si.useEffect;function Zv(i,e){for(;i;){if(i===e)return!0;i=Object.getPrototypeOf(i)}return!1}const _z={position:"absolute",zIndex:-1};function FA(i,e){if(typeof i=="function")return i(e);if(Array.isArray(i))return i.map(t=>FA(t,e));if(l0(i)){if(yz(i))return e.style=_z,Si.cloneElement(i,e);if(vz(i))return Si.cloneElement(i,e)}return i}function l0(i){return i&&typeof i=="object"&&"type"in i||!1}function yz(i){return i.props?.mapStyle}function vz(i){const e=i.type;return e&&e.deckGLViewProps}function ox(i){if(typeof i=="function")return Si.createElement(em,{},i);if(Array.isArray(i))return i.map(ox);if(l0(i)){if(i.type===Si.Fragment)return ox(i.props.children);if(Zv(i.type,em))return i}return i}function bz({children:i,layers:e=[],views:t=null}){const s=[],l=[],d={};return Si.Children.forEach(ox(i),g=>{if(l0(g)){const o=g.type;if(Zv(o,vh)){const A=xz(o,g.props);l.push(A)}else s.push(g);if(Zv(o,em)&&o!==em&&g.props.id){const A=new o(g.props);d[A.id]=A}}else g&&s.push(g)}),Object.keys(d).length>0&&(Array.isArray(t)?t.forEach(g=>{d[g.id]=g}):t&&(d[t.id]=t),t=Object.values(d)),e=l.length>0?[...l,...e]:e,{layers:e,children:s,views:t}}function xz(i,e){const t={},s=i.defaultProps||{};for(const l in e)s[l]!==e[l]&&(t[l]=e[l]);return new i(t)}const wz=Si.createContext();function Tz({children:i,deck:e,ContextProvider:t=wz.Provider}){const{viewManager:s}=e||{};if(!s||!s.views.length)return[];const l={},d=s.views[0].id;for(const g of i){let o=d,A=g;l0(g)&&Zv(g.type,em)&&(o=g.props.id||d,A=g.props.children);const M=s.getViewport(o),I=s.getViewState(o);if(M){I.padding=M.padding;const{x:z,y:W,width:J,height:oe}=M;A=FA(A,{x:z,y:W,width:J,height:oe,viewport:M,viewState:I}),l[o]||(l[o]={viewport:M,children:[]}),l[o].children.push(A)}}return Object.keys(l).map(g=>{const{viewport:o,children:A}=l[g],{x:M,y:I,width:z,height:W}=o,J={position:"absolute",left:M,top:I,width:z,height:W},oe=`view-${g}`,le=Si.createElement("div",{key:oe,id:oe,style:J},...A),ne={deck:e,viewport:o,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:Ue=>{Ue.viewId=g,e._onViewStateChange(Ue)},widgets:[]},Ie=`view-${g}-context`;return Si.createElement(t,{key:Ie,value:ne},le)})}const Sz={mixBlendMode:null};function Az({width:i,height:e,style:t}){const s={position:"absolute",zIndex:0,left:0,top:0,width:i,height:e},l={left:0,top:0};if(t)for(const d in t)d in Sz?l[d]=t[d]:s[d]=t[d];return{containerStyle:s,canvasStyle:l}}function Ez(i){return{get deck(){return i.deck},pickObject:e=>i.deck.pickObject(e),pickMultipleObjects:e=>i.deck.pickMultipleObjects(e),pickObjects:e=>i.deck.pickObjects(e)}}function NA(i){i.redrawReason&&(i.deck._drawLayers(i.redrawReason),i.redrawReason=null)}function Cz(i,e,t){const s=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:l=>{i.redrawReason=l;const d=s.getViewports();i.lastRenderedViewports!==d?i.forceUpdate():NA(i)}});return s}function Mz(i,e){const[t,s]=Si.useState(0),d=Si.useRef({control:null,version:t,forceUpdate:()=>s(st=>st+1)}).current,g=Si.useRef(null),o=Si.useRef(null),A=Si.useMemo(()=>bz(i),[i.layers,i.views,i.children]);let M=!0;const I=st=>M&&i.viewState?(d.viewStateUpdateRequested=st,null):(d.viewStateUpdateRequested=null,i.onViewStateChange?.(st)),z=st=>{M?d.interactionStateUpdateRequested=st:(d.interactionStateUpdateRequested=null,i.onInteractionStateChange?.(st))},W=Si.useMemo(()=>{const st={widgets:[],...i,style:null,width:"100%",height:"100%",parent:g.current,canvas:o.current,layers:A.layers,views:A.views,onViewStateChange:I,onInteractionStateChange:z};return delete st._customRender,d.deck&&d.deck.setProps(st),st},[i]);Si.useEffect(()=>{const st=i.Deck||i1;return d.deck=Cz(d,st,{...W,parent:g.current,canvas:o.current}),()=>d.deck?.finalize()},[]),mz(()=>{NA(d);const{viewStateUpdateRequested:st,interactionStateUpdateRequested:ot}=d;st&&I(st),ot&&z(ot),d.deck?.isInitialized&&d.deck.redraw("Initial render")}),Si.useImperativeHandle(e,()=>Ez(d),[]);const J=d.deck&&d.deck.isInitialized?d.deck.getViewports():void 0,{ContextProvider:oe,width:le="100%",height:ne="100%",id:Ie,style:Ue}=i,{containerStyle:Se,canvasStyle:Ve}=Si.useMemo(()=>Az({width:le,height:ne,style:Ue}),[le,ne,Ue]);if(!d.viewStateUpdateRequested&&d.lastRenderedViewports===J||d.version!==t){d.lastRenderedViewports=J,d.version=t;const st=Tz({children:A.children,deck:d.deck,ContextProvider:oe}),ot=Si.createElement("canvas",{key:"canvas",id:Ie||"deckgl-overlay",ref:o,style:Ve});d.control=Si.createElement("div",{id:`${Ie||"deckgl"}-wrapper`,ref:g,style:Se},[ot,st])}return M=!1,d.control}const Pz=Si.forwardRef(Mz),FT=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeBasis;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,Iz={name:"icon",vs:FT,fs:FT,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeBasis:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Rz=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float iconConstraint = icon.sizeBasis == 0.0 ? iconSize.x : iconSize.y;
float instanceScale = iconConstraint == 0.0 ? 0.0 : sizePixels / iconConstraint;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Dz=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Oz=1024,kz=4,NT=()=>{},UT={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Lz={x:0,y:0,width:0,height:0};function Bz(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function zz(i,e,t,s){const l=Math.min(t/e.width,s/e.height),d=Math.floor(e.width*l),g=Math.floor(e.height*l);return l===1?{image:e,width:d,height:g}:(i.canvas.height=g,i.canvas.width=d,i.clearRect(0,0,d,g),i.drawImage(e,0,0,e.width,e.height,0,0,d,g),{image:i.canvas,width:d,height:g})}function O_(i){return i&&(i.id||i.url)}function Fz(i,e,t,s){const{width:l,height:d,device:g}=i,o=g.createTexture({format:"rgba8unorm",width:e,height:t,sampler:s,mipLevels:g.getMipLevelCount(e,t)}),A=g.createCommandEncoder();return A.copyTextureToTexture({sourceTexture:i,destinationTexture:o,width:l,height:d}),A.finish(),o.generateMipmapsWebGL(),i.destroy(),o}function VT(i,e,t){for(let s=0;s<e.length;s++){const{icon:l,xOffset:d}=e[s],g=O_(l);i[g]={...l,x:d,y:t}}}function Nz({icons:i,buffer:e,mapping:t={},xOffset:s=0,yOffset:l=0,rowHeight:d=0,canvasWidth:g}){let o=[];for(let A=0;A<i.length;A++){const M=i[A],I=O_(M);if(!t[I]){const{height:z,width:W}=M;s+W+e>g&&(VT(t,o,l),s=0,l=d+l+e,d=0,o=[]),o.push({icon:M,xOffset:s}),s=s+W+e,d=Math.max(d,z)}}return o.length>0&&VT(t,o,l),{mapping:t,rowHeight:d,xOffset:s,yOffset:l,canvasWidth:g,canvasHeight:Bz(d+l+e)}}function Uz(i,e,t){if(!i||!e)return null;t=t||{};const s={},{iterable:l,objectInfo:d}=a0(i);for(const g of l){d.index++;const o=e(g,d),A=O_(o);if(!o)throw new Error("Icon is missing.");if(!o.url)throw new Error("Icon url is missing.");!s[A]&&(!t[A]||o.url!==t[A].url)&&(s[A]={...o,source:g,sourceIndex:d.index})}return s}class Vz{constructor(e,{onUpdate:t=NT,onError:s=NT}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=kz,this._canvasWidth=Oz,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=s}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?O_(e):e;return this._mapping[t]||Lz}setProps({loadOptions:e,autoPacking:t,iconAtlas:s,iconMapping:l,textureParameters:d}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),l&&(this._mapping=l),s&&(this._texture?.delete(),this._texture=null,this._externalTexture=s),d&&(this._samplerParameters=d)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;const s=Object.values(Uz(e,t,this._mapping)||{});if(s.length>0){const{mapping:l,xOffset:d,yOffset:g,rowHeight:o,canvasHeight:A}=Nz({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=l,this._xOffset=d,this._yOffset=g,this._canvasHeight=A,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",data:null,width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||UT,mipLevels:this.device.getMipLevelCount(this._canvasWidth,this._canvasHeight)})),this._texture.height!==this._canvasHeight&&(this._texture=Fz(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||UT)),this.onUpdate(!0),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(s)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const s of e)this._pendingCount++,Rv(s.url,this._loadOptions).then(l=>{const d=O_(s),g=this._mapping[d],{x:o,y:A,width:M,height:I}=g,{image:z,width:W,height:J}=zz(t,l,M,I),oe=o+(M-W)/2,le=A+(I-J)/2;this._texture?.copyExternalImage({image:z,x:oe,y:le,width:W,height:J}),g.x=oe,g.y=le,g.width=W,g.height=J,this._texture?.generateMipmapsWebGL(),this.onUpdate(W!==M||J!==I)}).catch(l=>{this.onError({url:s.url,source:s.source,sourceIndex:s.sourceIndex,loadOptions:this._loadOptions,error:l})}).finally(()=>{this._pendingCount--})}}const UA=[0,0,0,255],jz={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeBasis:"height",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:i=>i.position},getIcon:{type:"accessor",value:i=>i.icon},getColor:{type:"accessor",value:UA},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class c0 extends vh{getShaders(){return super.getShaders({vs:Rz,fs:Dz,modules:[U_,V_,Iz]})}initializeState(){this.state={iconManager:new Vz(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:UA},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:s,changeFlags:l}=e,d=this.getAttributeManager(),{iconAtlas:g,iconMapping:o,data:A,getIcon:M,textureParameters:I}=t,{iconManager:z}=this.state;if(typeof g=="string")return;const W=g||this.internalState.isAsyncPropLoading("iconAtlas");z.setProps({loadOptions:t.loadOptions,autoPacking:!W,iconAtlas:g,iconMapping:W?o:null,textureParameters:I}),W?s.iconMapping!==t.iconMapping&&d.invalidate("getIcon"):(l.dataChanged||l.updateTriggersChanged&&(l.updateTriggersChanged.all||l.updateTriggersChanged.getIcon))&&z.packIcons(A,M),l.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),d.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeBasis:s,sizeMinPixels:l,sizeMaxPixels:d,sizeUnits:g,billboard:o,alphaCutoff:A}=this.props,{iconManager:M}=this.state,I=M.getTexture();if(I){const z=this.state.model,W={iconsTexture:I,iconsTextureDim:[I.width,I.height],sizeUnits:_h[g],sizeScale:t,sizeBasis:s==="height"?1:0,sizeMinPixels:l,sizeMaxPixels:d,billboard:o,alphaCutoff:A};z.shaderInputs.setProps({icon:W}),z.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new gc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(e){e?(this.getAttributeManager()?.invalidate("getIcon"),this.setNeedsUpdate()):this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):Ui.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:s,anchorX:l=t/2,anchorY:d=s/2}=this.state.iconManager.getIconMapping(e);return[t/2-l,s/2-d]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:s,width:l,height:d}=this.state.iconManager.getIconMapping(e);return[t,s,l,d]}}c0.defaultProps=jz;c0.layerName="IconLayer";const jT=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,$z={name:"scatterplot",vs:jT,fs:jT,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Hz=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Wz=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,qz=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,$T=[0,0,0,255],Xz={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:$T},getLineColor:{type:"accessor",value:$T},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class s1 extends vh{getShaders(){return super.getShaders({vs:Hz,fs:Wz,source:qz,modules:[U_,CR,V_,$z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:s,radiusMinPixels:l,radiusMaxPixels:d,stroked:g,filled:o,billboard:A,antialiasing:M,lineWidthUnits:I,lineWidthScale:z,lineWidthMinPixels:W,lineWidthMaxPixels:J}=this.props,oe={stroked:g,filled:o,billboard:A,antialiasing:M,radiusUnits:_h[t],radiusScale:s,radiusMinPixels:l,radiusMaxPixels:d,lineWidthUnits:_h[I],lineWidthScale:z,lineWidthMinPixels:W,lineWidthMaxPixels:J},le=this.state.model;le.shaderInputs.setProps({scatterplot:oe}),this.context.device.type==="webgpu"&&(le.instanceCount=this.props.data.length),le.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new gc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jg({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}s1.defaultProps=Xz;s1.layerName="ScatterplotLayer";const VA={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function jA(i,e,t={}){return Gz(i,t)!==e?(Yz(i,t),!0):!1}function Gz(i,e={}){return Math.sign(Zz(i,e))}const HT={x:0,y:1,z:2};function Zz(i,e={}){const{start:t=0,end:s=i.length,plane:l="xy"}=e,d=e.size||2;let g=0;const o=HT[l[0]],A=HT[l[1]];for(let M=t,I=s-d;M<s;M+=d)g+=(i[M+o]-i[I+o])*(i[M+A]+i[I+A]),I=M;return g/2}function Yz(i,e){const{start:t=0,end:s=i.length,size:l=2}=e,d=(s-t)/l,g=Math.floor(d/2);for(let o=0;o<g;++o){const A=t+o*l,M=t+(d-1-o)*l;for(let I=0;I<l;++I){const z=i[A+I];i[A+I]=i[M+I],i[M+I]=z}}}function pc(i,e){const t=e.length,s=i.length;if(s>0){let l=!0;for(let d=0;d<t;d++)if(i[s-t+d]!==e[d]){l=!1;break}if(l)return!1}for(let l=0;l<t;l++)i[s+l]=e[l];return!0}function lx(i,e){const t=e.length;for(let s=0;s<t;s++)i[s]=e[s]}function k_(i,e,t,s,l=[]){const d=s+e*t;for(let g=0;g<t;g++)l[g]=i[d+g];return l}function cx(i,e,t,s,l=[]){let d,g;if(t&8)d=(s[3]-i[1])/(e[1]-i[1]),g=3;else if(t&4)d=(s[1]-i[1])/(e[1]-i[1]),g=1;else if(t&2)d=(s[2]-i[0])/(e[0]-i[0]),g=2;else if(t&1)d=(s[0]-i[0])/(e[0]-i[0]),g=0;else return null;for(let o=0;o<i.length;o++)l[o]=(g&1)===o?s[g]:d*(e[o]-i[o])+i[o];return l}function Tv(i,e){let t=0;return i[0]<e[0]?t|=1:i[0]>e[2]&&(t|=2),i[1]<e[1]?t|=4:i[1]>e[3]&&(t|=8),t}function $A(i,e){const{size:t=2,broken:s=!1,gridResolution:l=10,gridOffset:d=[0,0],startIndex:g=0,endIndex:o=i.length}=e||{},A=(o-g)/t;let M=[];const I=[M],z=k_(i,0,t,g);let W,J;const oe=WA(z,l,d,[]),le=[];pc(M,z);for(let ne=1;ne<A;ne++){for(W=k_(i,ne,t,g,W),J=Tv(W,oe);J;){cx(z,W,J,oe,le);const Ie=Tv(le,oe);Ie&&(cx(z,le,Ie,oe,le),J=Ie),pc(M,le),lx(z,le),Qz(oe,l,J),s&&M.length>t&&(M=[],I.push(M),pc(M,z)),J=Tv(W,oe)}pc(M,W),lx(z,W)}return s?I:I[0]}const WT=0,Kz=1;function HA(i,e=null,t){if(!i.length)return[];const{size:s=2,gridResolution:l=10,gridOffset:d=[0,0],edgeTypes:g=!1}=t||{},o=[],A=[{pos:i,types:g?new Array(i.length/s).fill(Kz):null,holes:e||[]}],M=[[],[]];let I=[];for(;A.length;){const{pos:z,types:W,holes:J}=A.shift();Jz(z,s,J[0]||z.length,M),I=WA(M[0],l,d,I);const oe=Tv(M[1],I);if(oe){let le=qT(z,W,s,0,J[0]||z.length,I,oe);const ne={pos:le[0].pos,types:le[0].types,holes:[]},Ie={pos:le[1].pos,types:le[1].types,holes:[]};A.push(ne,Ie);for(let Ue=0;Ue<J.length;Ue++)le=qT(z,W,s,J[Ue],J[Ue+1]||z.length,I,oe),le[0]&&(ne.holes.push(ne.pos.length),ne.pos=cv(ne.pos,le[0].pos),g&&(ne.types=cv(ne.types,le[0].types))),le[1]&&(Ie.holes.push(Ie.pos.length),Ie.pos=cv(Ie.pos,le[1].pos),g&&(Ie.types=cv(Ie.types,le[1].types)))}else{const le={positions:z};g&&(le.edgeTypes=W),J.length&&(le.holeIndices=J),o.push(le)}}return o}function qT(i,e,t,s,l,d,g){const o=(l-s)/t,A=[],M=[],I=[],z=[],W=[];let J,oe,le;const ne=k_(i,o-1,t,s);let Ie=Math.sign(g&8?ne[1]-d[3]:ne[0]-d[2]),Ue=e&&e[o-1],Se=0,Ve=0;for(let st=0;st<o;st++)J=k_(i,st,t,s,J),oe=Math.sign(g&8?J[1]-d[3]:J[0]-d[2]),le=e&&e[s/t+st],oe&&Ie&&Ie!==oe&&(cx(ne,J,g,d,W),pc(A,W)&&I.push(Ue),pc(M,W)&&z.push(Ue)),oe<=0?(pc(A,J)&&I.push(le),Se-=oe):I.length&&(I[I.length-1]=WT),oe>=0?(pc(M,J)&&z.push(le),Ve+=oe):z.length&&(z[z.length-1]=WT),lx(ne,J),Ie=oe,Ue=le;return[Se?{pos:A,types:e&&I}:null,Ve?{pos:M,types:e&&z}:null]}function WA(i,e,t,s){const l=Math.floor((i[0]-t[0])/e)*e+t[0],d=Math.floor((i[1]-t[1])/e)*e+t[1];return s[0]=l,s[1]=d,s[2]=l+e,s[3]=d+e,s}function Qz(i,e,t){t&8?(i[1]+=e,i[3]+=e):t&4?(i[1]-=e,i[3]-=e):t&2?(i[0]+=e,i[2]+=e):t&1&&(i[0]-=e,i[2]-=e)}function Jz(i,e,t,s){let l=1/0,d=-1/0,g=1/0,o=-1/0;for(let A=0;A<t;A+=e){const M=i[A],I=i[A+1];l=M<l?M:l,d=M>d?M:d,g=I<g?I:g,o=I>o?I:o}return s[0][0]=l,s[0][1]=g,s[1][0]=d,s[1][1]=o,s}function cv(i,e){for(let t=0;t<e.length;t++)i.push(e[t]);return i}const eF=85.051129;function tF(i,e){const{size:t=2,startIndex:s=0,endIndex:l=i.length,normalize:d=!0}=e||{},g=i.slice(s,l);qA(g,t,0,l-s);const o=$A(g,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(d)for(const A of o)XA(A,t);return o}function iF(i,e=null,t){const{size:s=2,normalize:l=!0,edgeTypes:d=!1}=t||{};e=e||[];const g=[],o=[];let A=0,M=0;for(let z=0;z<=e.length;z++){const W=e[z]||i.length,J=M,oe=nF(i,s,A,W);for(let le=oe;le<W;le++)g[M++]=i[le];for(let le=A;le<oe;le++)g[M++]=i[le];qA(g,s,J,M),rF(g,s,J,M,t?.maxLatitude),A=W,o[z]=M}o.pop();const I=HA(g,o,{size:s,gridResolution:360,gridOffset:[-180,-180],edgeTypes:d});if(l)for(const z of I)XA(z.positions,s);return I}function nF(i,e,t,s){let l=-1,d=-1;for(let g=t+1;g<s;g+=e){const o=Math.abs(i[g]);o>l&&(l=o,d=g-1)}return d}function rF(i,e,t,s,l=eF){const d=i[t],g=i[s-e];if(Math.abs(d-g)>180){const o=k_(i,0,e,t);o[0]+=Math.round((g-d)/360)*360,pc(i,o),o[1]=Math.sign(o[1])*l,pc(i,o),o[0]=d,pc(i,o)}}function qA(i,e,t,s){let l=i[0],d;for(let g=t;g<s;g+=e){d=i[g];const o=d-l;(o>180||o<-180)&&(d-=Math.round(o/360)*360),i[g]=l=d}}function XA(i,e){let t;const s=i.length/e;for(let d=0;d<s&&(t=i[d*e],(t+180)%360===0);d++);const l=-Math.round(t/360)*360;if(l!==0)for(let d=0;d<s;d++)i[d*e]+=l}function sF(i,e,t,s){let l;if(Array.isArray(i[0])){const d=i.length*e;l=new Array(d);for(let g=0;g<i.length;g++)for(let o=0;o<e;o++)l[g*e+o]=i[g][o]||0}else l=i;return t?$A(l,{size:e,gridResolution:t}):s?tF(l,{size:e}):l}const aF=1,oF=2,vb=4;class lF extends zA{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?sF(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(XT(e)){let s=0;for(const l of e)s+=this.getGeometrySize(l);return s}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&XT(e))for(const s of e){const l=this.getGeometrySize(s);t.geometrySize=l,this.updateGeometryAttributes(s,t),t.vertexStart+=l}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const s=this.attributes.segmentTypes,l=e?this.isClosed(e):!1,{vertexStart:d,geometrySize:g}=t;s.fill(0,d,d+g),l?(s[d]=vb,s[d+g-2]=vb):(s[d]+=aF,s[d+g-2]+=oF),s[d+g-1]=vb}_updatePositions(e,t){const{positions:s}=this.attributes;if(!s||!e)return;const{vertexStart:l,geometrySize:d}=t,g=new Array(3);for(let o=l,A=0;A<d;o++,A++)this.getPointOnPath(e,A,g),s[o*3]=g[0],s[o*3+1]=g[1],s[o*3+2]=g[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,s=[]){const{positionSize:l}=this;t*l>=e.length&&(t+=1-e.length/l);const d=t*l;return s[0]=e[d],s[1]=e[d+1],s[2]=l===3&&e[d+2]||0,s}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,s=e.length-t;return e[0]===e[s]&&e[1]===e[s+1]&&(t===2||e[2]===e[s+2])}}function XT(i){return Array.isArray(i[0])}const GT=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,cF={name:"path",vs:GT,fs:GT,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},uF=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,hF=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,GA=[0,0,0,255],fF={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:i=>i.path},getColor:{type:"accessor",value:GA},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},bb={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class a1 extends vh{getShaders(){return super.getShaders({vs:uF,fs:hF,modules:[U_,V_,cF]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:bb,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:bb,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:bb,defaultValue:GA},instancePickingColors:{size:4,type:"uint8",accessor:(s,{index:l,target:d})=>this.encodePickingColor(s&&s.__source?s.__source.index:l,d)}}),this.setState({pathTesselator:new lF({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:s}=e,l=this.getAttributeManager();if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPath)){const{pathTesselator:g}=this.state,o=t.data.attributes||{};g.updateGeometry({data:t.data,geometryBuffer:o.getPath,buffers:o,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:s.dataChanged}),this.setState({numInstances:g.instanceCount,startIndices:g.vertexStarts}),s.dataChanged||l.invalidateAll()}s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),l.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s}=t,l=this.props.data;return l[0]&&l[0].__source&&(t.object=l.find(d=>d.__source.index===s)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let s=0;s<t.length;s++)t[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:s,billboard:l,miterLimit:d,widthUnits:g,widthScale:o,widthMinPixels:A,widthMaxPixels:M}=this.props,I=this.state.model,z={jointType:Number(t),capType:Number(s),billboard:l,widthUnits:_h[g],widthScale:o,miterLimit:d,widthMinPixels:A,widthMaxPixels:M};I.shaderInputs.setProps({path:z}),I.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new gc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jg({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}a1.defaultProps=fF;a1.layerName="PathLayer";var uv={exports:{}},ZT;function dF(){if(ZT)return uv.exports;ZT=1,uv.exports=i,uv.exports.default=i;function i(re,be,_e){_e=_e||2;var Be=be&&be.length,nt=Be?be[0]*_e:re.length,he=e(re,0,nt,_e,!0),Oe=[];if(!he||he.next===he.prev)return Oe;var Je,gt,Mt,$t,Ht,Qt,vi;if(Be&&(he=A(re,be,he,_e)),re.length>80*_e){Je=Mt=re[0],gt=$t=re[1];for(var Mi=_e;Mi<nt;Mi+=_e)Ht=re[Mi],Qt=re[Mi+1],Ht<Je&&(Je=Ht),Qt<gt&&(gt=Qt),Ht>Mt&&(Mt=Ht),Qt>$t&&($t=Qt);vi=Math.max(Mt-Je,$t-gt),vi=vi!==0?32767/vi:0}return s(he,Oe,_e,Je,gt,vi,0),Oe}function e(re,be,_e,Be,nt){var he,Oe;if(nt===Yt(re,be,_e,Be)>0)for(he=be;he<_e;he+=Be)Oe=Lt(he,re[he],re[he+1],Oe);else for(he=_e-Be;he>=be;he-=Be)Oe=Lt(he,re[he],re[he+1],Oe);return Oe&&Ve(Oe,Oe.next)&&(Dt(Oe),Oe=Oe.next),Oe}function t(re,be){if(!re)return re;be||(be=re);var _e=re,Be;do if(Be=!1,!_e.steiner&&(Ve(_e,_e.next)||Se(_e.prev,_e,_e.next)===0)){if(Dt(_e),_e=be=_e.prev,_e===_e.next)break;Be=!0}else _e=_e.next;while(Be||_e!==be);return be}function s(re,be,_e,Be,nt,he,Oe){if(re){!Oe&&he&&J(re,Be,nt,he);for(var Je=re,gt,Mt;re.prev!==re.next;){if(gt=re.prev,Mt=re.next,he?d(re,Be,nt,he):l(re)){be.push(gt.i/_e|0),be.push(re.i/_e|0),be.push(Mt.i/_e|0),Dt(re),re=Mt.next,Je=Mt.next;continue}if(re=Mt,re===Je){Oe?Oe===1?(re=g(t(re),be,_e),s(re,be,_e,Be,nt,he,2)):Oe===2&&o(re,be,_e,Be,nt,he):s(t(re),be,_e,Be,nt,he,1);break}}}}function l(re){var be=re.prev,_e=re,Be=re.next;if(Se(be,_e,Be)>=0)return!1;for(var nt=be.x,he=_e.x,Oe=Be.x,Je=be.y,gt=_e.y,Mt=Be.y,$t=nt<he?nt<Oe?nt:Oe:he<Oe?he:Oe,Ht=Je<gt?Je<Mt?Je:Mt:gt<Mt?gt:Mt,Qt=nt>he?nt>Oe?nt:Oe:he>Oe?he:Oe,vi=Je>gt?Je>Mt?Je:Mt:gt>Mt?gt:Mt,Mi=Be.next;Mi!==be;){if(Mi.x>=$t&&Mi.x<=Qt&&Mi.y>=Ht&&Mi.y<=vi&&Ie(nt,Je,he,gt,Oe,Mt,Mi.x,Mi.y)&&Se(Mi.prev,Mi,Mi.next)>=0)return!1;Mi=Mi.next}return!0}function d(re,be,_e,Be){var nt=re.prev,he=re,Oe=re.next;if(Se(nt,he,Oe)>=0)return!1;for(var Je=nt.x,gt=he.x,Mt=Oe.x,$t=nt.y,Ht=he.y,Qt=Oe.y,vi=Je<gt?Je<Mt?Je:Mt:gt<Mt?gt:Mt,Mi=$t<Ht?$t<Qt?$t:Qt:Ht<Qt?Ht:Qt,Mr=Je>gt?Je>Mt?Je:Mt:gt>Mt?gt:Mt,An=$t>Ht?$t>Qt?$t:Qt:Ht>Qt?Ht:Qt,Oo=le(vi,Mi,be,_e,Be),gn=le(Mr,An,be,_e,Be),gi=re.prevZ,bi=re.nextZ;gi&&gi.z>=Oo&&bi&&bi.z<=gn;){if(gi.x>=vi&&gi.x<=Mr&&gi.y>=Mi&&gi.y<=An&&gi!==nt&&gi!==Oe&&Ie(Je,$t,gt,Ht,Mt,Qt,gi.x,gi.y)&&Se(gi.prev,gi,gi.next)>=0||(gi=gi.prevZ,bi.x>=vi&&bi.x<=Mr&&bi.y>=Mi&&bi.y<=An&&bi!==nt&&bi!==Oe&&Ie(Je,$t,gt,Ht,Mt,Qt,bi.x,bi.y)&&Se(bi.prev,bi,bi.next)>=0))return!1;bi=bi.nextZ}for(;gi&&gi.z>=Oo;){if(gi.x>=vi&&gi.x<=Mr&&gi.y>=Mi&&gi.y<=An&&gi!==nt&&gi!==Oe&&Ie(Je,$t,gt,Ht,Mt,Qt,gi.x,gi.y)&&Se(gi.prev,gi,gi.next)>=0)return!1;gi=gi.prevZ}for(;bi&&bi.z<=gn;){if(bi.x>=vi&&bi.x<=Mr&&bi.y>=Mi&&bi.y<=An&&bi!==nt&&bi!==Oe&&Ie(Je,$t,gt,Ht,Mt,Qt,bi.x,bi.y)&&Se(bi.prev,bi,bi.next)>=0)return!1;bi=bi.nextZ}return!0}function g(re,be,_e){var Be=re;do{var nt=Be.prev,he=Be.next.next;!Ve(nt,he)&&st(nt,Be,Be.next,he)&&lt(nt,he)&&lt(he,nt)&&(be.push(nt.i/_e|0),be.push(Be.i/_e|0),be.push(he.i/_e|0),Dt(Be),Dt(Be.next),Be=re=he),Be=Be.next}while(Be!==re);return t(Be)}function o(re,be,_e,Be,nt,he){var Oe=re;do{for(var Je=Oe.next.next;Je!==Oe.prev;){if(Oe.i!==Je.i&&Ue(Oe,Je)){var gt=xt(Oe,Je);Oe=t(Oe,Oe.next),gt=t(gt,gt.next),s(Oe,be,_e,Be,nt,he,0),s(gt,be,_e,Be,nt,he,0);return}Je=Je.next}Oe=Oe.next}while(Oe!==re)}function A(re,be,_e,Be){var nt=[],he,Oe,Je,gt,Mt;for(he=0,Oe=be.length;he<Oe;he++)Je=be[he]*Be,gt=he<Oe-1?be[he+1]*Be:re.length,Mt=e(re,Je,gt,Be,!1),Mt===Mt.next&&(Mt.steiner=!0),nt.push(ne(Mt));for(nt.sort(M),he=0;he<nt.length;he++)_e=I(nt[he],_e);return _e}function M(re,be){return re.x-be.x}function I(re,be){var _e=z(re,be);if(!_e)return be;var Be=xt(_e,re);return t(Be,Be.next),t(_e,_e.next)}function z(re,be){var _e=be,Be=re.x,nt=re.y,he=-1/0,Oe;do{if(nt<=_e.y&&nt>=_e.next.y&&_e.next.y!==_e.y){var Je=_e.x+(nt-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(Je<=Be&&Je>he&&(he=Je,Oe=_e.x<_e.next.x?_e:_e.next,Je===Be))return Oe}_e=_e.next}while(_e!==be);if(!Oe)return null;var gt=Oe,Mt=Oe.x,$t=Oe.y,Ht=1/0,Qt;_e=Oe;do Be>=_e.x&&_e.x>=Mt&&Be!==_e.x&&Ie(nt<$t?Be:he,nt,Mt,$t,nt<$t?he:Be,nt,_e.x,_e.y)&&(Qt=Math.abs(nt-_e.y)/(Be-_e.x),lt(_e,re)&&(Qt<Ht||Qt===Ht&&(_e.x>Oe.x||_e.x===Oe.x&&W(Oe,_e)))&&(Oe=_e,Ht=Qt)),_e=_e.next;while(_e!==gt);return Oe}function W(re,be){return Se(re.prev,re,be.prev)<0&&Se(be.next,re,re.next)<0}function J(re,be,_e,Be){var nt=re;do nt.z===0&&(nt.z=le(nt.x,nt.y,be,_e,Be)),nt.prevZ=nt.prev,nt.nextZ=nt.next,nt=nt.next;while(nt!==re);nt.prevZ.nextZ=null,nt.prevZ=null,oe(nt)}function oe(re){var be,_e,Be,nt,he,Oe,Je,gt,Mt=1;do{for(_e=re,re=null,he=null,Oe=0;_e;){for(Oe++,Be=_e,Je=0,be=0;be<Mt&&(Je++,Be=Be.nextZ,!!Be);be++);for(gt=Mt;Je>0||gt>0&&Be;)Je!==0&&(gt===0||!Be||_e.z<=Be.z)?(nt=_e,_e=_e.nextZ,Je--):(nt=Be,Be=Be.nextZ,gt--),he?he.nextZ=nt:re=nt,nt.prevZ=he,he=nt;_e=Be}he.nextZ=null,Mt*=2}while(Oe>1);return re}function le(re,be,_e,Be,nt){return re=(re-_e)*nt|0,be=(be-Be)*nt|0,re=(re|re<<8)&16711935,re=(re|re<<4)&252645135,re=(re|re<<2)&858993459,re=(re|re<<1)&1431655765,be=(be|be<<8)&16711935,be=(be|be<<4)&252645135,be=(be|be<<2)&858993459,be=(be|be<<1)&1431655765,re|be<<1}function ne(re){var be=re,_e=re;do(be.x<_e.x||be.x===_e.x&&be.y<_e.y)&&(_e=be),be=be.next;while(be!==re);return _e}function Ie(re,be,_e,Be,nt,he,Oe,Je){return(nt-Oe)*(be-Je)>=(re-Oe)*(he-Je)&&(re-Oe)*(Be-Je)>=(_e-Oe)*(be-Je)&&(_e-Oe)*(he-Je)>=(nt-Oe)*(Be-Je)}function Ue(re,be){return re.next.i!==be.i&&re.prev.i!==be.i&&!Ft(re,be)&&(lt(re,be)&&lt(be,re)&&kt(re,be)&&(Se(re.prev,re,be.prev)||Se(re,be.prev,be))||Ve(re,be)&&Se(re.prev,re,re.next)>0&&Se(be.prev,be,be.next)>0)}function Se(re,be,_e){return(be.y-re.y)*(_e.x-be.x)-(be.x-re.x)*(_e.y-be.y)}function Ve(re,be){return re.x===be.x&&re.y===be.y}function st(re,be,_e,Be){var nt=wt(Se(re,be,_e)),he=wt(Se(re,be,Be)),Oe=wt(Se(_e,Be,re)),Je=wt(Se(_e,Be,be));return!!(nt!==he&&Oe!==Je||nt===0&&ot(re,_e,be)||he===0&&ot(re,Be,be)||Oe===0&&ot(_e,re,Be)||Je===0&&ot(_e,be,Be))}function ot(re,be,_e){return be.x<=Math.max(re.x,_e.x)&&be.x>=Math.min(re.x,_e.x)&&be.y<=Math.max(re.y,_e.y)&&be.y>=Math.min(re.y,_e.y)}function wt(re){return re>0?1:re<0?-1:0}function Ft(re,be){var _e=re;do{if(_e.i!==re.i&&_e.next.i!==re.i&&_e.i!==be.i&&_e.next.i!==be.i&&st(_e,_e.next,re,be))return!0;_e=_e.next}while(_e!==re);return!1}function lt(re,be){return Se(re.prev,re,re.next)<0?Se(re,be,re.next)>=0&&Se(re,re.prev,be)>=0:Se(re,be,re.prev)<0||Se(re,re.next,be)<0}function kt(re,be){var _e=re,Be=!1,nt=(re.x+be.x)/2,he=(re.y+be.y)/2;do _e.y>he!=_e.next.y>he&&_e.next.y!==_e.y&&nt<(_e.next.x-_e.x)*(he-_e.y)/(_e.next.y-_e.y)+_e.x&&(Be=!Be),_e=_e.next;while(_e!==re);return Be}function xt(re,be){var _e=new Pt(re.i,re.x,re.y),Be=new Pt(be.i,be.x,be.y),nt=re.next,he=be.prev;return re.next=be,be.prev=re,_e.next=nt,nt.prev=_e,Be.next=_e,_e.prev=Be,he.next=Be,Be.prev=he,Be}function Lt(re,be,_e,Be){var nt=new Pt(re,be,_e);return Be?(nt.next=Be.next,nt.prev=Be,Be.next.prev=nt,Be.next=nt):(nt.prev=nt,nt.next=nt),nt}function Dt(re){re.next.prev=re.prev,re.prev.next=re.next,re.prevZ&&(re.prevZ.nextZ=re.nextZ),re.nextZ&&(re.nextZ.prevZ=re.prevZ)}function Pt(re,be,_e){this.i=re,this.x=be,this.y=_e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(re,be,_e,Be){var nt=be&&be.length,he=nt?be[0]*_e:re.length,Oe=Math.abs(Yt(re,0,he,_e));if(nt)for(var Je=0,gt=be.length;Je<gt;Je++){var Mt=be[Je]*_e,$t=Je<gt-1?be[Je+1]*_e:re.length;Oe-=Math.abs(Yt(re,Mt,$t,_e))}var Ht=0;for(Je=0;Je<Be.length;Je+=3){var Qt=Be[Je]*_e,vi=Be[Je+1]*_e,Mi=Be[Je+2]*_e;Ht+=Math.abs((re[Qt]-re[Mi])*(re[vi+1]-re[Qt+1])-(re[Qt]-re[vi])*(re[Mi+1]-re[Qt+1]))}return Oe===0&&Ht===0?0:Math.abs((Ht-Oe)/Oe)};function Yt(re,be,_e,Be){for(var nt=0,he=be,Oe=_e-Be;he<_e;he+=Be)nt+=(re[Oe]-re[he])*(re[he+1]+re[Oe+1]),Oe=he;return nt}return i.flatten=function(re){for(var be=re[0][0].length,_e={vertices:[],holes:[],dimensions:be},Be=0,nt=0;nt<re.length;nt++){for(var he=0;he<re[nt].length;he++)for(var Oe=0;Oe<be;Oe++)_e.vertices.push(re[nt][he][Oe]);nt>0&&(Be+=re[nt-1].length,_e.holes.push(Be))}return _e},uv.exports}var pF=dF();const gF=L_(pF),hv=VA.CLOCKWISE,YT=VA.COUNTER_CLOCKWISE,Cf={};function mF(i){if(i=i&&i.positions||i,!Array.isArray(i)&&!ArrayBuffer.isView(i))throw new Error("invalid polygon")}function y_(i){return"positions"in i?i.positions:i}function Sv(i){return"holeIndices"in i?i.holeIndices:null}function _F(i){return Array.isArray(i[0])}function yF(i){return i.length>=1&&i[0].length>=2&&Number.isFinite(i[0][0])}function vF(i){const e=i[0],t=i[i.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function bF(i,e,t,s){for(let l=0;l<e;l++)if(i[t+l]!==i[s-e+l])return!1;return!0}function KT(i,e,t,s,l){let d=e;const g=t.length;for(let o=0;o<g;o++)for(let A=0;A<s;A++)i[d++]=t[o][A]||0;if(!vF(t))for(let o=0;o<s;o++)i[d++]=t[0][o]||0;return Cf.start=e,Cf.end=d,Cf.size=s,jA(i,l,Cf),d}function QT(i,e,t,s,l=0,d,g){d=d||t.length;const o=d-l;if(o<=0)return e;let A=e;for(let M=0;M<o;M++)i[A++]=t[l+M];if(!bF(t,s,l,d))for(let M=0;M<s;M++)i[A++]=t[l+M];return Cf.start=e,Cf.end=A,Cf.size=s,jA(i,g,Cf),A}function xF(i,e){mF(i);const t=[],s=[];if("positions"in i){const{positions:l,holeIndices:d}=i;if(d){let g=0;for(let o=0;o<=d.length;o++)g=QT(t,g,l,e,d[o-1],d[o],o===0?hv:YT),s.push(g);return s.pop(),{positions:t,holeIndices:s}}i=l}if(!_F(i))return QT(t,0,i,e,0,t.length,hv),t;if(!yF(i)){let l=0;for(const[d,g]of i.entries())l=KT(t,l,g,e,d===0?hv:YT),s.push(l);return s.pop(),{positions:t,holeIndices:s}}return KT(t,0,i,e,hv),t}function xb(i,e,t){const s=i.length/3;let l=0;for(let d=0;d<s;d++){const g=(d+1)%s;l+=i[d*3+e]*i[g*3+t],l-=i[g*3+e]*i[d*3+t]}return Math.abs(l/2)}function JT(i,e,t,s){const l=i.length/3;for(let d=0;d<l;d++){const g=d*3,o=i[g+0],A=i[g+1],M=i[g+2];i[g+e]=o,i[g+t]=A,i[g+s]=M}}function wF(i,e,t,s){let l=Sv(i);l&&(l=l.map(o=>o/e));let d=y_(i);const g=s&&e===3;if(t){const o=d.length;d=d.slice();const A=[];for(let M=0;M<o;M+=e){A[0]=d[M],A[1]=d[M+1],g&&(A[2]=d[M+2]);const I=t(A);d[M]=I[0],d[M+1]=I[1],g&&(d[M+2]=I[2])}}if(g){const o=xb(d,0,1),A=xb(d,0,2),M=xb(d,1,2);if(!o&&!A&&!M)return[];o>A&&o>M||(A>M?(t||(d=d.slice()),JT(d,0,2,1)):(t||(d=d.slice()),JT(d,2,0,1)))}return gF(d,l,e)}class TF extends zA{constructor(e){const{fp64:t,IndexType:s=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:s,size:1}}})}get(e){const{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=xF(e,this.positionSize);return this.opts.resolution?HA(y_(t),Sv(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?iF(y_(t),Sv(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(e2(e)){let t=0;for(const s of e)t+=this.getGeometrySize(s);return t}return y_(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&e2(e))for(const s of e){const l=this.getGeometrySize(s);t.geometrySize=l,this.updateGeometryAttributes(s,t),t.vertexStart+=l,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const s=e;this._updateIndices(s,t),this._updatePositions(s,t),this._updateVertexValid(s,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:s,indexStart:l}){const{attributes:d,indexStarts:g,typedArrayManager:o}=this;let A=d.indices;if(!A||!e)return;let M=l;const I=wF(e,this.positionSize,this.opts.preproject,this.opts.full3d);A=o.allocate(A,l+I.length,{copy:!0});for(let z=0;z<I.length;z++)A[M++]=I[z]+s;g[t+1]=l+I.length,d.indices=A}_updatePositions(e,{vertexStart:t,geometrySize:s}){const{attributes:{positions:l},positionSize:d}=this;if(!l||!e)return;const g=y_(e);for(let o=t,A=0;A<s;o++,A++){const M=g[A*d],I=g[A*d+1],z=d>2?g[A*d+2]:0;l[o*3]=M,l[o*3+1]=I,l[o*3+2]=z}}_updateVertexValid(e,{vertexStart:t,geometrySize:s}){const{positionSize:l}=this,d=this.attributes.vertexValid,g=e&&Sv(e);if(e&&e.edgeTypes?d.set(e.edgeTypes,t):d.fill(1,t,t+s),g)for(let o=0;o<g.length;o++)d[t+g[o]/l-1]=0;d[t+s-1]=0}}function e2(i){return Array.isArray(i)&&i.length>0&&!Number.isFinite(i[0])}const t2=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,SF={name:"solidPolygon",vs:t2,fs:t2,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},ZA=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,AF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${ZA}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,EF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${ZA}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,CF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Yv=[0,0,0,255],MF={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:i=>i.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Yv},getLineColor:{type:"accessor",value:Yv},material:!0},fv={enter:(i,e)=>e.length?e.subarray(e.length-i.length):i};class o1 extends vh{getShaders(e){return super.getShaders({vs:e==="top"?AF:EF,fs:CF,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[U_,NS,V_,SF]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:s}=this.props;e.isGeospatial&&t===Qi.DEFAULT&&(t=Qi.LNGLAT);let l;t===Qi.LNGLAT&&(s?l=e.projectPosition.bind(e):l=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new TF({preproject:l,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const d=this.getAttributeManager(),g=!0;d.remove(["instancePickingColors"]),d.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:g},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:fv,accessor:"getPolygon",update:this.calculatePositions,noAlloc:g,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:g},elevations:{size:1,stepMode:"dynamic",transition:fv,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:fv,accessor:"getFillColor",defaultValue:Yv},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:fv,accessor:"getLineColor",defaultValue:Yv},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(o,{index:A,target:M})=>this.encodePickingColor(o&&o.__source?o.__source.index:A,M)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s}=t,l=this.props.data;return l[0]&&l[0].__source&&(t.object=l.find(d=>d.__source.index===s)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let s=0;s<t.length;s++)t[s].__source.index===e&&this._disablePickingIndex(s);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:s,wireframe:l,elevationScale:d}=this.props,{topModel:g,sideModel:o,wireframeModel:A,polygonTesselator:M}=this.state,I={extruded:!!t,elevationScale:d,isWireframe:!1};A&&l&&(A.setInstanceCount(M.instanceCount-1),A.shaderInputs.setProps({solidPolygon:{...I,isWireframe:!0}}),A.draw(this.context.renderPass)),o&&s&&(o.setInstanceCount(M.instanceCount-1),o.shaderInputs.setProps({solidPolygon:I}),o.draw(this.context.renderPass)),g&&s&&(g.setVertexCount(M.vertexCount),g.shaderInputs.setProps({solidPolygon:I}),g.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:s,changeFlags:l}=e,d=this.getAttributeManager();(l.extensionsChanged||t.filled!==s.filled||t.extruded!==s.extruded)&&(this.state.models?.forEach(o=>o.destroy()),this.setState(this._getModels()),d.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:s}){if(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon)){const{polygonTesselator:d}=this.state,g=e.data.attributes||{};d.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:g.getPolygon,buffers:g,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:e._full3d}),this.setState({numInstances:d.instanceCount,startIndices:d.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:s}=this.props;let l,d,g;if(t){const o=this.getShaders("top");o.defines.NON_INSTANCED_MODEL=1;const A=this.getAttributeManager().getBufferLayouts({isInstanced:!1});l=new gc(this.context.device,{...o,id:`${e}-top`,topology:"triangle-list",bufferLayout:A,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(s){const o=this.getAttributeManager().getBufferLayouts({isInstanced:!0});d=new gc(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:o,geometry:new Jg({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),g=new gc(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:o,geometry:new Jg({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[d,g,l].filter(Boolean),topModel:l,sideModel:d,wireframeModel:g}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}o1.defaultProps=MF;o1.layerName="SolidPolygonLayer";function PF({data:i,getIndex:e,dataRange:t,replace:s}){const{startRow:l=0,endRow:d=1/0}=t,g=i.length;let o=g,A=g;for(let W=0;W<g;W++){const J=e(i[W]);if(o>W&&J>=l&&(o=W),J>=d){A=W;break}}let M=o;const z=A-o!==s.length?i.slice(A):void 0;for(let W=0;W<s.length;W++)i[M++]=s[W];if(z){for(let W=0;W<z.length;W++)i[M++]=z[W];i.length=M}return{startRow:o,endRow:o+s.length}}function IF(i,e){if(!i)return null;const t="startIndices"in i?i.startIndices[e]:e,s=i.featureIds.value[t];return t!==-1?RF(i,s,t):null}function RF(i,e,t){const s={properties:{...i.properties[e]}};for(const l in i.numericProps)s.properties[l]=i.numericProps[l].value[t];return s}function DF(i,e){const t={points:null,lines:null,polygons:null};for(const s in t){const l=i[s].globalFeatureIds.value;t[s]=new Uint8ClampedArray(l.length*4);const d=[];for(let g=0;g<l.length;g++)e(l[g],d),t[s][g*4+0]=d[0],t[s][g*4+1]=d[1],t[s][g*4+2]=d[2],t[s][g*4+3]=255}return t}const i2=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,OF={name:"sdf",vs:i2,fs:i2,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},kF=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,wb=192/256,n2=[],LF={getIconOffsets:{type:"accessor",value:i=>i.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class l1 extends c0{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,OF],fs:kF}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:s,target:l})=>this.encodePickingColor(s,l)}})}updateState(e){super.updateState(e);const{props:t,oldProps:s}=e,{outlineColor:l}=t;if(l!==s.outlineColor){const d=[l[0]/255,l[1]/255,l[2]/255,(l[3]??255)/255];this.setState({outlineColor:d})}!t.sdf&&t.outlineWidth&&Ui.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:s,outlineWidth:l}=this.props,{outlineColor:d}=this.state,g=l?Math.max(s,wb*(1-l)):-1,o=this.state.model,A={buffer:wb,outlineBuffer:g,gamma:s,enabled:!!t,outlineColor:d};if(o.shaderInputs.setProps({sdf:A}),super.draw(e),t&&l){const{iconManager:M}=this.state;M.getTexture()&&(o.shaderInputs.setProps({sdf:{...A,outlineBuffer:wb}}),o.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):n2}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):n2}}l1.defaultProps=LF;l1.layerName="MultiIconLayer";const C_=1e20;class BF{constructor({fontSize:e=24,buffer:t=3,radius:s=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:o="normal",lang:A=null}={}){this.buffer=t,this.cutoff=l,this.radius=s,this.lang=A;const M=this.size=e+t*4,I=this._createCanvas(M),z=this.ctx=I.getContext("2d",{willReadFrequently:!0});z.font=`${o} ${g} ${e}px ${d}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(e),o=Math.ceil(s),A=0,M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),I=Math.min(this.size-this.buffer,o+Math.ceil(l)),z=M+2*this.buffer,W=I+2*this.buffer,J=Math.max(z*W,0),oe=new Uint8ClampedArray(J),le={data:oe,width:z,height:W,glyphWidth:M,glyphHeight:I,glyphTop:o,glyphLeft:A,glyphAdvance:t};if(M===0||I===0)return le;const{ctx:ne,buffer:Ie,gridInner:Ue,gridOuter:Se}=this;this.lang&&(ne.lang=this.lang),ne.clearRect(Ie,Ie,M,I),ne.fillText(e,Ie,Ie+o);const Ve=ne.getImageData(Ie,Ie,M,I);Se.fill(C_,0,J),Ue.fill(0,0,J);for(let st=0;st<I;st++)for(let ot=0;ot<M;ot++){const wt=Ve.data[4*(st*M+ot)+3]/255;if(wt===0)continue;const Ft=(st+Ie)*z+ot+Ie;if(wt===1)Se[Ft]=0,Ue[Ft]=C_;else{const lt=.5-wt;Se[Ft]=lt>0?lt*lt:0,Ue[Ft]=lt<0?lt*lt:0}}r2(Se,0,0,z,W,z,this.f,this.v,this.z),r2(Ue,Ie,Ie,M,I,z,this.f,this.v,this.z);for(let st=0;st<J;st++){const ot=Math.sqrt(Se[st])-Math.sqrt(Ue[st]);oe[st]=Math.round(255-255*(ot/this.radius+this.cutoff))}return le}}function r2(i,e,t,s,l,d,g,o,A){for(let M=e;M<e+s;M++)s2(i,t*d+M,d,l,g,o,A);for(let M=t;M<t+l;M++)s2(i,M*d+e,1,s,g,o,A)}function s2(i,e,t,s,l,d,g){d[0]=0,g[0]=-C_,g[1]=C_,l[0]=i[e];for(let o=1,A=0,M=0;o<s;o++){l[o]=i[e+o*t];const I=o*o;do{const z=d[A];M=(l[o]-l[z]+I-z*z)/(o-z)/2}while(M<=g[A]&&--A>-1);A++,d[A]=o,g[A]=M,g[A+1]=C_}for(let o=0,A=0;o<s;o++){for(;g[A+1]<o;)A++;const M=d[A],I=o-M;i[e+o*t]=l[M]+I*I}}const zF=32,FF=[];function NF(i){return Math.pow(2,Math.ceil(Math.log2(i)))}function UF({characterSet:i,getFontWidth:e,fontHeight:t,buffer:s,maxCanvasWidth:l,mapping:d={},xOffset:g=0,yOffset:o=0}){let A=0,M=g;const I=t+s*2;for(const z of i)if(!d[z]){const W=e(z);M+W+s*2>l&&(M=0,A++),d[z]={x:M+s,y:o+A*I+s,width:W,height:I,layoutWidth:W,layoutHeight:t},M+=W+s*2}return{mapping:d,xOffset:M,yOffset:o+A*I,canvasHeight:NF(o+(A+1)*I)}}function YA(i,e,t,s){let l=0;for(let d=e;d<t;d++){const g=i[d];l+=s[g]?.layoutWidth||0}return l}function KA(i,e,t,s,l,d){let g=e,o=0;for(let A=e;A<t;A++){const M=YA(i,A,A+1,l);o+M>s&&(g<A&&d.push(A),g=A,o=0),o+=M}return o}function VF(i,e,t,s,l,d){let g=e,o=e,A=e,M=0;for(let I=e;I<t;I++)if((i[I]===" "||i[I+1]===" "||I+1===t)&&(A=I+1),A>o){let z=YA(i,o,A,l);M+z>s&&(g<o&&(d.push(o),g=o,M=0),z>s&&(z=KA(i,o,A,s,l,d),g=d[d.length-1])),o=A,M+=z}return M}function jF(i,e,t,s,l=0,d){d===void 0&&(d=i.length);const g=[];return e==="break-all"?KA(i,l,d,t,s,g):VF(i,l,d,t,s,g),g}function $F(i,e,t,s,l,d){let g=0,o=0;for(let A=e;A<t;A++){const M=i[A],I=s[M];I?(o||(o=I.layoutHeight),l[A]=g+I.layoutWidth/2,g+=I.layoutWidth):(Ui.warn(`Missing character: ${M} (${M.codePointAt(0)})`)(),l[A]=g,g+=zF)}d[0]=g,d[1]=o}function HF(i,e,t,s,l){const d=Array.from(i),g=d.length,o=new Array(g),A=new Array(g),M=new Array(g),I=(t==="break-word"||t==="break-all")&&isFinite(s)&&s>0,z=[0,0],W=[0,0];let J=0,oe=0,le=0;for(let ne=0;ne<=g;ne++){const Ie=d[ne];if((Ie===`
`||ne===g)&&(le=ne),le>oe){const Ue=I?jF(d,t,s,l,oe,le):FF;for(let Se=0;Se<=Ue.length;Se++){const Ve=Se===0?oe:Ue[Se-1],st=Se<Ue.length?Ue[Se]:le;$F(d,Ve,st,l,o,W);for(let ot=Ve;ot<st;ot++){const wt=d[ot],Ft=l[wt]?.layoutOffsetY||0;A[ot]=J+W[1]/2+Ft,M[ot]=W[0]}J=J+W[1]*e,z[0]=Math.max(z[0],W[0])}oe=le}Ie===`
`&&(o[oe]=0,A[oe]=0,M[oe]=0,oe++)}return z[1]=J,{x:o,y:A,rowWidth:M,size:z}}function WF({value:i,length:e,stride:t,offset:s,startIndices:l,characterSet:d}){const g=i.BYTES_PER_ELEMENT,o=t?t/g:1,A=s?s/g:0,M=l[e]||Math.ceil((i.length-A)/o),I=d&&new Set,z=new Array(e);let W=i;if(o>1||A>0){const J=i.constructor;W=new J(M);for(let oe=0;oe<M;oe++)W[oe]=i[oe*o+A]}for(let J=0;J<e;J++){const oe=l[J],le=l[J+1]||M,ne=W.subarray(oe,le);z[J]=String.fromCodePoint.apply(null,ne),I&&ne.forEach(I.add,I)}if(I)for(const J of I)d.add(String.fromCodePoint(J));return{texts:z,characterCount:M}}class QA{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}function qF(){const i=[];for(let e=32;e<128;e++)i.push(String.fromCharCode(e));return i}const Hg={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:qF(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},a2=1024,o2=.9,l2=1.2,JA=3;let Kv=new QA(JA);function XF(i,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);const s=Kv.get(i);if(!s)return t;for(const l in s.mapping)t.has(l)&&t.delete(l);return t}function GF(i,e){for(let t=0;t<i.length;t++)e.data[4*t+3]=i[t]}function c2(i,e,t,s){i.font=`${s} ${t}px ${e}`,i.fillStyle="#000",i.textBaseline="alphabetic",i.textAlign="left"}function ZF(i){Ui.assert(Number.isFinite(i)&&i>=JA,"Invalid cache limit"),Kv=new QA(i)}class YF{constructor(){this.props={...Hg}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(e*l2+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=XF(this._key,this.props.characterSet),s=Kv.get(this._key);if(s&&t.size===0){this._atlas!==s&&(this._atlas=s);return}const l=this._generateFontAtlas(t,s);this._atlas=l,Kv.set(this._key,l)}_generateFontAtlas(e,t){const{fontFamily:s,fontWeight:l,fontSize:d,buffer:g,sdf:o,radius:A,cutoff:M}=this.props;let I=t&&t.data;I||(I=document.createElement("canvas"),I.width=a2);const z=I.getContext("2d",{willReadFrequently:!0});c2(z,s,d,l);const{mapping:W,canvasHeight:J,xOffset:oe,yOffset:le}=UF({getFontWidth:ne=>z.measureText(ne).width,fontHeight:d*l2,buffer:g,characterSet:e,maxCanvasWidth:a2,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(I.height!==J){const ne=z.getImageData(0,0,I.width,I.height);I.height=J,z.putImageData(ne,0,0)}if(c2(z,s,d,l),o){const ne=new BF({fontSize:d,buffer:g,radius:A,cutoff:M,fontFamily:s,fontWeight:`${l}`});for(const Ie of e){const{data:Ue,width:Se,height:Ve,glyphTop:st}=ne.draw(Ie);W[Ie].width=Se,W[Ie].layoutOffsetY=d*o2-st;const ot=z.createImageData(Se,Ve);GF(Ue,ot),z.putImageData(ot,W[Ie].x,W[Ie].y)}}else for(const ne of e)z.fillText(ne,W[ne].x,W[ne].y+g+d*o2);return{xOffset:oe,yOffset:le,mapping:W,data:I,width:I.width,height:I.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:s,buffer:l,sdf:d,radius:g,cutoff:o}=this.props;return d?`${e} ${t} ${s} ${l} ${g} ${o}`:`${e} ${t} ${s} ${l}`}}const u2=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,KF={name:"textBackground",vs:u2,fs:u2,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},QF=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,JF=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,eN={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:i=>i.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class c1 extends vh{getShaders(){return super.getShaders({vs:QF,fs:JF,modules:[U_,V_,KF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:s,sizeUnits:l,sizeMinPixels:d,sizeMaxPixels:g,getLineWidth:o}=this.props;let{padding:A,borderRadius:M}=this.props;A.length<4&&(A=[A[0],A[1],A[0],A[1]]),Array.isArray(M)||(M=[M,M,M,M]);const I=this.state.model,z={billboard:t,stroked:!!o,borderRadius:M,padding:A,sizeUnits:_h[l],sizeScale:s,sizeMinPixels:d,sizeMaxPixels:g};I.shaderInputs.setProps({textBackground:z}),I.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new gc(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Jg({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}c1.defaultProps=eN;c1.layerName="TextBackgroundLayer";const h2={start:1,middle:0,end:-1},f2={top:1,center:0,bottom:-1},Tb=[0,0,0,255],tN=1,iN={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Tb},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Hg.characterSet},fontFamily:Hg.fontFamily,fontWeight:Hg.fontWeight,lineHeight:tN,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Tb},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:i=>i.text},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:Tb},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class u0 extends r1{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[s,l]}=this.transformParagraph(e,t);const{fontSize:d}=this.state.fontAtlasManager.props;s/=d,l/=d;const{getTextAnchor:g,getAlignmentBaseline:o}=this.props,A=h2[typeof g=="function"?g(e,t):g],M=f2[typeof o=="function"?o(e,t):o];return[(A-1)*s/2,(M-1)*l/2,s,l]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:s,getAlignmentBaseline:l}=this.props,{x:d,y:g,rowWidth:o,size:[A,M]}=this.transformParagraph(e,t),I=h2[typeof s=="function"?s(e,t):s],z=f2[typeof l=="function"?l(e,t):l],W=d.length,J=new Array(W*2);let oe=0;for(let le=0;le<W;le++){const ne=(1-I)*(A-o[le])/2;J[oe++]=(I-1)*A/2+ne+d[le],J[oe++]=(z-1)*M/2+g[le]}return J}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new YF},this.props.maxWidth>0&&Ui.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:s,changeFlags:l}=e;(l.dataChanged||l.updateTriggersChanged&&(l.updateTriggersChanged.all||l.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==s.lineHeight||t.wordBreak!==s.wordBreak||t.maxWidth!==s.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:s}=this.props,{fontAtlasManager:l,characterSet:d}=this.state,g={...e,characterSet:d,fontFamily:t,fontWeight:s};if(!l.mapping)return l.setProps(g),!0;for(const o in g)if(g[o]!==l.props[o])return l.setProps(g),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,s=e.attributes?.getText;let{getText:l}=this.props,d=e.startIndices,g;const o=t==="auto"&&new Set;if(s&&d){const{texts:A,characterCount:M}=WF({...ArrayBuffer.isView(s)?{value:s}:s,length:e.length,startIndices:d,characterSet:o});g=M,l=(I,{index:z})=>A[z]}else{const{iterable:A,objectInfo:M}=a0(e);d=[0],g=0;for(const I of A){M.index++;const z=Array.from(l(I,M)||"");o&&z.forEach(o.add,o),g+=z.length,d.push(g)}}this.setState({getText:l,startIndices:d,numInstances:g,characterSet:o||t})}transformParagraph(e,t){const{fontAtlasManager:s}=this.state,l=s.mapping,d=this.state.getText,{wordBreak:g,lineHeight:o,maxWidth:A}=this.props,M=d(e,t)||"";return HF(M,o,g,A*s.props.fontSize,l)}renderLayers(){const{startIndices:e,numInstances:t,getText:s,fontAtlasManager:{scale:l,atlas:d,mapping:g},styleVersion:o}=this.state,{data:A,_dataDiff:M,getPosition:I,getColor:z,getSize:W,getAngle:J,getPixelOffset:oe,getBackgroundColor:le,getBorderColor:ne,getBorderWidth:Ie,backgroundBorderRadius:Ue,backgroundPadding:Se,background:Ve,billboard:st,fontSettings:ot,outlineWidth:wt,outlineColor:Ft,sizeScale:lt,sizeUnits:kt,sizeMinPixels:xt,sizeMaxPixels:Lt,transitions:Dt,updateTriggers:Pt}=this.props,Yt=this.getSubLayerClass("characters",l1),re=this.getSubLayerClass("background",c1);return[Ve&&new re({getFillColor:le,getLineColor:ne,getLineWidth:Ie,borderRadius:Ue,padding:Se,getPosition:I,getSize:W,getAngle:J,getPixelOffset:oe,billboard:st,sizeScale:lt,sizeUnits:kt,sizeMinPixels:xt,sizeMaxPixels:Lt,transitions:Dt&&{getPosition:Dt.getPosition,getAngle:Dt.getAngle,getSize:Dt.getSize,getFillColor:Dt.getBackgroundColor,getLineColor:Dt.getBorderColor,getLineWidth:Dt.getBorderWidth,getPixelOffset:Dt.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Pt.getPosition,getAngle:Pt.getAngle,getSize:Pt.getSize,getFillColor:Pt.getBackgroundColor,getLineColor:Pt.getBorderColor,getLineWidth:Pt.getBorderWidth,getPixelOffset:Pt.getPixelOffset,getBoundingRect:{getText:Pt.getText,getTextAnchor:Pt.getTextAnchor,getAlignmentBaseline:Pt.getAlignmentBaseline,styleVersion:o}}}),{data:A.attributes&&A.attributes.background?{length:A.length,attributes:A.attributes.background}:A,_dataDiff:M,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Yt({sdf:ot.sdf,smoothing:Number.isFinite(ot.smoothing)?ot.smoothing:Hg.smoothing,outlineWidth:wt/(ot.radius||Hg.radius),outlineColor:Ft,iconAtlas:d,iconMapping:g,getPosition:I,getColor:z,getSize:W,getAngle:J,getPixelOffset:oe,billboard:st,sizeScale:lt*l,sizeUnits:kt,sizeMinPixels:xt*l,sizeMaxPixels:Lt*l,transitions:Dt&&{getPosition:Dt.getPosition,getAngle:Dt.getAngle,getColor:Dt.getColor,getSize:Dt.getSize,getPixelOffset:Dt.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Pt.getText,getPosition:Pt.getPosition,getAngle:Pt.getAngle,getColor:Pt.getColor,getSize:Pt.getSize,getPixelOffset:Pt.getPixelOffset,getIconOffsets:{getTextAnchor:Pt.getTextAnchor,getAlignmentBaseline:Pt.getAlignmentBaseline,styleVersion:o}}}),{data:A,_dataDiff:M,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:s})]}static set fontAtlasCacheLimit(e){ZF(e)}}u0.defaultProps=iN;u0.layerName="TextLayer";const Av={circle:{type:s1,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:c0,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:u0,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ev={type:a1,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},ux={type:o1,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function f_({type:i,props:e}){const t={};for(const s in e)t[s]=i.defaultProps[e[s]];return t}function Sb(i,e){const{transitions:t,updateTriggers:s}=i.props,l={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(const d in e){const g=e[d];let o=i.props[d];d.startsWith("get")&&(o=i.getSubLayerAccessor(o),l.updateTriggers[g]=s[d],t&&(l.transitions[g]=t[d])),l[g]=o}return l}function nN(i){if(Array.isArray(i))return i;switch(Ui.assert(i.type,"GeoJSON does not have type"),i.type){case"Feature":return[i];case"FeatureCollection":return Ui.assert(Array.isArray(i.features),"GeoJSON does not have features array"),i.features;default:return[{geometry:i}]}}function d2(i,e,t={}){const s={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:l=0,endRow:d=i.length}=t;for(let g=l;g<d;g++){const o=i[g],{geometry:A}=o;if(A)if(A.type==="GeometryCollection"){Ui.assert(Array.isArray(A.geometries),"GeoJSON does not have geometries array");const{geometries:M}=A;for(let I=0;I<M.length;I++){const z=M[I];p2(z,s,e,o,g)}}else p2(A,s,e,o,g)}return s}function p2(i,e,t,s,l){const{type:d,coordinates:g}=i,{pointFeatures:o,lineFeatures:A,polygonFeatures:M,polygonOutlineFeatures:I}=e;if(!sN(d,g)){Ui.warn(`${d} coordinates are malformed`)();return}switch(d){case"Point":o.push(t({geometry:i},s,l));break;case"MultiPoint":g.forEach(z=>{o.push(t({geometry:{type:"Point",coordinates:z}},s,l))});break;case"LineString":A.push(t({geometry:i},s,l));break;case"MultiLineString":g.forEach(z=>{A.push(t({geometry:{type:"LineString",coordinates:z}},s,l))});break;case"Polygon":M.push(t({geometry:i},s,l)),g.forEach(z=>{I.push(t({geometry:{type:"LineString",coordinates:z}},s,l))});break;case"MultiPolygon":g.forEach(z=>{M.push(t({geometry:{type:"Polygon",coordinates:z}},s,l)),z.forEach(W=>{I.push(t({geometry:{type:"LineString",coordinates:W}},s,l))})});break}}const rN={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function sN(i,e){let t=rN[i];for(Ui.assert(t,`Unknown GeoJSON type ${i}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function eE(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function dv(i){return i.geometry.coordinates}function aN(i,e){const t=eE(),{pointFeatures:s,lineFeatures:l,polygonFeatures:d,polygonOutlineFeatures:g}=i;return t.points.data=s,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=dv,t.lines.data=l,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=dv,t.polygons.data=d,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=dv,t.polygonsOutline.data=g,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=dv,t}function oN(i,e){const t=eE(),{points:s,lines:l,polygons:d}=i,g=DF(i,e);t.points.data={length:s.positions.value.length/s.positions.size,attributes:{...s.attributes,getPosition:s.positions,instancePickingColors:{size:4,value:g.points}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.lines.data={length:l.pathIndices.value.length-1,startIndices:l.pathIndices.value,attributes:{...l.attributes,getPath:l.positions,instancePickingColors:{size:4,value:g.lines}},properties:l.properties,numericProps:l.numericProps,featureIds:l.featureIds},t.lines._pathType="open";const o=d.positions.value.length/d.positions.size,A=Array(o).fill(1);for(const M of d.primitivePolygonIndices.value)A[M-1]=0;return t.polygons.data={length:d.polygonIndices.value.length-1,startIndices:d.polygonIndices.value,attributes:{...d.attributes,getPolygon:d.positions,instanceVertexValid:{size:1,value:new Uint16Array(A)},pickingColors:{size:4,value:g.polygons}},properties:d.properties,numericProps:d.numericProps,featureIds:d.featureIds},t.polygons._normalize=!1,d.triangles&&(t.polygons.data.attributes.indices=d.triangles.value),t.polygonsOutline.data={length:d.primitivePolygonIndices.value.length-1,startIndices:d.primitivePolygonIndices.value,attributes:{...d.attributes,getPath:d.positions,instancePickingColors:{size:4,value:g.polygons}},properties:d.properties,numericProps:d.numericProps,featureIds:d.featureIds},t.polygonsOutline._pathType="open",t}const lN=["points","linestrings","polygons"],cN={...f_(Av.circle),...f_(Av.icon),...f_(Av.text),...f_(Ev),...f_(ux),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:i=>i.properties.icon},getText:{type:"accessor",value:i=>i.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class u1 extends r1{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:s}=this.props,l=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:l}),l?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const s=oN(e.data,this.encodePickingColor);this.setState({layerProps:s})}_updateStateJSON({props:e,changeFlags:t}){const s=nN(e.data),l=this.getSubLayerRow.bind(this);let d={};const g={};if(Array.isArray(t.dataChanged)){const A=this.state.features;for(const M in A)d[M]=A[M].slice(),g[M]=[];for(const M of t.dataChanged){const I=d2(s,l,M);for(const z in A)g[z].push(PF({data:d[z],getIndex:W=>W.__source.index,dataRange:M,replace:I[z]}))}}else d=d2(s,l);const o=aN(d,g);this.setState({features:d,featuresDiff:g,layerProps:o})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:s,sourceLayer:l}=t;return t.featureType=lN.find(d=>l.id.startsWith(`${this.id}-${d}-`)),s>=0&&l.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[s]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,s=e.featureType==="points";for(const l of this.getSubLayers())l.id.startsWith(t)===s&&l.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:s}=this.state,l="polygons-fill",d=this.shouldRenderSubLayer(l,s.polygons?.data)&&this.getSubLayerClass(l,ux.type);if(d){const g=Sb(this,ux.props),o=e&&t;return o||delete g.getLineColor,g.updateTriggers.lineColors=o,new d(g,this.getSubLayerProps({id:l,updateTriggers:g.updateTriggers}),s.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:s}=this.state,l="polygons-stroke",d="linestrings",g=!e&&t&&this.shouldRenderSubLayer(l,s.polygonsOutline?.data)&&this.getSubLayerClass(l,Ev.type),o=this.shouldRenderSubLayer(d,s.lines?.data)&&this.getSubLayerClass(d,Ev.type);if(g||o){const A=Sb(this,Ev.props);return[g&&new g(A,this.getSubLayerProps({id:l,updateTriggers:A.updateTriggers}),s.polygonsOutline),o&&new o(A,this.getSubLayerProps({id:d,updateTriggers:A.updateTriggers}),s.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:s}=this.state;let{highlightedObjectIndex:l}=this.props;!s&&Number.isFinite(l)&&(l=t.points.data.findIndex(o=>o.__source.index===l));const d=new Set(e.split("+")),g=[];for(const o of d){const A=`points-${o}`,M=Av[o],I=M&&this.shouldRenderSubLayer(A,t.points?.data)&&this.getSubLayerClass(A,M.type);if(I){const z=Sb(this,M.props);let W=t.points;if(o==="text"&&s){const{instancePickingColors:J,...oe}=W.data.attributes;W={...W,data:{...W.data,attributes:oe}}}g.push(new I(z,this.getSubLayerProps({id:A,updateTriggers:z.updateTriggers,highlightedObjectIndex:l}),W))}}return g}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer(),s=this._renderLineLayers(),l=this._renderPointLayers();return[!e&&t,s,l,e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(s,l)=>{const{data:d,index:g}=l,o=IF(d,g);return e(o,l)}}}u1.layerName="GeoJsonLayer";u1.defaultProps=cN;const tE=Si.createContext({viewport:null,setViewport:()=>{}});function uN({children:i}){const[e,t]=Si.useState(null);return Dn.jsx(tE,{value:{viewport:e,setViewport:t},children:i})}function iE(){return Si.useContext(tE)}var Ab,g2;function hN(){if(g2)return Ab;g2=1;for(var i="0123456789bcdefghjkmnpqrstuvwxyz",e={},t=0;t<i.length;t++)e[i.charAt(t)]=t;var s="auto",l=-90,d=90,g=-180,o=180,A=[0,5,7,8,11,12,13,15,16,17,18],M=function(lt,kt,xt){if(xt===s){if(typeof lt=="number"||typeof kt=="number")throw new Error("string notation required for auto precision.");var Lt=lt.split(".")[1].length,Dt=kt.split(".")[1].length,Pt=Math.max(Lt,Dt);xt=A[Pt]}else xt===void 0&&(xt=9);for(var Yt=[],re=0,be=0,_e=0,Be=d,nt=l,he=o,Oe=g,Je;Yt.length<xt;)if(be%2===0?(Je=(he+Oe)/2,kt>Je?(_e=(_e<<1)+1,Oe=Je):(_e=(_e<<1)+0,he=Je)):(Je=(Be+nt)/2,lt>Je?(_e=(_e<<1)+1,nt=Je):(_e=(_e<<1)+0,Be=Je)),re++,be++,re===5){var gt=i[_e];Yt.push(gt),re=0,_e=0}return Yt.join("")},I=function(lt,kt,xt){xt=xt||52;for(var Lt=0,Dt=d,Pt=l,Yt=o,re=g,be,_e=0;Lt<xt;)_e*=2,Lt%2===0?(be=(Yt+re)/2,kt>be?(_e+=1,re=be):Yt=be):(be=(Dt+Pt)/2,lt>be?(_e+=1,Pt=be):Dt=be),Lt++;return _e},z=function(lt){for(var kt=!0,xt=d,Lt=l,Dt=o,Pt=g,Yt,re=0,be=0,_e=lt.length;be<_e;be++){var Be=lt[be].toLowerCase();re=e[Be];for(var nt=4;nt>=0;nt--){var he=re>>nt&1;kt?(Yt=(Dt+Pt)/2,he===1?Pt=Yt:Dt=Yt):(Yt=(xt+Lt)/2,he===1?Lt=Yt:xt=Yt),kt=!kt}}return[Lt,Pt,xt,Dt]},W=function(lt,kt){kt=kt||52;for(var xt=d,Lt=l,Dt=o,Pt=g,Yt=0,re=0,be=kt/2,_e=0;_e<be;_e++)re=J(lt,(be-_e)*2-1),Yt=J(lt,(be-_e)*2-2),Yt===0?xt=(xt+Lt)/2:Lt=(xt+Lt)/2,re===0?Dt=(Dt+Pt)/2:Pt=(Dt+Pt)/2;return[Lt,Pt,xt,Dt]};function J(lt,kt){return lt/Math.pow(2,kt)&1}var oe=function(lt){var kt=z(lt),xt=(kt[0]+kt[2])/2,Lt=(kt[1]+kt[3])/2,Dt=kt[2]-xt,Pt=kt[3]-Lt;return{latitude:xt,longitude:Lt,error:{latitude:Dt,longitude:Pt}}},le=function(lt,kt){var xt=W(lt,kt),Lt=(xt[0]+xt[2])/2,Dt=(xt[1]+xt[3])/2,Pt=xt[2]-Lt,Yt=xt[3]-Dt;return{latitude:Lt,longitude:Dt,error:{latitude:Pt,longitude:Yt}}},ne=function(lt,kt){var xt=oe(lt),Lt=xt.latitude+kt[0]*xt.error.latitude*2,Dt=xt.longitude+kt[1]*xt.error.longitude*2;return Dt=ot(Dt),Lt=wt(Lt),M(Lt,Dt,lt.length)},Ie=function(lt,kt,xt){xt=xt||52;var Lt=le(lt,xt),Dt=Lt.latitude+kt[0]*Lt.error.latitude*2,Pt=Lt.longitude+kt[1]*Lt.error.longitude*2;return Pt=ot(Pt),Dt=wt(Dt),I(Dt,Pt,xt)},Ue=function(lt){var kt=lt.length,xt=oe(lt),Lt=xt.latitude,Dt=xt.longitude,Pt=xt.error.latitude*2,Yt=xt.error.longitude*2,re,be,_e=[Be(1,0),Be(1,1),Be(0,1),Be(-1,1),Be(-1,0),Be(-1,-1),Be(0,-1),Be(1,-1)];function Be(nt,he){return re=Lt+nt*Pt,be=Dt+he*Yt,be=ot(be),re=wt(re),M(re,be,kt)}return _e},Se=function(lt,kt){kt=kt||52;var xt=le(lt,kt),Lt=xt.latitude,Dt=xt.longitude,Pt=xt.error.latitude*2,Yt=xt.error.longitude*2,re,be,_e=[Be(1,0),Be(1,1),Be(0,1),Be(-1,1),Be(-1,0),Be(-1,-1),Be(0,-1),Be(1,-1)];function Be(nt,he){return re=Lt+nt*Pt,be=Dt+he*Yt,be=ot(be),re=wt(re),I(re,be,kt)}return _e},Ve=function(lt,kt,xt,Lt,Dt){Dt=Dt||9;for(var Pt=M(lt,kt,Dt),Yt=M(xt,Lt,Dt),re=oe(Pt),be=re.error.latitude*2,_e=re.error.longitude*2,Be=z(Pt),nt=z(Yt),he=Math.round((nt[0]-Be[0])/be),Oe=Math.round((nt[1]-Be[1])/_e),Je=[],gt=0;gt<=he;gt++)for(var Mt=0;Mt<=Oe;Mt++)Je.push(ne(Pt,[gt,Mt]));return Je},st=function(lt,kt,xt,Lt,Dt){Dt=Dt||52;for(var Pt=I(lt,kt,Dt),Yt=I(xt,Lt,Dt),re=le(Pt,Dt),be=re.error.latitude*2,_e=re.error.longitude*2,Be=W(Pt,Dt),nt=W(Yt,Dt),he=Math.round((nt[0]-Be[0])/be),Oe=Math.round((nt[1]-Be[1])/_e),Je=[],gt=0;gt<=he;gt++)for(var Mt=0;Mt<=Oe;Mt++)Je.push(Ie(Pt,[gt,Mt],Dt));return Je};function ot(lt){return lt>o?g+lt%o:lt<g?o+lt%o:lt}function wt(lt){return lt>d?d:lt<l?l:lt}var Ft={ENCODE_AUTO:s,encode:M,encode_uint64:I,encode_int:I,decode:oe,decode_int:le,decode_uint64:le,decode_bbox:z,decode_bbox_uint64:W,decode_bbox_int:W,neighbor:ne,neighbor_int:Ie,neighbors:Ue,neighbors_int:Se,bboxes:Ve,bboxes_int:st};return Ab=Ft,Ab}var fN=hN();const $_=L_(fN),dN=250,m2=1;function nE(i){return i>=14?7:i>=12?6:i>=8?5:i>=6?4:i>=4?3:2}function _2(i,e){const{south:t,west:s,north:l,east:d}=i;return $_.bboxes(t,s,l,d,e)}function pN(i,e){let t=nE(e);for(;t>m2;){const s=_2(i,t);if(s.length<=dN)return s;t-=1}return _2(i,m2)}function gN(i,e,t){return $_.encode(i,e,t)}function mN(i){const{latitude:e,longitude:t}=$_.decode(i);return{lat:e,lng:t}}function _N(i){return{type:"FeatureCollection",features:i.map(e=>{const[t,s,l,d]=$_.decode_bbox(e);return{type:"Feature",properties:{hash:e},geometry:{type:"Polygon",coordinates:[[[s,t],[d,t],[d,l],[s,l],[s,t]]]}}})}}const y2=[28,163,236],v2=[255,140,0],b2=77,yN=77,vN=180;function bN(i){const{viewport:e}=iE(),[t,s]=Si.useState(null);Si.useEffect(()=>{i!=="geohash"&&s(null)},[i]);const l=Si.useMemo(()=>!e||i!=="geohash"?[]:pN(e,e.zoom),[e,i]),d=Si.useMemo(()=>_N(l),[l]),g=Si.useCallback(({lng:z,lat:W})=>{if(i!=="geohash"||!e)return;const J=l[0]?.length??nE(e.zoom),oe=gN(W,z,J);if(!l.includes(oe)){s(null);return}s(le=>le?.hash===oe?null:{hash:oe,center:mN(oe)})},[i,e,l]),o=Si.useMemo(()=>i!=="geohash"?null:new u1({id:"geohash-grid",data:d,pickable:!1,stroked:!0,filled:!0,lineWidthMinPixels:1,getFillColor:z=>z.properties?.hash===t?.hash?[...v2,yN]:[0,0,0,0],getLineColor:z=>z.properties?.hash===t?.hash?[...v2,b2]:[...y2,b2],updateTriggers:{getFillColor:t?.hash,getLineColor:t?.hash}}),[d,t,i]),A=Si.useMemo(()=>l.map(z=>{const[,W,J]=$_.decode_bbox(z);return{position:[W+.001,J-.001],text:z}}),[l]),M=Si.useMemo(()=>i!=="geohash"?null:new u0({id:"geohash-labels",data:A,getPosition:z=>z.position,getText:z=>z.text,getSize:15,getColor:[...y2,vN],getTextAnchor:"start",getAlignmentBaseline:"top",fontFamily:"monospace",pickable:!1}),[A,i]);return{layers:Si.useMemo(()=>[o,M].filter(Boolean),[o,M]),onClick:g,selectedCell:t}}var Cv={exports:{}};var xN=Cv.exports,x2;function wN(){return x2||(x2=1,(function(i,e){(function(t,s){i.exports=s()})(xN,(function(){var t={},s={};function l(g,o,A){if(s[g]=A,g==="index"){var M="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",I={};return s.shared(I),s.index(t,I),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([M],{type:"text/javascript"}))),t}}l("shared",["exports"],(function(g){function o(c,n,a,p){return new(a||(a=Promise))((function(_,b){function x(O){try{P(p.next(O))}catch(B){b(B)}}function E(O){try{P(p.throw(O))}catch(B){b(B)}}function P(O){var B;O.done?_(O.value):(B=O.value,B instanceof a?B:new a((function(F){F(B)}))).then(x,E)}P((p=p.apply(c,n||[])).next())}))}function A(c,n){this.x=c,this.y=n}function M(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var I,z;typeof SuppressedError=="function"&&SuppressedError,A.prototype={clone(){return new A(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,n){return this.clone()._rotateAround(c,n)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const n=c.x-this.x,a=c.y-this.y;return n*n+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,n){return Math.atan2(this.x*n-this.y*c,this.x*c+this.y*n)},_matMult(c){const n=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=n,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const n=Math.cos(c),a=Math.sin(c),p=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=p,this},_rotateAround(c,n){const a=Math.cos(c),p=Math.sin(c),_=n.y+p*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-p*(this.y-n.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:A},A.convert=function(c){if(c instanceof A)return c;if(Array.isArray(c))return new A(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new A(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};var W=(function(){if(z)return I;function c(n,a,p,_){this.cx=3*n,this.bx=3*(p-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(_-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=p,this.p2y=_}return z=1,I=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var p=n,_=0;_<8;_++){var b=this.sampleCurveX(p)-n;if(Math.abs(b)<a)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=b/x}var E=0,P=1;for(p=n,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-n)<a));_++)n>b?E=p:P=p,p=.5*(P-E)+E;return p},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},I})(),J=M(W);let oe,le;function ne(){return oe==null&&(oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oe}function Ie(){if(le==null&&(le=!1,ne())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let p=0;p<25;p++){const _=4*p;n.fillStyle=`rgb(${_},${_+1},${_+2})`,n.fillRect(p%5,Math.floor(p/5),1,1)}const a=n.getImageData(0,0,5,5).data;for(let p=0;p<100;p++)if(p%4!=3&&a[p]!==p){le=!0;break}}}return le||!1}var Ue=1e-6,Se=typeof Float32Array<"u"?Float32Array:Array;function Ve(){var c=new Se(9);return Se!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function st(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ot(){var c=new Se(3);return Se!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function wt(c){var n=c[0],a=c[1],p=c[2];return Math.sqrt(n*n+a*a+p*p)}function Ft(c,n,a){var p=new Se(3);return p[0]=c,p[1]=n,p[2]=a,p}function lt(c,n,a){return c[0]=n[0]+a[0],c[1]=n[1]+a[1],c[2]=n[2]+a[2],c}function kt(c,n,a){return c[0]=n[0]*a,c[1]=n[1]*a,c[2]=n[2]*a,c}function xt(c,n,a){var p=n[0],_=n[1],b=n[2],x=a[0],E=a[1],P=a[2];return c[0]=_*P-b*E,c[1]=b*x-p*P,c[2]=p*E-_*x,c}var Lt,Dt=wt;function Pt(c,n,a){var p=n[0],_=n[1],b=n[2],x=n[3];return c[0]=a[0]*p+a[4]*_+a[8]*b+a[12]*x,c[1]=a[1]*p+a[5]*_+a[9]*b+a[13]*x,c[2]=a[2]*p+a[6]*_+a[10]*b+a[14]*x,c[3]=a[3]*p+a[7]*_+a[11]*b+a[15]*x,c}function Yt(){var c=new Se(4);return Se!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function re(c,n,a,p){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",b=Math.PI/360;n*=b,p*=b,a*=b;var x=Math.sin(n),E=Math.cos(n),P=Math.sin(a),O=Math.cos(a),B=Math.sin(p),F=Math.cos(p);switch(_){case"xyz":c[0]=x*O*F+E*P*B,c[1]=E*P*F-x*O*B,c[2]=E*O*B+x*P*F,c[3]=E*O*F-x*P*B;break;case"xzy":c[0]=x*O*F-E*P*B,c[1]=E*P*F-x*O*B,c[2]=E*O*B+x*P*F,c[3]=E*O*F+x*P*B;break;case"yxz":c[0]=x*O*F+E*P*B,c[1]=E*P*F-x*O*B,c[2]=E*O*B-x*P*F,c[3]=E*O*F+x*P*B;break;case"yzx":c[0]=x*O*F+E*P*B,c[1]=E*P*F+x*O*B,c[2]=E*O*B-x*P*F,c[3]=E*O*F-x*P*B;break;case"zxy":c[0]=x*O*F-E*P*B,c[1]=E*P*F+x*O*B,c[2]=E*O*B+x*P*F,c[3]=E*O*F-x*P*B;break;case"zyx":c[0]=x*O*F-E*P*B,c[1]=E*P*F+x*O*B,c[2]=E*O*B-x*P*F,c[3]=E*O*F+x*P*B;break;default:throw new Error("Unknown angle order "+_)}return c}function be(){var c=new Se(2);return Se!=Float32Array&&(c[0]=0,c[1]=0),c}function _e(c,n){var a=new Se(2);return a[0]=c,a[1]=n,a}ot(),Lt=new Se(4),Se!=Float32Array&&(Lt[0]=0,Lt[1]=0,Lt[2]=0,Lt[3]=0),ot(),Ft(1,0,0),Ft(0,1,0),Yt(),Yt(),Ve(),be();const Be=8192;function nt(c,n,a){return n*(Be/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}function he(c,n){return(c%n+n)%n}function Oe(c,n,a){return c*(1-a)+n*a}function Je(c){if(c<=0)return 0;if(c>=1)return 1;const n=c*c,a=n*c;return 4*(c<.5?a:3*(c-n)+a-.75)}function gt(c,n,a,p){const _=new J(c,n,a,p);return b=>_.solve(b)}const Mt=gt(.25,.1,.25,1);function $t(c,n,a){return Math.min(a,Math.max(n,c))}function Ht(c,n,a){const p=a-n,_=((c-n)%p+p)%p+n;return _===n?a:_}function Qt(c,...n){for(const a of n)for(const p in a)c[p]=a[p];return c}let vi=1;function Mi(c,n,a){const p={};for(const _ in c)p[_]=n.call(this,c[_],_,c);return p}function Mr(c,n,a){const p={};for(const _ in c)n.call(this,c[_],_,c)&&(p[_]=c[_]);return p}function An(c){return Array.isArray(c)?c.map(An):typeof c=="object"&&c?Mi(c,An):c}const Oo={};function gn(c){Oo[c]||(typeof console<"u"&&console.warn(c),Oo[c]=!0)}function gi(c,n,a){return(a.y-c.y)*(n.x-c.x)>(n.y-c.y)*(a.x-c.x)}function bi(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let mn=null;function Ea(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ko="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function to(c,n,a,p,_){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(c,{timestamp:0});try{const x=b?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const E=x.startsWith("BGR"),P=new Uint8ClampedArray(p*_*4);if(yield b.copyTo(P,(function(O,B,F,V,j){const X=4*Math.max(-B,0),Z=(Math.max(0,F)-F)*V*4+X,Q=4*V,se=Math.max(0,B),ge=Math.max(0,F);return{rect:{x:se,y:ge,width:Math.min(O.width,B+V)-se,height:Math.min(O.height,F+j)-ge},layout:[{offset:Z,stride:Q}]}})(c,n,a,p,_)),E)for(let O=0;O<P.length;O+=4){const B=P[O];P[O]=P[O+2],P[O+2]=B}return P}finally{b.close()}}))}let Ca,oa;function yc(c,n,a,p){return c.addEventListener(n,a,p),{unsubscribe:()=>{c.removeEventListener(n,a,p)}}}function rr(c){return c*Math.PI/180}function gs(c){return c/Math.PI*180}const vc={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},io={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},no="AbortError";class fu extends Error{constructor(n=no){super(n instanceof Error?n.message:n),this.name=no,n instanceof Error&&n.stack&&(this.stack=n.stack)}}function Lo(c){return c.name===no}const ze={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(c){return ze.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const K="global-dispatcher";class ee extends Error{constructor(n,a,p,_){super(`AJAXError: ${a} (${n}): ${p}`),this.status=n,this.statusText=a,this.url=p,this.body=_}}const ve=()=>bi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Me=function(c,n){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const p=G(c.url);if(p)return p(c,n);if(bi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:K},n)}if(!(/^file:/.test(a=c.url)||/^file:/.test(ve())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(p,_){return o(this,void 0,void 0,(function*(){const b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:ve(),signal:_.signal});let x,E;p.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");try{x=yield fetch(b)}catch(O){throw Lo(O)?O:new ee(0,O.message,p.url,new Blob)}if(!x.ok){const O=yield x.blob();throw new ee(x.status,x.statusText,p.url,O)}E=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const P=yield E;return _.signal.throwIfAborted(),{data:P,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}}))})(c,n);if(bi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:K},n)}var a;return(function(p,_){return new Promise(((b,x)=>{var E;const P=new XMLHttpRequest;P.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(P.responseType="arraybuffer");for(const O in p.headers)P.setRequestHeader(O,p.headers[O]);p.type==="json"&&(P.responseType="text",!((E=p.headers)===null||E===void 0)&&E.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=p.credentials==="include",P.onerror=()=>{x(new Error(P.statusText))},P.onload=()=>{if(!_.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let O=P.response;if(p.type==="json")try{O=JSON.parse(P.response)}catch(B){return void x(B)}b({data:O,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const O=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});x(new ee(P.status,P.statusText,p.url,O))}},_.signal.addEventListener("abort",(()=>{P.abort(),x(new fu(_.signal.reason))})),P.send(p.body)}))})(c,n)};function Xe(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const n=new URL(c),a=window.location;return n.protocol===a.protocol&&n.host===a.host}function We(c,n,a){a[c]&&a[c].indexOf(n)!==-1||(a[c]=a[c]||[],a[c].push(n))}function Fe(c,n,a){if(a&&a[c]){const p=a[c].indexOf(n);p!==-1&&a[c].splice(p,1)}}class qe{constructor(n,a={}){Qt(this,a),this.type=n}}class yt extends qe{constructor(n,a={}){super("error",Qt({error:n},a))}}class ut{on(n,a){return this._listeners=this._listeners||{},We(n,a,this._listeners),{unsubscribe:()=>{this.off(n,a)}}}off(n,a){return Fe(n,a,this._listeners),Fe(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},We(n,a,this._oneTimeListeners),this):new Promise((p=>this.once(n,p)))}fire(n,a){typeof n=="string"&&(n=new qe(n,a||{}));const p=n.type;if(this.listens(p)){n.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of _)E.call(this,n);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of b)Fe(p,E,this._oneTimeListeners),E.call(this,n);const x=this._eventedParent;x&&(Qt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof yt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Wt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ai(c,n){const a={};for(const p in c)p!=="ref"&&(a[p]=c[p]);return Wt.forEach((p=>{p in n&&(a[p]=n[p])})),a}function Jt(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!Jt(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!Jt(c[a],n[a]))return!1;return!0}return c===n}function ii(c,n){c.push(n)}function ni(c,n,a){ii(a,{command:"addSource",args:[c,n[c]]})}function oi(c,n,a){ii(n,{command:"removeSource",args:[c]}),a[c]=!0}function _n(c,n,a,p){oi(c,a,p),ni(c,n,a)}function kn(c,n,a){let p;for(p in c[a])if(Object.prototype.hasOwnProperty.call(c[a],p)&&p!=="data"&&!Jt(c[a][p],n[a][p]))return!1;for(p in n[a])if(Object.prototype.hasOwnProperty.call(n[a],p)&&p!=="data"&&!Jt(c[a][p],n[a][p]))return!1;return!0}function En(c,n,a,p,_,b){c=c||{},n=n||{};for(const x in c)Object.prototype.hasOwnProperty.call(c,x)&&(Jt(c[x],n[x])||a.push({command:b,args:[p,x,n[x],_]}));for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&!Object.prototype.hasOwnProperty.call(c,x)&&(Jt(c[x],n[x])||a.push({command:b,args:[p,x,n[x],_]}))}function Tr(c){return c.id}function yn(c,n){return c[n.id]=n,c}class Tt{constructor(n,a,p,_){this.message=(n?`${n}: `:"")+p,_&&(this.identifier=_),a!=null&&a.__line__&&(this.line=a.__line__)}}function Li(c,...n){for(const a of n)for(const p in a)c[p]=a[p];return c}class ln extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class Qr{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[p,_]of a)this.bindings[p]=_}concat(n){return new Qr(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Hi={kind:"null"},Ct={kind:"number"},ti={kind:"string"},hi={kind:"boolean"},ms={kind:"color"},bh={kind:"projectionDefinition"},Ma={kind:"object"},fi={kind:"value"},bl={kind:"collator"},Pa={kind:"formatted"},ro={kind:"padding"},Ia={kind:"colorArray"},Ra={kind:"numberArray"},Ln={kind:"resolvedImage"},bc={kind:"variableAnchorOffsetCollection"};function Pr(c,n){return{kind:"array",itemType:c,N:n}}function Ii(c){if(c.kind==="array"){const n=Ii(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const so=[Hi,Ct,ti,hi,ms,bh,Pa,Ma,Pr(fi),ro,Ra,Ia,Ln,bc];function xc(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!xc(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const a of so)if(!xc(a,n))return null}}return`Expected ${Ii(c)} but found ${Ii(n)} instead.`}function wc(c,n){return n.some((a=>a.kind===c.kind))}function Bo(c,n){return n.some((a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c))}function la(c,n){return c.kind==="array"&&n.kind==="array"?c.itemType.kind===n.itemType.kind&&typeof c.N=="number":c.kind===n.kind}const du=.96422,Da=.82521,zs=4/29,Bi=6/29,Rf=3*Bi*Bi,sp=Bi*Bi*Bi,xl=Math.PI/180,Df=180/Math.PI;function pu(c){return(c%=360)<0&&(c+=360),c}function ap([c,n,a,p]){let _,b;const x=gu((.2225045*(c=Nr(c))+.7168786*(n=Nr(n))+.0606169*(a=Nr(a)))/1);c===n&&n===a?_=b=x:(_=gu((.4360747*c+.3850649*n+.1430804*a)/du),b=gu((.0139322*c+.0971045*n+.7141733*a)/Da));const E=116*x-16;return[E<0?0:E,500*(_-x),200*(x-b),p]}function Nr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function gu(c){return c>sp?Math.pow(c,1/3):c/Rf+zs}function xh([c,n,a,p]){let _=(c+16)/116,b=isNaN(n)?_:_+n/500,x=isNaN(a)?_:_-a/200;return _=1*zo(_),b=du*zo(b),x=Da*zo(x),[mu(3.1338561*b-1.6168667*_-.4906146*x),mu(-.9787684*b+1.9161415*_+.033454*x),mu(.0719453*b-.2289914*_+1.4052427*x),p]}function mu(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function zo(c){return c>Bi?c*c*c:Rf*(c-zs)}const op=Object.hasOwn||function(c,n){return Object.prototype.hasOwnProperty.call(c,n)};function Tc(c,n){return op(c,n)?c[n]:void 0}function ao(c){return parseInt(c.padEnd(2,c),16)/255}function lp(c,n){return wl(n?c/100:c,0,1)}function wl(c,n,a){return Math.min(Math.max(n,c),a)}function wh(c){return!c.some(Number.isNaN)}const Tl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Fo(c,n,a){return c+a*(n-c)}function Sc(c,n,a){return c.map(((p,_)=>Fo(p,n[_],a)))}class mi{constructor(n,a,p,_=1,b=!0){this.r=n,this.g=a,this.b=p,this.a=_,b||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[n,a,p,_]))}static parse(n){if(n instanceof mi)return n;if(typeof n!="string")return;const a=(function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Tc(Tl,p);if(_){const[x,E,P]=_;return[x/255,E/255,P/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let E=1;return[ao(p.slice(E,E+=x)),ao(p.slice(E,E+=x)),ao(p.slice(E,E+=x)),ao(p.slice(E,E+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[E,P,O,B,F,V,j,X,Z,Q,se,ge]=x,ie=[B||" ",j||" ",Q].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const ue=[O,V,Z].join(""),Te=ue==="%%%"?100:ue===""?255:0;if(Te){const Re=[wl(+P/Te,0,1),wl(+F/Te,0,1),wl(+X/Te,0,1),se?lp(+se,ge):1];if(wh(Re))return Re}}return}}const b=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[x,E,P,O,B,F,V,j,X]=b,Z=[P||" ",B||" ",V].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const Q=[+E,wl(+O,0,100),wl(+F,0,100),j?lp(+j,X):1];if(wh(Q))return(function([se,ge,ie,ue]){function Te(Re){const Ye=(Re+se/30)%12,ft=ge*Math.min(ie,1-ie);return ie-ft*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return se=pu(se),ge/=100,ie/=100,[Te(0),Te(8),Te(4),ue]})(Q)}}})(n);return a?new mi(...a,!1):void 0}get rgb(){const{r:n,g:a,b:p,a:_}=this,b=_||1/0;return this.overwriteGetter("rgb",[n/b,a/b,p/b,_])}get hcl(){return this.overwriteGetter("hcl",(function(n){const[a,p,_,b]=ap(n),x=Math.sqrt(p*p+_*_);return[Math.round(1e4*x)?pu(Math.atan2(_,p)*Df):NaN,x,a,b]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ap(this.rgb))}overwriteGetter(n,a){return Object.defineProperty(this,n,{value:a}),a}toString(){const[n,a,p,_]=this.rgb;return`rgba(${[n,a,p].map((b=>Math.round(255*b))).join(",")},${_})`}static interpolate(n,a,p,_="rgb"){switch(_){case"rgb":{const[b,x,E,P]=Sc(n.rgb,a.rgb,p);return new mi(b,x,E,P,!1)}case"hcl":{const[b,x,E,P]=n.hcl,[O,B,F,V]=a.hcl;let j,X;if(isNaN(b)||isNaN(O))isNaN(b)?isNaN(O)?j=NaN:(j=O,E!==1&&E!==0||(X=B)):(j=b,F!==1&&F!==0||(X=x));else{let ie=O-b;O>b&&ie>180?ie-=360:O<b&&b-O>180&&(ie+=360),j=b+p*ie}const[Z,Q,se,ge]=(function([ie,ue,Te,Re]){return ie=isNaN(ie)?0:ie*xl,xh([Te,Math.cos(ie)*ue,Math.sin(ie)*ue,Re])})([j,X??Fo(x,B,p),Fo(E,F,p),Fo(P,V,p)]);return new mi(Z,Q,se,ge,!1)}case"lab":{const[b,x,E,P]=xh(Sc(n.lab,a.lab,p));return new mi(b,x,E,P,!1)}}}}mi.black=new mi(0,0,0,1),mi.white=new mi(1,1,1,1),mi.transparent=new mi(0,0,0,0),mi.red=new mi(1,0,0,1);class ca{constructor(n,a,p){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Of=["bottom","center","top"];class _u{constructor(n,a,p,_,b,x){this.text=n,this.image=a,this.scale=p,this.fontStack=_,this.textColor=b,this.verticalAlign=x}}class sr{constructor(n){this.sections=n}static fromString(n){return new sr([new _u(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((n=>n.text.length!==0||n.image&&n.image.name.length!==0))}static factory(n){return n instanceof sr?n:sr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map((n=>n.text)).join("")}}class Zn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Zn)return n;if(typeof n=="number")return new Zn([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const a of n)if(typeof a!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Zn(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){return new Zn(Sc(n.values,a.values,p))}}class vn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof vn)return n;if(typeof n=="number")return new vn([n]);if(Array.isArray(n)){for(const a of n)if(typeof a!="number")return;return new vn(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){return new vn(Sc(n.values,a.values,p))}}class ri{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof ri)return n;if(typeof n=="string"){const p=mi.parse(n);return p?new ri([p]):void 0}if(!Array.isArray(n))return;const a=[];for(const p of n){if(typeof p!="string")return;const _=mi.parse(p);if(!_)return;a.push(_)}return new ri(a)}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p,_="rgb"){const b=[];if(n.values.length!=a.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${a.values.length}), cannot interpolate.`);for(let x=0;x<n.values.length;x++)b.push(mi.interpolate(n.values[x],a.values[x],p,_));return new ri(b)}}class Ji extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}const Fs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bn{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Bn)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let a=0;a<n.length;a+=2){const p=n[a],_=n[a+1];if(typeof p!="string"||!Fs.has(p)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Bn(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){const _=n.values,b=a.values;if(_.length!==b.length)throw new Ji(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${a.toString()}`);const x=[];for(let E=0;E<_.length;E+=2){if(_[E]!==b[E])throw new Ji(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${_[E]}, to[${E}]: ${b[E]}`);x.push(_[E]);const[P,O]=_[E+1],[B,F]=b[E+1];x.push([Fo(P,B,p),Fo(O,F,p)])}return new Bn(x)}}class Ur{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Ur({name:n,available:!1}):null}}class ar{constructor(n,a,p){this.from=n,this.to=a,this.transition=p}static interpolate(n,a,p){return new ar(n,a,p)}static parse(n){return n instanceof ar?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new ar(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new ar(n.from,n.to,n.transition):typeof n=="string"?new ar(n,n,1):void 0}}function _s(c,n,a,p){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[c,n,a,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[c,n,a,p]:[c,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oa(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof ar||c instanceof mi||c instanceof ca||c instanceof sr||c instanceof Zn||c instanceof vn||c instanceof ri||c instanceof Bn||c instanceof Ur)return!0;if(Array.isArray(c)){for(const n of c)if(!Oa(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!Oa(c[n]))return!1;return!0}return!1}function bn(c){if(c===null)return Hi;if(typeof c=="string")return ti;if(typeof c=="boolean")return hi;if(typeof c=="number")return Ct;if(c instanceof mi)return ms;if(c instanceof ar)return bh;if(c instanceof ca)return bl;if(c instanceof sr)return Pa;if(c instanceof Zn)return ro;if(c instanceof vn)return Ra;if(c instanceof ri)return Ia;if(c instanceof Bn)return bc;if(c instanceof Ur)return Ln;if(Array.isArray(c)){const n=c.length;let a;for(const p of c){const _=bn(p);if(a){if(a===_)continue;a=fi;break}a=_}return Pr(a||fi,n)}return Ma}function No(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof mi||c instanceof ar||c instanceof sr||c instanceof Zn||c instanceof vn||c instanceof ri||c instanceof Bn||c instanceof Ur?c.toString():JSON.stringify(c)}class ys{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Oa(n[1]))return a.error("invalid value");const p=n[1];let _=bn(p);const b=a.expectedType;return _.kind!=="array"||_.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(_=b),new ys(_,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Sl={string:ti,number:Ct,boolean:hi,object:Ma};class Vr{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let p,_=1;const b=n[0];if(b==="array"){let E,P;if(n.length>2){const O=n[1];if(typeof O!="string"||!(O in Sl)||O==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);E=Sl[O],_++}else E=fi;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);P=n[2],_++}p=Pr(E,P)}else{if(!Sl[b])throw new Error(`Types doesn't contain name = ${b}`);p=Sl[b]}const x=[];for(;_<n.length;_++){const E=a.parse(n[_],_,fi);if(!E)return null;x.push(E)}return new Vr(p,x)}evaluate(n){for(let a=0;a<this.args.length;a++){const p=this.args[a].evaluate(n);if(!xc(this.type,bn(p)))return p;if(a===this.args.length-1)throw new Ji(`Expected value to be of type ${Ii(this.type)}, but found ${Ii(bn(p))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}const er={"to-boolean":hi,"to-color":ms,"to-number":Ct,"to-string":ti};class jr{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const p=n[0];if(!er[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&n.length!==2)return a.error("Expected one argument.");const _=er[p],b=[];for(let x=1;x<n.length;x++){const E=a.parse(n[x],x,fi);if(!E)return null;b.push(E)}return new jr(_,b)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let a,p;for(const _ of this.args){if(a=_.evaluate(n),p=null,a instanceof mi)return a;if(typeof a=="string"){const b=n.parseColor(a);if(b)return b}else if(Array.isArray(a)&&(p=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:_s(a[0],a[1],a[2],a[3]),!p))return new mi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ji(p||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const p of this.args){a=p.evaluate(n);const _=Zn.parse(a);if(_)return _}throw new Ji(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"numberArray":{let a;for(const p of this.args){a=p.evaluate(n);const _=vn.parse(a);if(_)return _}throw new Ji(`Could not parse numberArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"colorArray":{let a;for(const p of this.args){a=p.evaluate(n);const _=ri.parse(a);if(_)return _}throw new Ji(`Could not parse colorArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const p of this.args){a=p.evaluate(n);const _=Bn.parse(a);if(_)return _}throw new Ji(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const p of this.args){if(a=p.evaluate(n),a===null)return 0;const _=Number(a);if(!isNaN(_))return _}throw new Ji(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return sr.fromString(No(this.args[0].evaluate(n)));case"resolvedImage":return Ur.fromString(No(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return No(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}const yu=["Unknown","Point","LineString","Polygon"];class Al{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let a=this._parseColorCache.get(n);return a||(a=mi.parse(n),this._parseColorCache.set(n,a)),a}}class El{constructor(n,a,p=[],_,b=new Qr,x=[]){this.registry=n,this.path=p,this.key=p.map((E=>`[${E}]`)).join(""),this.scope=b,this.errors=x,this.expectedType=_,this._isConstant=a}parse(n,a,p,_,b={}){return a?this.concat(a,p,_)._parse(n,b):this._parse(n,b)}_parse(n,a){function p(_,b,x){return x==="assert"?new Vr(b,[_]):x==="coerce"?new jr(b,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=n[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[_];if(b){let x=b.parse(n,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,P=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||P.kind!=="value"){if(E.kind==="projectionDefinition"&&["string","array"].includes(P.kind)||["color","formatted","resolvedImage"].includes(E.kind)&&["value","string"].includes(P.kind)||["padding","numberArray"].includes(E.kind)&&["value","number","array"].includes(P.kind)||E.kind==="colorArray"&&["value","string","array"].includes(P.kind)||E.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(P.kind))x=p(x,E,a.typeAnnotation||"coerce");else if(this.checkSubtype(E,P))return null}else x=p(x,E,a.typeAnnotation||"assert")}if(!(x instanceof ys)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const E=new Al;try{x=new ys(x.type,x.evaluate(E))}catch(P){return this.error(P.message),null}}return x}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,p){const _=typeof n=="number"?this.path.concat(n):this.path,b=p?this.scope.concat(p):this.scope;return new El(this.registry,this._isConstant,_,a||null,b,this.errors)}error(n,...a){const p=`${this.key}${a.map((_=>`[${_}]`)).join("")}`;this.errors.push(new ln(p,n))}checkSubtype(n,a){const p=xc(n,a);return p&&this.error(p),p}}class Gi{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const p=[];for(let b=1;b<n.length-1;b+=2){const x=n[b];if(typeof x!="string")return a.error(`Expected string, but found ${typeof x} instead.`,b);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",b);const E=a.parse(n[b+1],b+1);if(!E)return null;p.push([x,E])}const _=a.parse(n[n.length-1],n.length-1,a.expectedType,p);return _?new Gi(p,_):null}outputDefined(){return this.result.outputDefined()}}class Uo{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const p=n[1];return a.scope.has(p)?new Uo(p,a.scope.get(p)):a.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Ai{constructor(n,a,p){this.type=n,this.index=a,this.input=p}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,Ct),_=a.parse(n[2],2,Pr(a.expectedType||fi));return p&&_?new Ai(_.type.itemType,p,_):null}evaluate(n){const a=this.index.evaluate(n),p=this.input.evaluate(n);if(a<0)throw new Ji(`Array index out of bounds: ${a} < 0.`);if(a>=p.length)throw new Ji(`Array index out of bounds: ${a} > ${p.length-1}.`);if(a!==Math.floor(a))throw new Ji(`Array index must be an integer, but found ${a} instead.`);return p[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class di{constructor(n,a){this.type=hi,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,fi),_=a.parse(n[2],2,fi);return p&&_?wc(p.type,[hi,ti,Ct,Hi,fi])?new di(p,_):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(p.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!p)return!1;if(!Bo(a,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(bn(a))} instead.`);if(!Bo(p,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${Ii(bn(p))} instead.`);return p.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Cl{constructor(n,a,p){this.type=Ct,this.needle=n,this.haystack=a,this.fromIndex=p}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,fi),_=a.parse(n[2],2,fi);if(!p||!_)return null;if(!wc(p.type,[hi,ti,Ct,Hi,fi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(p.type)} instead`);if(n.length===4){const b=a.parse(n[3],3,Ct);return b?new Cl(p,_,b):null}return new Cl(p,_)}evaluate(n){const a=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!Bo(a,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(bn(a))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(n)),Bo(p,["string"])){const b=p.indexOf(a,_);return b===-1?-1:[...p.slice(0,b)].length}if(Bo(p,["array"]))return p.indexOf(a,_);throw new Ji(`Expected second argument to be of type array or string, but found ${Ii(bn(p))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Ri{constructor(n,a,p,_,b,x){this.inputType=n,this.type=a,this.input=p,this.cases=_,this.outputs=b,this.otherwise=x}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let p,_;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);const b={},x=[];for(let O=2;O<n.length-1;O+=2){let B=n[O];const F=n[O+1];Array.isArray(B)||(B=[B]);const V=a.concat(O);if(B.length===0)return V.error("Expected at least one branch label.");for(const X of B){if(typeof X!="number"&&typeof X!="string")return V.error("Branch labels must be numbers or strings.");if(typeof X=="number"&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof X=="number"&&Math.floor(X)!==X)return V.error("Numeric branch labels must be integer values.");if(p){if(V.checkSubtype(p,bn(X)))return null}else p=bn(X);if(b[String(X)]!==void 0)return V.error("Branch labels must be unique.");b[String(X)]=x.length}const j=a.parse(F,O,_);if(!j)return null;_=_||j.type,x.push(j)}const E=a.parse(n[1],1,fi);if(!E)return null;const P=a.parse(n[n.length-1],n.length-1,_);return P?E.type.kind!=="value"&&a.concat(1).checkSubtype(p,E.type)?null:new Ri(p,_,E,b,x,P):null}evaluate(n){const a=this.input.evaluate(n);return(bn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))&&this.otherwise.outputDefined()}}class vu{constructor(n,a,p){this.type=n,this.branches=a,this.otherwise=p}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const _=[];for(let x=1;x<n.length-1;x+=2){const E=a.parse(n[x],x,hi);if(!E)return null;const P=a.parse(n[x+1],x+1,p);if(!P)return null;_.push([E,P]),p=p||P.type}const b=a.parse(n[n.length-1],n.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new vu(p,_,b)}evaluate(n){for(const[a,p]of this.branches)if(a.evaluate(n))return p.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,p]of this.branches)n(a),n(p);n(this.otherwise)}outputDefined(){return this.branches.every((([n,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}}class Ns{constructor(n,a,p,_){this.type=n,this.input=a,this.beginIndex=p,this.endIndex=_}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,fi),_=a.parse(n[2],2,Ct);if(!p||!_)return null;if(!wc(p.type,[Pr(fi),ti,fi]))return a.error(`Expected first argument to be of type array or string, but found ${Ii(p.type)} instead`);if(n.length===4){const b=a.parse(n[3],3,Ct);return b?new Ns(p.type,p,_,b):null}return new Ns(p.type,p,_)}evaluate(n){const a=this.input.evaluate(n),p=this.beginIndex.evaluate(n);let _;if(this.endIndex&&(_=this.endIndex.evaluate(n)),Bo(a,["string"]))return[...a].slice(p,_).join("");if(Bo(a,["array"]))return a.slice(p,_);throw new Ji(`Expected first argument to be of type array or string, but found ${Ii(bn(a))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function Vo(c,n){const a=c.length-1;let p,_,b=0,x=a,E=0;for(;b<=x;)if(E=Math.floor((b+x)/2),p=c[E],_=c[E+1],p<=n){if(E===a||n<_)return E;b=E+1}else{if(!(p>n))throw new Ji("Input is not a number.");x=E-1}return 0}class jo{constructor(n,a,p){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[_,b]of p)this.labels.push(_),this.outputs.push(b)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const p=a.parse(n[1],1,Ct);if(!p)return null;const _=[];let b=null;a.expectedType&&a.expectedType.kind!=="value"&&(b=a.expectedType);for(let x=1;x<n.length;x+=2){const E=x===1?-1/0:n[x],P=n[x+1],O=x,B=x+1;if(typeof E!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(_.length&&_[_.length-1][0]>=E)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const F=a.parse(P,B,b);if(!F)return null;b=b||F.type,_.push([E,F])}return new jo(b,p,_)}evaluate(n){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(n);const _=this.input.evaluate(n);if(_<=a[0])return p[0].evaluate(n);const b=a.length;return _>=a[b-1]?p[b-1].evaluate(n):p[Vo(a,_)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}}function cp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var bu,kf,sm=(function(){if(kf)return bu;function c(n,a,p,_){this.cx=3*n,this.bx=3*(p-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(_-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=p,this.p2y=_}return kf=1,bu=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var p=n,_=0;_<8;_++){var b=this.sampleCurveX(p)-n;if(Math.abs(b)<a)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=b/x}var E=0,P=1;for(p=n,_=0;_<20&&(b=this.sampleCurveX(p),!(Math.abs(b-n)<a));_++)n>b?E=p:P=p,p=.5*(P-E)+E;return p},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},bu})(),Lf=cp(sm);class $r{constructor(n,a,p,_,b){this.type=n,this.operator=a,this.interpolation=p,this.input=_,this.labels=[],this.outputs=[];for(const[x,E]of b)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(n,a,p,_){let b=0;if(n.name==="exponential")b=ka(a,n.base,p,_);else if(n.name==="linear")b=ka(a,1,p,_);else if(n.name==="cubic-bezier"){const x=n.controlPoints;b=new Lf(x[0],x[1],x[2],x[3]).solve(ka(a,1,p,_))}return b}static parse(n,a){let[p,_,b,...x]=n;if(!Array.isArray(_)||_.length===0)return a.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const O=_[1];if(typeof O!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:O}}else{if(_[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const O=_.slice(1);if(O.length!==4||O.some((B=>typeof B!="number"||B<0||B>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:O}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(b=a.parse(b,2,Ct),!b)return null;const E=[];let P=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||a.expectedType==Ia?a.expectedType&&a.expectedType.kind!=="value"&&(P=a.expectedType):P=ms;for(let O=0;O<x.length;O+=2){const B=x[O],F=x[O+1],V=O+3,j=O+4;if(typeof B!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(E.length&&E[E.length-1][0]>=B)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const X=a.parse(F,j,P);if(!X)return null;P=P||X.type,E.push([B,X])}return la(P,Ct)||la(P,bh)||la(P,ms)||la(P,ro)||la(P,Ra)||la(P,Ia)||la(P,bc)||la(P,Pr(Ct))?new $r(P,p,_,b,E):a.error(`Type ${Ii(P)} is not interpolatable.`)}evaluate(n){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(n);const _=this.input.evaluate(n);if(_<=a[0])return p[0].evaluate(n);const b=a.length;if(_>=a[b-1])return p[b-1].evaluate(n);const x=Vo(a,_),E=$r.interpolationFactor(this.interpolation,_,a[x],a[x+1]),P=p[x].evaluate(n),O=p[x+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Fo(P,O,E);case"color":return mi.interpolate(P,O,E);case"padding":return Zn.interpolate(P,O,E);case"colorArray":return ri.interpolate(P,O,E);case"numberArray":return vn.interpolate(P,O,E);case"variableAnchorOffsetCollection":return Bn.interpolate(P,O,E);case"array":return Sc(P,O,E);case"projectionDefinition":return ar.interpolate(P,O,E)}case"interpolate-hcl":switch(this.type.kind){case"color":return mi.interpolate(P,O,E,"hcl");case"colorArray":return ri.interpolate(P,O,E,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return mi.interpolate(P,O,E,"lab");case"colorArray":return ri.interpolate(P,O,E,"lab")}}}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every((n=>n.outputDefined()))}}function ka(c,n,a,p){const _=p-a,b=c-a;return _===0?0:n===1?b/_:(Math.pow(n,b)-1)/(Math.pow(n,_)-1)}const xn={color:mi.interpolate,number:Fo,padding:Zn.interpolate,numberArray:vn.interpolate,colorArray:ri.interpolate,variableAnchorOffsetCollection:Bn.interpolate,array:Sc};class Ml{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let p=null;const _=a.expectedType;_&&_.kind!=="value"&&(p=_);const b=[];for(const E of n.slice(1)){const P=a.parse(E,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!P)return null;p=p||P.type,b.push(P)}if(!p)throw new Error("No output type");const x=_&&b.some((E=>xc(_,E.type)));return new Ml(x?fi:p,b)}evaluate(n){let a,p=null,_=0;for(const b of this.args)if(_++,p=b.evaluate(n),p&&p instanceof Ur&&!p.available&&(a||(a=p.name),p=null,_===this.args.length&&(p=a)),p!==null)break;return p}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every((n=>n.outputDefined()))}}function xu(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function wu(c,n,a,p){return p.compare(n,a)===0}function zn(c,n,a){const p=c!=="=="&&c!=="!=";return class rE{constructor(b,x,E){this.type=hi,this.lhs=b,this.rhs=x,this.collator=E,this.hasUntypedArgument=b.type.kind==="value"||x.type.kind==="value"}static parse(b,x){if(b.length!==3&&b.length!==4)return x.error("Expected two or three arguments.");const E=b[0];let P=x.parse(b[1],1,fi);if(!P)return null;if(!xu(E,P.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${Ii(P.type)}'.`);let O=x.parse(b[2],2,fi);if(!O)return null;if(!xu(E,O.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${Ii(O.type)}'.`);if(P.type.kind!==O.type.kind&&P.type.kind!=="value"&&O.type.kind!=="value")return x.error(`Cannot compare types '${Ii(P.type)}' and '${Ii(O.type)}'.`);p&&(P.type.kind==="value"&&O.type.kind!=="value"?P=new Vr(O.type,[P]):P.type.kind!=="value"&&O.type.kind==="value"&&(O=new Vr(P.type,[O])));let B=null;if(b.length===4){if(P.type.kind!=="string"&&O.type.kind!=="string"&&P.type.kind!=="value"&&O.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(B=x.parse(b[3],3,bl),!B)return null}return new rE(P,O,B)}evaluate(b){const x=this.lhs.evaluate(b),E=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const P=bn(x),O=bn(E);if(P.kind!==O.kind||P.kind!=="string"&&P.kind!=="number")throw new Ji(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${P.kind}, ${O.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const P=bn(x),O=bn(E);if(P.kind!=="string"||O.kind!=="string")return n(b,x,E)}return this.collator?a(b,x,E,this.collator.evaluate(b)):n(b,x,E)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const up=zn("==",(function(c,n,a){return n===a}),wu),Th=zn("!=",(function(c,n,a){return n!==a}),(function(c,n,a,p){return!wu(0,n,a,p)})),hp=zn("<",(function(c,n,a){return n<a}),(function(c,n,a,p){return p.compare(n,a)<0})),am=zn(">",(function(c,n,a){return n>a}),(function(c,n,a,p){return p.compare(n,a)>0})),Ac=zn("<=",(function(c,n,a){return n<=a}),(function(c,n,a,p){return p.compare(n,a)<=0})),Sh=zn(">=",(function(c,n,a){return n>=a}),(function(c,n,a,p){return p.compare(n,a)>=0}));class Ec{constructor(n,a,p){this.type=bl,this.locale=p,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const p=n[1];if(typeof p!="object"||Array.isArray(p))return a.error("Collator options argument must be an object.");const _=a.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,hi);if(!_)return null;const b=a.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,hi);if(!b)return null;let x=null;return p.locale&&(x=a.parse(p.locale,1,ti),!x)?null:new Ec(_,b,x)}evaluate(n){return new ca(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Bf{constructor(n,a,p,_,b){this.type=ti,this.number=n,this.locale=a,this.currency=p,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const p=a.parse(n[1],1,Ct);if(!p)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return a.error("NumberFormat options argument must be an object.");let b=null;if(_.locale&&(b=a.parse(_.locale,1,ti),!b))return null;let x=null;if(_.currency&&(x=a.parse(_.currency,1,ti),!x))return null;let E=null;if(_["min-fraction-digits"]&&(E=a.parse(_["min-fraction-digits"],1,Ct),!E))return null;let P=null;return _["max-fraction-digits"]&&(P=a.parse(_["max-fraction-digits"],1,Ct),!P)?null:new Bf(p,b,x,E,P)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Tu{constructor(n){this.type=Pa,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const p=n[1];if(!Array.isArray(p)&&typeof p=="object")return a.error("First argument must be an image or text section.");const _=[];let b=!1;for(let x=1;x<=n.length-1;++x){const E=n[x];if(b&&typeof E=="object"&&!Array.isArray(E)){b=!1;let P=null;if(E["font-scale"]&&(P=a.parse(E["font-scale"],1,Ct),!P))return null;let O=null;if(E["text-font"]&&(O=a.parse(E["text-font"],1,Pr(ti)),!O))return null;let B=null;if(E["text-color"]&&(B=a.parse(E["text-color"],1,ms),!B))return null;let F=null;if(E["vertical-align"]){if(typeof E["vertical-align"]=="string"&&!Of.includes(E["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${E["vertical-align"]}' instead.`);if(F=a.parse(E["vertical-align"],1,ti),!F)return null}const V=_[_.length-1];V.scale=P,V.font=O,V.textColor=B,V.verticalAlign=F}else{const P=a.parse(n[x],1,fi);if(!P)return null;const O=P.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,_.push({content:P,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Tu(_)}evaluate(n){return new sr(this.sections.map((a=>{const p=a.content.evaluate(n);return bn(p)===Ln?new _u("",p,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(n):null):new _u(No(p),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null,a.verticalAlign?a.verticalAlign.evaluate(n):null)})))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor),a.verticalAlign&&n(a.verticalAlign)}outputDefined(){return!1}}class Cc{constructor(n){this.type=Ln,this.input=n}static parse(n,a){if(n.length!==2)return a.error("Expected two arguments.");const p=a.parse(n[1],1,ti);return p?new Cc(p):a.error("No image name provided.")}evaluate(n){const a=this.input.evaluate(n),p=Ur.fromString(a);return p&&n.availableImages&&(p.available=n.availableImages.indexOf(a)>-1),p}eachChild(n){n(this.input)}outputDefined(){return!1}}class Mc{constructor(n){this.type=Ct,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=a.parse(n[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Ii(p.type)} instead.`):new Mc(p):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new Ji(`Expected value to be of type string or array, but found ${Ii(bn(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Hn=8192;function Pc(c,n){const a=(180+c[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(a*_*Hn),Math.round(p*_*Hn)]}function Ic(c,n){const a=Math.pow(2,n.z);return[(_=(c[0]/Hn+n.x)/a,360*_-180),(p=(c[1]/Hn+n.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,_}function Rc(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function $o(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function fp(c,n,a){const p=c[0]-n[0],_=c[1]-n[1],b=c[0]-a[0],x=c[1]-a[1];return p*x-b*_==0&&p*b<=0&&_*x<=0}function Su(c,n,a,p){return(_=[p[0]-a[0],p[1]-a[1]])[0]*(b=[n[0]-c[0],n[1]-c[1]])[1]-_[1]*b[0]!=0&&!(!Eh(c,n,a,p)||!Eh(a,p,c,n));var _,b}function dp(c,n,a){for(const p of a)for(let _=0;_<p.length-1;++_)if(Su(c,n,p[_],p[_+1]))return!0;return!1}function ua(c,n,a=!1){let p=!1;for(const E of n)for(let P=0;P<E.length-1;P++){if(fp(c,E[P],E[P+1]))return a;(b=E[P])[1]>(_=c)[1]!=(x=E[P+1])[1]>_[1]&&_[0]<(x[0]-b[0])*(_[1]-b[1])/(x[1]-b[1])+b[0]&&(p=!p)}var _,b,x;return p}function Ah(c,n){for(const a of n)if(ua(c,a))return!0;return!1}function pp(c,n){for(const a of c)if(!ua(a,n))return!1;for(let a=0;a<c.length-1;++a)if(dp(c[a],c[a+1],n))return!1;return!0}function gp(c,n){for(const a of n)if(pp(c,a))return!0;return!1}function Eh(c,n,a,p){const _=p[0]-a[0],b=p[1]-a[1],x=(c[0]-a[0])*b-_*(c[1]-a[1]),E=(n[0]-a[0])*b-_*(n[1]-a[1]);return x>0&&E<0||x<0&&E>0}function Ch(c,n,a){const p=[];for(let _=0;_<c.length;_++){const b=[];for(let x=0;x<c[_].length;x++){const E=Pc(c[_][x],a);Rc(n,E),b.push(E)}p.push(b)}return p}function Pl(c,n,a){const p=[];for(let _=0;_<c.length;_++){const b=Ch(c[_],n,a);p.push(b)}return p}function Dc(c,n,a,p){if(c[0]<a[0]||c[0]>a[2]){const _=.5*p;let b=c[0]-a[0]>_?-p:a[0]-c[0]>_?p:0;b===0&&(b=c[0]-a[2]>_?-p:a[2]-c[0]>_?p:0),c[0]+=b}Rc(n,c)}function mp(c,n,a,p){const _=Math.pow(2,p.z)*Hn,b=[p.x*Hn,p.y*Hn],x=[];for(const E of c)for(const P of E){const O=[P.x+b[0],P.y+b[1]];Dc(O,n,a,_),x.push(O)}return x}function Au(c,n,a,p){const _=Math.pow(2,p.z)*Hn,b=[p.x*Hn,p.y*Hn],x=[];for(const P of c){const O=[];for(const B of P){const F=[B.x+b[0],B.y+b[1]];Rc(n,F),O.push(F)}x.push(O)}if(n[2]-n[0]<=_/2){(E=n)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const P of x)for(const O of P)Dc(O,n,a,_)}var E;return x}class Ho{constructor(n,a){this.type=hi,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Oa(n[1])){const p=n[1];if(p.type==="FeatureCollection"){const _=[];for(const b of p.features){const{type:x,coordinates:E}=b.geometry;x==="Polygon"&&_.push(E),x==="MultiPolygon"&&_.push(...E)}if(_.length)return new Ho(p,{type:"MultiPolygon",coordinates:_})}else if(p.type==="Feature"){const _=p.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ho(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Ho(p,p)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(a,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(p.type==="Polygon"){const E=Ch(p.coordinates,b,x),P=mp(a.geometry(),_,b,x);if(!$o(_,b))return!1;for(const O of P)if(!ua(O,E))return!1}if(p.type==="MultiPolygon"){const E=Pl(p.coordinates,b,x),P=mp(a.geometry(),_,b,x);if(!$o(_,b))return!1;for(const O of P)if(!Ah(O,E))return!1}return!0})(n,this.geometries);if(n.geometryType()==="LineString")return(function(a,p){const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(p.type==="Polygon"){const E=Ch(p.coordinates,b,x),P=Au(a.geometry(),_,b,x);if(!$o(_,b))return!1;for(const O of P)if(!pp(O,E))return!1}if(p.type==="MultiPolygon"){const E=Pl(p.coordinates,b,x),P=Au(a.geometry(),_,b,x);if(!$o(_,b))return!1;for(const O of P)if(!gp(O,E))return!1}return!0})(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zf=class{constructor(c=[],n=(a,p)=>a<p?-1:a>p?1:0){if(this.data=c,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:n,compare:a}=this,p=n[c];for(;c>0;){const _=c-1>>1,b=n[_];if(a(p,b)>=0)break;n[c]=b,c=_}n[c]=p}_down(c){const{data:n,compare:a}=this,p=this.length>>1,_=n[c];for(;c<p;){let b=1+(c<<1);const x=b+1;if(x<this.length&&a(n[x],n[b])<0&&(b=x),a(n[b],_)>=0)break;n[c]=n[b],c=b}n[c]=_}};function Eu(c,n,a=0,p=c.length-1,_=Ff){for(;p>a;){if(p-a>600){const P=p-a+1,O=n-a+1,B=Math.log(P),F=.5*Math.exp(2*B/3),V=.5*Math.sqrt(B*F*(P-F)/P)*(O-P/2<0?-1:1);Eu(c,n,Math.max(a,Math.floor(n-O*F/P+V)),Math.min(p,Math.floor(n+(P-O)*F/P+V)),_)}const b=c[n];let x=a,E=p;for(Wo(c,a,n),_(c[p],b)>0&&Wo(c,a,p);x<E;){for(Wo(c,x,E),x++,E--;_(c[x],b)<0;)x++;for(;_(c[E],b)>0;)E--}_(c[a],b)===0?Wo(c,a,E):(E++,Wo(c,E,p)),E<=n&&(a=E+1),n<=E&&(p=E-1)}}function Wo(c,n,a){const p=c[n];c[n]=c[a],c[a]=p}function Ff(c,n){return c<n?-1:c>n?1:0}function Cu(c,n){if(c.length<=1)return[c];const a=[];let p,_;for(const b of c){const x=om(b);x!==0&&(b.area=Math.abs(x),_===void 0&&(_=x<0),_===x<0?(p&&a.push(p),p=[b]):p.push(b))}if(p&&a.push(p),n>1)for(let b=0;b<a.length;b++)a[b].length<=n||(Eu(a[b],n,1,a[b].length-1,_p),a[b]=a[b].slice(0,n));return a}function _p(c,n){return n.area-c.area}function om(c){let n=0;for(let a,p,_=0,b=c.length,x=b-1;_<b;x=_++)a=c[_],p=c[x],n+=(p.x-a.x)*(a.y+p.y);return n}const yp=1/298.257223563,Mu=yp*(2-yp),vp=Math.PI/180;class Nf{constructor(n){const a=6378.137*vp*1e3,p=Math.cos(n*vp),_=1/(1-Mu*(1-p*p)),b=Math.sqrt(_);this.kx=a*b*p,this.ky=a*b*_*(1-Mu)}distance(n,a){const p=this.wrap(n[0]-a[0])*this.kx,_=(n[1]-a[1])*this.ky;return Math.sqrt(p*p+_*_)}pointOnLine(n,a){let p,_,b,x,E=1/0;for(let P=0;P<n.length-1;P++){let O=n[P][0],B=n[P][1],F=this.wrap(n[P+1][0]-O)*this.kx,V=(n[P+1][1]-B)*this.ky,j=0;F===0&&V===0||(j=(this.wrap(a[0]-O)*this.kx*F+(a[1]-B)*this.ky*V)/(F*F+V*V),j>1?(O=n[P+1][0],B=n[P+1][1]):j>0&&(O+=F/this.kx*j,B+=V/this.ky*j)),F=this.wrap(a[0]-O)*this.kx,V=(a[1]-B)*this.ky;const X=F*F+V*V;X<E&&(E=X,p=O,_=B,b=P,x=j)}return{point:[p,_],index:b,t:Math.max(0,Math.min(1,x))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Jr(c,n){return n[0]-c[0]}function qo(c){return c[1]-c[0]+1}function Us(c,n){return c[1]>=c[0]&&c[1]<n}function Pu(c,n){if(c[0]>c[1])return[null,null];const a=qo(c);if(n){if(a===2)return[c,null];const _=Math.floor(a/2);return[[c[0],c[0]+_],[c[0]+_,c[1]]]}if(a===1)return[c,null];const p=Math.floor(a/2)-1;return[[c[0],c[0]+p],[c[0]+p+1,c[1]]]}function Mh(c,n){if(!Us(n,c.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let p=n[0];p<=n[1];++p)Rc(a,c[p]);return a}function Ph(c){const n=[1/0,1/0,-1/0,-1/0];for(const a of c)for(const p of a)Rc(n,p);return n}function Iu(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Ih(c,n,a){if(!Iu(c)||!Iu(n))return NaN;let p=0,_=0;return c[2]<n[0]&&(p=n[0]-c[2]),c[0]>n[2]&&(p=c[0]-n[2]),c[1]>n[3]&&(_=c[1]-n[3]),c[3]<n[1]&&(_=n[1]-c[3]),a.distance([0,0],[p,_])}function Vs(c,n,a){const p=a.pointOnLine(n,c);return a.distance(c,p.point)}function Ru(c,n,a,p,_){const b=Math.min(Vs(c,[a,p],_),Vs(n,[a,p],_)),x=Math.min(Vs(a,[c,n],_),Vs(p,[c,n],_));return Math.min(b,x)}function Du(c,n,a,p,_){if(!Us(n,c.length)||!Us(p,a.length))return 1/0;let b=1/0;for(let x=n[0];x<n[1];++x){const E=c[x],P=c[x+1];for(let O=p[0];O<p[1];++O){const B=a[O],F=a[O+1];if(Su(E,P,B,F))return 0;b=Math.min(b,Ru(E,P,B,F,_))}}return b}function Rh(c,n,a,p,_){if(!Us(n,c.length)||!Us(p,a.length))return NaN;let b=1/0;for(let x=n[0];x<=n[1];++x)for(let E=p[0];E<=p[1];++E)if(b=Math.min(b,_.distance(c[x],a[E])),b===0)return b;return b}function bp(c,n,a){if(ua(c,n,!0))return 0;let p=1/0;for(const _ of n){const b=_[0],x=_[_.length-1];if(b!==x&&(p=Math.min(p,Vs(c,[x,b],a)),p===0))return p;const E=a.pointOnLine(_,c);if(p=Math.min(p,a.distance(c,E.point)),p===0)return p}return p}function Il(c,n,a,p){if(!Us(n,c.length))return NaN;for(let b=n[0];b<=n[1];++b)if(ua(c[b],a,!0))return 0;let _=1/0;for(let b=n[0];b<n[1];++b){const x=c[b],E=c[b+1];for(const P of a)for(let O=0,B=P.length,F=B-1;O<B;F=O++){const V=P[F],j=P[O];if(Su(x,E,V,j))return 0;_=Math.min(_,Ru(x,E,V,j,p))}}return _}function Rl(c,n){for(const a of c)for(const p of a)if(ua(p,n,!0))return!0;return!1}function Uf(c,n,a,p=1/0){const _=Ph(c),b=Ph(n);if(p!==1/0&&Ih(_,b,a)>=p)return p;if($o(_,b)){if(Rl(c,n))return 0}else if(Rl(n,c))return 0;let x=1/0;for(const E of c)for(let P=0,O=E.length,B=O-1;P<O;B=P++){const F=E[B],V=E[P];for(const j of n)for(let X=0,Z=j.length,Q=Z-1;X<Z;Q=X++){const se=j[Q],ge=j[X];if(Su(F,V,se,ge))return 0;x=Math.min(x,Ru(F,V,se,ge,a))}}return x}function zi(c,n,a,p,_,b){if(!b)return;const x=Ih(Mh(p,b),_,a);x<n&&c.push([x,b,[0,0]])}function La(c,n,a,p,_,b,x){if(!b||!x)return;const E=Ih(Mh(p,b),Mh(_,x),a);E<n&&c.push([E,b,x])}function Ou(c,n,a,p,_=1/0){let b=Math.min(p.distance(c[0],a[0][0]),_);if(b===0)return b;const x=new zf([[0,[0,c.length-1],[0,0]]],Jr),E=Ph(a);for(;x.length>0;){const P=x.pop();if(P[0]>=b)continue;const O=P[1],B=n?50:100;if(qo(O)<=B){if(!Us(O,c.length))return NaN;if(n){const F=Il(c,O,a,p);if(isNaN(F)||F===0)return F;b=Math.min(b,F)}else for(let F=O[0];F<=O[1];++F){const V=bp(c[F],a,p);if(b=Math.min(b,V),b===0)return 0}}else{const F=Pu(O,n);zi(x,b,p,c,E,F[0]),zi(x,b,p,c,E,F[1])}}return b}function ku(c,n,a,p,_,b=1/0){let x=Math.min(b,_.distance(c[0],a[0]));if(x===0)return x;const E=new zf([[0,[0,c.length-1],[0,a.length-1]]],Jr);for(;E.length>0;){const P=E.pop();if(P[0]>=x)continue;const O=P[1],B=P[2],F=n?50:100,V=p?50:100;if(qo(O)<=F&&qo(B)<=V){if(!Us(O,c.length)&&Us(B,a.length))return NaN;let j;if(n&&p)j=Du(c,O,a,B,_),x=Math.min(x,j);else if(n&&!p){const X=c.slice(O[0],O[1]+1);for(let Z=B[0];Z<=B[1];++Z)if(j=Vs(a[Z],X,_),x=Math.min(x,j),x===0)return x}else if(!n&&p){const X=a.slice(B[0],B[1]+1);for(let Z=O[0];Z<=O[1];++Z)if(j=Vs(c[Z],X,_),x=Math.min(x,j),x===0)return x}else j=Rh(c,O,a,B,_),x=Math.min(x,j)}else{const j=Pu(O,n),X=Pu(B,p);La(E,x,_,c,a,j[0],X[0]),La(E,x,_,c,a,j[0],X[1]),La(E,x,_,c,a,j[1],X[0]),La(E,x,_,c,a,j[1],X[1])}}return x}function Dh(c){return c.type==="MultiPolygon"?c.coordinates.map((n=>({type:"Polygon",coordinates:n}))):c.type==="MultiLineString"?c.coordinates.map((n=>({type:"LineString",coordinates:n}))):c.type==="MultiPoint"?c.coordinates.map((n=>({type:"Point",coordinates:n}))):[c]}class Dl{constructor(n,a){this.type=Ct,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Oa(n[1])){const p=n[1];if(p.type==="FeatureCollection")return new Dl(p,p.features.map((_=>Dh(_.geometry))).flat());if(p.type==="Feature")return new Dl(p,Dh(p.geometry));if("type"in p&&"coordinates"in p)return new Dl(p,Dh(p))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return(function(a,p){const _=a.geometry(),b=_.flat().map((P=>Ic([P.x,P.y],a.canonical)));if(_.length===0)return NaN;const x=new Nf(b[0][1]);let E=1/0;for(const P of p){switch(P.type){case"Point":E=Math.min(E,ku(b,!1,[P.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,ku(b,!1,P.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ou(b,!1,P.coordinates,x,E))}if(E===0)return E}return E})(n,this.geometries);if(n.geometryType()==="LineString")return(function(a,p){const _=a.geometry(),b=_.flat().map((P=>Ic([P.x,P.y],a.canonical)));if(_.length===0)return NaN;const x=new Nf(b[0][1]);let E=1/0;for(const P of p){switch(P.type){case"Point":E=Math.min(E,ku(b,!0,[P.coordinates],!1,x,E));break;case"LineString":E=Math.min(E,ku(b,!0,P.coordinates,!0,x,E));break;case"Polygon":E=Math.min(E,Ou(b,!0,P.coordinates,x,E))}if(E===0)return E}return E})(n,this.geometries);if(n.geometryType()==="Polygon")return(function(a,p){const _=a.geometry();if(_.length===0||_[0].length===0)return NaN;const b=Cu(_,0).map((P=>P.map((O=>O.map((B=>Ic([B.x,B.y],a.canonical))))))),x=new Nf(b[0][0][0][1]);let E=1/0;for(const P of p)for(const O of b){switch(P.type){case"Point":E=Math.min(E,Ou([P.coordinates],!1,O,x,E));break;case"LineString":E=Math.min(E,Ou(P.coordinates,!0,O,x,E));break;case"Polygon":E=Math.min(E,Uf(O,P.coordinates,x,E))}if(E===0)return E}return E})(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Lu{constructor(n){this.type=fi,this.key=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=n[1];return p==null?a.error("Global state property must be defined."):typeof p!="string"?a.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new Lu(p)}evaluate(n){var a;const p=(a=n.globals)===null||a===void 0?void 0:a.globalState;return p&&Object.keys(p).length!==0?Tc(p,this.key):null}eachChild(){}outputDefined(){return!1}}const Oc={"==":up,"!=":Th,">":am,"<":hp,">=":Sh,"<=":Ac,array:Vr,at:Ai,boolean:Vr,case:vu,coalesce:Ml,collator:Ec,format:Tu,image:Cc,in:di,"index-of":Cl,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:Mc,let:Gi,literal:ys,match:Ri,number:Vr,"number-format":Bf,object:Vr,slice:Ns,step:jo,string:Vr,"to-boolean":jr,"to-color":jr,"to-number":jr,"to-string":jr,var:Uo,within:Ho,distance:Dl,"global-state":Lu};class vs{constructor(n,a,p,_){this.name=n,this.type=a,this._evaluate=p,this.args=_}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,a){const p=n[0],_=vs.definitions[p];if(!_)return a.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,E=x.filter((([O])=>!Array.isArray(O)||O.length===n.length-1));let P=null;for(const[O,B]of E){P=new El(a.registry,Hr,a.path,null,a.scope);const F=[];let V=!1;for(let j=1;j<n.length;j++){const X=n[j],Z=Array.isArray(O)?O[j-1]:O.type,Q=P.parse(X,1+F.length,Z);if(!Q){V=!0;break}F.push(Q)}if(!V)if(Array.isArray(O)&&O.length!==F.length)P.error(`Expected ${O.length} arguments, but found ${F.length} instead.`);else{for(let j=0;j<F.length;j++){const X=Array.isArray(O)?O[j]:O.type,Z=F[j];P.concat(j+1).checkSubtype(X,Z.type)}if(P.errors.length===0)return new vs(p,b,B,F)}}if(E.length===1)a.errors.push(...P.errors);else{const O=(E.length?E:x).map((([F])=>{return V=F,Array.isArray(V)?`(${V.map(Ii).join(", ")})`:`(${Ii(V.type)}...)`;var V})).join(" | "),B=[];for(let F=1;F<n.length;F++){const V=a.parse(n[F],1+B.length);if(!V)return null;B.push(Ii(V.type))}a.error(`Expected arguments of type ${O}, but found (${B.join(", ")}) instead.`)}return null}static register(n,a){vs.definitions=a;for(const p in a)n[p]=vs}}function Vf(c,[n,a,p,_]){n=n.evaluate(c),a=a.evaluate(c),p=p.evaluate(c);const b=_?_.evaluate(c):1,x=_s(n,a,p,b);if(x)throw new Ji(x);return new mi(n/255,a/255,p/255,b,!1)}function Oh(c,n){return c in n}function bs(c,n){const a=n[c];return a===void 0?null:a}function Ba(c){return{type:c}}function Hr(c){if(c instanceof Uo)return Hr(c.boundExpression);if(c instanceof vs&&c.name==="error"||c instanceof Ec||c instanceof Ho||c instanceof Dl||c instanceof Lu)return!1;const n=c instanceof jr||c instanceof Vr;let a=!0;return c.eachChild((p=>{a=n?a&&Hr(p):a&&p instanceof ys})),!!a&&oo(c)&&kl(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function oo(c){if(c instanceof vs&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ho||c instanceof Dl)return!1;let n=!0;return c.eachChild((a=>{n&&!oo(a)&&(n=!1)})),n}function Ol(c){if(c instanceof vs&&c.name==="feature-state")return!1;let n=!0;return c.eachChild((a=>{n&&!Ol(a)&&(n=!1)})),n}function kl(c,n){if(c instanceof vs&&n.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild((p=>{a&&!kl(p,n)&&(a=!1)})),a}function Bu(c){return{result:"success",value:c}}function Xo(c){return{result:"error",value:c}}function js(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function jf(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function kc(c){return!!c.expression&&c.expression.interpolated}function pi(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function kh(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&bn(c)===Ma}function xs(c){return c}function Lh(c,n){const a=c.stops&&typeof c.stops[0][0]=="object",p=a||!(a||c.property!==void 0),_=c.type||(kc(n)?"exponential":"interval"),b=(function(B){switch(B.type){case"color":return mi.parse;case"padding":return Zn.parse;case"numberArray":return vn.parse;case"colorArray":return ri.parse;default:return null}})(n);if(b&&((c=Li({},c)).stops&&(c.stops=c.stops.map((B=>[B[0],b(B[1])]))),c.default=b(c.default?c.default:n.default)),c.colorSpace&&(x=c.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var x;const E=(function(B){switch(B){case"exponential":return Go;case"interval":return Bh;case"categorical":return xp;case"identity":return $f;default:throw new Error(`Unknown function type "${B}"`)}})(_);let P,O;if(_==="categorical"){P=Object.create(null);for(const B of c.stops)P[B[0]]=B[1];O=typeof c.stops[0][0]}if(a){const B={},F=[];for(let X=0;X<c.stops.length;X++){const Z=c.stops[X],Q=Z[0].zoom;B[Q]===void 0&&(B[Q]={zoom:Q,type:c.type,property:c.property,default:c.default,stops:[]},F.push(Q)),B[Q].stops.push([Z[0].value,Z[1]])}const V=[];for(const X of F)V.push([B[X].zoom,Lh(B[X],n)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:$r.interpolationFactor.bind(void 0,j),zoomStops:V.map((X=>X[0])),evaluate:({zoom:X},Z)=>Go({stops:V,base:c.base},n,X).evaluate(X,Z)}}if(p){const B=_==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:$r.interpolationFactor.bind(void 0,B),zoomStops:c.stops.map((F=>F[0])),evaluate:({zoom:F})=>E(c,n,F,P,O)}}return{kind:"source",evaluate(B,F){const V=F&&F.properties?F.properties[c.property]:void 0;return V===void 0?ws(c.default,n.default):E(c,n,V,P,O)}}}function ws(c,n,a){return c!==void 0?c:n!==void 0?n:a!==void 0?a:void 0}function xp(c,n,a,p,_){return ws(typeof a===_?p[a]:void 0,c.default,n.default)}function Bh(c,n,a){if(pi(a)!=="number")return ws(c.default,n.default);const p=c.stops.length;if(p===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[p-1][0])return c.stops[p-1][1];const _=Vo(c.stops.map((b=>b[0])),a);return c.stops[_][1]}function Go(c,n,a){const p=c.base!==void 0?c.base:1;if(pi(a)!=="number")return ws(c.default,n.default);const _=c.stops.length;if(_===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[_-1][0])return c.stops[_-1][1];const b=Vo(c.stops.map((B=>B[0])),a),x=(function(B,F,V,j){const X=j-V,Z=B-V;return X===0?0:F===1?Z/X:(Math.pow(F,Z)-1)/(Math.pow(F,X)-1)})(a,p,c.stops[b][0],c.stops[b+1][0]),E=c.stops[b][1],P=c.stops[b+1][1],O=xn[n.type]||xs;return typeof E.evaluate=="function"?{evaluate(...B){const F=E.evaluate.apply(void 0,B),V=P.evaluate.apply(void 0,B);if(F!==void 0&&V!==void 0)return O(F,V,x,c.colorSpace)}}:O(E,P,x,c.colorSpace)}function $f(c,n,a){switch(n.type){case"color":a=mi.parse(a);break;case"formatted":a=sr.fromString(a.toString());break;case"resolvedImage":a=Ur.fromString(a.toString());break;case"padding":a=Zn.parse(a);break;case"colorArray":a=ri.parse(a);break;case"numberArray":a=vn.parse(a);break;default:pi(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0)}return ws(a,c.default,n.default)}vs.register(Oc,{error:[{kind:"error"},[ti],(c,[n])=>{throw new Ji(n.evaluate(c))}],typeof:[ti,[fi],(c,[n])=>Ii(bn(n.evaluate(c)))],"to-rgba":[Pr(Ct,4),[ms],(c,[n])=>{const[a,p,_,b]=n.evaluate(c).rgb;return[255*a,255*p,255*_,b]}],rgb:[ms,[Ct,Ct,Ct],Vf],rgba:[ms,[Ct,Ct,Ct,Ct],Vf],has:{type:hi,overloads:[[[ti],(c,[n])=>Oh(n.evaluate(c),c.properties())],[[ti,Ma],(c,[n,a])=>Oh(n.evaluate(c),a.evaluate(c))]]},get:{type:fi,overloads:[[[ti],(c,[n])=>bs(n.evaluate(c),c.properties())],[[ti,Ma],(c,[n,a])=>bs(n.evaluate(c),a.evaluate(c))]]},"feature-state":[fi,[ti],(c,[n])=>bs(n.evaluate(c),c.featureState||{})],properties:[Ma,[],c=>c.properties()],"geometry-type":[ti,[],c=>c.geometryType()],id:[fi,[],c=>c.id()],zoom:[Ct,[],c=>c.globals.zoom],"heatmap-density":[Ct,[],c=>c.globals.heatmapDensity||0],elevation:[Ct,[],c=>c.globals.elevation||0],"line-progress":[Ct,[],c=>c.globals.lineProgress||0],accumulated:[fi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Ct,Ba(Ct),(c,n)=>{let a=0;for(const p of n)a+=p.evaluate(c);return a}],"*":[Ct,Ba(Ct),(c,n)=>{let a=1;for(const p of n)a*=p.evaluate(c);return a}],"-":{type:Ct,overloads:[[[Ct,Ct],(c,[n,a])=>n.evaluate(c)-a.evaluate(c)],[[Ct],(c,[n])=>-n.evaluate(c)]]},"/":[Ct,[Ct,Ct],(c,[n,a])=>n.evaluate(c)/a.evaluate(c)],"%":[Ct,[Ct,Ct],(c,[n,a])=>n.evaluate(c)%a.evaluate(c)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(c,[n,a])=>Math.pow(n.evaluate(c),a.evaluate(c))],sqrt:[Ct,[Ct],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[Ct,[Ct],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[Ct,[Ct],(c,[n])=>Math.log(n.evaluate(c))],log2:[Ct,[Ct],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[Ct,[Ct],(c,[n])=>Math.sin(n.evaluate(c))],cos:[Ct,[Ct],(c,[n])=>Math.cos(n.evaluate(c))],tan:[Ct,[Ct],(c,[n])=>Math.tan(n.evaluate(c))],asin:[Ct,[Ct],(c,[n])=>Math.asin(n.evaluate(c))],acos:[Ct,[Ct],(c,[n])=>Math.acos(n.evaluate(c))],atan:[Ct,[Ct],(c,[n])=>Math.atan(n.evaluate(c))],min:[Ct,Ba(Ct),(c,n)=>Math.min(...n.map((a=>a.evaluate(c))))],max:[Ct,Ba(Ct),(c,n)=>Math.max(...n.map((a=>a.evaluate(c))))],abs:[Ct,[Ct],(c,[n])=>Math.abs(n.evaluate(c))],round:[Ct,[Ct],(c,[n])=>{const a=n.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[Ct,[Ct],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[Ct,[Ct],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[hi,[ti,fi],(c,[n,a])=>c.properties()[n.value]===a.value],"filter-id-==":[hi,[fi],(c,[n])=>c.id()===n.value],"filter-type-==":[hi,[ti],(c,[n])=>c.geometryType()===n.value],"filter-<":[hi,[ti,fi],(c,[n,a])=>{const p=c.properties()[n.value],_=a.value;return typeof p==typeof _&&p<_}],"filter-id-<":[hi,[fi],(c,[n])=>{const a=c.id(),p=n.value;return typeof a==typeof p&&a<p}],"filter->":[hi,[ti,fi],(c,[n,a])=>{const p=c.properties()[n.value],_=a.value;return typeof p==typeof _&&p>_}],"filter-id->":[hi,[fi],(c,[n])=>{const a=c.id(),p=n.value;return typeof a==typeof p&&a>p}],"filter-<=":[hi,[ti,fi],(c,[n,a])=>{const p=c.properties()[n.value],_=a.value;return typeof p==typeof _&&p<=_}],"filter-id-<=":[hi,[fi],(c,[n])=>{const a=c.id(),p=n.value;return typeof a==typeof p&&a<=p}],"filter->=":[hi,[ti,fi],(c,[n,a])=>{const p=c.properties()[n.value],_=a.value;return typeof p==typeof _&&p>=_}],"filter-id->=":[hi,[fi],(c,[n])=>{const a=c.id(),p=n.value;return typeof a==typeof p&&a>=p}],"filter-has":[hi,[fi],(c,[n])=>n.value in c.properties()],"filter-has-id":[hi,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[hi,[Pr(ti)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[hi,[Pr(fi)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[hi,[ti,Pr(fi)],(c,[n,a])=>a.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[hi,[ti,Pr(fi)],(c,[n,a])=>(function(p,_,b,x){for(;b<=x;){const E=b+x>>1;if(_[E]===p)return!0;_[E]>p?x=E-1:b=E+1}return!1})(c.properties()[n.value],a.value,0,a.value.length-1)],all:{type:hi,overloads:[[[hi,hi],(c,[n,a])=>n.evaluate(c)&&a.evaluate(c)],[Ba(hi),(c,n)=>{for(const a of n)if(!a.evaluate(c))return!1;return!0}]]},any:{type:hi,overloads:[[[hi,hi],(c,[n,a])=>n.evaluate(c)||a.evaluate(c)],[Ba(hi),(c,n)=>{for(const a of n)if(a.evaluate(c))return!0;return!1}]]},"!":[hi,[hi],(c,[n])=>!n.evaluate(c)],"is-supported-script":[hi,[ti],(c,[n])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(n.evaluate(c))}],upcase:[ti,[ti],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[ti,[ti],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[ti,Ba(fi),(c,n)=>n.map((a=>No(a.evaluate(c)))).join("")],"resolved-locale":[ti,[bl],(c,[n])=>n.evaluate(c).resolvedLocale()]});class zh{constructor(n,a,p){this.expression=n,this._warningHistory={},this._evaluator=new Al,this._defaultValue=a?(function(_){if(_.type==="color"&&kh(_.default))return new mi(0,0,0,0);switch(_.type){case"color":return mi.parse(_.default)||null;case"padding":return Zn.parse(_.default)||null;case"numberArray":return vn.parse(_.default)||null;case"colorArray":return ri.parse(_.default)||null;case"variableAnchorOffsetCollection":return Bn.parse(_.default)||null;case"projectionDefinition":return ar.parse(_.default)||null;default:return _.default===void 0?null:_.default}})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this._globalState=p}evaluateWithoutErrorHandling(n,a,p,_,b,x){return this._globalState&&(n=ur(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=p,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,a,p,_,b,x){this._globalState&&(n=ur(n,this._globalState)),this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=p||null,this._evaluator.canonical=_,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map((P=>JSON.stringify(P))).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Zo(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Oc}function Lc(c,n,a){const p=new El(Oc,Hr,[],n?(function(b){const x={color:ms,string:ti,number:Ct,enum:ti,boolean:hi,formatted:Pa,padding:ro,numberArray:Ra,colorArray:Ia,projectionDefinition:bh,resolvedImage:Ln,variableAnchorOffsetCollection:bc};return b.type==="array"?Pr(x[b.value]||fi,b.length):x[b.type]})(n):void 0),_=p.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Bu(new zh(_,n,a)):Xo(p.errors)}class Wr{constructor(n,a,p){this.kind=n,this._styleExpression=a,this.isStateDependent=n!=="constant"&&!Ol(a.expression),this.globalStateRefs=or(a.expression),this._globalState=p}evaluateWithoutErrorHandling(n,a,p,_,b,x){return this._globalState&&(n=ur(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,a,p,_,b,x)}evaluate(n,a,p,_,b,x){return this._globalState&&(n=ur(n,this._globalState)),this._styleExpression.evaluate(n,a,p,_,b,x)}}class Yo{constructor(n,a,p,_,b){this.kind=n,this.zoomStops=p,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!Ol(a.expression),this.globalStateRefs=or(a.expression),this.interpolationType=_,this._globalState=b}evaluateWithoutErrorHandling(n,a,p,_,b,x){return this._globalState&&(n=ur(n,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(n,a,p,_,b,x)}evaluate(n,a,p,_,b,x){return this._globalState&&(n=ur(n,this._globalState)),this._styleExpression.evaluate(n,a,p,_,b,x)}interpolationFactor(n,a,p){return this.interpolationType?$r.interpolationFactor(this.interpolationType,n,a,p):0}}function Ko(c,n,a){const p=Lc(c,n,a);if(p.result==="error")return p;const _=p.value.expression,b=oo(_);if(!b&&!js(n))return Xo([new ln("","data expressions not supported")]);const x=kl(_,["zoom"]);if(!x&&!jf(n))return Xo([new ln("","zoom expressions not supported")]);const E=Qo(_);return E||x?E instanceof ln?Xo([E]):E instanceof $r&&!kc(n)?Xo([new ln("",'"interpolate" expressions cannot be used with this property')]):Bu(E?new Yo(b?"camera":"composite",p.value,E.labels,E instanceof $r?E.interpolation:void 0,a):new Wr(b?"constant":"source",p.value,a)):Xo([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ll{constructor(n,a){this._parameters=n,this._specification=a,Li(this,Lh(this._parameters,this._specification))}static deserialize(n){return new Ll(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Qo(c){let n=null;if(c instanceof Gi)n=Qo(c.result);else if(c instanceof Ml){for(const a of c.args)if(n=Qo(a),n)break}else(c instanceof jo||c instanceof $r)&&c.input instanceof vs&&c.input.name==="zoom"&&(n=c);return n instanceof ln||c.eachChild((a=>{const p=Qo(a);p instanceof ln?n=p:!n&&p?n=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&p&&n!==p&&(n=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}function or(c,n=new Set){return c instanceof Lu&&n.add(c.key),c.eachChild((a=>{or(a,n)})),n}function ur(c,n){const{zoom:a,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:x,accumulated:E}=c??{};return{zoom:a,heatmapDensity:p,elevation:_,lineProgress:b,isSupportedScript:x,accumulated:E,globalState:n}}function za(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!za(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Fa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function es(c,n){if(c==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};za(c)||(c=Bl(c));const a=Lc(c,Fa,n);if(a.result==="error")throw new Error(a.value.map((p=>`${p.key}: ${p.message}`)).join(", "));return{filter:(p,_,b)=>a.value.evaluate(p,_,{},b),needGeometry:Hf(c),getGlobalStateRefs:()=>or(a.value.expression)}}function lo(c,n){return c<n?-1:c>n?1:0}function Hf(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let n=1;n<c.length;n++)if(Hf(c[n]))return!0;return!1}function Bl(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?Bc(c[1],c[2],"=="):n==="!="?en(Bc(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Bc(c[1],c[2],n):n==="any"?(a=c.slice(1),["any"].concat(a.map(Bl))):n==="all"?["all"].concat(c.slice(1).map(Bl)):n==="none"?["all"].concat(c.slice(1).map(Bl).map(en)):n==="in"?Wf(c[1],c.slice(2)):n==="!in"?en(Wf(c[1],c.slice(2))):n==="has"?hr(c[1]):n!=="!has"||en(hr(c[1]));var a}function Bc(c,n,a){switch(c){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,c,n]}}function Wf(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some((a=>typeof a!=typeof n[0]))?["filter-in-large",c,["literal",n.sort(lo)]]:["filter-in-small",c,["literal",n]]}}function hr(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function en(c){return["!",c]}function Pi(c){const n=typeof c;if(n==="number"||n==="boolean"||n==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let _="[";for(const b of c)_+=`${Pi(b)},`;return`${_}]`}const a=Object.keys(c).sort();let p="{";for(let _=0;_<a.length;_++)p+=`${JSON.stringify(a[_])}:${Pi(c[a[_]])},`;return`${p}}`}function co(c){let n="";for(const a of Wt)n+=`/${Pi(c[a])}`;return n}function Ts(c){const n=c.value;return n?[new Tt(c.key,n,"constants have been deprecated as of v8")]:[]}function Cn(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ts(c){if(Array.isArray(c))return c.map(ts);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const a in c)n[a]=ts(c[a]);return n}return Cn(c)}function is(c){const n=c.key,a=c.value,p=c.valueSpec||{},_=c.objectElementValidators||{},b=c.style,x=c.styleSpec,E=c.validateSpec;let P=[];const O=pi(a);if(O!=="object")return[new Tt(n,a,`object expected, ${O} found`)];for(const B in a){const F=B.split(".")[0],V=Tc(p,F)||p["*"];let j;if(Tc(_,F))j=_[F];else if(Tc(p,F)){if(a[B]===void 0)continue;j=E}else if(_["*"])j=_["*"];else{if(!p["*"]){P.push(new Tt(n,a[B],`unknown property "${B}"`));continue}j=E}P=P.concat(j({key:(n&&`${n}.`)+B,value:a[B],valueSpec:V,style:b,styleSpec:x,object:a,objectKey:B,validateSpec:E},a))}for(const B in p)_[B]||p[B].required&&p[B].default===void 0&&a[B]===void 0&&P.push(new Tt(n,a,`missing required property "${B}"`));return P}function zu(c){const n=c.value,a=c.valueSpec,p=c.style,_=c.styleSpec,b=c.key,x=c.arrayElementValidator||c.validateSpec;if(pi(n)!=="array")return[new Tt(b,n,`array expected, ${pi(n)} found`)];if(a.length&&n.length!==a.length)return[new Tt(b,n,`array length ${a.length} expected, length ${n.length} found`)];let E={type:a.value,values:a.values};_.$version<7&&(E.function=a.function),pi(a.value)==="object"&&(E=a.value);let P=[];for(let O=0;O<n.length;O++)P=P.concat(x({array:n,arrayIndex:O,value:n[O],valueSpec:E,validateSpec:c.validateSpec,style:p,styleSpec:_,key:`${b}[${O}]`}));return P}function Na(c){const n=c.key,a=c.value,p=c.valueSpec;let _=pi(a);return _==="number"&&a!=a&&(_="NaN"),_!=="number"?[new Tt(n,a,`number expected, ${_} found`)]:"minimum"in p&&a<p.minimum?[new Tt(n,a,`${a} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&a>p.maximum?[new Tt(n,a,`${a} is greater than the maximum value ${p.maximum}`)]:[]}function Ua(c){const n=c.valueSpec,a=Cn(c.value.type);let p,_,b,x={};const E=a!=="categorical"&&c.value.property===void 0,P=!E,O=pi(c.value.stops)==="array"&&pi(c.value.stops[0])==="array"&&pi(c.value.stops[0][0])==="object",B=is({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(j){if(a==="identity")return[new Tt(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const Z=j.value;return X=X.concat(zu({key:j.key,value:Z,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),pi(Z)==="array"&&Z.length===0&&X.push(new Tt(j.key,Z,"array must have at least one stop")),X},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:n,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return a==="identity"&&E&&B.push(new Tt(c.key,c.value,'missing required property "property"')),a==="identity"||c.value.stops||B.push(new Tt(c.key,c.value,'missing required property "stops"')),a==="exponential"&&c.valueSpec.expression&&!kc(c.valueSpec)&&B.push(new Tt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(P&&!js(c.valueSpec)?B.push(new Tt(c.key,c.value,"property functions not supported")):E&&!jf(c.valueSpec)&&B.push(new Tt(c.key,c.value,"zoom functions not supported"))),a!=="categorical"&&!O||c.value.property!==void 0||B.push(new Tt(c.key,c.value,'"property" property is required')),B;function F(j){let X=[];const Z=j.value,Q=j.key;if(pi(Z)!=="array")return[new Tt(Q,Z,`array expected, ${pi(Z)} found`)];if(Z.length!==2)return[new Tt(Q,Z,`array length 2 expected, length ${Z.length} found`)];if(O){if(pi(Z[0])!=="object")return[new Tt(Q,Z,`object expected, ${pi(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Tt(Q,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Tt(Q,Z,"object stop key must have value")];if(b&&b>Cn(Z[0].zoom))return[new Tt(Q,Z[0].zoom,"stop zoom values must appear in ascending order")];Cn(Z[0].zoom)!==b&&(b=Cn(Z[0].zoom),_=void 0,x={}),X=X.concat(is({key:`${Q}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Na,value:V}}))}else X=X.concat(V({key:`${Q}[0]`,value:Z[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},Z));return Zo(ts(Z[1]))?X.concat([new Tt(`${Q}[1]`,Z[1],"expressions are not allowed in function stops.")]):X.concat(j.validateSpec({key:`${Q}[1]`,value:Z[1],valueSpec:n,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function V(j,X){const Z=pi(j.value),Q=Cn(j.value),se=j.value!==null?j.value:X;if(p){if(Z!==p)return[new Tt(j.key,se,`${Z} stop domain type must match previous stop domain type ${p}`)]}else p=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Tt(j.key,se,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&a!=="categorical"){let ge=`number expected, ${Z} found`;return js(n)&&a===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(j.key,se,ge)]}return a!=="categorical"||Z!=="number"||isFinite(Q)&&Math.floor(Q)===Q?a!=="categorical"&&Z==="number"&&_!==void 0&&Q<_?[new Tt(j.key,se,"stop domain values must appear in ascending order")]:(_=Q,a==="categorical"&&Q in x?[new Tt(j.key,se,"stop domain values must be unique")]:(x[Q]=!0,[])):[new Tt(j.key,se,`integer expected, found ${Q}`)]}}function Va(c){const n=(c.expressionContext==="property"?Ko:Lc)(ts(c.value),c.valueSpec);if(n.result==="error")return n.value.map((p=>new Tt(`${c.key}${p.key}`,c.value,p.message)));const a=n.value.expression||n.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!a.outputDefined())return[new Tt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Ol(a))return[new Tt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Ol(a))return[new Tt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!kl(a,["zoom","feature-state"]))return[new Tt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!oo(a))return[new Tt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function uo(c){const n=c.key,a=c.value,p=pi(a);return p!=="string"?[new Tt(n,a,`color expected, ${p} found`)]:mi.parse(String(a))?[]:[new Tt(n,a,`color expected, "${a}" found`)]}function ho(c){const n=c.key,a=c.value,p=c.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(Cn(a))===-1&&_.push(new Tt(n,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(Cn(a))===-1&&_.push(new Tt(n,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),_}function $s(c){return za(ts(c.value))?Va(Li({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ja(c)}function ja(c){const n=c.value,a=c.key;if(pi(n)!=="array")return[new Tt(a,n,`array expected, ${pi(n)} found`)];const p=c.styleSpec;let _,b=[];if(n.length<1)return[new Tt(a,n,"filter array must have at least 1 element")];switch(b=b.concat(ho({key:`${a}[0]`,value:n[0],valueSpec:p.filter_operator,style:c.style,styleSpec:c.styleSpec})),Cn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Cn(n[1])==="$type"&&b.push(new Tt(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&b.push(new Tt(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(_=pi(n[1]),_!=="string"&&b.push(new Tt(`${a}[1]`,n[1],`string expected, ${_} found`)));for(let x=2;x<n.length;x++)_=pi(n[x]),Cn(n[1])==="$type"?b=b.concat(ho({key:`${a}[${x}]`,value:n[x],valueSpec:p.geometry_type,style:c.style,styleSpec:c.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&b.push(new Tt(`${a}[${x}]`,n[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)b=b.concat(ja({key:`${a}[${x}]`,value:n[x],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":_=pi(n[1]),n.length!==2?b.push(new Tt(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):_!=="string"&&b.push(new Tt(`${a}[1]`,n[1],`string expected, ${_} found`))}return b}function fo(c,n){const a=c.key,p=c.validateSpec,_=c.style,b=c.styleSpec,x=c.value,E=c.objectKey,P=b[`${n}_${c.layerType}`];if(!P)return[];const O=E.match(/^(.*)-transition$/);if(n==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return p({key:a,value:x,valueSpec:b.transition,style:_,styleSpec:b});const B=c.valueSpec||P[E];if(!B)return[new Tt(a,x,`unknown property "${E}"`)];let F;if(pi(x)==="string"&&js(B)&&!B.tokens&&(F=/^{([^}]+)}$/.exec(x)))return[new Tt(a,x,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const V=[];return c.layerType==="symbol"&&E==="text-font"&&kh(ts(x))&&Cn(x.type)==="identity"&&V.push(new Tt(a,x,'"text-font" does not support identity functions')),V.concat(p({key:c.key,value:x,valueSpec:B,style:_,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:E}))}function $a(c){return fo(c,"paint")}function Fh(c){return fo(c,"layout")}function Nh(c){let n=[];const a=c.value,p=c.key,_=c.style,b=c.styleSpec;if(pi(a)!=="object")return[new Tt(p,a,`object expected, ${pi(a)} found`)];a.type||a.ref||n.push(new Tt(p,a,'either "type" or "ref" is required'));let x=Cn(a.type);const E=Cn(a.ref);if(a.id){const P=Cn(a.id);for(let O=0;O<c.arrayIndex;O++){const B=_.layers[O];Cn(B.id)===P&&n.push(new Tt(p,a.id,`duplicate layer id "${a.id}", previously used at line ${B.id.__line__}`))}}if("ref"in a){let P;["type","source","source-layer","filter","layout"].forEach((O=>{O in a&&n.push(new Tt(p,a[O],`"${O}" is prohibited for ref layers`))})),_.layers.forEach((O=>{Cn(O.id)===E&&(P=O)})),P?P.ref?n.push(new Tt(p,a.ref,"ref cannot reference another ref layer")):x=Cn(P.type):n.push(new Tt(p,a.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(a.source){const P=_.sources&&_.sources[a.source],O=P&&Cn(P.type);P?O==="vector"&&x==="raster"?n.push(new Tt(p,a.source,`layer "${a.id}" requires a raster source`)):O!=="raster-dem"&&x==="hillshade"||O!=="raster-dem"&&x==="color-relief"?n.push(new Tt(p,a.source,`layer "${a.id}" requires a raster-dem source`)):O==="raster"&&x!=="raster"?n.push(new Tt(p,a.source,`layer "${a.id}" requires a vector source`)):O!=="vector"||a["source-layer"]?O==="raster-dem"&&x!=="hillshade"&&x!=="color-relief"?n.push(new Tt(p,a.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):x!=="line"||!a.paint||!a.paint["line-gradient"]||O==="geojson"&&P.lineMetrics||n.push(new Tt(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Tt(p,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new Tt(p,a.source,`source "${a.source}" not found`))}else n.push(new Tt(p,a,'missing required property "source"'));return n=n.concat(is({key:p,value:a,valueSpec:b.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${p}.type`,value:a.type,valueSpec:b.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:a,objectKey:"type"}),filter:$s,layout:P=>is({layer:a,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>Fh(Li({layerType:x},O))}}),paint:P=>is({layer:a,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>$a(Li({layerType:x},O))}})}})),n}function Ss(c){const n=c.value,a=c.key,p=pi(n);return p!=="string"?[new Tt(a,n,`string expected, ${p} found`)]:[]}const zc={promoteId:function({key:c,value:n}){if(pi(n)==="string")return Ss({key:c,value:n});{const a=[];for(const p in n)a.push(...Ss({key:`${c}.${p}`,value:n[p]}));return a}}};function po(c){const n=c.value,a=c.key,p=c.styleSpec,_=c.style,b=c.validateSpec;if(!n.type)return[new Tt(a,n,'"type" is required')];const x=Cn(n.type);let E;switch(x){case"vector":case"raster":return E=is({key:a,value:n,valueSpec:p[`source_${x.replace("-","_")}`],style:c.style,styleSpec:p,objectElementValidators:zc,validateSpec:b}),E;case"raster-dem":return E=(function(P){var O;const B=(O=P.sourceName)!==null&&O!==void 0?O:"",F=P.value,V=P.styleSpec,j=V.source_raster_dem,X=P.style;let Z=[];const Q=pi(F);if(F===void 0)return Z;if(Q!=="object")return Z.push(new Tt("source_raster_dem",F,`object expected, ${Q} found`)),Z;const se=Cn(F.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],ie=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const ue in F)!se&&ge.includes(ue)?Z.push(new Tt(ue,F[ue],`In "${B}": "${ue}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):j[ue]?Z=Z.concat(P.validateSpec({key:ue,value:F[ue],valueSpec:j[ue],validateSpec:P.validateSpec,style:X,styleSpec:V})):Z.push(new Tt(ue,F[ue],`unknown property "${ue}"`));return Z})({sourceName:a,value:n,style:c.style,styleSpec:p,validateSpec:b}),E;case"geojson":if(E=is({key:a,value:n,valueSpec:p.source_geojson,style:_,styleSpec:p,validateSpec:b,objectElementValidators:zc}),n.cluster)for(const P in n.clusterProperties){const[O,B]=n.clusterProperties[P],F=typeof O=="string"?[O,["accumulated"],["get",P]]:O;E.push(...Va({key:`${a}.${P}.map`,value:B,expressionContext:"cluster-map"})),E.push(...Va({key:`${a}.${P}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return E;case"video":return is({key:a,value:n,valueSpec:p.source_video,style:_,validateSpec:b,styleSpec:p});case"image":return is({key:a,value:n,valueSpec:p.source_image,style:_,validateSpec:b,styleSpec:p});case"canvas":return[new Tt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ho({key:`${a}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Yn(c){const n=c.value,a=c.styleSpec,p=a.light,_=c.style;let b=[];const x=pi(n);if(n===void 0)return b;if(x!=="object")return b=b.concat([new Tt("light",n,`object expected, ${x} found`)]),b;for(const E in n){const P=E.match(/^(.*)-transition$/);b=b.concat(P&&p[P[1]]&&p[P[1]].transition?c.validateSpec({key:E,value:n[E],valueSpec:a.transition,validateSpec:c.validateSpec,style:_,styleSpec:a}):p[E]?c.validateSpec({key:E,value:n[E],valueSpec:p[E],validateSpec:c.validateSpec,style:_,styleSpec:a}):[new Tt(E,n[E],`unknown property "${E}"`)])}return b}function Fu(c){const n=c.value,a=c.styleSpec,p=a.sky,_=c.style,b=pi(n);if(n===void 0)return[];if(b!=="object")return[new Tt("sky",n,`object expected, ${b} found`)];let x=[];for(const E in n)x=x.concat(p[E]?c.validateSpec({key:E,value:n[E],valueSpec:p[E],style:_,styleSpec:a}):[new Tt(E,n[E],`unknown property "${E}"`)]);return x}function Uh(c){const n=c.value,a=c.styleSpec,p=a.terrain,_=c.style;let b=[];const x=pi(n);if(n===void 0)return b;if(x!=="object")return b=b.concat([new Tt("terrain",n,`object expected, ${x} found`)]),b;for(const E in n)b=b.concat(p[E]?c.validateSpec({key:E,value:n[E],valueSpec:p[E],validateSpec:c.validateSpec,style:_,styleSpec:a}):[new Tt(E,n[E],`unknown property "${E}"`)]);return b}function qf(c){let n=[];const a=c.value,p=c.key;if(Array.isArray(a)){const _=[],b=[];for(const x in a)a[x].id&&_.includes(a[x].id)&&n.push(new Tt(p,a,`all the sprites' ids must be unique, but ${a[x].id} is duplicated`)),_.push(a[x].id),a[x].url&&b.includes(a[x].url)&&n.push(new Tt(p,a,`all the sprites' URLs must be unique, but ${a[x].url} is duplicated`)),b.push(a[x].url),n=n.concat(is({key:`${p}[${x}]`,value:a[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return n}return Ss({key:p,value:a})}function wp(c){return!!c&&c.constructor===Object}function Xf(c){return wp(c.value)?[]:[new Tt(c.key,c.value,`object expected, ${pi(c.value)} found`)]}const Wn={"*":()=>[],array:zu,boolean:function(c){const n=c.value,a=c.key,p=pi(n);return p!=="boolean"?[new Tt(a,n,`boolean expected, ${p} found`)]:[]},number:Na,color:uo,constants:Ts,enum:ho,filter:$s,function:Ua,layer:Nh,object:is,source:po,light:Yn,sky:Fu,terrain:Uh,projection:function(c){const n=c.value,a=c.styleSpec,p=a.projection,_=c.style,b=pi(n);if(n===void 0)return[];if(b!=="object")return[new Tt("projection",n,`object expected, ${b} found`)];let x=[];for(const E in n)x=x.concat(p[E]?c.validateSpec({key:E,value:n[E],valueSpec:p[E],style:_,styleSpec:a}):[new Tt(E,n[E],`unknown property "${E}"`)]);return x},projectionDefinition:function(c){const n=c.key;let a=c.value;a=a instanceof String?a.valueOf():a;const p=pi(a);return p!=="array"||(function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"})(a)||(function(_){return!!["interpolate","step","literal"].includes(_[0])})(a)?["array","string"].includes(p)?[]:[new Tt(n,a,`projection expected, invalid type "${p}" found`)]:[new Tt(n,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:Ss,formatted:function(c){return Ss(c).length===0?[]:Va(c)},resolvedImage:function(c){return Ss(c).length===0?[]:Va(c)},padding:function(c){const n=c.key,a=c.value;if(pi(a)==="array"){if(a.length<1||a.length>4)return[new Tt(n,a,`padding requires 1 to 4 values; ${a.length} values found`)];const p={type:"number"};let _=[];for(let b=0;b<a.length;b++)_=_.concat(c.validateSpec({key:`${n}[${b}]`,value:a[b],validateSpec:c.validateSpec,valueSpec:p}));return _}return Na({key:n,value:a,valueSpec:{}})},numberArray:function(c){const n=c.key,a=c.value;if(pi(a)==="array"){const p={type:"number"};if(a.length<1)return[new Tt(n,a,"array length at least 1 expected, length 0 found")];let _=[];for(let b=0;b<a.length;b++)_=_.concat(c.validateSpec({key:`${n}[${b}]`,value:a[b],validateSpec:c.validateSpec,valueSpec:p}));return _}return Na({key:n,value:a,valueSpec:{}})},colorArray:function(c){const n=c.key,a=c.value;if(pi(a)==="array"){if(a.length<1)return[new Tt(n,a,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<a.length;_++)p=p.concat(uo({key:`${n}[${_}]`,value:a[_]}));return p}return uo({key:n,value:a})},variableAnchorOffsetCollection:function(c){const n=c.key,a=c.value,p=pi(a),_=c.styleSpec;if(p!=="array"||a.length<1||a.length%2!=0)return[new Tt(n,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let x=0;x<a.length;x+=2)b=b.concat(ho({key:`${n}[${x}]`,value:a[x],valueSpec:_.layout_symbol["text-anchor"]})),b=b.concat(zu({key:`${n}[${x+1}]`,value:a[x+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:_}));return b},sprite:qf,state:Xf,fontFaces:function(c){const n=c.key,a=c.value,p=c.validateSpec,_=c.styleSpec,b=c.style;if(!wp(a))return[new Tt(n,a,`object expected, ${pi(a)} found`)];const x=[];for(const E in a){const P=a[E],O=pi(P);if(O==="string")x.push(...Ss({key:`${n}.${E}`,value:P}));else if(O==="array"){const B={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[F,V]of P.entries())x.push(...is({key:`${n}.${E}[${F}]`,value:V,valueSpec:B,styleSpec:_,style:b,validateSpec:p}))}else x.push(new Tt(`${n}.${E}`,P,`string or array expected, ${O} found`))}return x}};function Ha(c){const n=c.value,a=c.valueSpec,p=c.styleSpec;return c.validateSpec=Ha,a.expression&&kh(Cn(n))?Ua(c):a.expression&&Zo(ts(n))?Va(c):a.type&&Wn[a.type]?Wn[a.type](c):is(Li({},c,{valueSpec:a.type?p[a.type]:a}))}function Fc(c){const n=c.value,a=c.key,p=Ss(c);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new Tt(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new Tt(a,n,'"glyphs" url must include a "{range}" token'))),p}function Ir(c,n=Ce){let a=[];return a=a.concat(Ha({key:"",value:c,valueSpec:n.$root,styleSpec:n,style:c,validateSpec:Ha,objectElementValidators:{glyphs:Fc,"*":()=>[]}})),c.constants&&(a=a.concat(Ts({key:"constants",value:c.constants}))),zl(a)}function As(c){return function(n){return c(Object.assign({},n,{validateSpec:Ha}))}}function zl(c){return[].concat(c).sort(((n,a)=>n.line-a.line))}function Rr(c){return function(...n){return zl(c.apply(this,n))}}Ir.source=Rr(As(po)),Ir.sprite=Rr(As(qf)),Ir.glyphs=Rr(As(Fc)),Ir.light=Rr(As(Yn)),Ir.sky=Rr(As(Fu)),Ir.terrain=Rr(As(Uh)),Ir.state=Rr(As(Xf)),Ir.layer=Rr(As(Nh)),Ir.filter=Rr(As($s)),Ir.paintProperty=Rr(As($a)),Ir.layoutProperty=Rr(As(Fh));const lm={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Nc{constructor(n,a){this._globalState=a,this.setValue(n)}evaluate(){var n;return(n=this._literalValue)!==null&&n!==void 0?n:this._compiledValue.evaluate({})}setValue(n){if(n==null||n==="visible"||n==="none")return this._literalValue=n==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const a=Lc(n,lm,this._globalState);if(a.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(a.value.map((p=>`${p.key}: ${p.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=a.value,this._globalStateRefs=or(a.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Nu=Ce,lr=Ir,ha=lr.light,Vh=lr.sky,jh=lr.paintProperty,Tp=lr.layoutProperty;function fa(c,n){let a=!1;if(n&&n.length)for(const p of n)c.fire(new yt(new Error(p.message))),a=!0;return a}class Jo{constructor(n,a,p){const _=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(a=x[1])+2*(p=x[2]);for(let P=0;P<this.d*this.d;P++){const O=x[3+P],B=x[3+P+1];_.push(O===B?null:x.subarray(O,B))}const E=x[3+_.length+1];this.keys=x.subarray(x[3+_.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=a+2*p;for(let x=0;x<this.d*this.d;x++)_.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=p,this.scale=a/n,this.uid=0;const b=p/a*n;this.min=-b,this.max=n+b}insert(n,a,p,_,b){this._forEachCell(a,p,_,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,a,p,_,b,x){this.cells[b].push(x)}query(n,a,p,_,b){const x=this.min,E=this.max;if(n<=x&&a<=x&&E<=p&&E<=_&&!b)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(n,a,p,_,this._queryCell,P,{},b),P}}_queryCell(n,a,p,_,b,x,E,P){const O=this.cells[b];if(O!==null){const B=this.keys,F=this.bboxes;for(let V=0;V<O.length;V++){const j=O[V];if(E[j]===void 0){const X=4*j;(P?P(F[X+0],F[X+1],F[X+2],F[X+3]):n<=F[X+2]&&a<=F[X+3]&&p>=F[X+0]&&_>=F[X+1])?(E[j]=!0,x.push(B[j])):E[j]=!1}}}}_forEachCell(n,a,p,_,b,x,E,P){const O=this._convertToCellCoord(n),B=this._convertToCellCoord(a),F=this._convertToCellCoord(p),V=this._convertToCellCoord(_);for(let j=O;j<=F;j++)for(let X=B;X<=V;X++){const Z=this.d*X+j;if((!P||P(this._convertFromCellCoord(j),this._convertFromCellCoord(X),this._convertFromCellCoord(j+1),this._convertFromCellCoord(X+1)))&&b.call(this,n,a,p,_,Z,x,E,P))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,a=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const _=new Int32Array(a+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let b=a;for(let x=0;x<n.length;x++){const E=n[x];_[3+x]=b,_.set(E,b),b+=E.length}return _[3+n.length]=b,_.set(this.keys,b),b+=this.keys.length,_[3+n.length+1]=b,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer}static serialize(n,a){const p=n.toArrayBuffer();return a&&a.push(p),{buffer:p}}static deserialize(n){return new Jo(n.buffer)}}const ns={};function Nt(c,n,a={}){if(ns[c])throw new Error(`${c} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:c,writeable:!1}),ns[c]={klass:n,omit:a.omit||[],shallow:a.shallow||[]}}Nt("Object",Object),Nt("Set",Set),Nt("TransferableGridIndex",Jo),Nt("Color",mi),Nt("Error",Error),Nt("AJAXError",ee),Nt("ResolvedImage",Ur),Nt("StylePropertyFunction",Ll),Nt("StyleExpression",zh,{omit:["_evaluator"]}),Nt("ZoomDependentExpression",Yo),Nt("ZoomConstantExpression",Wr),Nt("CompoundExpression",vs,{omit:["_evaluate"]});for(const c in Oc)Oc[c]._classRegistryKey||Nt(`Expression_${c}`,Oc[c]);function Uu(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function $h(c){return c.$name||c.constructor._classRegistryKey}function Hs(c){return!(function(n){if(n===null||typeof n!="object")return!1;const a=$h(n);return!(!a||a==="Object")})(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Uu(c)||Ea(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function da(c,n){if(Hs(c))return(Uu(c)||Ea(c))&&n&&n.push(c),ArrayBuffer.isView(c)&&n&&n.push(c.buffer),c instanceof ImageData&&n&&n.push(c.data.buffer),c;if(Array.isArray(c)){const b=[];for(const x of c)b.push(da(x,n));return b}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const a=$h(c);if(!a)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!ns[a])throw new Error(`${a} is not registered.`);const{klass:p}=ns[a],_=p.serialize?p.serialize(c,n):{};if(p.serialize){if(n&&_===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in c){if(!c.hasOwnProperty(b)||ns[a].omit.indexOf(b)>=0)continue;const x=c[b];_[b]=ns[a].shallow.indexOf(b)>=0?x:da(x,n)}c instanceof Error&&(_.message=c.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(_.$name=a),_}function Uc(c){if(Hs(c))return c;if(Array.isArray(c))return c.map(Uc);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const n=$h(c)||"Object";if(!ns[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:a}=ns[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(c);const p=Object.create(a.prototype);for(const _ of Object.keys(c)){if(_==="$name")continue;const b=c[_];p[_]=ns[n].shallow.indexOf(_)>=0?b:Uc(b)}return p}class Hh{constructor(){this.first=!0}update(n,a){const p=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=a),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=p,!0))}}function Wa(c){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function Fl(c){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function Vu(c){return/\s/u.test(String.fromCodePoint(c))}function qa(c){for(const n of c)if(Fl(n.codePointAt(0)))return!0;return!1}function Wh(c){for(const n of c)if(!Gf(n.codePointAt(0)))return!1;return!0}function ju(c){const n=c.map((a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}})).filter((a=>a));return new RegExp(n.join("|"),"u")}const Xa=ju(["Arab","Dupl","Mong","Ougr","Syrc"]);function Gf(c){return!Xa.test(String.fromCodePoint(c))}function Ga(c){return!(Fl(c)||(n=c,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(n))));var n}const qh=ju(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function $u(c){return qh.test(String.fromCodePoint(c))}function Za(c,n){return!(!n&&$u(c)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(c)))}function go(c){for(const n of c)if($u(n.codePointAt(0)))return!0;return!1}const Ws=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(Ws.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,n){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;const a=c.pluginURL,p=new Promise((b=>{this.loadScriptResolve=b}));n(a);const _=new Promise((b=>setTimeout((()=>b()),this.TIMEOUT)));if(yield Promise.race([p,_]),this.isParsed()){const b={pluginStatus:"loaded",pluginURL:a};return this.setState(b),b}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)}))}};class Wi{constructor(n,a){this.isSupportedScript=Zf,this.zoom=n,a?(this.now=a.now||0,this.fadeDuration=a.fadeDuration||0,this.zoomHistory=a.zoomHistory||new Hh,this.transition=a.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hh,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,a=n-Math.floor(n),p=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*a}}}function Zf(c){return(function(n,a){for(const p of n)if(!Za(p.codePointAt(0),a))return!1;return!0})(c,Ws.getRTLTextPluginStatus()==="loaded")}const mo="-transition";class el{constructor(n,a,p){this.property=n,this.value=a,this.expression=(function(_,b,x){if(kh(_))return new Ll(_,b);if(Zo(_)){const E=Ko(_,b,x);if(E.result==="error")throw new Error(E.value.map((P=>`${P.key}: ${P.message}`)).join(", "));return E.value}{let E=_;return b.type==="color"&&typeof _=="string"?E=mi.parse(_):b.type!=="padding"||typeof _!="number"&&!Array.isArray(_)?b.type!=="numberArray"||typeof _!="number"&&!Array.isArray(_)?b.type!=="colorArray"||typeof _!="string"&&!Array.isArray(_)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(_)?E=Bn.parse(_):b.type==="projectionDefinition"&&typeof _=="string"&&(E=ar.parse(_)):E=ri.parse(_):E=vn.parse(_):E=Zn.parse(_),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>E}}})(a===void 0?n.specification.default:a,n.specification,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,a,p){return this.property.possiblyEvaluate(this,n,a,p)}}class Hu{constructor(n,a){this.property=n,this.value=new el(n,void 0,a)}transitioned(n,a){return new Nl(this.property,this.value,a,Qt({},n.transition,this.transition),n.now)}untransitioned(){return new Nl(this.property,this.value,null,{},0)}}class Xh{constructor(n,a){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._globalState=a}getValue(n){return An(this._values[n].value.value)}setValue(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Hu(this._values[n].property,this._globalState)),this._values[n].value=new el(this._values[n].property,a===null?void 0:An(a),this._globalState)}getTransition(n){return An(this._values[n].transition)}setTransition(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Hu(this._values[n].property,this._globalState)),this._values[n].transition=An(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(n[a]=p);const _=this.getTransition(a);_!==void 0&&(n[`${a}${mo}`]=_)}return n}transitioned(n,a){const p=new Wu(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].transitioned(n,a._values[_]);return p}untransitioned(){const n=new Wu(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class Nl{constructor(n,a,p,_,b){this.property=n,this.value=a,this.begin=b+_.delay||0,this.end=this.begin+_.duration||0,n.specification.transition&&(_.delay||_.duration)&&(this.prior=p)}possiblyEvaluate(n,a,p){const _=n.now||0,b=this.value.possiblyEvaluate(n,a,p),x=this.prior;if(x){if(_>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(_<this.begin)return x.possiblyEvaluate(n,a,p);{const E=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,a,p),b,Je(E))}}return b}}class Wu{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,p){const _=new Ul(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(n,a,p);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Yf{constructor(n,a){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._globalState=a}hasValue(n){return this._values[n].value!==void 0}getValue(n){return An(this._values[n].value)}setValue(n,a){this._values[n]=new el(this._values[n].property,a===null?void 0:An(a),this._globalState)}serialize(){const n={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(n[a]=p)}return n}possiblyEvaluate(n,a,p){const _=new Ul(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(n,a,p);return _}}class Es{constructor(n,a,p){this.property=n,this.value=a,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,p,_){return this.property.evaluate(this.value,this.parameters,n,a,p,_)}}class Ul{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Ut{constructor(n){this.specification=n}possiblyEvaluate(n,a){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(a)}interpolate(n,a,p){const _=xn[this.specification.type];return _?_(n,a,p):n}}class Xt{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,p,_){return new Es(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},p,_)}:n.expression,a)}interpolate(n,a,p){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new Es(this,{kind:"constant",value:void 0},n.parameters);const _=xn[this.specification.type];if(_){const b=_(n.value.value,a.value.value,p);return new Es(this,{kind:"constant",value:b},n.parameters)}return n}evaluate(n,a,p,_,b,x){return n.kind==="constant"?n.value:n.evaluate(a,p,_,b,x)}}class qs extends Xt{possiblyEvaluate(n,a,p,_){if(n.value===void 0)return new Es(this,{kind:"constant",value:void 0},a);if(n.expression.kind==="constant"){const b=n.expression.evaluate(a,null,{},p,_),x=n.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,E=this._calculate(x,x,x,a);return new Es(this,{kind:"constant",value:E},a)}if(n.expression.kind==="camera"){const b=this._calculate(n.expression.evaluate({zoom:a.zoom-1}),n.expression.evaluate({zoom:a.zoom}),n.expression.evaluate({zoom:a.zoom+1}),a);return new Es(this,{kind:"constant",value:b},a)}return new Es(this,n.expression,a)}evaluate(n,a,p,_,b,x){if(n.kind==="source"){const E=n.evaluate(a,p,_,b,x);return this._calculate(E,E,E,a)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(a.zoom)-1},p,_),n.evaluate({zoom:Math.floor(a.zoom)},p,_),n.evaluate({zoom:Math.floor(a.zoom)+1},p,_),a):n.value}_calculate(n,a,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:p,to:a}}interpolate(n){return n}}class Vc{constructor(n){this.specification=n}possiblyEvaluate(n,a,p,_){if(n.value!==void 0){if(n.expression.kind==="constant"){const b=n.expression.evaluate(a,null,{},p,_);return this._calculate(b,b,b,a)}return this._calculate(n.expression.evaluate(new Wi(Math.floor(a.zoom-1),a)),n.expression.evaluate(new Wi(Math.floor(a.zoom),a)),n.expression.evaluate(new Wi(Math.floor(a.zoom+1),a)),a)}}_calculate(n,a,p,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:p,to:a}}interpolate(n){return n}}class qu{constructor(n){this.specification=n}possiblyEvaluate(n,a,p,_){return!!n.expression.evaluate(a,null,{},p,_)}interpolate(){return!1}}class qn{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in n){const p=n[a];p.specification.overridable&&this.overridableProperties.push(a);const _=this.defaultPropertyValues[a]=new el(p,void 0,void 0),b=this.defaultTransitionablePropertyValues[a]=new Hu(p,void 0);this.defaultTransitioningPropertyValues[a]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=_.possiblyEvaluate({})}}}Nt("DataDrivenProperty",Xt),Nt("DataConstantProperty",Ut),Nt("CrossFadedDataDrivenProperty",qs),Nt("CrossFadedProperty",Vc),Nt("ColorRampProperty",qu);class Mn extends ut{constructor(n,a,p){if(super(),this.id=n.id,this.type=n.type,this._globalState=p,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(_,b){return new Nc(_,b)})(this.visibility,p),n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=es(n.filter,p)),a.layout&&(this._unevaluatedLayout=new Yf(a.layout,p)),a.paint)){this._transitionablePaint=new Xh(a.paint,p);for(const _ in n.paint)this.setPaintProperty(_,n.paint[_],{validate:!1});for(const _ in n.layout)this.setLayoutProperty(_,n.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ul(a.paint)}}setFilter(n){this.filter=n,this._featureFilter=es(n,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){const n=new Set;for(const a of this._visibilityExpression.getGlobalStateRefs())n.add(a);if(this._unevaluatedLayout)for(const a in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[a];for(const _ of p.getGlobalStateRefs())n.add(_)}for(const a of this._featureFilter.getGlobalStateRefs())n.add(a);return n}getPaintAffectingGlobalStateRefs(){var n;const a=new globalThis.Map;if(this._transitionablePaint)for(const p in this._transitionablePaint._values){const _=this._transitionablePaint._values[p].value;for(const b of _.getGlobalStateRefs()){const x=(n=a.get(b))!==null&&n!==void 0?n:[];x.push({name:p,value:_.value}),a.set(b,x)}}return a}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(n,a,p={}){if(a==null||!this._validate(Tp,`layers.${this.id}.layout.${n}`,n,a,p))return n==="visibility"?(this.visibility=a,this._visibilityExpression.setValue(a),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(n,a)}getPaintProperty(n){return n.endsWith(mo)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a,p={}){if(a!=null&&this._validate(jh,`layers.${this.id}.paint.${n}`,n,a,p))return!1;if(n.endsWith(mo))return this._transitionablePaint.setTransition(n.slice(0,-11),a||void 0),!1;{const _=this._transitionablePaint._values[n],b=_.property.specification["property-type"]==="cross-faded-data-driven",x=_.value.isDataDriven(),E=_.value;this._transitionablePaint.setValue(n,a),this._handleSpecialPaintPropertyUpdate(n);const P=this._transitionablePaint._values[n].value;return P.isDataDriven()||x||b||this._handleOverridablePaintPropertyUpdate(n,E,P)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,a,p){return!1}isHidden(n=this.minzoom,a=!1){return!!(this.minzoom&&n<(a?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&n>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(n,a){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Mr(n,((a,p)=>!(a===void 0||p==="layout"&&!Object.keys(a).length||p==="paint"&&!Object.keys(a).length)))}_validate(n,a,p,_,b={}){return(!b||b.validate!==!1)&&fa(this,n.call(lr,{key:a,layerType:this.type,objectKey:p,value:_,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof Es&&js(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}let Fn;var Xu={get paint(){return Fn=Fn||new qn({"raster-opacity":new Ut(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ut(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(Ce.paint_raster["raster-saturation"]),"raster-contrast":new Ut(Ce.paint_raster["raster-contrast"]),"raster-resampling":new Ut(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(Ce.paint_raster["raster-fade-duration"])})}};class _o extends Mn{constructor(n,a){super(n,Xu,a)}}const Ti={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vi{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wn(c,n=1){let a=0,p=0;return{members:c.map((_=>{const b=Ti[_.type].BYTES_PER_ELEMENT,x=a=Xs(a,Math.max(n,b)),E=_.components||1;return p=Math.max(p,b),a+=b*E,{name:_.name,type:_.type,components:E,offset:x}})),size:Xs(a,Math.max(p,n)),alignment:n}}function Xs(c,n){return Math.ceil(c/n)*n}class pa extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const _=2*n;return this.int16[_+0]=a,this.int16[_+1]=p,n}}pa.prototype.bytesPerElement=4,Nt("StructArrayLayout2i4",pa);class Vl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,p)}emplace(n,a,p,_){const b=3*n;return this.int16[b+0]=a,this.int16[b+1]=p,this.int16[b+2]=_,n}}Vl.prototype.bytesPerElement=6,Nt("StructArrayLayout3i6",Vl);class jl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,p,_)}emplace(n,a,p,_,b){const x=4*n;return this.int16[x+0]=a,this.int16[x+1]=p,this.int16[x+2]=_,this.int16[x+3]=b,n}}jl.prototype.bytesPerElement=8,Nt("StructArrayLayout4i8",jl);class yo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,p,_,b,x)}emplace(n,a,p,_,b,x,E){const P=6*n;return this.int16[P+0]=a,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=b,this.int16[P+4]=x,this.int16[P+5]=E,n}}yo.prototype.bytesPerElement=12,Nt("StructArrayLayout2i4i12",yo);class Kf extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,p,_,b,x)}emplace(n,a,p,_,b,x,E){const P=4*n,O=8*n;return this.int16[P+0]=a,this.int16[P+1]=p,this.uint8[O+4]=_,this.uint8[O+5]=b,this.uint8[O+6]=x,this.uint8[O+7]=E,n}}Kf.prototype.bytesPerElement=8,Nt("StructArrayLayout2i4ub8",Kf);class hn extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const _=2*n;return this.float32[_+0]=a,this.float32[_+1]=p,n}}hn.prototype.bytesPerElement=8,Nt("StructArrayLayout2f8",hn);class ga extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P,O,B){const F=this.length;return this.resize(F+1),this.emplace(F,n,a,p,_,b,x,E,P,O,B)}emplace(n,a,p,_,b,x,E,P,O,B,F){const V=10*n;return this.uint16[V+0]=a,this.uint16[V+1]=p,this.uint16[V+2]=_,this.uint16[V+3]=b,this.uint16[V+4]=x,this.uint16[V+5]=E,this.uint16[V+6]=P,this.uint16[V+7]=O,this.uint16[V+8]=B,this.uint16[V+9]=F,n}}ga.prototype.bytesPerElement=20,Nt("StructArrayLayout10ui20",ga);class jc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P){const O=this.length;return this.resize(O+1),this.emplace(O,n,a,p,_,b,x,E,P)}emplace(n,a,p,_,b,x,E,P,O){const B=8*n;return this.uint16[B+0]=a,this.uint16[B+1]=p,this.uint16[B+2]=_,this.uint16[B+3]=b,this.uint16[B+4]=x,this.uint16[B+5]=E,this.uint16[B+6]=P,this.uint16[B+7]=O,n}}jc.prototype.bytesPerElement=16,Nt("StructArrayLayout8ui16",jc);class $c extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P,O,B,F,V){const j=this.length;return this.resize(j+1),this.emplace(j,n,a,p,_,b,x,E,P,O,B,F,V)}emplace(n,a,p,_,b,x,E,P,O,B,F,V,j){const X=12*n;return this.int16[X+0]=a,this.int16[X+1]=p,this.int16[X+2]=_,this.int16[X+3]=b,this.uint16[X+4]=x,this.uint16[X+5]=E,this.uint16[X+6]=P,this.uint16[X+7]=O,this.int16[X+8]=B,this.int16[X+9]=F,this.int16[X+10]=V,this.int16[X+11]=j,n}}$c.prototype.bytesPerElement=24,Nt("StructArrayLayout4i4ui4i24",$c);class Gu extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,p)}emplace(n,a,p,_){const b=3*n;return this.float32[b+0]=a,this.float32[b+1]=p,this.float32[b+2]=_,n}}Gu.prototype.bytesPerElement=12,Nt("StructArrayLayout3f12",Gu);class Zu extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}Zu.prototype.bytesPerElement=4,Nt("StructArrayLayout1ul4",Zu);class Yu extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P,O){const B=this.length;return this.resize(B+1),this.emplace(B,n,a,p,_,b,x,E,P,O)}emplace(n,a,p,_,b,x,E,P,O,B){const F=10*n,V=5*n;return this.int16[F+0]=a,this.int16[F+1]=p,this.int16[F+2]=_,this.int16[F+3]=b,this.int16[F+4]=x,this.int16[F+5]=E,this.uint32[V+3]=P,this.uint16[F+8]=O,this.uint16[F+9]=B,n}}Yu.prototype.bytesPerElement=20,Nt("StructArrayLayout6i1ul2ui20",Yu);class tl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,p,_,b,x)}emplace(n,a,p,_,b,x,E){const P=6*n;return this.int16[P+0]=a,this.int16[P+1]=p,this.int16[P+2]=_,this.int16[P+3]=b,this.int16[P+4]=x,this.int16[P+5]=E,n}}tl.prototype.bytesPerElement=12,Nt("StructArrayLayout2i2i2i12",tl);class vo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b){const x=this.length;return this.resize(x+1),this.emplace(x,n,a,p,_,b)}emplace(n,a,p,_,b,x){const E=4*n,P=8*n;return this.float32[E+0]=a,this.float32[E+1]=p,this.float32[E+2]=_,this.int16[P+6]=b,this.int16[P+7]=x,n}}vo.prototype.bytesPerElement=16,Nt("StructArrayLayout2f1f2i16",vo);class Sr extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,p,_,b,x)}emplace(n,a,p,_,b,x,E){const P=16*n,O=4*n,B=8*n;return this.uint8[P+0]=a,this.uint8[P+1]=p,this.float32[O+1]=_,this.float32[O+2]=b,this.int16[B+6]=x,this.int16[B+7]=E,n}}Sr.prototype.bytesPerElement=16,Nt("StructArrayLayout2ub2f2i16",Sr);class Tn extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,p)}emplace(n,a,p,_){const b=3*n;return this.uint16[b+0]=a,this.uint16[b+1]=p,this.uint16[b+2]=_,n}}Tn.prototype.bytesPerElement=6,Nt("StructArrayLayout3ui6",Tn);class Ya extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se){const ge=this.length;return this.resize(ge+1),this.emplace(ge,n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se)}emplace(n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se,ge){const ie=24*n,ue=12*n,Te=48*n;return this.int16[ie+0]=a,this.int16[ie+1]=p,this.uint16[ie+2]=_,this.uint16[ie+3]=b,this.uint32[ue+2]=x,this.uint32[ue+3]=E,this.uint32[ue+4]=P,this.uint16[ie+10]=O,this.uint16[ie+11]=B,this.uint16[ie+12]=F,this.float32[ue+7]=V,this.float32[ue+8]=j,this.uint8[Te+36]=X,this.uint8[Te+37]=Z,this.uint8[Te+38]=Q,this.uint32[ue+10]=se,this.int16[ie+22]=ge,n}}Ya.prototype.bytesPerElement=48,Nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ya);class $l extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se,ge,ie,ue,Te,Re,Ye,ft,dt,bt,Bt,At){const pt=this.length;return this.resize(pt+1),this.emplace(pt,n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se,ge,ie,ue,Te,Re,Ye,ft,dt,bt,Bt,At)}emplace(n,a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se,ge,ie,ue,Te,Re,Ye,ft,dt,bt,Bt,At,pt){const ct=32*n,Vt=16*n;return this.int16[ct+0]=a,this.int16[ct+1]=p,this.int16[ct+2]=_,this.int16[ct+3]=b,this.int16[ct+4]=x,this.int16[ct+5]=E,this.int16[ct+6]=P,this.int16[ct+7]=O,this.uint16[ct+8]=B,this.uint16[ct+9]=F,this.uint16[ct+10]=V,this.uint16[ct+11]=j,this.uint16[ct+12]=X,this.uint16[ct+13]=Z,this.uint16[ct+14]=Q,this.uint16[ct+15]=se,this.uint16[ct+16]=ge,this.uint16[ct+17]=ie,this.uint16[ct+18]=ue,this.uint16[ct+19]=Te,this.uint16[ct+20]=Re,this.uint16[ct+21]=Ye,this.uint16[ct+22]=ft,this.uint32[Vt+12]=dt,this.float32[Vt+13]=bt,this.float32[Vt+14]=Bt,this.uint16[ct+30]=At,this.uint16[ct+31]=pt,n}}$l.prototype.bytesPerElement=64,Nt("StructArrayLayout8i15ui1ul2f2ui64",$l);class Hl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}Hl.prototype.bytesPerElement=4,Nt("StructArrayLayout1f4",Hl);class Hc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,p)}emplace(n,a,p,_){const b=3*n;return this.uint16[6*n+0]=a,this.float32[b+1]=p,this.float32[b+2]=_,n}}Hc.prototype.bytesPerElement=12,Nt("StructArrayLayout1ui2f12",Hc);class ma extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,p)}emplace(n,a,p,_){const b=4*n;return this.uint32[2*n+0]=a,this.uint16[b+2]=p,this.uint16[b+3]=_,n}}ma.prototype.bytesPerElement=8,Nt("StructArrayLayout1ul2ui8",ma);class w extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const _=2*n;return this.uint16[_+0]=a,this.uint16[_+1]=p,n}}w.prototype.bytesPerElement=4,Nt("StructArrayLayout2ui4",w);class r extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}r.prototype.bytesPerElement=2,Nt("StructArrayLayout1ui2",r);class h extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,p,_)}emplace(n,a,p,_,b){const x=4*n;return this.float32[x+0]=a,this.float32[x+1]=p,this.float32[x+2]=_,this.float32[x+3]=b,n}}h.prototype.bytesPerElement=16,Nt("StructArrayLayout4f16",h);class m extends Vi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new A(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class v extends Yu{get(n){return new m(this,n)}}Nt("CollisionBoxArray",v);class S extends Vi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}S.prototype.size=48;class C extends Ya{get(n){return new S(this,n)}}Nt("PlacedSymbolArray",C);class R extends Vi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}R.prototype.size=64;class k extends $l{get(n){return new R(this,n)}}Nt("SymbolInstanceArray",k);class N extends Hl{getoffsetX(n){return this.float32[1*n+0]}}Nt("GlyphOffsetArray",N);class U extends Vl{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Nt("SymbolLineVertexArray",U);class H extends Vi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}H.prototype.size=12;class $ extends Hc{get(n){return new H(this,n)}}Nt("TextAnchorOffsetArray",$);class Y extends Vi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Y.prototype.size=8;class te extends ma{get(n){return new Y(this,n)}}Nt("FeatureIndexArray",te);class ce extends pa{}class de extends pa{}class fe extends pa{}class ye extends yo{}class Ee extends Kf{}class me extends hn{}class Ae extends ga{}class Pe extends jc{}class we extends $c{}class ke extends Gu{}class et extends Zu{}class Ze extends tl{}class Ke extends Sr{}class Qe extends Tn{}class Rt extends w{}const Ot=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:_t}=Ot;class zt{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,a,p,_){const b=this.segments[this.segments.length-1];return n>zt.MAX_VERTEX_ARRAY_LENGTH&&gn(`Max vertices per segment is ${zt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${zt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!b||b.vertexLength+n>zt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==_?this.createNewSegment(a,p,_):b}createNewSegment(n,a,p){const _={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(_.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(n,a,p){return this.prepareSegment(0,n,a,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,p,_){return new zt([{vertexOffset:n,primitiveOffset:a,vertexLength:p,primitiveLength:_,vaos:{},sortKey:0}])}}function ci(c,n){return 256*(c=$t(Math.floor(c),0,255))+$t(Math.floor(n),0,255)}zt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nt("SegmentVector",zt);const ji=wn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),on=wn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var tn,fn,Zi,Pn={exports:{}},dn={exports:{}},fr={exports:{}},Nn=(function(){if(Zi)return Pn.exports;Zi=1;var c=(tn||(tn=1,dn.exports=function(a,p){var _,b,x,E,P,O,B,F;for(b=a.length-(_=3&a.length),x=p,P=3432918353,O=461845907,F=0;F<b;)B=255&a.charCodeAt(F)|(255&a.charCodeAt(++F))<<8|(255&a.charCodeAt(++F))<<16|(255&a.charCodeAt(++F))<<24,++F,x=27492+(65535&(E=5*(65535&(x=(x^=B=(65535&(B=(B=(65535&B)*P+(((B>>>16)*P&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(B=0,_){case 3:B^=(255&a.charCodeAt(F+2))<<16;case 2:B^=(255&a.charCodeAt(F+1))<<8;case 1:x^=B=(65535&(B=(B=(65535&(B^=255&a.charCodeAt(F)))*P+(((B>>>16)*P&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),dn.exports),n=(fn||(fn=1,fr.exports=function(a,p){for(var _,b=a.length,x=p^b,E=0;b>=4;)_=1540483477*(65535&(_=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24))+((1540483477*(_>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),b-=4,++E;switch(b){case 3:x^=(255&a.charCodeAt(E+2))<<16;case 2:x^=(255&a.charCodeAt(E+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(E)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),fr.exports);return Pn.exports=c,Pn.exports.murmur3=c,Pn.exports.murmur2=n,Pn.exports})(),Un=M(Nn);class dr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,a,p,_){this.ids.push(Ka(n)),this.positions.push(a,p,_)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=Ka(n);let p=0,_=this.ids.length-1;for(;p<_;){const x=p+_>>1;this.ids[x]>=a?_=x:p=x+1}const b=[];for(;this.ids[p]===a;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(n,a){const p=new Float64Array(n.ids),_=new Uint32Array(n.positions);return Qa(p,_,0,p.length-1),a&&a.push(p.buffer,_.buffer),{ids:p,positions:_}}static deserialize(n){const a=new dr;return a.ids=n.ids,a.positions=n.positions,a.indexed=!0,a}}function Ka(c){const n=+c;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Un(String(c))}function Qa(c,n,a,p){for(;a<p;){const _=c[a+p>>1];let b=a-1,x=p+1;for(;;){do b++;while(c[b]<_);do x--;while(c[x]>_);if(b>=x)break;_a(c,b,x),_a(n,3*b,3*x),_a(n,3*b+1,3*x+1),_a(n,3*b+2,3*x+2)}x-a<p-x?(Qa(c,n,a,x),a=x+1):(Qa(c,n,x+1,p),p=x)}}function _a(c,n,a){const p=c[n];c[n]=c[a],c[a]=p}Nt("FeaturePositionMap",dr);class rs{constructor(n,a){this.gl=n.gl,this.location=a}}class Wl extends rs{constructor(n,a){super(n,a),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Wc extends rs{constructor(n,a){super(n,a),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class ya extends rs{constructor(n,a){super(n,a),this.current=mi.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const ss=new Float32Array(16);function Cs(c){return[ci(255*c.r,255*c.g),ci(255*c.b,255*c.a)]}class Gs{constructor(n,a,p){this.value=n,this.uniformNames=a.map((_=>`u_${_}`)),this.type=p}setUniform(n,a,p){n.set(p.constantOr(this.value))}getBinding(n,a,p){return this.type==="color"?new ya(n,a):new Wl(n,a)}}class Zs{constructor(n,a){this.uniformNames=a.map((p=>`u_${p}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=n.tlbr}setConstantDashPositions(n,a){this.dashTo=[0,n.y,n.height,n.width],this.dashFrom=[0,a.y,a.height,a.width]}setUniform(n,a,p,_){let b=null;_==="u_pattern_to"?b=this.patternTo:_==="u_pattern_from"?b=this.patternFrom:_==="u_dasharray_to"?b=this.dashTo:_==="u_dasharray_from"?b=this.dashFrom:_==="u_pixel_ratio_to"?b=this.pixelRatioTo:_==="u_pixel_ratio_from"&&(b=this.pixelRatioFrom),b!==null&&n.set(b)}getBinding(n,a,p){return p.substr(0,9)==="u_pattern"||p.substr(0,12)==="u_dasharray_"?new Wc(n,a):new Wl(n,a)}}class qi{constructor(n,a,p,_){this.expression=n,this.type=p,this.maxValue=0,this.paintVertexAttributes=a.map((b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0}))),this.paintVertexArray=new _}populatePaintArray(n,a,p){const _=this.paintVertexArray.length,b=this.expression.evaluate(new Wi(0,p),a,{},p.canonical,[],p.formattedSection);this.paintVertexArray.resize(n),this._setPaintValue(_,n,b)}updatePaintArray(n,a,p,_,b){const x=this.expression.evaluate(new Wi(0,b),p,_);this._setPaintValue(n,a,x)}_setPaintValue(n,a,p){if(this.type==="color"){const _=Cs(p);for(let b=n;b<a;b++)this.paintVertexArray.emplace(b,_[0],_[1])}else{for(let _=n;_<a;_++)this.paintVertexArray.emplace(_,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class nn{constructor(n,a,p,_,b,x){this.expression=n,this.uniformNames=a.map((E=>`u_${E}_t`)),this.type=p,this.useIntegerZoom=_,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=a.map((E=>({name:`a_${E}`,type:"Float32",components:p==="color"?4:2,offset:0}))),this.paintVertexArray=new x}populatePaintArray(n,a,p){const _=this.expression.evaluate(new Wi(this.zoom,p),a,{},p.canonical,[],p.formattedSection),b=this.expression.evaluate(new Wi(this.zoom+1,p),a,{},p.canonical,[],p.formattedSection),x=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(x,n,_,b)}updatePaintArray(n,a,p,_,b){const x=this.expression.evaluate(new Wi(this.zoom,b),p,_),E=this.expression.evaluate(new Wi(this.zoom+1,b),p,_);this._setPaintValue(n,a,x,E)}_setPaintValue(n,a,p,_){if(this.type==="color"){const b=Cs(p),x=Cs(_);for(let E=n;E<a;E++)this.paintVertexArray.emplace(E,b[0],b[1],x[0],x[1])}else{for(let b=n;b<a;b++)this.paintVertexArray.emplace(b,p,_);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=$t(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(_)}getBinding(n,a,p){return new Wl(n,a)}}class Kn{constructor(n,a,p,_,b,x){this.expression=n,this.type=a,this.useIntegerZoom=p,this.zoom=_,this.layerId=x,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(n,a,p){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(_,n,this.getPositionIds(a),p)}updatePaintArray(n,a,p,_,b){this._setPaintValues(n,a,this.getPositionIds(p),b)}_setPaintValues(n,a,p,_){const b=this.getPositions(_);if(!b||!p)return;const x=b[p.min],E=b[p.mid],P=b[p.max];if(x&&E&&P)for(let O=n;O<a;O++)this.emplace(this.zoomInPaintVertexArray,O,E,x),this.emplace(this.zoomOutPaintVertexArray,O,E,P)}upload(n){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const a=this.getVertexAttributes();this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,a,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,a,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tr extends Kn{getPositions(n){return n.imagePositions}getPositionIds(n){return n.patterns&&n.patterns[this.layerId]}getVertexAttributes(){return ji.members}emplace(n,a,p,_){n.emplace(a,p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],_.tlbr[0],_.tlbr[1],_.tlbr[2],_.tlbr[3],p.pixelRatio,_.pixelRatio)}}class Gh extends Kn{getPositions(n){return n.dashPositions}getPositionIds(n){return n.dashes&&n.dashes[this.layerId]}getVertexAttributes(){return on.members}emplace(n,a,p,_){n.emplace(a,0,p.y,p.height,p.width,0,_.y,_.height,_.width)}}class Zh{constructor(n,a,p){this.binders={},this._buffers=[];const _=[];for(const b in n.paint._values){if(!p(b))continue;const x=n.paint.get(b);if(!(x instanceof Es&&js(x.property.specification)))continue;const E=Sp(b,n.type),P=x.value,O=x.property.specification.type,B=x.property.useIntegerZoom,F=x.property.specification["property-type"],V=F==="cross-faded"||F==="cross-faded-data-driven";if(P.kind==="constant")this.binders[b]=V?new Zs(P.value,E):new Gs(P.value,E,O),_.push(`/u_${b}`);else if(P.kind==="source"||V){const j=nl(b,O,"source");this.binders[b]=V?b==="line-dasharray"?new Gh(P,O,B,a,j,n.id):new tr(P,O,B,a,j,n.id):new qi(P,E,O,j),_.push(`/a_${b}`)}else{const j=nl(b,O,"composite");this.binders[b]=new nn(P,E,O,B,a,j),_.push(`/z_${b}`)}}this.cacheKey=_.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof qi||a instanceof nn?a.maxValue:0}populatePaintArrays(n,a,p){for(const _ in this.binders){const b=this.binders[_];(b instanceof qi||b instanceof nn||b instanceof Kn)&&b.populatePaintArray(n,a,p)}}setConstantPatternPositions(n,a){for(const p in this.binders){const _=this.binders[p];_ instanceof Zs&&_.setConstantPatternPositions(n,a)}}setConstantDashPositions(n,a){for(const p in this.binders){const _=this.binders[p];_ instanceof Zs&&_.setConstantDashPositions(n,a)}}updatePaintArrays(n,a,p,_,b){let x=!1;for(const E in n){const P=a.getPositions(E);for(const O of P){const B=p.feature(O.index);for(const F in this.binders){const V=this.binders[F];if((V instanceof qi||V instanceof nn||V instanceof Kn)&&V.expression.isStateDependent===!0){const j=_.paint.get(F);V.expression=j.value,V.updatePaintArray(O.start,O.end,B,n[E],b),x=!0}}}}return x}defines(){const n=[];for(const a in this.binders){const p=this.binders[a];(p instanceof Gs||p instanceof Zs)&&n.push(...p.uniformNames.map((_=>`#define HAS_UNIFORM_${_}`)))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof qi||p instanceof nn)for(let _=0;_<p.paintVertexAttributes.length;_++)n.push(p.paintVertexAttributes[_].name);else if(p instanceof Kn){const _=p.getVertexAttributes();for(const b of _)n.push(b.name)}}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof Gs||p instanceof Zs||p instanceof nn)for(const _ of p.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,a){const p=[];for(const _ in this.binders){const b=this.binders[_];if(b instanceof Gs||b instanceof Zs||b instanceof nn){for(const x of b.uniformNames)if(a[x]){const E=b.getBinding(n,a[x],x);p.push({name:x,property:_,binding:E})}}}return p}setUniforms(n,a,p,_){for(const{name:b,property:x,binding:E}of a)this.binders[x].setUniform(E,_,p.get(x),b)}updatePaintBuffers(n){this._buffers=[];for(const a in this.binders){const p=this.binders[a];if(n&&p instanceof Kn){const _=n.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(p instanceof qi||p instanceof nn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(n){for(const a in this.binders){const p=this.binders[a];(p instanceof qi||p instanceof nn||p instanceof Kn)&&p.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof qi||a instanceof nn||a instanceof Kn)&&a.destroy()}}}class il{constructor(n,a,p=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new Zh(_,a,p);this.needsUpload=!1,this._featureMap=new dr,this._bufferOffset=0}populatePaintArrays(n,a,p,_){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(n,a,_);a.id!==void 0&&this._featureMap.add(a.id,p,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,p,_){for(const b of p)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(n,this._featureMap,a,b,_)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Sp(c,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}function nl(c,n,a){const p={color:{source:hn,composite:h},number:{source:Hl,composite:hn}},_=(function(b){return{"line-pattern":{source:Ae,composite:Ae},"fill-pattern":{source:Ae,composite:Ae},"fill-extrusion-pattern":{source:Ae,composite:Ae},"line-dasharray":{source:Pe,composite:Pe}}[b]})(c);return _&&_[a]||p[n][a]}Nt("ConstantBinder",Gs),Nt("CrossFadedConstantBinder",Zs),Nt("SourceExpressionBinder",qi),Nt("CrossFadedPatternBinder",tr),Nt("CrossFadedDasharrayBinder",Gh),Nt("CompositeExpressionBinder",nn),Nt("ProgramConfiguration",Zh,{omit:["_buffers"]}),Nt("ProgramConfigurationSet",il);const Yh=Math.pow(2,14)-1,bo=-Yh-1;function xo(c){const n=Be/c.extent,a=c.loadGeometry();for(let p=0;p<a.length;p++){const _=a[p];for(let b=0;b<_.length;b++){const x=_[b],E=Math.round(x.x*n),P=Math.round(x.y*n);x.x=$t(E,bo,Yh),x.y=$t(P,bo,Yh),(E<x.x||E>x.x+1||P<x.y||P>x.y+1)&&gn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function va(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?xo(c):[]}}const Kh=-32768;function Ku(c,n,a,p,_){c.emplaceBack(Kh+8*n+p,Kh+8*a+_)}class Qu{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=n.index,this.hasDependencies=!1,this.layoutVertexArray=new de,this.indexArray=new Qe,this.segments=new zt,this.programConfigurations=new il(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(n,a,p){const _=this.layers[0],b=[];let x=null,E=!1,P=_.type==="heatmap";if(_.type==="circle"){const B=_;x=B.layout.get("circle-sort-key"),E=!x.isConstant(),P=P||B.paint.get("circle-pitch-alignment")==="map"}const O=P?a.subdivisionGranularity.circle:1;for(const{feature:B,id:F,index:V,sourceLayerIndex:j}of n){const X=this.layers[0]._featureFilter.needGeometry,Z=va(B,X);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),Z,p))continue;const Q=E?x.evaluate(Z,{},p):void 0,se={id:F,properties:B.properties,type:B.type,sourceLayerIndex:j,index:V,geometry:X?Z.geometry:xo(B),patterns:{},sortKey:Q};b.push(se)}E&&b.sort(((B,F)=>B.sortKey-F.sortKey));for(const B of b){const{geometry:F,index:V,sourceLayerIndex:j}=B,X=n[V].feature;this.addFeature(B,F,V,p,O),a.featureIndex.insert(X,F,V,j,this.index)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,_t),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,p,_,b=1){let x;switch(b){case 1:x=[0,7];break;case 3:x=[0,2,5,7];break;case 5:x=[0,1,3,4,6,7];break;case 7:x=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${b}; valid values are 1, 3, 5, 7.`)}const E=x.length;for(const P of a)for(const O of P){const B=O.x,F=O.y;if(B<0||B>=Be||F<0||F>=Be)continue;const V=this.segments.prepareSegment(E*E,this.layoutVertexArray,this.indexArray,n.sortKey),j=V.vertexLength;for(let X=0;X<E;X++)for(let Z=0;Z<E;Z++)Ku(this.layoutVertexArray,B,F,x[Z],x[X]);for(let X=0;X<E-1;X++)for(let Z=0;Z<E-1;Z++){const Q=j+X*E+Z,se=j+(X+1)*E+Z;this.indexArray.emplaceBack(Q,se+1,Q+1),this.indexArray.emplaceBack(Q,se,se+1)}V.vertexLength+=E*E,V.primitiveLength+=(E-1)*(E-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{imagePositions:{},canonical:_})}}function Ju(c,n){for(let a=0;a<c.length;a++)if(rl(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(rl(c,n[a]))return!0;return!!Ar(c,n)}function Ap(c,n,a){return!!rl(c,n)||!!Cp(n,c,a)}function Ep(c,n){if(c.length===1)return um(n,c[0]);for(let a=0;a<n.length;a++){const p=n[a];for(let _=0;_<p.length;_++)if(rl(c,p[_]))return!0}for(let a=0;a<c.length;a++)if(um(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(Ar(c,n[a]))return!0;return!1}function pr(c,n,a){if(c.length>1){if(Ar(c,n))return!0;for(let p=0;p<n.length;p++)if(Cp(n[p],c,a))return!0}for(let p=0;p<c.length;p++)if(Cp(c[p],n,a))return!0;return!1}function Ar(c,n){if(c.length===0||n.length===0)return!1;for(let a=0;a<c.length-1;a++){const p=c[a],_=c[a+1];for(let b=0;b<n.length-1;b++)if(H_(p,_,n[b],n[b+1]))return!0}return!1}function H_(c,n,a,p){return gi(c,a,p)!==gi(n,a,p)&&gi(c,n,a)!==gi(c,n,p)}function Cp(c,n,a){const p=a*a;if(n.length===1)return c.distSqr(n[0])<p;for(let _=1;_<n.length;_++)if(cm(c,n[_-1],n[_])<p)return!0;return!1}function cm(c,n,a){const p=n.distSqr(a);if(p===0)return c.distSqr(n);const _=((c.x-n.x)*(a.x-n.x)+(c.y-n.y)*(a.y-n.y))/p;return c.distSqr(_<0?n:_>1?a:a.sub(n)._mult(_)._add(n))}function um(c,n){let a,p,_,b=!1;for(let x=0;x<c.length;x++){a=c[x];for(let E=0,P=a.length-1;E<a.length;P=E++)p=a[E],_=a[P],p.y>n.y!=_.y>n.y&&n.x<(_.x-p.x)*(n.y-p.y)/(_.y-p.y)+p.x&&(b=!b)}return b}function rl(c,n){let a=!1;for(let p=0,_=c.length-1;p<c.length;_=p++){const b=c[p],x=c[_];b.y>n.y!=x.y>n.y&&n.x<(x.x-b.x)*(n.y-b.y)/(x.y-b.y)+b.x&&(a=!a)}return a}function W_(c,n,a){const p=a[0],_=a[2];if(c.x<p.x&&n.x<p.x||c.x>_.x&&n.x>_.x||c.y<p.y&&n.y<p.y||c.y>_.y&&n.y>_.y)return!1;const b=gi(c,n,a[0]);return b!==gi(c,n,a[1])||b!==gi(c,n,a[2])||b!==gi(c,n,a[3])}function ql(c,n,a){const p=n.paint.get(c).value;return p.kind==="constant"?p.value:a.programConfigurations.get(n.id).getMaxValue(c)}function Qf(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Mp(c,n,a,p,_){if(!n[0]&&!n[1])return c;const b=A.convert(n)._mult(_);a==="viewport"&&b._rotate(-p);const x=[];for(let E=0;E<c.length;E++)x.push(c[E].sub(b));return x}function Pp(c){const n=[];for(let a=0;a<c.length;a++){const p=c[a],_=n.at(-1);(a===0||_&&!p.equals(_))&&n.push(p)}return n}function hm({queryGeometry:c,size:n},a){return Ap(c,a,n)}function q_({queryGeometry:c,size:n,transform:a,unwrappedTileID:p,getElevation:_},b){return Ap(c,b,n*(a.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera/a.cameraToCenterDistance))}function X_({queryGeometry:c,size:n,transform:a,unwrappedTileID:p,getElevation:_},b){const x=a.projectTileCoordinates(b.x,b.y,p,_).signedDistanceFromCamera,E=n*(a.cameraToCenterDistance/x);return Ap(c,Jf(b,a,p,_),E)}function G_({queryGeometry:c,size:n,transform:a,unwrappedTileID:p,getElevation:_},b){return Ap(c,Jf(b,a,p,_),n)}function Ip({queryGeometry:c,size:n,transform:a,unwrappedTileID:p,getElevation:_,pitchAlignment:b="map",pitchScale:x="map"},E){const P=b==="map"?x==="map"?hm:q_:x==="map"?X_:G_,O={queryGeometry:c,size:n,transform:a,unwrappedTileID:p,getElevation:_};for(const B of E)for(const F of B)if(P(O,F))return!0;return!1}function Jf(c,n,a,p){const _=n.projectTileCoordinates(c.x,c.y,a,p).point;return new A((.5*_.x+.5)*n.width,(.5*-_.y+.5)*n.height)}let Rp,fm;Nt("CircleBucket",Qu,{omit:["layers"]});var dm={get paint(){return fm=fm||new qn({"circle-radius":new Xt(Ce.paint_circle["circle-radius"]),"circle-color":new Xt(Ce.paint_circle["circle-color"]),"circle-blur":new Xt(Ce.paint_circle["circle-blur"]),"circle-opacity":new Xt(Ce.paint_circle["circle-opacity"]),"circle-translate":new Ut(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return Rp=Rp||new qn({"circle-sort-key":new Xt(Ce.layout_circle["circle-sort-key"])})}};class Dp extends Mn{constructor(n,a){super(n,dm,a)}createBucket(n){return new Qu(n)}queryRadius(n){const a=n;return ql("circle-radius",this,a)+ql("circle-stroke-width",this,a)+Qf(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:_,transform:b,pixelsToTileUnits:x,unwrappedTileID:E,getElevation:P}){const O=Mp(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-b.bearingInRadians,x),B=this.paint.get("circle-radius").evaluate(a,p)+this.paint.get("circle-stroke-width").evaluate(a,p),F=this.paint.get("circle-pitch-scale"),V=this.paint.get("circle-pitch-alignment");let j,X;return V==="map"?(j=O,X=B*x):(j=(function(Z,Q,se,ge){return Z.map((ie=>Jf(ie,Q,se,ge)))})(O,b,E,P),X=B),Ip({queryGeometry:j,size:X,transform:b,unwrappedTileID:E,getElevation:P,pitchAlignment:V,pitchScale:F},_)}}class Op extends Qu{}let pm;Nt("HeatmapBucket",Op,{omit:["layers"]});var gm={get paint(){return pm=pm||new qn({"heatmap-radius":new Xt(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qu(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(Ce.paint_heatmap["heatmap-opacity"])})}};function kp(c,{width:n,height:a},p,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*a*p)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${n*a*p}`)}else _=new Uint8Array(n*a*p);return c.width=n,c.height=a,c.data=_,c}function sl(c,{width:n,height:a},p){if(n===c.width&&a===c.height)return;const _=kp({},{width:n,height:a},p);ed(c,_,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,n),height:Math.min(c.height,a)},p),c.width=n,c.height=a,c.data=_.data}function ed(c,n,a,p,_,b){if(_.width===0||_.height===0)return n;if(_.width>c.width||_.height>c.height||a.x>c.width-_.width||a.y>c.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||p.x>n.width-_.width||p.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const x=c.data,E=n.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<_.height;P++){const O=((a.y+P)*c.width+a.x)*b,B=((p.y+P)*n.width+p.x)*b;for(let F=0;F<_.width*b;F++)E[B+F]=x[O+F]}return n}class td{constructor(n,a){kp(this,n,1,a)}resize(n){sl(this,n,1)}clone(){return new td({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,p,_,b){ed(n,a,p,_,b,1)}}class as{constructor(n,a){kp(this,n,4,a)}resize(n){sl(this,n,4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,p,_,b){ed(n,a,p,_,b,4)}setPixel(n,a,p){const _=4*(n*this.width+a);this.data[_+0]=Math.round(255*p.r/p.a),this.data[_+1]=Math.round(255*p.g/p.a),this.data[_+2]=Math.round(255*p.b/p.a),this.data[_+3]=Math.round(255*p.a)}}function al(c){const n={},a=c.resolution||256,p=c.clips?c.clips.length:1,_=c.image||new as({width:a,height:p});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const b=(x,E,P)=>{n[c.evaluationKey]=P;const O=c.expression.evaluate(n);_.setPixel(x/4/a,E/4,O)};if(c.clips)for(let x=0,E=0;x<p;++x,E+=4*a)for(let P=0,O=0;P<a;P++,O+=4){const B=P/(a-1),{start:F,end:V}=c.clips[x];b(E,O,F*(1-B)+V*B)}else for(let x=0,E=0;x<a;x++,E+=4)b(0,E,x/(a-1));return _}Nt("AlphaImage",td),Nt("RGBAImage",as);const id="big-fb";class Z_ extends Mn{createBucket(n){return new Op(n)}constructor(n,a){super(n,gm,a),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=al({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(id)&&this.heatmapFbos.delete(id)}queryRadius(n){return ql("heatmap-radius",this,n)}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:_,transform:b,pixelsToTileUnits:x,unwrappedTileID:E,getElevation:P}){return Ip({queryGeometry:n,size:this.paint.get("heatmap-radius").evaluate(a,p)*x,transform:b,unwrappedTileID:E,getElevation:P},_)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let nd;var rd={get paint(){return nd=nd||new qn({"hillshade-illumination-direction":new Ut(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ut(Ce.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ut(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ut(Ce.paint_hillshade["hillshade-method"])})}};class Vn extends Mn{constructor(n,a){super(n,rd,a),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,a=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const b=Math.max(n.length,a.length,p.length,_.length);n=n.concat(Array(b-n.length).fill(n.at(-1))),a=a.concat(Array(b-a.length).fill(a.at(-1))),p=p.concat(Array(b-p.length).fill(p.at(-1))),_=_.concat(Array(b-_.length).fill(_.at(-1)));const x=a.map(rr);return{directionRadians:n.map(rr),altitudeRadians:x,shadowColor:_,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Y_;var h0={get paint(){return Y_=Y_||new qn({"color-relief-opacity":new Ut(Ce["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new qu(Ce["paint_color-relief"]["color-relief-color"])})}};class Lp{constructor(n,a,p,_){this.context=n,this.format=p,this.texture=n.gl.createTexture(),this.update(a,_)}update(n,a,p){const{width:_,height:b}=n,x=!(this.size&&this.size[0]===_&&this.size[1]===b||p),{context:E}=this,{gl:P}=E;if(this.useMipmap=!!(a&&a.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!a||a.premultiply!==!1)),x)this.size=[_,b],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Ea(n)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,n):P.texImage2D(P.TEXTURE_2D,0,this.format,_,b,0,this.format,P.UNSIGNED_BYTE,n.data);else{const{x:O,y:B}=p||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||Ea(n)?P.texSubImage2D(P.TEXTURE_2D,0,O,B,P.RGBA,P.UNSIGNED_BYTE,n):P.texSubImage2D(P.TEXTURE_2D,0,O,B,_,b,P.RGBA,P.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D),E.pixelStoreUnpackFlipY.setDefault(),E.pixelStoreUnpack.setDefault(),E.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,a,p){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),n!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,n),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||n),this.filter=n),a!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Qh{constructor(n,a,p,_=1,b=1,x=1,E=0){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void gn(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const P=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=b,this.blueFactor=x,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<P;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(P,O)]=this.data[this._idx(P-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,P)]=this.data[this._idx(O,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<P;O++)for(let B=0;B<P;B++){const F=this.get(O,B);F>this.max&&(this.max=F),F<this.min&&(this.min=F)}}get(n,a){const p=new Uint8Array(this.data.buffer),_=4*this._idx(n,a);return this.unpack(p[_],p[_+1],p[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${n}, y: ${a}, dim: ${this.dim}`);return(a+1)*this.stride+(n+1)}unpack(n,a,p){return n*this.redFactor+a*this.greenFactor+p*this.blueFactor-this.baseShift}pack(n){return Xl(n,this.getUnpackVector())}getPixels(){return new as({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,a,p){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=a*this.dim,b=a*this.dim+this.dim,x=p*this.dim,E=p*this.dim+this.dim;switch(a){case-1:_=b-1;break;case 1:b=_+1}switch(p){case-1:x=E-1;break;case 1:E=x+1}const P=-a*this.dim,O=-p*this.dim;for(let B=x;B<E;B++)for(let F=_;F<b;F++)this.data[this._idx(F,B)]=n.data[this._idx(F+P,B+O)]}}function Xl(c,n){const a=n[0],p=n[1],_=n[2],b=n[3],x=Math.min(a,p,_),E=Math.round((c+b)/x);return{r:Math.floor(E*x/a)%256,g:Math.floor(E*x/p)%256,b:Math.floor(E*x/_)%256}}Nt("DEMData",Qh);class K_ extends Mn{constructor(n,a){super(n,h0,a)}_createColorRamp(n){const a={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof Wr&&p._styleExpression.expression instanceof $r){this.colorRampExpression=p;const x=p._styleExpression.expression;a.elevationStops=x.labels,a.colorStops=[];for(const E of a.elevationStops)a.colorStops.push(x.evaluate({globals:{elevation:E}}))}if(a.elevationStops.length<1&&(a.elevationStops=[0],a.colorStops=[mi.transparent]),a.elevationStops.length<2&&(a.elevationStops.push(a.elevationStops[0]+1),a.colorStops.push(a.colorStops[0])),a.elevationStops.length<=n)return a;const _={elevationStops:[],colorStops:[]},b=(a.elevationStops.length-1)/(n-1);for(let x=0;x<a.elevationStops.length-.5;x+=b)_.elevationStops.push(a.elevationStops[Math.round(x)]),_.colorStops.push(a.colorStops[Math.round(x)]);return gn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${n}, provided: ${a.elevationStops.length}`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,a,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(a),b=new as({width:_.colorStops.length,height:1}),x=new as({width:_.colorStops.length,height:1});for(let E=0;E<_.elevationStops.length;E++){const P=Xl(_.elevationStops[E],p);x.setPixel(0,E,new mi(P.r/255,P.g/255,P.b/255,1)),b.setPixel(0,E,_.colorStops[E])}return this.colorRampTextures={elevationTexture:new Lp(n,x,n.gl.RGBA),colorTexture:new Lp(n,b,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const Q_=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:sd}=Q_;function ba(c,n,a){const p=a.patternDependencies;let _=!1;for(const b of n){const x=b.paint.get(`${c}-pattern`);x.isConstant()||(_=!0);const E=x.constantOr(null);E&&(_=!0,p[E.to]=!0,p[E.from]=!0)}return _}function Bp(c,n,a,p,_){const{zoom:b}=p,x=_.patternDependencies;for(const E of n){const P=E.paint.get(`${c}-pattern`).value;if(P.kind!=="constant"){let O=P.evaluate({zoom:b-1},a,{},_.availableImages),B=P.evaluate({zoom:b},a,{},_.availableImages),F=P.evaluate({zoom:b+1},a,{},_.availableImages);O=O&&O.name?O.name:O,B=B&&B.name?B.name:B,F=F&&F.name?F.name:F,x[O]=!0,x[B]=!0,x[F]=!0,a.patterns[E.id]={min:O,mid:B,max:F}}}return a}function zp(c,n,a,p,_){let b;if(_===(function(x,E,P,O){let B=0;for(let F=E,V=P-O;F<P;F+=O)B+=(x[V]-x[F])*(x[F+1]+x[V+1]),V=F;return B})(c,n,a,p)>0)for(let x=n;x<a;x+=p)b=Ms(x/p|0,c[x],c[x+1],b);else for(let x=a-p;x>=n;x-=p)b=Ms(x/p|0,c[x],c[x+1],b);return b&&Ys(b,b.next)&&(Ps(b),b=b.next),b}function qc(c,n){if(!c)return c;n||(n=c);let a,p=c;do if(a=!1,p.steiner||!Ys(p,p.next)&&Fi(p.prev,p,p.next)!==0)p=p.next;else{if(Ps(p),p=n=p.prev,p===p.next)break;a=!0}while(a||p!==n);return n}function eh(c,n,a,p,_,b,x){if(!c)return;!x&&b&&(function(P,O,B,F){let V=P;do V.z===0&&(V.z=mr(V.x,V.y,O,B,F)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==P);V.prevZ.nextZ=null,V.prevZ=null,(function(j){let X,Z=1;do{let Q,se=j;j=null;let ge=null;for(X=0;se;){X++;let ie=se,ue=0;for(let Re=0;Re<Z&&(ue++,ie=ie.nextZ,ie);Re++);let Te=Z;for(;ue>0||Te>0&&ie;)ue!==0&&(Te===0||!ie||se.z<=ie.z)?(Q=se,se=se.nextZ,ue--):(Q=ie,ie=ie.nextZ,Te--),ge?ge.nextZ=Q:j=Q,Q.prevZ=ge,ge=Q;se=ie}ge.nextZ=null,Z*=2}while(X>1)})(V)})(c,p,_,b);let E=c;for(;c.prev!==c.next;){const P=c.prev,O=c.next;if(b?Fp(c,p,_,b):mm(c))n.push(P.i,c.i,O.i),Ps(c),c=O.next,E=O.next;else if((c=O)===E){x?x===1?eh(c=J_(qc(c),n),n,a,p,_,b,2):x===2&&Gl(c,n,a,p,_,b):eh(qc(c),n,a,p,_,b,1);break}}}function mm(c){const n=c.prev,a=c,p=c.next;if(Fi(n,a,p)>=0)return!1;const _=n.x,b=a.x,x=p.x,E=n.y,P=a.y,O=p.y,B=Math.min(_,b,x),F=Math.min(E,P,O),V=Math.max(_,b,x),j=Math.max(E,P,O);let X=p.next;for(;X!==n;){if(X.x>=B&&X.x<=V&&X.y>=F&&X.y<=j&&Jh(_,E,b,P,x,O,X.x,X.y)&&Fi(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Fp(c,n,a,p){const _=c.prev,b=c,x=c.next;if(Fi(_,b,x)>=0)return!1;const E=_.x,P=b.x,O=x.x,B=_.y,F=b.y,V=x.y,j=Math.min(E,P,O),X=Math.min(B,F,V),Z=Math.max(E,P,O),Q=Math.max(B,F,V),se=mr(j,X,n,a,p),ge=mr(Z,Q,n,a,p);let ie=c.prevZ,ue=c.nextZ;for(;ie&&ie.z>=se&&ue&&ue.z<=ge;){if(ie.x>=j&&ie.x<=Z&&ie.y>=X&&ie.y<=Q&&ie!==_&&ie!==x&&Jh(E,B,P,F,O,V,ie.x,ie.y)&&Fi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ue.x>=j&&ue.x<=Z&&ue.y>=X&&ue.y<=Q&&ue!==_&&ue!==x&&Jh(E,B,P,F,O,V,ue.x,ue.y)&&Fi(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ie&&ie.z>=se;){if(ie.x>=j&&ie.x<=Z&&ie.y>=X&&ie.y<=Q&&ie!==_&&ie!==x&&Jh(E,B,P,F,O,V,ie.x,ie.y)&&Fi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ue&&ue.z<=ge;){if(ue.x>=j&&ue.x<=Z&&ue.y>=X&&ue.y<=Q&&ue!==_&&ue!==x&&Jh(E,B,P,F,O,V,ue.x,ue.y)&&Fi(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function J_(c,n){let a=c;do{const p=a.prev,_=a.next.next;!Ys(p,_)&&vm(p,a,a.next,_)&&ld(p,_)&&ld(_,p)&&(n.push(p.i,a.i,_.i),Ps(a),Ps(a.next),a=c=_),a=a.next}while(a!==c);return qc(a)}function Gl(c,n,a,p,_,b){let x=c;do{let E=x.next.next;for(;E!==x.prev;){if(x.i!==E.i&&Xn(x,E)){let P=cd(x,E);return x=qc(x,x.next),P=qc(P,P.next),eh(x,n,a,p,_,b,0),void eh(P,n,a,p,_,b,0)}E=E.next}x=x.next}while(x!==c)}function gr(c,n){let a=c.x-n.x;return a===0&&(a=c.y-n.y,a===0)&&(a=(c.next.y-c.y)/(c.next.x-c.x)-(n.next.y-n.y)/(n.next.x-n.x)),a}function _m(c,n){const a=(function(_,b){let x=b;const E=_.x,P=_.y;let O,B=-1/0;if(Ys(_,x))return x;do{if(Ys(_,x.next))return x.next;if(P<=x.y&&P>=x.next.y&&x.next.y!==x.y){const Z=x.x+(P-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(Z<=E&&Z>B&&(B=Z,O=x.x<x.next.x?x:x.next,Z===E))return O}x=x.next}while(x!==b);if(!O)return null;const F=O,V=O.x,j=O.y;let X=1/0;x=O;do{if(E>=x.x&&x.x>=V&&E!==x.x&&ym(P<j?E:B,P,V,j,P<j?B:E,P,x.x,x.y)){const Z=Math.abs(P-x.y)/(E-x.x);ld(x,_)&&(Z<X||Z===X&&(x.x>O.x||x.x===O.x&&ey(O,x)))&&(O=x,X=Z)}x=x.next}while(x!==F);return O})(c,n);if(!a)return n;const p=cd(a,c);return qc(p,p.next),qc(a,a.next)}function ey(c,n){return Fi(c.prev,c,n.prev)<0&&Fi(n.next,c,c.next)<0}function mr(c,n,a,p,_){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-p)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function f0(c){let n=c,a=c;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==c);return a}function ym(c,n,a,p,_,b,x,E){return(_-x)*(n-E)>=(c-x)*(b-E)&&(c-x)*(p-E)>=(a-x)*(n-E)&&(a-x)*(b-E)>=(_-x)*(p-E)}function Jh(c,n,a,p,_,b,x,E){return!(c===x&&n===E)&&ym(c,n,a,p,_,b,x,E)}function Xn(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!(function(a,p){let _=a;do{if(_.i!==a.i&&_.next.i!==a.i&&_.i!==p.i&&_.next.i!==p.i&&vm(_,_.next,a,p))return!0;_=_.next}while(_!==a);return!1})(c,n)&&(ld(c,n)&&ld(n,c)&&(function(a,p){let _=a,b=!1;const x=(a.x+p.x)/2,E=(a.y+p.y)/2;do _.y>E!=_.next.y>E&&_.next.y!==_.y&&x<(_.next.x-_.x)*(E-_.y)/(_.next.y-_.y)+_.x&&(b=!b),_=_.next;while(_!==a);return b})(c,n)&&(Fi(c.prev,c,n.prev)||Fi(c,n.prev,n))||Ys(c,n)&&Fi(c.prev,c,c.next)>0&&Fi(n.prev,n,n.next)>0)}function Fi(c,n,a){return(n.y-c.y)*(a.x-n.x)-(n.x-c.x)*(a.y-n.y)}function Ys(c,n){return c.x===n.x&&c.y===n.y}function vm(c,n,a,p){const _=od(Fi(c,n,a)),b=od(Fi(c,n,p)),x=od(Fi(a,p,c)),E=od(Fi(a,p,n));return _!==b&&x!==E||!(_!==0||!ad(c,a,n))||!(b!==0||!ad(c,p,n))||!(x!==0||!ad(a,c,p))||!(E!==0||!ad(a,n,p))}function ad(c,n,a){return n.x<=Math.max(c.x,a.x)&&n.x>=Math.min(c.x,a.x)&&n.y<=Math.max(c.y,a.y)&&n.y>=Math.min(c.y,a.y)}function od(c){return c>0?1:c<0?-1:0}function ld(c,n){return Fi(c.prev,c,c.next)<0?Fi(c,n,c.next)>=0&&Fi(c,c.prev,n)>=0:Fi(c,n,c.prev)<0||Fi(c,c.next,n)<0}function cd(c,n){const a=Np(c.i,c.x,c.y),p=Np(n.i,n.x,n.y),_=c.next,b=n.prev;return c.next=n,n.prev=c,a.next=_,_.prev=a,p.next=a,a.prev=p,b.next=p,p.prev=b,p}function Ms(c,n,a,p){const _=Np(c,n,a);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Ps(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Np(c,n,a){return{i:c,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Er{constructor(n,a){if(a>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=a}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class ud{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}ud.noSubdivision=new ud({fill:new Er(0,0),line:new Er(0,0),tile:new Er(0,0),stencil:new Er(0,0),circle:1}),Nt("SubdivisionGranularityExpression",Er),Nt("SubdivisionGranularitySetting",ud);const Ks=-32768,wo=32767;class Zl{constructor(n,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Be/n,this._canonical=a}_getKey(n,a){return(n+=32768)<<16|a+32768}_vertexToIndex(n,a){if(n<-32768||a<-32768||n>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(n),_=0|Math.round(a),b=this._getKey(p,_);if(this._vertexDictionary.has(b))return this._vertexDictionary.get(b);const x=this._vertexBuffer.length/2;return this._vertexDictionary.set(b,x),this._vertexBuffer.push(p,_),x}_subdivideTrianglesScanline(n){if(this._granularity<2)return(function(_,b){const x=[];for(let E=0;E<b.length;E+=3){const P=b[E],O=b[E+1],B=b[E+2],F=_[2*P],V=_[2*P+1];(_[2*O]-F)*(_[2*B+1]-V)-(_[2*O+1]-V)*(_[2*B]-F)>0?(x.push(P),x.push(B),x.push(O)):(x.push(P),x.push(O),x.push(B))}return x})(this._vertexBuffer,n);const a=[],p=n.length;for(let _=0;_<p;_+=3){const b=[n[_+0],n[_+1],n[_+2]],x=[this._vertexBuffer[2*n[_+0]+0],this._vertexBuffer[2*n[_+0]+1],this._vertexBuffer[2*n[_+1]+0],this._vertexBuffer[2*n[_+1]+1],this._vertexBuffer[2*n[_+2]+0],this._vertexBuffer[2*n[_+2]+1]];let E=1/0,P=1/0,O=-1/0,B=-1/0;for(let Z=0;Z<3;Z++){const Q=x[2*Z],se=x[2*Z+1];E=Math.min(E,Q),O=Math.max(O,Q),P=Math.min(P,se),B=Math.max(B,se)}if(E===O||P===B)continue;const F=Math.floor(E/this._granularityCellSize),V=Math.ceil(O/this._granularityCellSize),j=Math.floor(P/this._granularityCellSize),X=Math.ceil(B/this._granularityCellSize);if(F!==V||j!==X)for(let Z=j;Z<X;Z++){const Q=this._scanlineGenerateVertexRingForCellRow(Z,x,b);To(this._vertexBuffer,Q,a)}else a.push(...b)}return a}_scanlineGenerateVertexRingForCellRow(n,a,p){const _=n*this._granularityCellSize,b=_+this._granularityCellSize,x=[];for(let E=0;E<3;E++){const P=a[2*E],O=a[2*E+1],B=a[2*(E+1)%6],F=a[(2*(E+1)+1)%6],V=a[2*(E+2)%6],j=a[(2*(E+2)+1)%6],X=B-P,Z=F-O,Q=X===0,se=Z===0,ge=(_-O)/Z,ie=(b-O)/Z,ue=Math.min(ge,ie),Te=Math.max(ge,ie);if(!se&&(ue>=1||Te<=0)||se&&(O<_||O>b)){F>=_&&F<=b&&x.push(p[(E+1)%3]);continue}!se&&ue>0&&x.push(this._vertexToIndex(P+X*ue,O+Z*ue));const Re=P+X*Math.max(ue,0),Ye=P+X*Math.min(Te,1);Q||this._generateIntraEdgeVertices(x,P,O,B,F,Re,Ye),!se&&Te<1&&x.push(this._vertexToIndex(P+X*Te,O+Z*Te)),(se||F>=_&&F<=b)&&x.push(p[(E+1)%3]),!se&&(F<=_||F>=b)&&this._generateInterEdgeVertices(x,P,O,B,F,V,j,Ye,_,b)}return x}_generateIntraEdgeVertices(n,a,p,_,b,x,E){const P=_-a,O=b-p,B=O===0,F=B?Math.min(a,_):Math.min(x,E),V=B?Math.max(a,_):Math.max(x,E),j=Math.floor(F/this._granularityCellSize)+1,X=Math.ceil(V/this._granularityCellSize)-1;if(B?a<_:x<E)for(let Z=j;Z<=X;Z++){const Q=Z*this._granularityCellSize;n.push(this._vertexToIndex(Q,p+O*(Q-a)/P))}else for(let Z=X;Z>=j;Z--){const Q=Z*this._granularityCellSize;n.push(this._vertexToIndex(Q,p+O*(Q-a)/P))}}_generateInterEdgeVertices(n,a,p,_,b,x,E,P,O,B){const F=b-p,V=x-_,j=E-b,X=(O-b)/j,Z=(B-b)/j,Q=Math.min(X,Z),se=Math.max(X,Z),ge=_+V*Q;let ie=Math.floor(Math.min(ge,P)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(ge,P)/this._granularityCellSize)-1,Te=P<ge;const Re=j===0;if(Re&&(E===O||E===B))return;if(Re||Q>=1||se<=0){const ft=p-E,dt=x+(a-x)*Math.min((O-E)/ft,(B-E)/ft);ie=Math.floor(Math.min(dt,P)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(dt,P)/this._granularityCellSize)-1,Te=P<dt}const Ye=F>0?B:O;if(Te)for(let ft=ie;ft<=ue;ft++)n.push(this._vertexToIndex(ft*this._granularityCellSize,Ye));else for(let ft=ue;ft>=ie;ft--)n.push(this._vertexToIndex(ft*this._granularityCellSize,Ye))}_generateOutline(n){const a=[];for(const p of n){const _=Yl(p,this._granularity,!0),b=this._pointArrayToIndices(_),x=[];for(let E=1;E<b.length;E++)x.push(b[E-1]),x.push(b[E]);a.push(x)}return a}_handlePoles(n){let a=!1,p=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(a||p)&&this._fillPoles(n,a,p)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let a=0;a<n.length;a+=2){const p=n[a+1];p===Ks&&(n[a+1]=-32767),p===wo&&(n[a+1]=32766)}}_generatePoleQuad(n,a,p,_,b,x){_>b!=(x===Ks)?(n.push(a),n.push(p),n.push(this._vertexToIndex(_,x)),n.push(p),n.push(this._vertexToIndex(b,x)),n.push(this._vertexToIndex(_,x))):(n.push(p),n.push(a),n.push(this._vertexToIndex(_,x)),n.push(this._vertexToIndex(b,x)),n.push(p),n.push(this._vertexToIndex(_,x)))}_fillPoles(n,a,p){const _=this._vertexBuffer,b=Be,x=n.length;for(let E=2;E<x;E+=3){const P=n[E-2],O=n[E-1],B=n[E],F=_[2*P],V=_[2*P+1],j=_[2*O],X=_[2*O+1],Z=_[2*B],Q=_[2*B+1];a&&(V===0&&X===0&&this._generatePoleQuad(n,P,O,F,j,Ks),X===0&&Q===0&&this._generatePoleQuad(n,O,B,j,Z,Ks),Q===0&&V===0&&this._generatePoleQuad(n,B,P,Z,F,Ks)),p&&(V===b&&X===b&&this._generatePoleQuad(n,P,O,F,j,wo),X===b&&Q===b&&this._generatePoleQuad(n,O,B,j,Z,wo),Q===b&&V===b&&this._generatePoleQuad(n,B,P,Z,F,wo))}}_initializeVertices(n){for(let a=0;a<n.length;a+=2)this._vertexToIndex(n[a],n[a+1])}subdividePolygonInternal(n,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:_}=(function(E){const P=[],O=[];for(const B of E)if(B.length!==0){B!==E[0]&&P.push(O.length/2);for(let F=0;F<B.length;F++)O.push(B[F].x),O.push(B[F].y)}return{flattened:O,holeIndices:P}})(n);let b;this._initializeVertices(p);try{const E=(function(O,B,F=2){const V=B&&B.length,j=V?B[0]*F:O.length;let X=zp(O,0,j,F,!0);const Z=[];if(!X||X.next===X.prev)return Z;let Q,se,ge;if(V&&(X=(function(ie,ue,Te,Re){const Ye=[];for(let ft=0,dt=ue.length;ft<dt;ft++){const bt=zp(ie,ue[ft]*Re,ft<dt-1?ue[ft+1]*Re:ie.length,Re,!1);bt===bt.next&&(bt.steiner=!0),Ye.push(f0(bt))}Ye.sort(gr);for(let ft=0;ft<Ye.length;ft++)Te=_m(Ye[ft],Te);return Te})(O,B,X,F)),O.length>80*F){Q=O[0],se=O[1];let ie=Q,ue=se;for(let Te=F;Te<j;Te+=F){const Re=O[Te],Ye=O[Te+1];Re<Q&&(Q=Re),Ye<se&&(se=Ye),Re>ie&&(ie=Re),Ye>ue&&(ue=Ye)}ge=Math.max(ie-Q,ue-se),ge=ge!==0?32767/ge:0}return eh(X,Z,F,Q,se,ge,0),Z})(p,_),P=this._convertIndices(p,E);b=this._subdivideTrianglesScanline(P)}catch(E){console.error(E)}let x=[];return a&&(x=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(b),{verticesFlattened:this._vertexBuffer,indicesTriangles:b,indicesLineList:x}}_convertIndices(n,a){const p=[];for(let _=0;_<a.length;_++)p.push(this._vertexToIndex(n[2*a[_]],n[2*a[_]+1]));return p}_pointArrayToIndices(n){const a=[];for(let p=0;p<n.length;p++){const _=n[p];a.push(this._vertexToIndex(_.x,_.y))}return a}}function Up(c,n,a,p=!0){return new Zl(a,n).subdividePolygonInternal(c,p)}function Yl(c,n,a=!1){if(!c||c.length<1)return[];if(c.length<2)return[];const p=c[0],_=c[c.length-1],b=a&&(p.x!==_.x||p.y!==_.y);if(n<2)return b?[...c,c[0]]:[...c];const x=Math.floor(Be/n),E=[];E.push(new A(c[0].x,c[0].y));const P=c.length,O=b?P:P-1;for(let B=0;B<O;B++){const F=c[B],V=B<P-1?c[B+1]:c[0],j=F.x,X=F.y,Z=V.x,Q=V.y,se=j!==Z,ge=X!==Q;if(!se&&!ge)continue;const ie=Z-j,ue=Q-X,Te=Math.abs(ie),Re=Math.abs(ue);let Ye=j,ft=X;for(;;){const bt=ie>0?(Math.floor(Ye/x)+1)*x:(Math.ceil(Ye/x)-1)*x,Bt=ue>0?(Math.floor(ft/x)+1)*x:(Math.ceil(ft/x)-1)*x,At=Math.abs(Ye-bt),pt=Math.abs(ft-Bt),ct=Math.abs(Ye-Z),Vt=Math.abs(ft-Q),qt=se?At/Te:Number.POSITIVE_INFINITY,Kt=ge?pt/Re:Number.POSITIVE_INFINITY;if((ct<=At||!se)&&(Vt<=pt||!ge))break;if(qt<Kt&&se||!ge){Ye=bt,ft+=ue*qt;const Gt=new A(Ye,Math.round(ft));E[E.length-1].x===Gt.x&&E[E.length-1].y===Gt.y||E.push(Gt)}else{Ye+=ie*Kt,ft=Bt;const Gt=new A(Math.round(Ye),ft);E[E.length-1].x===Gt.x&&E[E.length-1].y===Gt.y||E.push(Gt)}}const dt=new A(Z,Q);E[E.length-1].x===dt.x&&E[E.length-1].y===dt.y||E.push(dt)}return E}function To(c,n,a){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,_=c[2*n[0]];for(let P=1;P<n.length;P++){const O=c[2*n[P]];O<_&&(_=O,p=P)}const b=n.length;let x=p,E=(x+1)%b;for(;;){const P=x-1>=0?x-1:b-1,O=(E+1)%b,B=c[2*n[P]],F=c[2*n[O]],V=c[2*n[x]],j=c[2*n[x]+1],X=c[2*n[E]+1];let Z=!1;if(B<F)Z=!0;else if(B>F)Z=!1;else{const Q=X-j,se=-(c[2*n[E]]-V),ge=j<X?1:-1;((B-V)*Q+(c[2*n[P]+1]-j)*se)*ge>((F-V)*Q+(c[2*n[O]+1]-j)*se)*ge&&(Z=!0)}if(Z){const Q=n[P],se=n[x],ge=n[E];Q!==se&&Q!==ge&&se!==ge&&a.push(ge,se,Q),x--,x<0&&(x=b-1)}else{const Q=n[O],se=n[x],ge=n[E];Q!==se&&Q!==ge&&se!==ge&&a.push(ge,se,Q),E++,E>=b&&(E=0)}if(P===O)break}}function bm(c,n,a,p,_,b,x,E,P){const O=_.length/2,B=x&&E&&P;if(O<zt.MAX_VERTEX_ARRAY_LENGTH){const F=n.prepareSegment(O,a,p),V=F.vertexLength;for(let Z=0;Z<b.length;Z+=3)p.emplaceBack(V+b[Z],V+b[Z+1],V+b[Z+2]);let j,X;F.vertexLength+=O,F.primitiveLength+=b.length/3,B&&(X=x.prepareSegment(O,a,E),j=X.vertexLength,X.vertexLength+=O);for(let Z=0;Z<_.length;Z+=2)c(_[Z],_[Z+1]);if(B)for(let Z=0;Z<P.length;Z++){const Q=P[Z];for(let se=1;se<Q.length;se+=2)E.emplaceBack(j+Q[se-1],j+Q[se]);X.primitiveLength+=Q.length/2}}else(function(F,V,j,X,Z,Q){const se=[];for(let Re=0;Re<X.length/2;Re++)se.push(-1);const ge={count:0};let ie=0,ue=F.getOrCreateLatestSegment(V,j),Te=ue.vertexLength;for(let Re=2;Re<Z.length;Re+=3){const Ye=Z[Re-2],ft=Z[Re-1],dt=Z[Re];let bt=se[Ye]<ie,Bt=se[ft]<ie,At=se[dt]<ie;ue.vertexLength+((bt?1:0)+(Bt?1:0)+(At?1:0))>zt.MAX_VERTEX_ARRAY_LENGTH&&(ue=F.createNewSegment(V,j),ie=ge.count,bt=!0,Bt=!0,At=!0,Te=0);const pt=ol(se,X,Q,ge,Ye,bt,ue),ct=ol(se,X,Q,ge,ft,Bt,ue),Vt=ol(se,X,Q,ge,dt,At,ue);j.emplaceBack(Te+pt-ie,Te+ct-ie,Te+Vt-ie),ue.primitiveLength++}})(n,a,p,_,b,c),B&&(function(F,V,j,X,Z,Q){const se=[];for(let Re=0;Re<X.length/2;Re++)se.push(-1);const ge={count:0};let ie=0,ue=F.getOrCreateLatestSegment(V,j),Te=ue.vertexLength;for(let Re=0;Re<Z.length;Re++){const Ye=Z[Re];for(let ft=1;ft<Z[Re].length;ft+=2){const dt=Ye[ft-1],bt=Ye[ft];let Bt=se[dt]<ie,At=se[bt]<ie;ue.vertexLength+((Bt?1:0)+(At?1:0))>zt.MAX_VERTEX_ARRAY_LENGTH&&(ue=F.createNewSegment(V,j),ie=ge.count,Bt=!0,At=!0,Te=0);const pt=ol(se,X,Q,ge,dt,Bt,ue),ct=ol(se,X,Q,ge,bt,At,ue);j.emplaceBack(Te+pt-ie,Te+ct-ie),ue.primitiveLength++}}})(x,a,E,_,P,c),n.forceNewSegmentOnNextPrepare(),x?.forceNewSegmentOnNextPrepare()}function ol(c,n,a,p,_,b,x){if(b){const E=p.count;return a(n[2*_],n[2*_+1]),c[_]=p.count,p.count++,x.vertexLength++,E}return c[_]}class th{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=n.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new fe,this.indexArray=new Qe,this.indexArray2=new Rt,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new zt,this.segments2=new zt,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(n,a,p){this.hasDependencies=ba("fill",this.layers,a);const _=this.layers[0].layout.get("fill-sort-key"),b=!_.isConstant(),x=[];for(const{feature:E,id:P,index:O,sourceLayerIndex:B}of n){const F=this.layers[0]._featureFilter.needGeometry,V=va(E,F);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),V,p))continue;const j=b?_.evaluate(V,{},p,a.availableImages):void 0,X={id:P,properties:E.properties,type:E.type,sourceLayerIndex:B,index:O,geometry:F?V.geometry:xo(E),patterns:{},sortKey:j};x.push(X)}b&&x.sort(((E,P)=>E.sortKey-P.sortKey));for(const E of x){const{geometry:P,index:O,sourceLayerIndex:B}=E;if(this.hasDependencies){const F=Bp("fill",this.layers,E,{zoom:this.zoom},a);this.patternFeatures.push(F)}else this.addFeature(E,P,O,p,{},a.subdivisionGranularity);a.featureIndex.insert(n[O].feature,P,O,B,this.index)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,{imagePositions:p})}addFeatures(n,a,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,p,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sd),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,p,_,b,x){for(const E of Cu(a,500)){const P=Up(E,_,x.fill.getGranularityForZoomLevel(_.z)),O=this.layoutVertexArray;bm(((B,F)=>{O.emplaceBack(B,F)}),this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles,this.segments2,this.indexArray2,P.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{imagePositions:b,canonical:_})}}let ef,ih;Nt("FillBucket",th,{omit:["layers","patternFeatures"]});var ty={get paint(){return ih=ih||new qn({"fill-antialias":new Ut(Ce.paint_fill["fill-antialias"]),"fill-opacity":new Xt(Ce.paint_fill["fill-opacity"]),"fill-color":new Xt(Ce.paint_fill["fill-color"]),"fill-outline-color":new Xt(Ce.paint_fill["fill-outline-color"]),"fill-translate":new Ut(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new qs(Ce.paint_fill["fill-pattern"])})},get layout(){return ef=ef||new qn({"fill-sort-key":new Xt(Ce.layout_fill["fill-sort-key"])})}};class iy extends Mn{constructor(n,a){super(n,ty,a)}recalculate(n,a){super.recalculate(n,a);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new th(n)}queryRadius(){return Qf(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:a,transform:p,pixelsToTileUnits:_}){return Ep(Mp(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,_),a)}isTileClipped(){return!0}}const hd=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ny=wn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Vp}=hd;class tf{constructor(n,a,p,_,b){this.properties={},this.extent=p,this.type=0,this.id=void 0,this._pbf=n,this._geometry=-1,this._keys=_,this._values=b,n.readFields(d0,this,a)}loadGeometry(){const n=this._pbf;n.pos=this._geometry;const a=n.readVarint()+n.pos,p=[];let _,b=1,x=0,E=0,P=0;for(;n.pos<a;){if(x<=0){const O=n.readVarint();b=7&O,x=O>>3}if(x--,b===1||b===2)E+=n.readSVarint(),P+=n.readSVarint(),b===1&&(_&&p.push(_),_=[]),_&&_.push(new A(E,P));else{if(b!==7)throw new Error(`unknown command ${b}`);_&&_.push(_[0].clone())}}return _&&p.push(_),p}bbox(){const n=this._pbf;n.pos=this._geometry;const a=n.readVarint()+n.pos;let p=1,_=0,b=0,x=0,E=1/0,P=-1/0,O=1/0,B=-1/0;for(;n.pos<a;){if(_<=0){const F=n.readVarint();p=7&F,_=F>>3}if(_--,p===1||p===2)b+=n.readSVarint(),x+=n.readSVarint(),b<E&&(E=b),b>P&&(P=b),x<O&&(O=x),x>B&&(B=x);else if(p!==7)throw new Error(`unknown command ${p}`)}return[E,O,P,B]}toGeoJSON(n,a,p){const _=this.extent*Math.pow(2,p),b=this.extent*n,x=this.extent*a,E=this.loadGeometry();function P(V){return[360*(V.x+b)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+x)/_)*Math.PI))-90]}function O(V){return V.map(P)}let B;if(this.type===1){const V=[];for(const X of E)V.push(X[0]);const j=O(V);B=V.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const V=E.map(O);B=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=ry(E),j=[];for(const X of V)j.push(X.map(O));B=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const F={type:"Feature",geometry:B,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function d0(c,n,a){c===1?n.id=a.readVarint():c===2?(function(p,_){const b=p.readVarint()+p.pos;for(;p.pos<b;){const x=_._keys[p.readVarint()],E=_._values[p.readVarint()];_.properties[x]=E}})(a,n):c===3?n.type=a.readVarint():c===4&&(n._geometry=a.pos)}function ry(c){const n=c.length;if(n<=1)return[c];const a=[];let p,_;for(let b=0;b<n;b++){const x=rn(c[b]);x!==0&&(_===void 0&&(_=x<0),_===x<0?(p&&a.push(p),p=[c[b]]):p&&p.push(c[b]))}return p&&a.push(p),a}function rn(c){let n=0;for(let a,p,_=0,b=c.length,x=b-1;_<b;x=_++)a=c[_],p=c[x],n+=(p.x-a.x)*(a.y+p.y);return n}tf.types=["Unknown","Point","LineString","Polygon"];class Sn{constructor(n,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Di,this,a),this.length=this._features.length}feature(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];const a=this._pbf.readVarint()+this._pbf.pos;return new tf(this._pbf,a,this.extent,this._keys,this._values)}}function Di(c,n,a){c===15?n.version=a.readVarint():c===1?n.name=a.readString():c===5?n.extent=a.readVarint():c===2?n._features.push(a.pos):c===3?n._keys.push(a.readString()):c===4&&n._values.push((function(p){let _=null;const b=p.readVarint()+p.pos;for(;p.pos<b;){const x=p.readVarint()>>3;_=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _})(a))}class Oi{constructor(n,a){this.layers=n.readFields(cn,{},a)}}function cn(c,n,a){if(c===3){const p=new Sn(a,a.readVarint()+a.pos);p.length&&(n[p.name]=p)}}const Is=Math.pow(2,13);function Ja(c,n,a,p,_,b,x,E){c.emplaceBack(n,a,2*Math.floor(p*Is)+x,_*Is*2,b*Is*2,Math.round(E))}class Xc{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=n.index,this.hasDependencies=!1,this.layoutVertexArray=new ye,this.centroidVertexArray=new ce,this.indexArray=new Qe,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new zt,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(n,a,p){this.features=[],this.hasDependencies=ba("fill-extrusion",this.layers,a);for(const{feature:_,id:b,index:x,sourceLayerIndex:E}of n){const P=this.layers[0]._featureFilter.needGeometry,O=va(_,P);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),O,p))continue;const B={id:b,sourceLayerIndex:E,index:x,geometry:P?O.geometry:xo(_),properties:_.properties,type:_.type,patterns:{}};this.hasDependencies?this.features.push(Bp("fill-extrusion",this.layers,B,{zoom:this.zoom},a)):this.addFeature(B,B.geometry,x,p,{},a.subdivisionGranularity),a.featureIndex.insert(_,B.geometry,x,E,this.index,!0)}}addFeatures(n,a,p){for(const _ of this.features){const{geometry:b}=_;this.addFeature(_,b,_.index,a,p,n.subdivisionGranularity)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,{imagePositions:p})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Vp),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,ny.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,a,p,_,b,x){for(const E of Cu(a,500)){const P={x:0,y:0,sampleCount:0},O=this.layoutVertexArray.length;this.processPolygon(P,_,n,E,x);const B=this.layoutVertexArray.length-O,F=Math.floor(P.x/P.sampleCount),V=Math.floor(P.y/P.sampleCount);for(let j=0;j<B;j++)this.centroidVertexArray.emplaceBack(F,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{imagePositions:b,canonical:_})}processPolygon(n,a,p,_,b){if(_.length<1||Qn(_[0]))return;for(const F of _)F.length!==0&&xm(n,F);const x={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},E=b.fill.getGranularityForZoomLevel(a.z),P=tf.types[p.type]==="Polygon";for(const F of _){if(F.length===0||Qn(F))continue;const V=Yl(F,E,P);this._generateSideFaces(V,x)}if(!P)return;const O=Up(_,a,E,!1),B=this.layoutVertexArray;bm(((F,V)=>{Ja(B,F,V,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,O.verticesFlattened,O.indicesTriangles)}_generateSideFaces(n,a){let p=0;for(let _=1;_<n.length;_++){const b=n[_],x=n[_-1];if(Kl(b,x))continue;a.segment.vertexLength+4>zt.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const E=b.sub(x)._perp()._unit(),P=x.dist(b);p+P>32768&&(p=0),Ja(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,0,p),Ja(this.layoutVertexArray,b.x,b.y,E.x,E.y,0,1,p),p+=P,Ja(this.layoutVertexArray,x.x,x.y,E.x,E.y,0,0,p),Ja(this.layoutVertexArray,x.x,x.y,E.x,E.y,0,1,p);const O=a.segment.vertexLength;this.indexArray.emplaceBack(O,O+2,O+1),this.indexArray.emplaceBack(O+1,O+2,O+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function xm(c,n){for(let a=0;a<n.length;a++){const p=n[a];a===n.length-1&&n[0].x===p.x&&n[0].y===p.y||(c.x+=p.x,c.y+=p.y,c.sampleCount++)}}function Kl(c,n){return c.x===n.x&&(c.x<0||c.x>Be)||c.y===n.y&&(c.y<0||c.y>Be)}function Qn(c){return c.every((n=>n.x<0))||c.every((n=>n.x>Be))||c.every((n=>n.y<0))||c.every((n=>n.y>Be))}let Ql;Nt("FillExtrusionBucket",Xc,{omit:["layers","features"]});var nh={get paint(){return Ql=Ql||new qn({"fill-extrusion-opacity":new Ut(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qs(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Xt(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ut(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class wm extends Mn{constructor(n,a){super(n,nh,a)}createBucket(n){return new Xc(n)}queryRadius(){return Qf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:_,transform:b,pixelsToTileUnits:x,pixelPosMatrix:E}){const P=Mp(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-b.bearingInRadians,x),O=this.paint.get("fill-extrusion-height").evaluate(a,p),B=this.paint.get("fill-extrusion-base").evaluate(a,p),F=(function(j,X){const Z=[];for(const Q of j){const se=[Q.x,Q.y,0,1];Pt(se,se,X),Z.push(new A(se[0]/se[3],se[1]/se[3]))}return Z})(P,E),V=(function(j,X,Z,Q){const se=[],ge=[],ie=Q[8]*X,ue=Q[9]*X,Te=Q[10]*X,Re=Q[11]*X,Ye=Q[8]*Z,ft=Q[9]*Z,dt=Q[10]*Z,bt=Q[11]*Z;for(const Bt of j){const At=[],pt=[];for(const ct of Bt){const Vt=ct.x,qt=ct.y,Kt=Q[0]*Vt+Q[4]*qt+Q[12],Gt=Q[1]*Vt+Q[5]*qt+Q[13],wi=Q[2]*Vt+Q[6]*qt+Q[14],jn=Q[3]*Vt+Q[7]*qt+Q[15],vr=wi+Te,us=jn+Re,fl=Kt+Ye,ta=Gt+ft,Xr=wi+dt,hs=jn+bt,ir=new A((Kt+ie)/us,(Gt+ue)/us);ir.z=vr/us,At.push(ir);const Gr=new A(fl/hs,ta/hs);Gr.z=Xr/hs,pt.push(Gr)}se.push(At),ge.push(pt)}return[se,ge]})(_,B,O,E);return(function(j,X,Z){let Q=1/0;Ep(Z,X)&&(Q=rh(Z,X[0]));for(let se=0;se<X.length;se++){const ge=X[se],ie=j[se];for(let ue=0;ue<ge.length-1;ue++){const Te=ge[ue],Re=[Te,ge[ue+1],ie[ue+1],ie[ue],Te];Ju(Z,Re)&&(Q=Math.min(Q,rh(Z,Re)))}}return Q!==1/0&&Q})(V[0],V[1],F)}}function qr(c,n){return c.x*n.x+c.y*n.y}function rh(c,n){if(c.length===1){let a=0;const p=n[a++];let _;for(;!_||p.equals(_);)if(_=n[a++],!_)return 1/0;for(;a<n.length;a++){const b=n[a],x=c[0],E=_.sub(p),P=b.sub(p),O=x.sub(p),B=qr(E,E),F=qr(E,P),V=qr(P,P),j=qr(O,E),X=qr(O,P),Z=B*V-F*F,Q=(V*j-F*X)/Z,se=(B*X-F*j)/Z,ge=p.z*(1-Q-se)+_.z*Q+b.z*se;if(isFinite(ge))return ge}return 1/0}{let a=1/0;for(const p of n)a=Math.min(a,p.z);return a}}const fd=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qs}=fd,Tm=wn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jp}=Tm,sy=Math.cos(Math.PI/180*37.5),dd=Math.pow(2,14)/.5;class nf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((a=>a.id)),this.index=n.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new Ee,this.layoutVertexArray2=new me,this.indexArray=new Qe,this.programConfigurations=new il(n.layers,n.zoom),this.segments=new zt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id))}populate(n,a,p){this.hasDependencies=ba("line",this.layers,a)||this.hasLineDasharray(this.layers);const _=this.layers[0].layout.get("line-sort-key"),b=!_.isConstant(),x=[];for(const{feature:E,id:P,index:O,sourceLayerIndex:B}of n){const F=this.layers[0]._featureFilter.needGeometry,V=va(E,F);if(!this.layers[0]._featureFilter.filter(new Wi(this.zoom),V,p))continue;const j=b?_.evaluate(V,{},p):void 0,X={id:P,properties:E.properties,type:E.type,sourceLayerIndex:B,index:O,geometry:F?V.geometry:xo(E),patterns:{},dashes:{},sortKey:j};x.push(X)}b&&x.sort(((E,P)=>E.sortKey-P.sortKey));for(const E of x){const{geometry:P,index:O,sourceLayerIndex:B}=E;this.hasDependencies?(ba("line",this.layers,a)?Bp("line",this.layers,E,{zoom:this.zoom},a):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,E,this.zoom,a),this.patternFeatures.push(E)):this.addFeature(E,P,O,p,{},{},a.subdivisionGranularity),a.featureIndex.insert(n[O].feature,P,O,B,this.index)}}update(n,a,p,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,{imagePositions:p,dashPositions:_})}addFeatures(n,a,p,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,p,_,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,jp)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Qs),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,p,_,b,x,E){const P=this.layers[0].layout,O=P.get("line-join").evaluate(n,{}),B=P.get("line-cap"),F=P.get("line-miter-limit"),V=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const j of a)this.addLine(j,n,O,B,F,V,_,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{imagePositions:b,dashPositions:x,canonical:_})}addLine(n,a,p,_,b,x,E,P){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=Yl(n,E?P.line.getGranularityForZoomLevel(E.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<n.length-1;ie++)this.totalDistance+=n[ie].dist(n[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=tf.types[a.type]==="Polygon";let B=n.length;for(;B>=2&&n[B-1].equals(n[B-2]);)B--;let F=0;for(;F<B-1&&n[F].equals(n[F+1]);)F++;if(B<(O?3:2))return;p==="bevel"&&(b=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let X,Z,Q,se,ge;this.e1=this.e2=-1,O&&(X=n[B-2],ge=n[F].sub(X)._unit()._perp());for(let ie=F;ie<B;ie++){if(Q=ie===B-1?O?n[F+1]:void 0:n[ie+1],Q&&n[ie].equals(Q))continue;ge&&(se=ge),X&&(Z=X),X=n[ie],ge=Q?Q.sub(X)._unit()._perp():se,se=se||ge;let ue=se.add(ge);ue.x===0&&ue.y===0||ue._unit();const Te=se.x*ge.x+se.y*ge.y,Re=ue.x*ge.x+ue.y*ge.y,Ye=Re!==0?1/Re:1/0,ft=2*Math.sqrt(2-2*Re),dt=Re<sy&&Z&&Q,bt=se.x*ge.y-se.y*ge.x>0;if(dt&&ie>F){const pt=X.dist(Z);if(pt>2*V){const ct=X.sub(X.sub(Z)._mult(V/pt)._round());this.updateDistance(Z,ct),this.addCurrentVertex(ct,se,0,0,j),Z=ct}}const Bt=Z&&Q;let At=Bt?p:O?"butt":_;if(Bt&&At==="round"&&(Ye<x?At="miter":Ye<=2&&(At="fakeround")),At==="miter"&&Ye>b&&(At="bevel"),At==="bevel"&&(Ye>2&&(At="flipbevel"),Ye<b&&(At="miter")),Z&&this.updateDistance(Z,X),At==="miter")ue._mult(Ye),this.addCurrentVertex(X,ue,0,0,j);else if(At==="flipbevel"){if(Ye>100)ue=ge.mult(-1);else{const pt=Ye*se.add(ge).mag()/se.sub(ge).mag();ue._perp()._mult(pt*(bt?-1:1))}this.addCurrentVertex(X,ue,0,0,j),this.addCurrentVertex(X,ue.mult(-1),0,0,j)}else if(At==="bevel"||At==="fakeround"){const pt=-Math.sqrt(Ye*Ye-1),ct=bt?pt:0,Vt=bt?0:pt;if(Z&&this.addCurrentVertex(X,se,ct,Vt,j),At==="fakeround"){const qt=Math.round(180*ft/Math.PI/20);for(let Kt=1;Kt<qt;Kt++){let Gt=Kt/qt;if(Gt!==.5){const jn=Gt-.5;Gt+=Gt*jn*(Gt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*jn*jn+(.848013+Te*(.215638*Te-1.06021)))}const wi=ge.sub(se)._mult(Gt)._add(se)._unit()._mult(bt?-1:1);this.addHalfVertex(X,wi.x,wi.y,!1,bt,0,j)}}Q&&this.addCurrentVertex(X,ge,-ct,-Vt,j)}else if(At==="butt")this.addCurrentVertex(X,ue,0,0,j);else if(At==="square"){const pt=Z?1:-1;this.addCurrentVertex(X,ue,pt,pt,j)}else At==="round"&&(Z&&(this.addCurrentVertex(X,se,0,0,j),this.addCurrentVertex(X,se,1,1,j,!0)),Q&&(this.addCurrentVertex(X,ge,-1,-1,j,!0),this.addCurrentVertex(X,ge,0,0,j)));if(dt&&ie<B-1){const pt=X.dist(Q);if(pt>2*V){const ct=X.add(Q.sub(X)._mult(V/pt)._round());this.updateDistance(X,ct),this.addCurrentVertex(ct,ge,0,0,j),X=ct}}}}addCurrentVertex(n,a,p,_,b,x=!1){const E=a.y*_-a.x,P=-a.y-a.x*_;this.addHalfVertex(n,a.x+a.y*p,a.y-a.x*p,x,!1,p,b),this.addHalfVertex(n,E,P,x,!0,-_,b),this.distance>dd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,a,p,_,b,x))}addHalfVertex({x:n,y:a},p,_,b,x,E,P){const O=.5*(this.lineClips?this.scaledDistance*(dd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(b?1:0),(a<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*_)+128,1+(E===0?0:E<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const B=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,B,this.e2),P.primitiveLength++),x?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}hasLineDasharray(n){for(const a of n){const p=a.paint.get("line-dasharray");if(p&&!p.isConstant())return!0}return!1}addLineDashDependencies(n,a,p,_){for(const b of n){const x=b.paint.get("line-dasharray");if(!x||x.value.kind==="constant")continue;const E=b.layout.get("line-cap")==="round",P={dasharray:x.value.evaluate({zoom:p-1},a,{}),round:E},O={dasharray:x.value.evaluate({zoom:p},a,{}),round:E},B={dasharray:x.value.evaluate({zoom:p+1},a,{}),round:E},F=`${P.dasharray.join(",")},${P.round}`,V=`${O.dasharray.join(",")},${O.round}`,j=`${B.dasharray.join(",")},${B.round}`;_.dashDependencies[F]=P,_.dashDependencies[V]=O,_.dashDependencies[j]=B,a.dashes[b.id]={min:F,mid:V,max:j}}}}let Jl,_r;Nt("LineBucket",nf,{omit:["layers","patternFeatures"]});var ec={get paint(){return _r=_r||new qn({"line-opacity":new Xt(Ce.paint_line["line-opacity"]),"line-color":new Xt(Ce.paint_line["line-color"]),"line-translate":new Ut(Ce.paint_line["line-translate"]),"line-translate-anchor":new Ut(Ce.paint_line["line-translate-anchor"]),"line-width":new Xt(Ce.paint_line["line-width"]),"line-gap-width":new Xt(Ce.paint_line["line-gap-width"]),"line-offset":new Xt(Ce.paint_line["line-offset"]),"line-blur":new Xt(Ce.paint_line["line-blur"]),"line-dasharray":new qs(Ce.paint_line["line-dasharray"]),"line-pattern":new qs(Ce.paint_line["line-pattern"]),"line-gradient":new qu(Ce.paint_line["line-gradient"])})},get layout(){return Jl=Jl||new qn({"line-cap":new Ut(Ce.layout_line["line-cap"]),"line-join":new Xt(Ce.layout_line["line-join"]),"line-miter-limit":new Ut(Ce.layout_line["line-miter-limit"]),"line-round-limit":new Ut(Ce.layout_line["line-round-limit"]),"line-sort-key":new Xt(Ce.layout_line["line-sort-key"])})}};class rf extends Xt{possiblyEvaluate(n,a){return a=new Wi(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,p,_){return a=Qt({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,p,_)}}let eo;class Sm extends Mn{constructor(n,a){super(n,ec,a),this.gradientVersion=0,eo||(eo=new rf(ec.paint.properties["line-width"].specification),eo.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!(function(p){return p._styleExpression!==void 0})(a)&&a._styleExpression.expression instanceof jo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,a){super.recalculate(n,a),this.paint._values["line-floorwidth"]=eo.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new nf(n)}queryRadius(n){const a=n,p=$p(ql("line-width",this,a),ql("line-gap-width",this,a)),_=ql("line-offset",this,a);return p/2+Math.abs(_)+Qf(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:_,transform:b,pixelsToTileUnits:x}){const E=Mp(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-b.bearingInRadians,x),P=x/2*$p(this.paint.get("line-width").evaluate(a,p),this.paint.get("line-gap-width").evaluate(a,p)),O=this.paint.get("line-offset").evaluate(a,p);return O&&(_=(function(B,F){const V=[];for(let j=0;j<B.length;j++){const X=Pp(B[j]),Z=[];for(let Q=0;Q<X.length;Q++){const se=X[Q],ge=X[Q-1],ie=X[Q+1],ue=Q===0?new A(0,0):se.sub(ge)._unit()._perp(),Te=Q===X.length-1?new A(0,0):ie.sub(se)._unit()._perp(),Re=ue._add(Te)._unit(),Ye=Re.x*Te.x+Re.y*Te.y;Ye!==0&&Re._mult(1/Ye),Z.push(Re._mult(F)._add(se))}V.push(Z)}return V})(_,O*x)),(function(B,F,V){for(let j=0;j<F.length;j++){const X=F[j];if(B.length>=3){for(let Z=0;Z<X.length;Z++)if(rl(B,X[Z]))return!0}if(pr(B,X,V))return!0}return!1})(E,_,P)}isTileClipped(){return!0}}function $p(c,n){return n>0?n+2*c:c}const ay=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pd=wn([{name:"a_projected_pos",components:3,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Am=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);wn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Js=wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),oy=wn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ea(c,n,a){return c.sections.forEach((p=>{p.text=(function(_,b,x){const E=b.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?_=_.toLocaleUpperCase():E==="lowercase"&&(_=_.toLocaleLowerCase()),Ws.applyArabicShaping&&(_=Ws.applyArabicShaping(_)),_})(p.text,n,a)})),c}wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var cr=24;const sf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},p0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Gc={40:!0};function gd(c,n,a,p,_,b){if("fontStack"in n){const x=a[n.fontStack],E=x&&x[c];return E?E.metrics.advance*n.scale+_:0}{const x=p[n.imageName];return x?x.displaySize[0]*n.scale*cr/b+_:0}}function Hp(c,n,a,p){const _=Math.pow(c-n,2);return p?c<n?_/2:2*_:_+Math.abs(a)*a}function af(c,n,a){let p=0;return c===10&&(p-=1e4),a&&(p+=150),c!==40&&c!==65288||(p+=50),n!==41&&n!==65289||(p+=50),p}function Em(c,n,a,p,_,b){let x=null,E=Hp(n,a,_,b);for(const P of p){const O=Hp(n-P.x,a,_,b)+P.badness;O<=E&&(x=P,E=O)}return{index:c,x:n,priorBreak:x,badness:E}}function Cm(c){return c?Cm(c.priorBreak).concat(c.index):[]}class sh{constructor(n="",a=[],p=[]){this.text=n,this.sections=a,this.sectionIndex=p,this.imageSectionID=null}static fromFeature(n,a){const p=new sh;for(let _=0;_<n.sections.length;_++){const b=n.sections[_];b.image?p.addImageSection(b):p.addTextSection(b,a)}return p}length(){return[...this.text].length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}verticalizePunctuation(){this.text=(function(n){let a="",p={premature:!0,value:void 0};const _=n[Symbol.iterator]();let b=_.next();const x=n[Symbol.iterator]();x.next();let E=x.next();for(;!b.done;)a+=!E.done&&Ga(E.value.codePointAt(0))&&!sf[E.value]||!p.premature&&Ga(p.value.codePointAt(0))&&!sf[p.value]||!sf[b.value]?b.value:sf[b.value],p={value:b.value,premature:!1},b=_.next(),E=x.next();return a})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const n=this.text.match(/^\s*/),a=n?n[0].length:0,p=this.text.match(/\S\s*$/),_=p?p[0].length-1:0;this.text=this.text.substring(a,this.text.length-_),this.sectionIndex=this.sectionIndex.slice(a,this.sectionIndex.length-_)}substring(n,a){const p=[...this.text].slice(n,a).join(""),_=this.sectionIndex.slice(n,a);return new sh(p,this.sections,_)}toCodeUnitIndex(n){return[...this.text].slice(0,n).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((n,a)=>Math.max(n,this.sections[a].scale)),0)}getMaxImageSize(n){let a=0,p=0;for(let _=0;_<this.length();_++){const b=this.getSection(_);if("imageName"in b){const x=n[b.imageName];if(!x)continue;const E=x.displaySize;a=Math.max(a,E[0]),p=Math.max(p,E[1])}}return{maxImageWidth:a,maxImageHeight:p}}addTextSection(n,a){this.text+=n.text,this.sections.push({scale:n.scale||1,verticalAlign:n.verticalAlign||"bottom",fontStack:n.fontStack||a});const p=this.sections.length-1;this.sectionIndex.push(...[...n.text].map((()=>p)))}addImageSection(n){const a=n.image?n.image.name:"";if(a.length===0)return void gn("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push({scale:1,verticalAlign:n.verticalAlign||"bottom",imageName:a}),this.sectionIndex.push(this.sections.length-1)):gn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(n,a,p,_,b){const x=[],E=this.determineAverageLineWidth(n,a,p,_,b),P=this.hasZeroWidthSpaces();let O=0,B=0;const F=this.text[Symbol.iterator]();let V=F.next();const j=this.text[Symbol.iterator]();j.next();let X=j.next();const Z=this.text[Symbol.iterator]();Z.next(),Z.next();let Q=Z.next();for(;!V.done;){const se=this.getSection(B),ge=V.value.codePointAt(0);if(Vu(ge)||(O+=gd(ge,se,p,_,n,b)),!X.done){const ie=Wa(ge),ue=X.value.codePointAt(0);(p0[ge]||ie||"imageName"in se||!Q.done&&Gc[ue])&&x.push(Em(B+1,O,E,x,af(ge,ue,ie&&P),!1))}B++,V=F.next(),X=j.next(),Q=Z.next()}return Cm(Em(this.length(),O,E,x,0,!0))}determineAverageLineWidth(n,a,p,_,b){let x=0,E=0;for(const P of this.text){const O=this.getSection(E);x+=gd(P.codePointAt(0),O,p,_,n,b),E++}return x/Math.max(1,Math.ceil(x/a))}}const Wp=4294967296,md=1/Wp,qp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Xp{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,a,p=this.length){for(;this.pos<p;){const _=this.readVarint(),b=_>>3,x=this.pos;this.type=7&_,n(b,a,this),this.pos===x&&this.skip(_)}return a}readMessage(n,a){return this.readFields(n,a,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Wp;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Wp;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const a=this.buf;let p,_;return _=a[this.pos++],p=127&_,_<128?p:(_=a[this.pos++],p|=(127&_)<<7,_<128?p:(_=a[this.pos++],p|=(127&_)<<14,_<128?p:(_=a[this.pos++],p|=(127&_)<<21,_<128?p:(_=a[this.pos],p|=(15&_)<<28,(function(b,x,E){const P=E.buf;let O,B;if(B=P[E.pos++],O=(112&B)>>4,B<128||(B=P[E.pos++],O|=(127&B)<<3,B<128)||(B=P[E.pos++],O|=(127&B)<<10,B<128)||(B=P[E.pos++],O|=(127&B)<<17,B<128)||(B=P[E.pos++],O|=(127&B)<<24,B<128)||(B=P[E.pos++],O|=(1&B)<<31,B<128))return of(b,O,x);throw new Error("Expected varint not more than 10 bytes")})(p,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,a=this.pos;return this.pos=n,n-a>=12&&qp?qp.decode(this.buf.subarray(a,n)):(function(p,_,b){let x="",E=_;for(;E<b;){const P=p[E];let O,B,F,V=null,j=P>239?4:P>223?3:P>191?2:1;if(E+j>b)break;j===1?P<128&&(V=P):j===2?(O=p[E+1],(192&O)==128&&(V=(31&P)<<6|63&O,V<=127&&(V=null))):j===3?(O=p[E+1],B=p[E+2],(192&O)==128&&(192&B)==128&&(V=(15&P)<<12|(63&O)<<6|63&B,(V<=2047||V>=55296&&V<=57343)&&(V=null))):j===4&&(O=p[E+1],B=p[E+2],F=p[E+3],(192&O)==128&&(192&B)==128&&(192&F)==128&&(V=(15&P)<<18|(63&O)<<12|(63&B)<<6|63&F,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,j=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),E+=j}return x})(this.buf,a,n)}readBytes(){const n=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,n);return this.pos=n,a}readPackedVarint(n=[],a){const p=this.readPackedEnd();for(;this.pos<p;)n.push(this.readVarint(a));return n}readPackedSVarint(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const a=this.readPackedEnd();for(;this.pos<a;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const a=7&n;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(n,a){this.writeVarint(n<<3|a)}realloc(n){let a=this.length||16;for(;a<this.pos+n;)a*=2;if(a!==this.length){const p=new Uint8Array(a);p.set(this.buf),this.buf=p,this.dataView=new DataView(p.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*md),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*md),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(a,p){let _,b;if(a>=0?(_=a%4294967296|0,b=a/4294967296|0):(_=~(-a%4294967296),b=~(-a/4294967296),4294967295^_?_=_+1|0:(_=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),(function(x,E,P){P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,x>>>=7,P.buf[P.pos++]=127&x|128,P.buf[P.pos]=127&(x>>>=7)})(_,0,p),(function(x,E){const P=(7&x)<<4;E.buf[E.pos++]|=P|((x>>>=3)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x|((x>>>=7)?128:0),x&&(E.buf[E.pos++]=127&x)))))})(b,p)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const a=this.pos;this.pos=(function(_,b,x){for(let E,P,O=0;O<b.length;O++){if(E=b.charCodeAt(O),E>55295&&E<57344){if(!P){E>56319||O+1===b.length?(_[x++]=239,_[x++]=191,_[x++]=189):P=E;continue}if(E<56320){_[x++]=239,_[x++]=191,_[x++]=189,P=E;continue}E=P-55296<<10|E-56320|65536,P=null}else P&&(_[x++]=239,_[x++]=191,_[x++]=189,P=null);E<128?_[x++]=E:(E<2048?_[x++]=E>>6|192:(E<65536?_[x++]=E>>12|224:(_[x++]=E>>18|240,_[x++]=E>>12&63|128),_[x++]=E>>6&63|128),_[x++]=63&E|128)}return x})(this.buf,n,this.pos);const p=this.pos-a;p>=128&&ly(a,p,this),this.pos=a-1,this.writeVarint(p),this.pos+=p}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const a=n.length;this.writeVarint(a),this.realloc(a);for(let p=0;p<a;p++)this.buf[this.pos++]=n[p]}writeRawMessage(n,a){this.pos++;const p=this.pos;n(a,this);const _=this.pos-p;_>=128&&ly(p,_,this),this.pos=p-1,this.writeVarint(_),this.pos+=_}writeMessage(n,a,p){this.writeTag(n,2),this.writeRawMessage(a,p)}writePackedVarint(n,a){a.length&&this.writeMessage(n,cy,a)}writePackedSVarint(n,a){a.length&&this.writeMessage(n,uy,a)}writePackedBoolean(n,a){a.length&&this.writeMessage(n,hy,a)}writePackedFloat(n,a){a.length&&this.writeMessage(n,lf,a)}writePackedDouble(n,a){a.length&&this.writeMessage(n,Gp,a)}writePackedFixed32(n,a){a.length&&this.writeMessage(n,fy,a)}writePackedSFixed32(n,a){a.length&&this.writeMessage(n,dy,a)}writePackedFixed64(n,a){a.length&&this.writeMessage(n,py,a)}writePackedSFixed64(n,a){a.length&&this.writeMessage(n,gy,a)}writeBytesField(n,a){this.writeTag(n,2),this.writeBytes(a)}writeFixed32Field(n,a){this.writeTag(n,5),this.writeFixed32(a)}writeSFixed32Field(n,a){this.writeTag(n,5),this.writeSFixed32(a)}writeFixed64Field(n,a){this.writeTag(n,1),this.writeFixed64(a)}writeSFixed64Field(n,a){this.writeTag(n,1),this.writeSFixed64(a)}writeVarintField(n,a){this.writeTag(n,0),this.writeVarint(a)}writeSVarintField(n,a){this.writeTag(n,0),this.writeSVarint(a)}writeStringField(n,a){this.writeTag(n,2),this.writeString(a)}writeFloatField(n,a){this.writeTag(n,5),this.writeFloat(a)}writeDoubleField(n,a){this.writeTag(n,1),this.writeDouble(a)}writeBooleanField(n,a){this.writeVarintField(n,+a)}}function of(c,n,a){return a?4294967296*n+(c>>>0):4294967296*(n>>>0)+(c>>>0)}function ly(c,n,a){const p=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));a.realloc(p);for(let _=a.pos-1;_>=c;_--)a.buf[_+p]=a.buf[_]}function cy(c,n){for(let a=0;a<c.length;a++)n.writeVarint(c[a])}function uy(c,n){for(let a=0;a<c.length;a++)n.writeSVarint(c[a])}function lf(c,n){for(let a=0;a<c.length;a++)n.writeFloat(c[a])}function Gp(c,n){for(let a=0;a<c.length;a++)n.writeDouble(c[a])}function hy(c,n){for(let a=0;a<c.length;a++)n.writeBoolean(c[a])}function fy(c,n){for(let a=0;a<c.length;a++)n.writeFixed32(c[a])}function dy(c,n){for(let a=0;a<c.length;a++)n.writeSFixed32(c[a])}function py(c,n){for(let a=0;a<c.length;a++)n.writeFixed64(c[a])}function gy(c,n){for(let a=0;a<c.length;a++)n.writeSFixed64(c[a])}function my(c,n,a){c===1&&a.readMessage(Zp,n)}function Zp(c,n,a){if(c===3){const{id:p,bitmap:_,width:b,height:x,left:E,top:P,advance:O}=a.readMessage(_y,{});n.push({id:p,bitmap:new td({width:b+6,height:x+6},_),metrics:{width:b,height:x,left:E,top:P,advance:O}})}}function _y(c,n,a){c===1?n.id=a.readVarint():c===2?n.bitmap=a.readBytes():c===3?n.width=a.readVarint():c===4?n.height=a.readVarint():c===5?n.left=a.readSVarint():c===6?n.top=a.readSVarint():c===7&&(n.advance=a.readVarint())}function Mm(c){let n=0,a=0;for(const x of c)n+=x.w*x.h,a=Math.max(a,x.w);c.sort(((x,E)=>E.h-x.h));const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let _=0,b=0;for(const x of c)for(let E=p.length-1;E>=0;E--){const P=p[E];if(!(x.w>P.w||x.h>P.h)){if(x.x=P.x,x.y=P.y,b=Math.max(b,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===P.w&&x.h===P.h){const O=p.pop();O&&E<p.length&&(p[E]=O)}else x.h===P.h?(P.x+=x.w,P.w-=x.w):x.w===P.w?(P.y+=x.h,P.h-=x.h):(p.push({x:P.x+x.w,y:P.y,w:P.w-x.w,h:x.h}),P.y+=x.h,P.h-=x.h);break}}return{w:_,h:b,fill:n/(_*b)||0}}class sn{constructor(n,{pixelRatio:a,version:p,stretchX:_,stretchY:b,content:x,textFitWidth:E,textFitHeight:P}){this.paddedRect=n,this.pixelRatio=a,this.stretchX=_,this.stretchY=b,this.content=x,this.version=p,this.textFitWidth=E,this.textFitHeight=P}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Yp{constructor(n,a){const p={},_={};this.haveRenderCallbacks=[];const b=[];this.addImages(n,p,b),this.addImages(a,_,b);const{w:x,h:E}=Mm(b),P=new as({width:x||1,height:E||1});for(const O in n){const B=n[O],F=p[O].paddedRect;as.copy(B.data,P,{x:0,y:0},{x:F.x+1,y:F.y+1},B.data)}for(const O in a){const B=a[O],F=_[O].paddedRect,V=F.x+1,j=F.y+1,X=B.data.width,Z=B.data.height;as.copy(B.data,P,{x:0,y:0},{x:V,y:j},B.data),as.copy(B.data,P,{x:0,y:Z-1},{x:V,y:j-1},{width:X,height:1}),as.copy(B.data,P,{x:0,y:0},{x:V,y:j+Z},{width:X,height:1}),as.copy(B.data,P,{x:X-1,y:0},{x:V-1,y:j},{width:1,height:Z}),as.copy(B.data,P,{x:0,y:0},{x:V+X,y:j},{width:1,height:Z})}this.image=P,this.iconPositions=p,this.patternPositions=_}addImages(n,a,p){for(const _ in n){const b=n[_],x={x:0,y:0,w:b.data.width+2,h:b.data.height+2};p.push(x),a[_]=new sn(x,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(n,a){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in n.updatedImages)this.patchUpdatedImage(this.iconPositions[p],n.getImage(p),a),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p),a)}patchUpdatedImage(n,a,p){if(!n||!a||n.version===a.version)return;n.version=a.version;const[_,b]=n.tl;p.update(a.data,void 0,{x:_,y:b})}}var Zc;function _d(c,n,a,p,_,b,x,E,P,O,B,F,V,j,X){const Z=sh.fromFeature(c,_);let Q;F===g.az.vertical&&Z.verticalizePunctuation();let se=Z.determineLineBreaks(O,b,n,p,j);const{processBidirectionalText:ge,processStyledBidirectionalText:ie}=Ws;if(ge&&Z.sections.length===1){Q=[],se=se.map((Ye=>Z.toCodeUnitIndex(Ye)));const Re=ge(Z.toString(),se);for(const Ye of Re){const ft=[...Ye].map((()=>0));Q.push(new sh(Ye,Z.sections,ft))}}else if(ie){Q=[],se=se.map((dt=>Z.toCodeUnitIndex(dt)));let Re=0;const Ye=[];for(const dt of Z.text)Ye.push(...Array(dt.length).fill(Z.sectionIndex[Re])),Re++;const ft=ie(Z.text,Ye,se);for(const dt of ft){const bt=[];let Bt="";for(const At of dt[0])bt.push(dt[1][Bt.length]),Bt+=At;Q.push(new sh(dt[0],Z.sections,bt))}}else Q=(function(Re,Ye){const ft=[];let dt=0;for(const bt of Ye)ft.push(Re.substring(dt,bt)),dt=bt;return dt<Re.length()&&ft.push(Re.substring(dt,Re.length())),ft})(Z,se);const ue=[],Te={positionedLines:ue,text:Z.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:F,iconsInText:!1,verticalizable:!1};return(function(Re,Ye,ft,dt,bt,Bt,At,pt,ct,Vt,qt,Kt){let Gt=0,wi=0,jn=0,vr=0;const us=pt==="right"?1:pt==="left"?0:.5,fl=cr/Kt;let ta=0;for(const ir of bt){ir.trim();const Gr=ir.getMaxScale(),ks={positionedGlyphs:[],lineOffset:0};Re.positionedLines[ta]=ks;const Ls=ks.positionedGlyphs;let Ta=0;if(!ir.length()){wi+=Bt,++ta;continue}const fs=g0(dt,ir,fl);let Sa=0;for(const kr of ir.text){const Gn=ir.getSection(Sa),br=kr.codePointAt(0),Jn=Kp(ct,qt,br),Lr={glyph:br,imageName:null,x:Gt,y:wi+-17,vertical:Jn,scale:1,fontStack:"",sectionIndex:ir.getSectionIndex(Sa),metrics:null,rect:null};let hh;if("fontStack"in Gn){if(hh=cf(Gn,br,Jn,fs,Ye,ft),!hh)continue;Lr.fontStack=Gn.fontStack}else{if(Re.iconsInText=!0,Gn.scale*=fl,hh=Im(Gn,Jn,Gr,fs,dt),!hh)continue;Ta=Math.max(Ta,hh.imageOffset),Lr.imageName=Gn.imageName}const{rect:lc,metrics:r_,baselineOffset:_f}=hh;Lr.y+=_f,Lr.scale=Gn.scale,Lr.metrics=r_,Lr.rect=lc,Ls.push(Lr),Jn?(Re.verticalizable=!0,Gt+=("imageName"in Gn?r_.advance:cr)*Gn.scale+Vt):Gt+=r_.advance*Gn.scale+Vt,Sa++}Ls.length!==0&&(jn=Math.max(Gt-Vt,jn),Qp(Ls,0,Ls.length-1,us)),Gt=0,ks.lineOffset=Math.max(Ta,(Gr-1)*cr);const dl=Bt*Gr+Ta;wi+=dl,vr=Math.max(dl,vr),++ta}const{horizontalAlign:Xr,verticalAlign:hs}=Pm(At);(function(ir,Gr,ks,Ls,Ta,fs,Sa,dl,kr){const Gn=(Gr-ks)*Ta;let br=0;br=fs!==Sa?-dl*Ls- -17:-Ls*kr*Sa+.5*Sa;for(const Jn of ir)for(const Lr of Jn.positionedGlyphs)Lr.x+=Gn,Lr.y+=br})(Re.positionedLines,us,Xr,hs,jn,vr,Bt,wi,bt.length),Re.top+=-hs*wi,Re.bottom=Re.top+wi,Re.left+=-Xr*jn,Re.right=Re.left+jn})(Te,n,a,p,Q,x,E,P,F,O,V,X),!(function(Re){for(const Ye of Re)if(Ye.positionedGlyphs.length!==0)return!1;return!0})(ue)&&Te}function Pm(c){let n=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function g0(c,n,a){const p=n.getMaxScale()*cr,{maxImageWidth:_,maxImageHeight:b}=n.getMaxImageSize(c),x=Math.max(p,b*a);return{verticalLineContentWidth:Math.max(p,_*a),horizontalLineContentHeight:x}}function yy(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function Kp(c,n,a){return!(c===g.az.horizontal||!n&&!Fl(a)||n&&(Vu(a)||(p=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function cf(c,n,a,p,_,b){const x=b[c.fontStack],E=(function(O,B,F,V){if(O&&O.rect)return O;const j=B[F.fontStack],X=j&&j[V];return X?{rect:null,metrics:X.metrics}:null})(x&&x[n],_,c,n);if(E===null)return null;let P;if(a)P=p.verticalLineContentWidth-c.scale*cr;else{const O=yy(c.verticalAlign);P=(p.horizontalLineContentHeight-c.scale*cr)*O}return{rect:E.rect,metrics:E.metrics,baselineOffset:P}}function Im(c,n,a,p,_){const b=_[c.imageName];if(!b)return null;const x=b.paddedRect,E=b.displaySize,P={width:E[0],height:E[1],left:1,top:-3,advance:n?E[1]:E[0]};let O;if(n)O=p.verticalLineContentWidth-E[1]*c.scale;else{const B=yy(c.verticalAlign);O=(p.horizontalLineContentHeight-E[1]*c.scale)*B}return{rect:x,metrics:P,baselineOffset:O,imageOffset:(n?E[0]:E[1])*c.scale-cr*a}}function Qp(c,n,a,p){if(p===0)return;const _=c[a],b=(c[a].x+_.metrics.advance*_.scale)*p;for(let x=n;x<=a;x++)c[x].x-=b}function Rm(c,n,a){const{horizontalAlign:p,verticalAlign:_}=Pm(a),b=n[0]-c.displaySize[0]*p,x=n[1]-c.displaySize[1]*_;return{image:c,top:x,bottom:x+c.displaySize[1],left:b,right:b+c.displaySize[0]}}function tc(c){var n,a;let p=c.left,_=c.top,b=c.right-p,x=c.bottom-_;const E=(n=c.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",P=(a=c.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",O=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(P==="proportional"){if(E==="stretchOnly"&&b/x<O||E==="proportional"){const B=Math.ceil(x*O);p*=B/b,b=B}}else if(E==="proportional"&&P==="stretchOnly"&&O!==0&&b/x>O){const B=Math.ceil(b/O);_*=B/x,x=B}return{x1:p,y1:_,x2:p+b,y2:_+x}}function So(c,n,a,p,_,b){const x=c.image;let E;if(x.content){const Q=x.content,se=x.pixelRatio||1;E=[Q[0]/se,Q[1]/se,x.displaySize[0]-Q[2]/se,x.displaySize[1]-Q[3]/se]}const P=n.left*b,O=n.right*b;let B,F,V,j;a==="width"||a==="both"?(j=_[0]+P-p[3],F=_[0]+O+p[1]):(j=_[0]+(P+O-x.displaySize[0])/2,F=j+x.displaySize[0]);const X=n.top*b,Z=n.bottom*b;return a==="height"||a==="both"?(B=_[1]+X-p[0],V=_[1]+Z+p[2]):(B=_[1]+(X+Z-x.displaySize[1])/2,V=B+x.displaySize[1]),{image:x,top:B,right:F,bottom:V,left:j,collisionPadding:E}}Nt("ImagePosition",sn),Nt("ImageAtlas",Yp),g.az=void 0,(Zc=g.az||(g.az={}))[Zc.none=0]="none",Zc[Zc.horizontal=1]="horizontal",Zc[Zc.vertical=2]="vertical",Zc[Zc.horizontalOnly=3]="horizontalOnly";const xa=128,Yc=32640;function Dm(c,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Wi(c+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=a;let b=0;for(;b<p.length&&p[b]<=c;)b++;b=Math.max(0,b-1);let x=b;for(;x<p.length&&p[x]<c+1;)x++;x=Math.min(p.length-1,x);const E=p[b],P=p[x];return a.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:E,maxZoom:P,minSize:a.evaluate(new Wi(E)),maxSize:a.evaluate(new Wi(P)),interpolationType:_}}}function Jp(c,n,a){let p="never";const _=c.get(n);return _?p=_:c.get(a)&&(p="always"),p}const vy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yd(c,n,a,p,_,b,x,E,P,O,B,F,V){const j=E?Math.min(Yc,Math.round(E[0])):0,X=E?Math.min(Yc,Math.round(E[1])):0;c.emplaceBack(n,a,Math.round(32*p),Math.round(32*_),b,x,(j<<1)+(P?1:0),X,16*O,16*B,256*F,256*V)}function Om(c,n,a){c.emplaceBack(n.x,n.y,a),c.emplaceBack(n.x,n.y,a),c.emplaceBack(n.x,n.y,a),c.emplaceBack(n.x,n.y,a)}function km(c){for(const n of c.sections)if(go(n.text))return!0;return!1}class eg{constructor(n){this.layoutVertexArray=new we,this.indexArray=new Qe,this.programConfigurations=n,this.segments=new zt,this.dynamicLayoutVertexArray=new ke,this.opacityVertexArray=new et,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,a,p,_){this.isEmpty()||(p&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ay.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,pd.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,vy,!0),this.opacityVertexBuffer.itemSize=1),(p||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Nt("SymbolBuffers",eg);class tg{constructor(n,a,p){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new p,this.segments=new zt,this.collisionVertexArray=new Ke}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Am.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Nt("CollisionBuffers",tg);class uf{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map((x=>x.id)),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Dm(this.zoom,a["text-size"]),this.iconSizeData=Dm(this.zoom,a["icon-size"]);const p=this.layers[0].layout,_=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=Jp(p,"text-overlap","text-allow-overlap")!=="never"||Jp(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map((x=>g.az[x]))),this.stateDependentLayerIds=this.layers.filter((x=>x.isStateDependent())).map((x=>x.id)),this.sourceID=n.sourceID}createArrays(){this.text=new eg(new il(this.layers,this.zoom,(n=>/^text/.test(n)))),this.icon=new eg(new il(this.layers,this.zoom,(n=>/^icon/.test(n)))),this.glyphOffsetArray=new N,this.lineVertexArray=new U,this.symbolInstances=new k,this.textAnchorOffsets=new $}calculateGlyphDependencies(n,a,p,_,b){for(const x of n)if(a[x.codePointAt(0)]=!0,(p||_)&&b){const E=sf[x];E&&(a[E.codePointAt(0)]=!0)}}populate(n,a,p){const _=this.layers[0],b=_.layout,x=b.get("text-font"),E=b.get("text-field"),P=b.get("icon-image"),O=(E.value.kind!=="constant"||E.value.value instanceof sr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,F=b.get("symbol-sort-key");if(this.features=[],!O&&!B)return;const V=a.iconDependencies,j=a.glyphDependencies,X=a.availableImages,Z=new Wi(this.zoom);for(const{feature:Q,id:se,index:ge,sourceLayerIndex:ie}of n){const ue=_._featureFilter.needGeometry,Te=va(Q,ue);if(!_._featureFilter.filter(Z,Te,p))continue;let Re,Ye;if(ue||(Te.geometry=xo(Q)),O){const dt=_.getValueAndResolveTokens("text-field",Te,p,X),bt=sr.factory(dt),Bt=this.hasRTLText=this.hasRTLText||km(bt);(!Bt||Ws.getRTLTextPluginStatus()==="unavailable"||Bt&&Ws.isParsed())&&(Re=ea(bt,_,Te))}if(B){const dt=_.getValueAndResolveTokens("icon-image",Te,p,X);Ye=dt instanceof Ur?dt:Ur.fromString(dt)}if(!Re&&!Ye)continue;const ft=this.sortFeaturesByKey?F.evaluate(Te,{},p):void 0;if(this.features.push({id:se,text:Re,icon:Ye,index:ge,sourceLayerIndex:ie,geometry:Te.geometry,properties:Q.properties,type:tf.types[Q.type],sortKey:ft}),Ye&&(V[Ye.name]=!0),Re){const dt=x.evaluate(Te,{},p).join(","),bt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.az.vertical)>=0;for(const Bt of Re.sections)if(Bt.image)V[Bt.image.name]=!0;else{const At=qa(Re.toString()),pt=Bt.fontStack||dt,ct=j[pt]=j[pt]||{};this.calculateGlyphDependencies(Bt.text,ct,bt,this.allowVerticalPlacement,At)}}}b.get("symbol-placement")==="line"&&(this.features=(function(Q){const se={},ge={},ie=[];let ue=0;function Te(dt){ie.push(Q[dt]),ue++}function Re(dt,bt,Bt){const At=ge[dt];return delete ge[dt],ge[bt]=At,ie[At].geometry[0].pop(),ie[At].geometry[0]=ie[At].geometry[0].concat(Bt[0]),At}function Ye(dt,bt,Bt){const At=se[bt];return delete se[bt],se[dt]=At,ie[At].geometry[0].shift(),ie[At].geometry[0]=Bt[0].concat(ie[At].geometry[0]),At}function ft(dt,bt,Bt){const At=Bt?bt[0][bt[0].length-1]:bt[0][0];return`${dt}:${At.x}:${At.y}`}for(let dt=0;dt<Q.length;dt++){const bt=Q[dt],Bt=bt.geometry,At=bt.text?bt.text.toString():null;if(!At){Te(dt);continue}const pt=ft(At,Bt),ct=ft(At,Bt,!0);if(pt in ge&&ct in se&&ge[pt]!==se[ct]){const Vt=Ye(pt,ct,Bt),qt=Re(pt,ct,ie[Vt].geometry);delete se[pt],delete ge[ct],ge[ft(At,ie[qt].geometry,!0)]=qt,ie[Vt].geometry=null}else pt in ge?Re(pt,ct,Bt):ct in se?Ye(pt,ct,Bt):(Te(dt),se[pt]=ue-1,ge[ct]=ue-1)}return ie.filter((dt=>dt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Q,se)=>Q.sortKey-se.sortKey))}update(n,a,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,a,this.layers,{imagePositions:p}),this.icon.programConfigurations.updatePaintArrays(n,a,this.layers,{imagePositions:p}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const p=this.lineVertexArray.length;if(n.segment!==void 0){let _=n.dist(a[n.segment+1]),b=n.dist(a[n.segment]);const x={};for(let E=n.segment+1;E<a.length;E++)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:_},E<a.length-1&&(_+=a[E+1].dist(a[E]));for(let E=n.segment||0;E>=0;E--)x[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:b},E>0&&(b+=a[E-1].dist(a[E]));for(let E=0;E<a.length;E++){const P=x[E];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(n,a,p,_,b,x,E,P,O,B,F,V){const j=n.indexArray,X=n.layoutVertexArray,Z=n.segments.prepareSegment(4*a.length,X,j,this.canOverlap?x.sortKey:void 0),Q=this.glyphOffsetArray.length,se=Z.vertexLength,ge=this.allowVerticalPlacement&&E===g.az.vertical?Math.PI/2:0,ie=x.text&&x.text.sections;for(let ue=0;ue<a.length;ue++){const{tl:Te,tr:Re,bl:Ye,br:ft,tex:dt,pixelOffsetTL:bt,pixelOffsetBR:Bt,minFontScaleX:At,minFontScaleY:pt,glyphOffset:ct,isSDF:Vt,sectionIndex:qt}=a[ue],Kt=Z.vertexLength,Gt=ct[1];yd(X,P.x,P.y,Te.x,Gt+Te.y,dt.x,dt.y,p,Vt,bt.x,bt.y,At,pt),yd(X,P.x,P.y,Re.x,Gt+Re.y,dt.x+dt.w,dt.y,p,Vt,Bt.x,bt.y,At,pt),yd(X,P.x,P.y,Ye.x,Gt+Ye.y,dt.x,dt.y+dt.h,p,Vt,bt.x,Bt.y,At,pt),yd(X,P.x,P.y,ft.x,Gt+ft.y,dt.x+dt.w,dt.y+dt.h,p,Vt,Bt.x,Bt.y,At,pt),Om(n.dynamicLayoutVertexArray,P,ge),j.emplaceBack(Kt,Kt+2,Kt+1),j.emplaceBack(Kt+1,Kt+2,Kt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),ue!==a.length-1&&qt===a[ue+1].sectionIndex||n.programConfigurations.populatePaintArrays(X.length,x,x.index,{imagePositions:{},canonical:V,formattedSection:ie&&ie[qt]})}n.placedSymbolArray.emplaceBack(P.x,P.y,Q,this.glyphOffsetArray.length-Q,se,O,B,P.segment,p?p[0]:0,p?p[1]:0,_[0],_[1],E,0,!1,0,F)}_addCollisionDebugVertex(n,a,p,_,b,x){return a.emplaceBack(0,0),n.emplaceBack(p.x,p.y,_,b,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,a,p,_,b,x,E){const P=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),O=P.vertexLength,B=b.layoutVertexArray,F=b.collisionVertexArray,V=E.anchorX,j=E.anchorY;this._addCollisionDebugVertex(B,F,x,V,j,new A(n,a)),this._addCollisionDebugVertex(B,F,x,V,j,new A(p,a)),this._addCollisionDebugVertex(B,F,x,V,j,new A(p,_)),this._addCollisionDebugVertex(B,F,x,V,j,new A(n,_)),P.vertexLength+=4;const X=b.indexArray;X.emplaceBack(O,O+1),X.emplaceBack(O+1,O+2),X.emplaceBack(O+2,O+3),X.emplaceBack(O+3,O),P.primitiveLength+=4}addDebugCollisionBoxes(n,a,p,_){for(let b=n;b<a;b++){const x=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,_?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new tg(Ze,Js.members,Rt),this.iconCollisionBox=new tg(Ze,Js.members,Rt);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(n,a,p,_,b,x,E,P,O){const B={};for(let F=a;F<p;F++){const V=n.get(F);B.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.textFeatureIndex=V.featureIndex;break}for(let F=_;F<b;F++){const V=n.get(F);B.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalTextFeatureIndex=V.featureIndex;break}for(let F=x;F<E;F++){const V=n.get(F);B.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.iconFeatureIndex=V.featureIndex;break}for(let F=P;F<O;F++){const V=n.get(F);B.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},B.verticalIconFeatureIndex=V.featureIndex;break}return B}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const p=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,a){const p=n.placedSymbolArray.get(a),_=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<_;b+=4)n.indexArray.emplaceBack(b,b+2,b+1),n.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),p=Math.cos(n),_=[],b=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const P=this.symbolInstances.get(E);_.push(0|Math.round(a*P.anchorX+p*P.anchorY)),b.push(P.featureIndex)}return x.sort(((E,P)=>_[E]-_[P]||b[P]-b[E])),x}addToSortKeyRanges(n,a){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===a?p.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const p=this.symbolInstances.get(a);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach(((_,b,x)=>{_>=0&&x.indexOf(_)===b&&this.addIndicesForPlacedSymbol(this.text,_)})),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ig,ng;Nt("SymbolBucket",uf,{omit:["layers","collisionBoxArray","features","compareText"]}),uf.MAX_GLYPHS=65535,uf.addDynamicAttributes=Om;var Lm={get paint(){return ng=ng||new qn({"icon-opacity":new Xt(Ce.paint_symbol["icon-opacity"]),"icon-color":new Xt(Ce.paint_symbol["icon-color"]),"icon-halo-color":new Xt(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Xt(Ce.paint_symbol["text-opacity"]),"text-color":new Xt(Ce.paint_symbol["text-color"],{runtimeType:ms,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Xt(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(Ce.paint_symbol["text-halo-blur"]),"text-translate":new Ut(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return ig=ig||new qn({"symbol-placement":new Ut(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ut(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ut(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ut(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(Ce.layout_symbol["icon-size"]),"icon-text-fit":new Ut(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(Ce.layout_symbol["icon-image"]),"icon-rotate":new Xt(Ce.layout_symbol["icon-rotate"]),"icon-padding":new Xt(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(Ce.layout_symbol["icon-offset"]),"icon-anchor":new Xt(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(Ce.layout_symbol["text-field"]),"text-font":new Xt(Ce.layout_symbol["text-font"]),"text-size":new Xt(Ce.layout_symbol["text-size"]),"text-max-width":new Xt(Ce.layout_symbol["text-max-width"]),"text-line-height":new Ut(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(Ce.layout_symbol["text-justify"]),"text-radial-offset":new Xt(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Xt(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Xt(Ce.layout_symbol["text-anchor"]),"text-max-angle":new Ut(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(Ce.layout_symbol["text-rotate"]),"text-padding":new Ut(Ce.layout_symbol["text-padding"]),"text-keep-upright":new Ut(Ce.layout_symbol["text-keep-upright"]),"text-transform":new Xt(Ce.layout_symbol["text-transform"]),"text-offset":new Xt(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new Ut(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new Ut(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(Ce.layout_symbol["text-optional"])})}};class by{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Hi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Nt("FormatSectionOverride",by,{omit:["defaultValue"]});class Kc extends Mn{constructor(n,a){super(n,Lm,a)}recalculate(n,a){if(super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const _=[];for(const b of p)_.indexOf(b)<0&&_.push(b);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,a,p,_){const b=this.layout.get(n).evaluate(a,{},p,_),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||Zo(x.value)||!b?b:(function(E,P){return P.replace(/{([^{}]+)}/g,((O,B)=>E&&B in E?String(E[B]):""))})(a.properties,b)}createBucket(n){return new uf(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Lm.paint.overridableProperties){if(!Kc.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),p=new by(a),_=new zh(p,a.property.specification);let b=null;b=a.value.kind==="constant"||a.value.kind==="source"?new Wr("source",_):new Yo("composite",_,a.value.zoomStops),this.paint._values[n]=new Es(a.property,b,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,p){return!(!this.layout||a.isDataDriven()||p.isDataDriven())&&Kc.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const p=n.get("text-field"),_=Lm.paint.properties[a];let b=!1;const x=E=>{for(const P of E)if(_.overrides&&_.overrides.hasOverride(P))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof sr)x(p.value.value.sections);else if(p.value.kind==="source"||p.value.kind==="composite"){const E=O=>{b||(O instanceof ys&&bn(O.value)===Pa?x(O.value.sections):O instanceof Tu?x(O.sections):O.eachChild(E))},P=p.value;P._styleExpression&&E(P._styleExpression.expression)}return b}}let xy;var wy={get paint(){return xy=xy||new qn({"background-color":new Ut(Ce.paint_background["background-color"]),"background-pattern":new Vc(Ce.paint_background["background-pattern"]),"background-opacity":new Ut(Ce.paint_background["background-opacity"])})}};class ki extends Mn{constructor(n,a){super(n,wy,a)}}class Bm extends Mn{constructor(n,a){super(n,{},a),this.onAdd=p=>{this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},this.onRemove=p=>{this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rg{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zm={once:!0},sg=63710088e-1;class ll{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ll(Ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,p=this.lat*a,_=n.lat*a,b=Math.sin(p)*Math.sin(_)+Math.cos(p)*Math.cos(_)*Math.cos((n.lng-this.lng)*a);return sg*Math.acos(Math.min(b,1))}static convert(n){if(n instanceof ll)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ll(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ll(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hf=2*Math.PI*sg;function vd(c){return hf*Math.cos(c*Math.PI/180)}function Ty(c){return(180+c)/360}function Fm(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Sy(c,n){return c/vd(n)}function Ay(c){return 360*c-180}function bd(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Nm(c,n){return c*vd(bd(n))}class Yi{constructor(n,a,p=0){this.x=+n,this.y=+a,this.z=+p}static fromLngLat(n,a=0){const p=ll.convert(n);return new Yi(Ty(p.lng),Fm(p.lat),Sy(a,p.lat))}toLngLat(){return new ll(Ay(this.x),bd(this.y))}toAltitude(){return Nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hf*(n=bd(this.y),1/Math.cos(n*Math.PI/180));var n}}function ag(c,n,a){var p=2*Math.PI*6378137/256/Math.pow(2,a);return[c*p-2*Math.PI*6378137/2,n*p-2*Math.PI*6378137/2]}class Cr{constructor(n,a,p){if(!(function(_,b,x){return!(_<0||_>25||x<0||x>=Math.pow(2,_)||b<0||b>=Math.pow(2,_))})(n,a,p))throw new Error(`x=${a}, y=${p}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=a,this.y=p,this.key=ff(0,n,n,a,p)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a,p){const _=(x=this.y,E=this.z,P=ag(256*(b=this.x),256*(x=Math.pow(2,E)-x-1),E),O=ag(256*(b+1),256*(x+1),E),P[0]+","+P[1]+","+O[0]+","+O[1]);var b,x,E,P,O;const B=(function(F,V,j){let X,Z="";for(let Q=F;Q>0;Q--)X=1<<Q-1,Z+=(V&X?1:0)+(j&X?2:0);return Z})(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,_)}isChildOf(n){const a=this.z-n.z;return a>0&&n.x===this.x>>a&&n.y===this.y>>a}getTilePoint(n){const a=Math.pow(2,this.z);return new A((n.x*a-this.x)*Be,(n.y*a-this.y)*Be)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ey{constructor(n,a){this.wrap=n,this.canonical=a,this.key=ff(n,a.z,a.z,a.x,a.y)}}class Rs{constructor(n,a,p,_,b){if(this.terrainRttPosMatrix32f=null,n<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${p}`);this.overscaledZ=n,this.wrap=a,this.canonical=new Cr(p,+_,+b),this.key=ff(a,n,p,_,b)}clone(){return new Rs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-n;return n>this.canonical.z?new Rs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rs(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(n,a){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-n;return n>this.canonical.z?ff(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y):ff(this.wrap*+a,n,n,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(n){if(n.wrap!==this.wrap||this.overscaledZ-n.overscaledZ<=0)return!1;if(n.overscaledZ===0)return this.overscaledZ>0;const a=this.canonical.z-n.canonical.z;return!(a<0)&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new Rs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,p=2*this.canonical.x,_=2*this.canonical.y;return[new Rs(a,this.wrap,a,p,_),new Rs(a,this.wrap,a,p+1,_),new Rs(a,this.wrap,a,p,_+1),new Rs(a,this.wrap,a,p+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Rs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Rs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ey(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Yi(n.x-this.wrap,n.y))}normalizeCoordinates(n,a,p=8192){if(n>=0&&n<p&&a>=0&&a<p)return{tileID:this,x:n,y:a};const _=Math.floor(n/p),b=Math.floor(a/p),x=n-_*p,E=a-b*p,P=this.canonical.z,O=1<<P,B=this.canonical.y+b;if(B<0||B>=O)return null;let F=this.canonical.x+_,V=this.wrap;return F<0?(V-=Math.ceil(-F/O),F=(F%O+O)%O):F>=O&&(V+=Math.floor(F/O),F%=O),{tileID:new Rs(this.overscaledZ,V,P,F,B),x,y:E}}}function ff(c,n,a,p,_){(c*=2)<0&&(c=-1*c-1);const b=1<<a;return(b*b*c+b*_+p).toString(36)+a.toString(36)+n.toString(36)}function xd(c,n){return n?c.properties[n]:c.id}function Um(c,n){const a={id:c.id};if(n.removeAllProperties&&(delete c.removeProperties,delete c.addOrUpdateProperties,delete n.removeProperties),n.removeProperties)for(const p of n.removeProperties){const _=c.addOrUpdateProperties.findIndex((b=>b.key===p));_>-1&&c.addOrUpdateProperties.splice(_,1)}return(c.removeAllProperties||n.removeAllProperties)&&(a.removeAllProperties=!0),(c.removeProperties||n.removeProperties)&&(a.removeProperties=[...c.removeProperties||[],...n.removeProperties||[]]),(c.addOrUpdateProperties||n.addOrUpdateProperties)&&(a.addOrUpdateProperties=[...c.addOrUpdateProperties||[],...n.addOrUpdateProperties||[]]),(c.newGeometry||n.newGeometry)&&(a.newGeometry=n.newGeometry||c.newGeometry),a}function wd(c){var n,a;if(!c)return{};const p={};return p.removeAll=c.removeAll,p.remove=new Set(c.remove||[]),p.add=new Map((n=c.add)===null||n===void 0?void 0:n.map((_=>[_.id,_]))),p.update=new Map((a=c.update)===null||a===void 0?void 0:a.map((_=>[_.id,_]))),p}Nt("CanonicalTileID",Cr),Nt("OverscaledTileID",Rs,{omit:["terrainRttPosMatrix32f"]});class Qc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){const a=new Qc;return a.extend(n(new A(this.minX,this.minY))),a.extend(n(new A(this.maxX,this.minY))),a.extend(n(new A(this.minX,this.maxY))),a.extend(n(new A(this.maxX,this.maxY))),a}static fromPoints(n){const a=new Qc;for(const p of n)a.extend(p);return a}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class Vm{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const p=n[a];this._stringToNumber[p]=a,this._numberToString[a]=p}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class og{constructor(n,a,p,_,b){this.type="Feature",this._vectorTileFeature=n,this._x=p,this._y=_,this._z=a,this.properties=n.properties,this.id=b}projectPoint(n,a,p,_){return[360*(n.x+a)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(n.y+p)/_)*Math.PI))-90]}projectLine(n,a,p,_){return n.map((b=>this.projectPoint(b,a,p,_)))}get geometry(){if(this._geometry)return this._geometry;const n=this._vectorTileFeature,a=n.extent*Math.pow(2,this._z),p=n.extent*this._x,_=n.extent*this._y,b=n.loadGeometry();switch(n.type){case 1:{const x=[];for(const P of b)x.push(P[0]);const E=this.projectLine(x,p,_,a);this._geometry=x.length===1?{type:"Point",coordinates:E[0]}:{type:"MultiPoint",coordinates:E};break}case 2:{const x=b.map((E=>this.projectLine(E,p,_,a)));this._geometry=x.length===1?{type:"LineString",coordinates:x[0]}:{type:"MultiLineString",coordinates:x};break}case 3:{const x=ry(b),E=[];for(const P of x)E.push(P.map((O=>this.projectLine(O,p,_,a))));this._geometry=E.length===1?{type:"Polygon",coordinates:E[0]}:{type:"MultiPolygon",coordinates:E};break}default:throw new Error(`unknown feature type: ${n.type}`)}return this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&a!=="_x"&&a!=="_y"&&a!=="_z"&&(n[a]=this[a]);return n}}class Jc{_name;dataBuffer;nullabilityBuffer;_size;constructor(n,a,p){this._name=n,this.dataBuffer=a,typeof p=="number"?this._size=p:(this.nullabilityBuffer=p,this._size=p.size())}getValue(n){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(n)?null:this.getValueFromBuffer(n)}has(n){return this.nullabilityBuffer&&this.nullabilityBuffer.get(n)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class lg extends Jc{}class cg extends lg{getValueFromBuffer(n){return this.dataBuffer[n]}}class jm extends lg{getValueFromBuffer(n){return this.dataBuffer[n]}}class $m extends Jc{delta;constructor(n,a,p,_){super(n,a,_),this.delta=p}}class Hm extends $m{constructor(n,a,p,_){super(n,Int32Array.of(a),p,_)}getValueFromBuffer(n){return this.dataBuffer[0]+n*this.delta}}class Wm extends Jc{constructor(n,a,p){super(n,Int32Array.of(a),p)}getValueFromBuffer(n){return this.dataBuffer[0]}}class eu{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(n,a,p,_,b=4096){this._name=n,this._geometryVector=a,this._idVector=p,this._propertyVectors=_,this._extent=b}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(n){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((a=>[a.name,a])))),this.propertyVectorsMap.get(n)}*[Symbol.iterator](){const n=this.geometryVector[Symbol.iterator]();let a=0;for(;a<this.numFeatures;){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(a)):this.idVector.getValue(a));const _=n?.next().value,b={};for(const x of this.propertyVectors){if(!x)continue;const E=x.name,P=x.getValue(a);P!==null&&(b[E]=P)}a++,yield{id:p,geometry:_,properties:b}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const n=[],a=this.geometryVector.getGeometries();for(let p=0;p<this.numFeatures;p++){let _;this.idVector&&(_=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(p)):this.idVector.getValue(p));const b={coordinates:a[p],type:this.geometryVector.geometryType(p)},x={};for(const E of this.propertyVectors){if(!E)continue;const P=E.name,O=E.getValue(p);O!==null&&(x[P]=O)}n.push({id:_,geometry:b,properties:x})}return n}containsMaxSaveIntegerValues(n){return n instanceof cg||n instanceof Wm&&n instanceof Hm||n instanceof jm}}class Cy{value;constructor(n){this.value=n}get(){return this.value}set(n){this.value=n}increment(){return this.value++}add(n){this.value+=n}}var Xi,cl,Dr,Ao,tu,os,In,yr,wa,Ds;function Or(c,n,a){const p=new Int32Array(a);let _=0,b=n.get();for(let x=0;x<p.length;x++){let E=c[b++],P=127&E;E<128||(E=c[b++],P|=(127&E)<<7,E<128||(E=c[b++],P|=(127&E)<<14,E<128||(E=c[b++],P|=(127&E)<<21,E<128||(E=c[b++],P|=(15&E)<<28)))),p[_++]=P}return n.set(b),p}function ug(c,n,a){const p=new BigInt64Array(a);for(let _=0;_<p.length;_++)p[_]=My(c,n);return p}function My(c,n){let a=0n,p=0,_=n.get();for(;_<c.length;){const b=c[_++];if(a|=BigInt(127&b)<<BigInt(p),!(128&b))break;if(p+=7,p>=64)throw new Error("Varint too long")}return n.set(_),a}function Td(c,n){let a,p;return p=c[n.get()],n.increment(),a=127&p,p<128?a:(p=c[n.get()],n.increment(),a|=(127&p)<<7,p<128?a:(p=c[n.get()],n.increment(),a|=(127&p)<<14,p<128?a:(p=c[n.get()],n.increment(),a|=(127&p)<<21,p<128?a:(p=c[n.get()],a|=(15&p)<<28,(function(_,b,x){let E,P;if(P=b[x.get()],x.increment(),E=(112&P)>>4,P<128||(P=b[x.get()],x.increment(),E|=(127&P)<<3,P<128)||(P=b[x.get()],x.increment(),E|=(127&P)<<10,P<128)||(P=b[x.get()],x.increment(),E|=(127&P)<<17,P<128)||(P=b[x.get()],x.increment(),E|=(127&P)<<24,P<128)||(P=b[x.get()],x.increment(),E|=(1&P)<<31,P<128))return 4294967296*E+(_>>>0);throw new Error("Expected varint not more than 10 bytes")})(a,c,n)))))}function Ni(c){return c>>>1^-(1&c)}function Os(c){return c>>1n^-(1n&c)}function ic(c){return c%2==1?(c+1)/-2:c/2}function ul(c,n,a){if(a===void 0){a=0;for(let b=0;b<n;b++)a+=c[b]}const p=new Int32Array(a);let _=0;for(let b=0;b<n;b++){const x=c[b];p.fill(c[b+n],_,_+x),_+=x}return p}function Py(c,n,a){if(a===void 0){a=0;for(let b=0;b<n;b++)a+=Number(c[b])}const p=new BigInt64Array(a);let _=0;for(let b=0;b<n;b++){const x=Number(c[b]);p.fill(c[b+n],_,_+x),_+=x}return p}function Iy(c,n,a){const p=new Float64Array(a);let _=0;for(let b=0;b<n;b++){const x=c[b];p.fill(c[b+n],_,_+x),_+=x}return p}function ah(c){const n=c.length/4*4;let a=1;if(n>=4)for(let p=c[0];a<n-4;a+=4)p=c[a]+=p,p=c[a+1]+=p,p=c[a+2]+=p,p=c[a+3]+=p;for(;a!=c.length;)c[a]+=c[a-1],++a}(function(c){c.NONE="NONE",c.DELTA="DELTA",c.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",c.RLE="RLE",c.MORTON="MORTON",c.PDE="PDE"})(Xi||(Xi={})),(function(c){c.NONE="NONE",c.FAST_PFOR="FAST_PFOR",c.VARINT="VARINT",c.ALP="ALP"})(cl||(cl={})),(function(c){c.PRESENT="PRESENT",c.DATA="DATA",c.OFFSET="OFFSET",c.LENGTH="LENGTH"})(Dr||(Dr={}));class hg{_dictionaryType;_offsetType;_lengthType;constructor(n,a,p){this._dictionaryType=n,this._offsetType=a,this._lengthType=p}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ls(c,n){const a=(function(p,_){const b=p[_.get()],x=Object.values(Dr)[b>>4];let E=null;switch(x){case Dr.DATA:E=new hg(Object.values(Ao)[15&b]);break;case Dr.OFFSET:E=new hg(null,Object.values(tu)[15&b]);break;case Dr.LENGTH:E=new hg(null,null,Object.values(os)[15&b])}_.increment();const P=p[_.get()],O=Object.values(Xi)[P>>5],B=Object.values(Xi)[P>>2&7],F=Object.values(cl)[3&P];_.increment();const V=Or(p,_,2),j=V[0];return{physicalStreamType:x,logicalStreamType:E,logicalLevelTechnique1:O,logicalLevelTechnique2:B,physicalLevelTechnique:F,numValues:j,byteLength:V[1],decompressedCount:j}})(c,n);return a.logicalLevelTechnique1===Xi.MORTON?(function(p,_,b){const x=Or(_,b,2);return{physicalStreamType:p.physicalStreamType,logicalStreamType:p.logicalStreamType,logicalLevelTechnique1:p.logicalLevelTechnique1,logicalLevelTechnique2:p.logicalLevelTechnique2,physicalLevelTechnique:p.physicalLevelTechnique,numValues:p.numValues,byteLength:p.byteLength,decompressedCount:p.decompressedCount,numBits:x[0],coordinateShift:x[1]}})(a,c,n):Xi.RLE!==a.logicalLevelTechnique1&&Xi.RLE!==a.logicalLevelTechnique2||cl.NONE===a.physicalLevelTechnique?a:(function(p,_,b){const x=Or(_,b,2);return{physicalStreamType:p.physicalStreamType,logicalStreamType:p.logicalStreamType,logicalLevelTechnique1:p.logicalLevelTechnique1,logicalLevelTechnique2:p.logicalLevelTechnique2,physicalLevelTechnique:p.physicalLevelTechnique,numValues:p.numValues,byteLength:p.byteLength,decompressedCount:x[1],runs:x[0],numRleValues:x[1]}})(a,c,n)}(function(c){c.NONE="NONE",c.SINGLE="SINGLE",c.SHARED="SHARED",c.VERTEX="VERTEX",c.MORTON="MORTON",c.FSST="FSST"})(Ao||(Ao={})),(function(c){c.VERTEX="VERTEX",c.INDEX="INDEX",c.STRING="STRING",c.KEY="KEY"})(tu||(tu={})),(function(c){c.VAR_BINARY="VAR_BINARY",c.GEOMETRIES="GEOMETRIES",c.PARTS="PARTS",c.RINGS="RINGS",c.TRIANGLES="TRIANGLES",c.SYMBOL="SYMBOL",c.DICTIONARY="DICTIONARY"})(os||(os={})),(function(c){c[c.FLAT=0]="FLAT",c[c.CONST=1]="CONST",c[c.SEQUENCE=2]="SEQUENCE",c[c.DICTIONARY=3]="DICTIONARY",c[c.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(In||(In={}));class Eo{values;_size;constructor(n,a){this.values=n,this._size=a}get(n){const a=Math.floor(n/8);return(this.values[a]>>n%8&1)==1}set(n,a){const p=Math.floor(n/8);this.values[p]=this.values[p]|(a?1:0)<<n%8}getInt(n){const a=Math.floor(n/8);return this.values[a]>>n%8&1}size(){return this._size}getBuffer(){return this.values}}function fg(c,n,a){if(!n)return c;const p=n.size(),_=new c.constructor(p);let b=0;for(let x=0;x<p;x++)_[x]=n.get(x)?c[b++]:a;return _}function cs(c,n,a,p,_,b){return(function(x,E,P,O,B){switch(E.logicalLevelTechnique1){case Xi.DELTA:if(E.logicalLevelTechnique2===Xi.RLE){const F=E;if(!B)return(function(V,j,X){const Z=new Int32Array(X);let Q=0,se=0;for(let ge=0;ge<j;ge++){const ie=V[ge],ue=Ni(V[ge+j]);for(let Te=0;Te<ie;Te++)se+=ue,Z[Q++]=se}return Z})(x,F.runs,F.numRleValues);x=ul(x,F.runs,F.numRleValues)}(function(F){F[0]=Ni(F[0]);const V=F.length/4*4;let j=1;if(V>=4)for(;j<V-4;j+=4){const X=F[j+1],Z=F[j+2],Q=F[j+3];F[j]=Ni(F[j])+F[j-1],F[j+1]=Ni(X)+F[j],F[j+2]=Ni(Z)+F[j+1],F[j+3]=Ni(Q)+F[j+2]}for(;j!=F.length;++j)F[j]=Ni(F[j])+F[j-1]})(x);break;case Xi.RLE:x=(function(F,V,j){return j?(function(X,Z,Q){if(Q===void 0){Q=0;for(let ie=0;ie<Z;ie++)Q+=X[ie]}const se=new Int32Array(Q);let ge=0;for(let ie=0;ie<Z;ie++){const ue=X[ie];let Te=X[ie+Z];Te=Ni(Te),se.fill(Te,ge,ge+ue),ge+=ue}return se})(F,V.runs,V.numRleValues):ul(F,V.runs,V.numRleValues)})(x,E,P);break;case Xi.MORTON:ah(x);break;case Xi.COMPONENTWISE_DELTA:(function(F){if(F.length<2)return;F[0]=Ni(F[0]),F[1]=Ni(F[1]);const V=F.length/4*4;let j=2;if(V>=4)for(;j<V-4;j+=4){const X=F[j+1],Z=F[j+2],Q=F[j+3];F[j]=Ni(F[j])+F[j-2],F[j+1]=Ni(X)+F[j-1],F[j+2]=Ni(Z)+F[j],F[j+3]=Ni(Q)+F[j+1]}for(;j!=F.length;j+=2)F[j]=Ni(F[j])+F[j-2],F[j+1]=Ni(F[j+1])+F[j-1]})(x);break;case Xi.NONE:P&&(function(F){for(let V=0;V<F.length;V++)F[V]=Ni(F[V])})(x);break;default:throw new Error(`The specified Logical level technique is not supported: ${E.logicalLevelTechnique1}`)}return B?fg(x,B,0):x})(dg(c,n,a),a,p,0,b)}function iu(c,n,a){return(function(p,_){if(_.logicalLevelTechnique1===Xi.DELTA&&_.logicalLevelTechnique2===Xi.NONE)return(function(b){const x=new Int32Array(b.length+1);x[0]=0,x[1]=Ni(b[0]);let E=x[1];for(let P=2;P!=x.length;++P)E+=Ni(b[P-1]),x[P]=x[P-1]+E;return new Uint32Array(x)})(p);if(_.logicalLevelTechnique1===Xi.RLE&&_.logicalLevelTechnique2===Xi.NONE)return(function(b,x,E){const P=new Int32Array(E+1);P[0]=0;let O=1,B=P[0];for(let F=0;F<x;F++){const V=b[F],j=b[F+x];for(let X=O;X<O+V;X++)P[X]=j+B,B=P[X];O+=V}return new Uint32Array(P)})(p,_.runs,_.numRleValues);if(_.logicalLevelTechnique1===Xi.NONE&&_.logicalLevelTechnique2===Xi.NONE){(function(x){let E=0;for(let P=0;P<x.length;P++)x[P]+=E,E=x[P]})(p);const b=new Uint32Array(_.numValues+1);return b[0]=0,b.set(p,1),b}if(_.logicalLevelTechnique1===Xi.DELTA&&_.logicalLevelTechnique2===Xi.RLE){const b=(function(x,E,P){const O=new Int32Array(P+1);O[0]=0;let B=1,F=O[0];for(let V=0;V<E;V++){const j=x[V];let X=x[V+E];X=Ni(X);for(let Z=B;Z<B+j;Z++)O[Z]=X+F,F=O[Z];B+=j}return new Uint32Array(O)})(p,_.runs,_.numRleValues);return ah(b),b}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(dg(c,n,a),a)}function dg(c,n,a){const p=a.physicalLevelTechnique;if(p===cl.FAST_PFOR)return(function(){throw new Error("FastPFor is not implemented yet.")})();if(p===cl.VARINT)return Or(c,n,a.numValues);if(p===cl.NONE){const _=n.get();n.add(a.byteLength);const b=c.subarray(_,n.get());return new Int32Array(b)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function qm(c,n,a,p){const _=dg(c,n,a);if(_.length===1){const b=_[0];return p?Ni(b):b}return p?(function(b){return Ni(b[1])})(_):(function(b){return b[1]})(_)}function Xm(c,n,a){return(function(p){if(p.length==2){const _=Ni(p[1]);return[_,_]}return[Ni(p[2]),Ni(p[3])]})(dg(c,n,a))}function oh(c,n,a){return(function(p){if(p.length==2){const _=Os(p[1]);return[_,_]}return[Os(p[2]),Os(p[3])]})(ug(c,n,a.numValues))}function df(c,n,a,p,_){return(function(b,x,E,P){switch(x.logicalLevelTechnique1){case Xi.DELTA:if(x.logicalLevelTechnique2===Xi.RLE){const O=x;if(!P)return(function(B,F,V){const j=new BigInt64Array(V);let X=0,Z=0n;for(let Q=0;Q<F;Q++){const se=Number(B[Q]),ge=Os(B[Q+F]);for(let ie=0;ie<se;ie++)Z+=ge,j[X++]=Z}return j})(b,O.runs,O.numRleValues);b=Py(b,O.runs,O.numRleValues)}(function(O){O[0]=Os(O[0]);const B=O.length/4*4;let F=1;if(B>=4)for(;F<B-4;F+=4){const V=O[F+1],j=O[F+2],X=O[F+3];O[F]=Os(O[F])+O[F-1],O[F+1]=Os(V)+O[F],O[F+2]=Os(j)+O[F+1],O[F+3]=Os(X)+O[F+2]}for(;F!=O.length;++F)O[F]=Os(O[F])+O[F-1]})(b);break;case Xi.RLE:b=(function(O,B,F){return F?(function(V,j,X){if(X===void 0){X=0;for(let se=0;se<j;se++)X+=Number(V[se])}const Z=new BigInt64Array(X);let Q=0;for(let se=0;se<j;se++){const ge=Number(V[se]);let ie=V[se+j];ie=Os(ie),Z.fill(ie,Q,Q+ge),Q+=ge}return Z})(O,B.runs,B.numRleValues):Py(O,B.runs,B.numRleValues)})(b,x,E);break;case Xi.NONE:E&&(function(O){for(let B=0;B<O.length;B++)O[B]=Os(O[B])})(b);break;default:throw new Error(`The specified Logical level technique is not supported: ${x.logicalLevelTechnique1}`)}return P?fg(b,P,0n):b})(ug(c,n,a.numValues),a,p,_)}function Gm(c,n,a,p){const _=ug(c,n,a.numValues);if(_.length===1){const b=_[0];return p?Os(b):b}return p?(function(b){return Os(b[1])})(_):(function(b){return b[1]})(_)}function pg(c,n,a,p){const _=c.logicalLevelTechnique1;if(_===Xi.RLE)return c.runs===1?In.CONST:In.FLAT;if(_!==Xi.DELTA||c.logicalLevelTechnique2!==Xi.RLE)return c.numValues===1?In.CONST:In.FLAT;const b=n instanceof Eo?n.size():n;if(c.numRleValues!==b)return In.FLAT;if(c.runs===1)return In.SEQUENCE;if(c.runs!==2)return c.numValues===1?In.CONST:In.FLAT;const x=p.get();let E;if(c.physicalLevelTechnique===cl.VARINT)E=Or(a,p,4);else{const P=p.get();E=new Int32Array(a.buffer,a.byteOffset+P,4)}return p.set(x),E[2]===2&&E[3]===2?In.SEQUENCE:c.numValues===1?In.CONST:In.FLAT}class lh extends lg{getValueFromBuffer(n){return this.dataBuffer[n]}}class pf extends $m{constructor(n,a,p,_){super(n,BigInt64Array.of(a),p,_)}getValueFromBuffer(n){return this.dataBuffer[0]+BigInt(n)*this.delta}}class ch{_geometryOffsets;_partOffsets;_ringOffsets;constructor(n,a,p){this._geometryOffsets=n,this._partOffsets=a,this._ringOffsets=p}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function gf(c,n,a){return{x:gg(c,n)-a,y:gg(c>>1,n)-a}}function gg(c,n){let a=0;for(let p=0;p<n;p++)a|=(c&1<<2*p)>>p;return a}(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON",c[c.MULTIPOINT=3]="MULTIPOINT",c[c.MULTILINESTRING=4]="MULTILINESTRING",c[c.MULTIPOLYGON=5]="MULTIPOLYGON"})(yr||(yr={})),(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON"})(wa||(wa={})),(function(c){c[c.MORTON=0]="MORTON",c[c.VEC_2=1]="VEC_2",c[c.VEC_3=2]="VEC_3"})(Ds||(Ds={}));class Zm{createPoint(n){return[[n]]}createMultiPoint(n){return n.map((a=>[a]))}createLineString(n){return[n]}createMultiLineString(n){return n}createPolygon(n,a){return[n].concat(a)}createMultiPolygon(n){return n.flat()}}function Sd(c){const n=new Array(c.numGeometries);let a=1,p=1,_=1,b=0;const x=new Zm;let E=0,P=0;const O=c.mortonSettings,B=c.topologyVector,F=B.geometryOffsets,V=B.partOffsets,j=B.ringOffsets,X=c.vertexOffsets,Z=c.containsPolygonGeometry(),Q=c.vertexBuffer;for(let se=0;se<c.numGeometries;se++){const ge=c.geometryType(se);if(ge===yr.POINT){if(X&&X.length!==0)if(c.vertexBufferType===Ds.VEC_2){const ie=2*X[P++],ue=new A(Q[ie],Q[ie+1]);n[b++]=x.createPoint(ue)}else{const ie=gf(Q[X[P++]],O.numBits,O.coordinateShift),ue=new A(ie.x,ie.y);n[b++]=x.createPoint(ue)}else{const ie=new A(Q[E++],Q[E++]);n[b++]=x.createPoint(ie)}F&&_++,V&&a++,j&&p++}else if(ge===yr.MULTIPOINT){const ie=F[_]-F[_-1];_++;const ue=new Array(ie);if(X&&X.length!==0){for(let Te=0;Te<ie;Te++){const Re=2*X[P++];ue[Te]=new A(Q[Re],Q[Re+1])}n[b++]=x.createMultiPoint(ue)}else{for(let Te=0;Te<ie;Te++){const Re=Q[E++],Ye=Q[E++];ue[Te]=new A(Re,Ye)}n[b++]=x.createMultiPoint(ue)}}else if(ge===yr.LINESTRING){let ie,ue=0;Z?(ue=j[p]-j[p-1],p++):ue=V[a]-V[a-1],a++,X&&X.length!==0?(ie=c.vertexBufferType===Ds.VEC_2?Ym(Q,X,P,ue,!1):Cd(Q,X,P,ue,!1,O),P+=ue):(ie=_g(Q,E,ue,!1),E+=2*ue),n[b++]=x.createLineString(ie),F&&_++}else if(ge===yr.POLYGON){const ie=V[a]-V[a-1];a++;const ue=new Array(ie-1);let Te=j[p]-j[p-1];if(p++,X&&X.length!==0){const Re=c.vertexBufferType===Ds.VEC_2?Ed(Q,X,P,Te):mg(Q,X,P,Te,0,O);P+=Te;for(let Ye=0;Ye<ue.length;Ye++)Te=j[p]-j[p-1],p++,ue[Ye]=c.vertexBufferType===Ds.VEC_2?Ed(Q,X,P,Te):mg(Q,X,P,Te,0,O),P+=Te;n[b++]=x.createPolygon(Re,ue)}else{const Re=Ad(Q,E,Te);E+=2*Te;for(let Ye=0;Ye<ue.length;Ye++)Te=j[p]-j[p-1],p++,ue[Ye]=Ad(Q,E,Te),E+=2*Te;n[b++]=x.createPolygon(Re,ue)}F&&_++}else if(ge===yr.MULTILINESTRING){const ie=F[_]-F[_-1];_++;const ue=new Array(ie);if(X&&X.length!==0){for(let Te=0;Te<ie;Te++){let Re=0;Z?(Re=j[p]-j[p-1],p++):Re=V[a]-V[a-1],a++;const Ye=c.vertexBufferType===Ds.VEC_2?Ym(Q,X,P,Re,!1):Cd(Q,X,P,Re,!1,O);ue[Te]=Ye,P+=Re}n[b++]=x.createMultiLineString(ue)}else{for(let Te=0;Te<ie;Te++){let Re=0;Z?(Re=j[p]-j[p-1],p++):Re=V[a]-V[a-1],a++,ue[Te]=_g(Q,E,Re,!1),E+=2*Re}n[b++]=x.createMultiLineString(ue)}}else{if(ge!==yr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ie=F[_]-F[_-1];_++;const ue=new Array(ie);let Te=0;if(X&&X.length!==0){for(let Re=0;Re<ie;Re++){const Ye=V[a]-V[a-1];a++;const ft=new Array(Ye-1);Te=j[p]-j[p-1],p++;const dt=c.vertexBufferType===Ds.VEC_2?Ed(Q,X,P,Te):mg(Q,X,P,Te,0,O);P+=Te;for(let bt=0;bt<ft.length;bt++)Te=j[p]-j[p-1],p++,ft[bt]=c.vertexBufferType===Ds.VEC_2?Ed(Q,X,P,Te):mg(Q,X,P,Te,0,O),P+=Te;ue[Re]=x.createPolygon(dt,ft)}n[b++]=x.createMultiPolygon(ue)}else{for(let Re=0;Re<ie;Re++){const Ye=V[a]-V[a-1];a++;const ft=new Array(Ye-1);Te=j[p]-j[p-1],p++;const dt=Ad(Q,E,Te);E+=2*Te;for(let bt=0;bt<ft.length;bt++){const Bt=j[p]-j[p-1];p++,ft[bt]=Ad(Q,E,Bt),E+=2*Bt}ue[Re]=x.createPolygon(dt,ft)}n[b++]=x.createMultiPolygon(ue)}}}}return n}function Ad(c,n,a){return _g(c,n,a,!0)}function Ed(c,n,a,p){return Ym(c,n,a,p,!0)}function mg(c,n,a,p,_,b){return Cd(c,n,a,p,!0,b)}function _g(c,n,a,p){const _=new Array(p?a+1:a);for(let b=0;b<2*a;b+=2)_[b/2]=new A(c[n+b],c[n+b+1]);return p&&(_[_.length-1]=_[0]),_}function Ym(c,n,a,p,_){const b=new Array(_?p+1:p);for(let x=0;x<2*p;x+=2){const E=2*n[a+x/2];b[x/2]=new A(c[E],c[E+1])}return _&&(b[b.length-1]=b[0]),b}function Cd(c,n,a,p,_,b){const x=new Array(_?p+1:p);for(let E=0;E<p;E++){const P=gf(c[n[a+E]],b.numBits,b.coordinateShift);x[E]=new A(P.x,P.y)}return _&&(x[x.length-1]=x[0]),x}class Ry{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(n,a,p,_,b){this._vertexBufferType=n,this._topologyVector=a,this._vertexOffsets=p,this._vertexBuffer=_,this._mortonSettings=b}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const n=Sd(this);let a=0;for(;a<this.numGeometries;)yield{coordinates:n[a],type:this.geometryType(a)},a++}getSimpleEncodedVertex(n){const a=this.vertexOffsets?2*this.vertexOffsets[n]:2*n;return[this.vertexBuffer[a],this.vertexBuffer[a+1]]}getVertex(n){if(this.vertexOffsets&&this.mortonSettings){const p=gf(this.vertexBuffer[this.vertexOffsets[n]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[p.x,p.y]}const a=this.vertexOffsets?2*this.vertexOffsets[n]:2*n;return[this.vertexBuffer[a],this.vertexBuffer[a+1]]}getGeometries(){return Sd(this)}get mortonSettings(){return this._mortonSettings}}class Md extends Ry{_numGeometries;_geometryType;constructor(n,a,p,_,b,x,E){super(p,_,b,x,E),this._numGeometries=n,this._geometryType=a}geometryType(n){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===yr.POLYGON||this._geometryType===yr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Pd extends Ry{_geometryTypes;constructor(n,a,p,_,b,x){super(n,p,_,b,x),this._geometryTypes=a}geometryType(n){return this._geometryTypes[n]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let n=0;n<this.numGeometries;n++)if(this.geometryType(n)===yr.POLYGON||this.geometryType(n)===yr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Id{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(n,a,p,_){this._triangleOffsets=n,this._indexBuffer=a,this._vertexBuffer=p,this._topologyVector=_}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const n=new Array(this.numGeometries),a=this._topologyVector,p=a.partOffsets,_=a.ringOffsets,b=a.geometryOffsets;let x=0,E=1,P=1,O=1;for(let B=0;B<this.numGeometries;B++)switch(this.geometryType(B)){case yr.POLYGON:{const F=p[E]-p[E-1];E++;const V=[];for(let j=0;j<F;j++){const X=_[P]-_[P-1];P++;const Z=[];for(let Q=0;Q<X;Q++){const se=this._vertexBuffer[x++],ge=this._vertexBuffer[x++];Z.push(new A(se,ge))}Z.length>0&&Z.push(Z[0]),V.push(Z)}n[B]=V,b&&O++}break;case yr.MULTIPOLYGON:{const F=b[O]-b[O-1];O++;const V=[];for(let j=0;j<F;j++){const X=p[E]-p[E-1];E++;for(let Z=0;Z<X;Z++){const Q=_[P]-_[P-1];P++;const se=[];for(let ge=0;ge<Q;ge++){const ie=this._vertexBuffer[x++],ue=this._vertexBuffer[x++];se.push(new A(ie,ue))}se.length>0&&se.push(se[0]),V.push(se)}}n[B]=V}}return n}[Symbol.iterator](){return null}}function Dy(c,n,a,p,_,b){return new Rd(c,n,a,p,_,b)}class Rd extends Id{_numGeometries;_geometryType;constructor(n,a,p,_,b,x){super(p,_,b,x),this._numGeometries=n,this._geometryType=a}geometryType(n){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Oy(c,n,a,p,_){return new ky(c,n,a,p,_)}class ky extends Id{_geometryTypes;constructor(n,a,p,_,b){super(a,p,_,b),this._geometryTypes=n}geometryType(n){return this._geometryTypes[n]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function Ly(c,n,a,p,_){const b=ls(c,a);let x=null,E=null,P=null,O=null;if(pg(b,p,c,a)===In.CONST){const ge=qm(c,a,b,!1);let ie=null,ue=null,Te=null,Re=null;for(let Ye=0;Ye<n-1;Ye++){const ft=ls(c,a);switch(ft.physicalStreamType){case Dr.LENGTH:switch(ft.logicalStreamType.lengthType){case os.GEOMETRIES:ie=iu(c,a,ft);break;case os.PARTS:ue=iu(c,a,ft);break;case os.RINGS:Te=iu(c,a,ft);break;case os.TRIANGLES:Re=iu(c,a,ft)}break;case Dr.OFFSET:switch(ft.logicalStreamType.offsetType){case tu.VERTEX:x=cs(c,a,ft,!1);break;case tu.INDEX:O=cs(c,a,ft,!1)}break;case Dr.DATA:Ao.VERTEX===ft.logicalStreamType.dictionaryType?E=cs(c,a,ft,!0):(P={numBits:ft.numBits,coordinateShift:ft.coordinateShift},E=cs(c,a,ft,!1))}}return O!==null?ie!=null||ue!=null?Dy(p,ge,Re,O,E,new ch(ie,ue,Te)):Dy(p,ge,Re,O,E):P===null?(function(Ye,ft,dt,bt,Bt){return new Md(Ye,ft,Ds.VEC_2,dt,bt,Bt)})(p,ge,new ch(ie,ue,Te),x,E):(function(Ye,ft,dt,bt,Bt,At){return new Md(Ye,ft,Ds.MORTON,dt,bt,Bt,At)})(p,ge,new ch(ie,ue,Te),x,E,P)}const B=cs(c,a,b,!1);let F=null,V=null,j=null,X=null;for(let ge=0;ge<n-1;ge++){const ie=ls(c,a);switch(ie.physicalStreamType){case Dr.LENGTH:switch(ie.logicalStreamType.lengthType){case os.GEOMETRIES:F=cs(c,a,ie,!1);break;case os.PARTS:V=cs(c,a,ie,!1);break;case os.RINGS:j=cs(c,a,ie,!1);break;case os.TRIANGLES:X=iu(c,a,ie)}break;case Dr.OFFSET:switch(ie.logicalStreamType.offsetType){case tu.VERTEX:x=cs(c,a,ie,!1);break;case tu.INDEX:O=cs(c,a,ie,!1)}break;case Dr.DATA:Ao.VERTEX===ie.logicalStreamType.dictionaryType?E=cs(c,a,ie,!0):(P={numBits:ie.numBits,coordinateShift:ie.coordinateShift},E=cs(c,a,ie,!1))}}let Z=null,Q=null,se=null;return F!==null?(Z=yg(B,F,2),V!==null&&j!==null?(Q=Km(B,Z,V,!1),se=(function(ge,ie,ue,Te){const Re=new Uint32Array(ue[ue.length-1]+1);let Ye=0;Re[0]=Ye;let ft=1,dt=1,bt=0;for(let Bt=0;Bt<ge.length;Bt++){const At=ge[Bt],pt=ie[Bt+1]-ie[Bt];if(At!==0&&At!==3)for(let ct=0;ct<pt;ct++){const Vt=ue[ft]-ue[ft-1];ft++;for(let qt=0;qt<Vt;qt++)Ye=Re[dt++]=Ye+Te[bt++]}else for(let ct=0;ct<pt;ct++)Re[dt++]=++Ye,ft++}return Re})(B,Z,Q,j)):V!==null&&(Q=(function(ge,ie,ue){const Te=new Uint32Array(ie[ie.length-1]+1);let Re=0;Te[0]=Re;let Ye=1,ft=0;for(let dt=0;dt<ge.length;dt++){const bt=ge[dt],Bt=ie[dt+1]-ie[dt];if(bt===4||bt===1)for(let At=0;At<Bt;At++)Re=Te[Ye++]=Re+ue[ft++];else for(let At=0;At<Bt;At++)Te[Ye++]=++Re}return Te})(B,Z,V))):V!==null&&j!==null?(Q=yg(B,V,1),se=Km(B,Q,j,!0)):V!==null&&(Q=yg(B,V,0)),O!==null&&Q===null?Oy(B,X,O,E):O!==null?Oy(B,X,O,E,new ch(Z,Q,se)):P===null?(function(ge,ie,ue,Te){return new Pd(Ds.VEC_2,ge,ie,ue,Te)})(B,new ch(Z,Q,se),x,E):(function(ge,ie,ue,Te,Re){return new Pd(Ds.MORTON,ge,ie,ue,Te,Re)})(B,new ch(Z,Q,se),x,E,P)}function yg(c,n,a){const p=new Uint32Array(c.length+1);let _=0;p[0]=_;let b=0;for(let x=0;x<c.length;x++)_=p[x+1]=_+(c[x]>a?n[b++]:1);return p}function Km(c,n,a,p){const _=new Uint32Array(n[n.length-1]+1);let b=0;_[0]=b;let x=1,E=0;for(let P=0;P<c.length;P++){const O=c[P],B=n[P+1]-n[P];if(O===5||O===2||p&&(O===4||O===1))for(let F=0;F<B;F++)b=_[x++]=b+a[E++];else for(let F=0;F<B;F++)_[x++]=++b}return _}class Qm extends Jc{dataVector;constructor(n,a,p){super(n,a.getBuffer(),p),this.dataVector=a}getValueFromBuffer(n){return this.dataVector.get(n)}}class By extends lg{getValueFromBuffer(n){return this.dataBuffer[n]}}class Jm extends Jc{constructor(n,a,p){super(n,BigInt64Array.of(a),p)}getValueFromBuffer(n){return this.dataBuffer[0]}}function nu(c,n,a,p,_){const b=(function(x,E,P,O){const B=new Uint8Array(E);let F=0;const V=O.get()+P;for(;F<E&&!(O.get()>=V);){const j=x[O.increment()];if(j<=127){const X=j+3,Z=x[O.increment()],Q=Math.min(F+X,E);B.fill(Z,F,Q),F=Q}else{const X=256-j;for(let Z=0;Z<X&&F<E;Z++)B[F++]=x[O.increment()]}}return O.set(V),B})(c,Math.ceil(n/8),a,p);return _?(function(x,E,P){if(!P)return x;const O=P.size(),B=new Eo(x,E),F=new Eo(new Uint8Array(Math.ceil(O/8)),O);let V=0;for(let j=0;j<O;j++){const X=!!P.get(j)&&B.get(V++);F.set(j,X)}return F.getBuffer()})(b,n,_):b}const m0=new TextDecoder;function e_(c,n,a){return a-n>=12?m0.decode(c.subarray(n,a)):(function(p,_,b){let x="",E=_;for(;E<b;){const P=p[E];let O,B,F,V=null,j=P>239?4:P>223?3:P>191?2:1;if(E+j>b)break;j===1?P<128&&(V=P):j===2?(O=p[E+1],(192&O)==128&&(V=(31&P)<<6|63&O,V<=127&&(V=null))):j===3?(O=p[E+1],B=p[E+2],(192&O)==128&&(192&B)==128&&(V=(15&P)<<12|(63&O)<<6|63&B,(V<=2047||V>=55296&&V<=57343)&&(V=null))):j===4&&(O=p[E+1],B=p[E+2],F=p[E+3],(192&O)==128&&(192&B)==128&&(192&F)==128&&(V=(15&P)<<18|(63&O)<<12|(63&B)<<6|63&F,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,j=1):V>65535&&(V-=65536,x+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),x+=String.fromCharCode(V),E+=j}return x})(c,n,a)}class Dd extends Jc{offsetBuffer;constructor(n,a,p,_){super(n,p,_),this.offsetBuffer=a}}class vg extends Dd{textEncoder;constructor(n,a,p,_){super(n,a,p,_??a.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(n){return e_(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class nc extends Dd{indexBuffer;textEncoder;constructor(n,a,p,_,b){super(n,p,_,b??a.length),this.indexBuffer=a,this.indexBuffer=a,this.textEncoder=new TextEncoder}getValueFromBuffer(n){const a=this.indexBuffer[n];return e_(this.dataBuffer,this.offsetBuffer[a],this.offsetBuffer[a+1])}}class bg extends Dd{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(n,a,p,_,b,x,E){super(n,p,_,E),this.indexBuffer=a,this.symbolOffsetBuffer=b,this.symbolTableBuffer=x,this.textEncoder=new TextEncoder}getValueFromBuffer(n){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(p,_,b){const x=[],E=new Array(_.length).fill(0);for(let P=1;P<_.length;P++)E[P]=E[P-1]+_[P-1];for(let P=0;P<b.length;P++)if(b[P]===255)x.push(b[++P]);else{const O=_[b[P]],B=E[b[P]];for(let F=0;F<O;F++)x.push(p[B+F])}return new Uint8Array(x)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const a=this.indexBuffer[n];return e_(this.decodedDictionary,this.offsetBuffer[a],this.offsetBuffer[a+1])}offsetToLengthBuffer(n){const a=new Uint32Array(n.length-1);let p=n[0];for(let _=1;_<n.length;_++){const b=n[_];a[_-1]=b-p,p=b}return a}}function zy(c,n,a,p,_,b){return a.type==="scalarType"?(function(x,E,P,O,B,F){let V=null,j=0;if(x===0)return null;if(F.nullable){const Z=ls(E,P);j=Z.numValues;const Q=P.get(),se=nu(E,j,Z.byteLength,P);P.set(Q+Z.byteLength),V=new Eo(se,Z.numValues)}const X=V??O;switch(B.physicalType){case 4:case 3:return(function(Z,Q,se,ge,ie){const ue=ls(Z,Q),Te=pg(ue,ie,Z,Q),Re=ge.physicalType===3;if(Te===In.FLAT){const Ye=cs(Z,Q,ue,Re,0,uh(ie)?ie:void 0);return new cg(se.name,Ye,ie)}if(Te===In.SEQUENCE){const Ye=Xm(Z,Q,ue);return new Hm(se.name,Ye[0],Ye[1],ue.numRleValues)}{const Ye=qm(Z,Q,ue,Re);return new Wm(se.name,Ye,ie)}})(E,P,F,B,X);case 9:return(function(Z,Q,se,ge,ie){let ue=null,Te=null,Re=null,Ye=null,ft=null,dt=null,bt=null,Bt=null;for(let At=0;At<ge;At++){const pt=ls(Q,se);if(pt.byteLength!==0)switch(pt.physicalStreamType){case Dr.PRESENT:{const ct=nu(Q,pt.numValues,pt.byteLength,se);dt=new Eo(ct,pt.numValues);break}case Dr.OFFSET:Te=cs(Q,se,pt,!1,0,ie!=null||dt!=null?ie??dt:void 0);break;case Dr.LENGTH:{const ct=iu(Q,se,pt);os.DICTIONARY===pt.logicalStreamType.lengthType?ue=ct:os.SYMBOL===pt.logicalStreamType.lengthType?Ye=ct:bt=ct;break}case Dr.DATA:{const ct=Q.subarray(se.get(),se.get()+pt.byteLength);se.add(pt.byteLength);const Vt=pt.logicalStreamType.dictionaryType;Ao.FSST===Vt?ft=ct:Ao.SINGLE===Vt||Ao.SHARED===Vt?Re=ct:Ao.NONE===Vt&&(Bt=ct);break}}}return(function(At,pt,ct,Vt,qt,Kt,Gt){return pt?new bg(At,ct,Vt,qt,Kt,pt,Gt):null})(Z,ft,Te,ue,Re,Ye,ie??dt)??(function(At,pt,ct,Vt,qt){return pt?qt?new nc(At,ct,Vt,pt,qt):new nc(At,ct,Vt,pt):null})(Z,Re,Te,ue,ie??dt)??(function(At,pt,ct,Vt,qt){if(!pt||!ct)return null;if(Vt)return qt?new nc(At,Vt,pt,ct,qt):new nc(At,Vt,pt,ct);if(qt&&qt.size()!==pt.length-1){const Kt=new Int32Array(qt.size());let Gt=0;for(let wi=0;wi<qt.size();wi++)Kt[wi]=qt.get(wi)?Gt++:0;return new nc(At,Kt,pt,ct,qt)}return qt?new vg(At,pt,ct,qt):new vg(At,pt,ct)})(Z,bt,Bt,Te,ie??dt)})(F.name,E,P,F.nullable?x-1:x,V);case 0:return(function(Z,Q,se,ge,ie){const ue=ls(Z,Q),Te=ue.numValues,Re=Q.get(),Ye=uh(ie)?ie:void 0,ft=nu(Z,Te,ue.byteLength,Q,Ye);Q.set(Re+ue.byteLength);const dt=new Eo(ft,Te);return new Qm(se.name,dt,ie)})(E,P,F,0,X);case 6:case 5:return(function(Z,Q,se,ge,ie){const ue=ls(Z,Q),Te=pg(ue,ge,Z,Q),Re=ie.physicalType===5;if(Te===In.FLAT){const Ye=df(Z,Q,ue,Re,uh(ge)?ge:void 0);return new lh(se.name,Ye,ge)}if(Te===In.SEQUENCE){const Ye=oh(Z,Q,ue);return new pf(se.name,Ye[0],Ye[1],ue.numRleValues)}{const Ye=Gm(Z,Q,ue,Re);return new Jm(se.name,Ye,ge)}})(E,P,F,X,B);case 7:return(function(Z,Q,se,ge){const ie=ls(Z,Q),ue=uh(ge)?ge:void 0,Te=(function(Re,Ye,ft,dt){const bt=Ye.get(),Bt=bt+ft*Float32Array.BYTES_PER_ELEMENT,At=new Uint8Array(Re.subarray(bt,Bt)).buffer,pt=new Float32Array(At);return Ye.set(Bt),dt?fg(pt,dt,0):pt})(Z,Q,ie.numValues,ue);return new By(se.name,Te,ge)})(E,P,F,X);case 8:return(function(Z,Q,se,ge){const ie=ls(Z,Q),ue=uh(ge)?ge:void 0,Te=(function(Re,Ye,ft,dt){const bt=Ye.get(),Bt=bt+ft*Float64Array.BYTES_PER_ELEMENT,At=new Uint8Array(Re.subarray(bt,Bt)).buffer,pt=new Float64Array(At);return Ye.set(Bt),dt?fg(pt,dt,0):pt})(Z,Q,ie.numValues,ue);return new jm(se.name,Te,ge)})(E,P,F,X);default:throw new Error(`The specified data type for the field is currently not supported: ${B}`)}})(p,c,n,_,a.scalarType,a):p===0?null:(function(x,E,P,O){let B=null,F=null,V=null,j=null,X=!1;for(;!X;){const ge=ls(x,E);switch(ge.physicalStreamType){case Dr.LENGTH:os.DICTIONARY===ge.logicalStreamType.lengthType?B=iu(x,E,ge):V=iu(x,E,ge);break;case Dr.DATA:Ao.SINGLE===ge.logicalStreamType.dictionaryType||Ao.SHARED===ge.logicalStreamType.dictionaryType?(F=x.subarray(E.get(),E.get()+ge.byteLength),X=!0):j=x.subarray(E.get(),E.get()+ge.byteLength),E.add(ge.byteLength)}}const Z=P.complexType.children,Q=[];let se=0;for(const ge of Z){const ie=Or(x,E,1)[0];if(ie==0)continue;const ue=ge.name?`${P.name}${ge.name}`:P.name;if(ie!==2||ge.type!=="scalarField"||ge.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const Te=ls(x,E),Re=nu(x,Te.numValues,Te.byteLength,E),Ye=ls(x,E),ft=cs(x,E,Ye,!1,0,Ye.decompressedCount!==O?new Eo(Re,Te.numValues):void 0);Q[se++]=j?new bg(ue,ft,B,F,V,j,new Eo(Re,Te.numValues)):new nc(ue,ft,B,F,new Eo(Re,Te.numValues))}return Q})(c,n,a,_)}function uh(c){return c instanceof Eo}function rc(c){switch(c){case 0:case 1:case 2:case 3:{const n={};n.nullable=!!(1&c),n.columnScope=0;const a={};return a.physicalType=c>1?6:4,a.type="physicalType",n.scalarType=a,n.type="scalarType",n}case 4:{const n={nullable:!1,columnScope:0},a={type:"physicalType",physicalType:0};return n.type="complexType",n.complexType=a,n}case 30:{const n={nullable:!1,columnScope:0},a={type:"physicalType",physicalType:1};return n.type="complexType",n.complexType=a,n}default:return(function(n){let a=null;switch(n){case 10:case 11:a=0;break;case 12:case 13:a=1;break;case 14:case 15:a=2;break;case 16:case 17:a=3;break;case 18:case 19:a=4;break;case 20:case 21:a=5;break;case 22:case 23:a=6;break;case 24:case 25:a=7;break;case 26:case 27:a=8;break;case 28:case 29:a=9;break;default:return null}const p={};p.nullable=!!(1&n),p.columnScope=0;const _={type:"physicalType"};return _.physicalType=a,p.type="scalarType",p.scalarType=_,p})(c)}}function sc(c){return c>=10}function ac(c){return c===30}function Od(c){if(c.name==="id")return!1;if(c.type==="scalarType"){const n=c.scalarType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(n.type==="logicalType")return!1}else if(c.type==="complexType"){const n=c.complexType;if(n.type==="physicalType")switch(n.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",c),!1}const kd=new TextDecoder;function hl(c,n){const a=Or(c,n,1)[0];if(a===0)return"";const p=n.get(),_=c.subarray(p,p+a);return n.add(a),kd.decode(_)}function Fy(c,n){const a=Or(c,n,1)[0]>>>0;if(a<10||a>30)throw new Error(`Unsupported field type code ${a}. Supported: 10-29(scalars), 30(STRUCT)`);const p=rc(a);if(sc(a)&&(p.name=hl(c,n)),ac(a)){const _=Or(c,n,1)[0]>>>0;p.complexType.children=new Array(_);for(let b=0;b<_;b++)p.complexType.children[b]=Fy(c,n)}return(function(_){return{name:_.name,nullable:_.nullable,scalarField:_.scalarType,complexField:_.complexType,type:_.type==="scalarType"?"scalarField":"complexField"}})(p)}function Ny(c,n){const a=Or(c,n,1)[0]>>>0,p=rc(a);if(!p)throw new Error(`Unsupported column type code ${a}. Supported: 0-3(ID), 4(GEOMETRY), 10-29(scalars), 30(STRUCT)`);if(sc(a)?p.name=hl(c,n):a>=0&&a<=3?p.name="id":a===4&&(p.name="geometry"),ac(a)){const _=Or(c,n,1)[0]>>>0,b=p.complexType;b.children=new Array(_);for(let x=0;x<_;x++)b.children[x]=Fy(c,n)}return p}function Ld(c,n){const a={featureTables:[]},p={};p.name=hl(c,n);const _=Or(c,n,1)[0]>>>0,b=Or(c,n,1)[0]>>>0;p.columns=new Array(b);for(let x=0;x<b;x++)p.columns[x]=Ny(c,n);return a.featureTables.push(p),[a,_]}function _0(c,n,a,p,_,b,x=!1){const E=n.scalarType.physicalType,P=pg(_,b,c,a);if(E===4)switch(P){case In.FLAT:{const O=cs(c,a,_,!1);return new cg(p,O,b)}case In.SEQUENCE:{const O=Xm(c,a,_);return new Hm(p,O[0],O[1],_.numRleValues)}case In.CONST:{const O=qm(c,a,_,!1);return new Wm(p,O,b)}}else switch(P){case In.FLAT:{if(x){const B=(function(F,V,j){const X=(function(Z,Q,se){const ge=new Float64Array(se);for(let ie=0;ie<se;ie++)ge[ie]=Td(Z,Q);return ge})(F,V,j.numValues);return(function(Z,Q){switch(Q.logicalLevelTechnique1){case Xi.DELTA:return Q.logicalLevelTechnique2===Xi.RLE&&(Z=Iy(Z,Q.runs,Q.numRleValues)),(function(se){se[0]=ic(se[0]);const ge=se.length/4*4;let ie=1;if(ge>=4)for(;ie<ge-4;ie+=4){const ue=se[ie+1],Te=se[ie+2],Re=se[ie+3];se[ie]=ic(se[ie])+se[ie-1],se[ie+1]=ic(ue)+se[ie],se[ie+2]=ic(Te)+se[ie+1],se[ie+3]=ic(Re)+se[ie+2]}for(;ie!=se.length;++ie)se[ie]=ic(se[ie])+se[ie-1]})(Z),Z;case Xi.RLE:return(function(se,ge){return Iy(se,ge.runs,ge.numRleValues)})(Z,Q);case Xi.NONE:return Z;default:throw new Error(`The specified Logical level technique is not supported: ${Q.logicalLevelTechnique1}`)}})(X,j)})(c,a,_);return new jm(p,B,b)}const O=df(c,a,_,!1);return new lh(p,O,b)}case In.SEQUENCE:{const O=oh(c,a,_);return new pf(p,O[0],O[1],_.numRleValues)}case In.CONST:{const O=Gm(c,a,_,!1);return new Jm(p,O,b)}}throw new Error("Vector type not supported for id column.")}class Uy{constructor(n,a){var p;switch(this._featureData=n,this.properties=this._featureData.properties||{},(p=this._featureData.geometry)===null||p===void 0?void 0:p.type){case yr.POINT:case yr.MULTIPOINT:this.type=1;break;case yr.LINESTRING:case yr.MULTILINESTRING:this.type=2;break;case yr.POLYGON:case yr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=a,this.id=Number(this._featureData.id)}loadGeometry(){const n=[];for(const a of this._featureData.geometry.coordinates){const p=[];for(const _ of a)p.push(new A(_.x,_.y));n.push(p)}return n}}class xg{constructor(n){this.features=[],this.featureTable=n,this.name=n.name,this.extent=n.extent,this.version=2,this.features=n.getFeatures(),this.length=this.features.length}feature(n){return new Uy(this.features[n],this.extent)}}class t_{constructor(n){this.layers={};const a=(function(p,_,b=!0){const x=new Cy(0),E=[];for(;x.get()<p.length;){const P=Or(p,x,1)[0]>>>0,O=x.get()+P;if(O>p.length)throw new Error(`Block overruns tile: ${O} > ${p.length}`);if(Or(p,x,1)[0]>>>0!=1){x.set(O);continue}const B=Ld(p,x),F=B[1],V=B[0].featureTables[0];let j=null,X=null;const Z=[];let Q=0;for(const ge of V.columns){const ie=ge.name;if(ie==="id"){let ue=null;if(ge.nullable){const Re=ls(p,x),Ye=x.get(),ft=nu(p,Re.numValues,Re.byteLength,x);x.set(Ye+Re.byteLength),ue=new Eo(ft,Re.numValues)}const Te=ls(p,x);Q=Te.decompressedCount,j=_0(p,ge,x,ie,Te,ue??Q,b)}else if(ie==="geometry"){const ue=Or(p,x,1)[0];if(Q===0){const Te=x.get();Q=ls(p,x).decompressedCount,x.set(Te)}X=Ly(p,ue,x,Q)}else{const ue=Od(ge)?Or(p,x,1)[0]:1;if(ue===0)continue;const Te=zy(p,x,ge,ue,Q);if(Te)if(Array.isArray(Te))for(const Re of Te)Z.push(Re);else Z.push(Te)}}const se=new eu(V.name,X,j,Z,F);E.push(se),x.set(O)}return E})(new Uint8Array(n));this.layers=a.reduce(((p,_)=>Object.assign(Object.assign({},p),{[_.name]:new xg(_)})),{})}}class y0{constructor(n,a){this.feature=n,this.type=n.type,this.properties=n.tags?n.tags:{},this.extent=a,"id"in n&&(typeof n.id=="string"?this.id=parseInt(n.id,10):typeof n.id!="number"||isNaN(n.id)||(this.id=n.id))}loadGeometry(){const n=[],a=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const p of a){const _=[];for(const b of p)_.push(new A(b[0],b[1]));n.push(_)}return n}}const ru="_geojsonTileLayer";function wg(c,n){n.writeVarintField(15,c.version||1),n.writeStringField(1,c.name||""),n.writeVarintField(5,c.extent||4096);const a={keys:[],values:[],keycache:{},valuecache:{}};for(let b=0;b<c.length;b++)a.feature=c.feature(b),n.writeMessage(2,Vy,a);const p=a.keys;for(const b of p)n.writeStringField(3,b);const _=a.values;for(const b of _)n.writeMessage(4,jy,b)}function Vy(c,n){if(!c.feature)return;const a=c.feature;a.id!==void 0&&n.writeVarintField(1,a.id),n.writeMessage(2,mf,c),n.writeVarintField(3,a.type),n.writeMessage(4,Ag,a)}function mf(c,n){for(const a in c.feature?.properties){let p=c.feature.properties[a],_=c.keycache[a];if(p==null)continue;_===void 0&&(c.keys.push(a),_=c.keys.length-1,c.keycache[a]=_),n.writeVarint(_),typeof p!="string"&&typeof p!="boolean"&&typeof p!="number"&&(p=JSON.stringify(p));const b=typeof p+":"+p;let x=c.valuecache[b];x===void 0&&(c.values.push(p),x=c.values.length-1,c.valuecache[b]=x),n.writeVarint(x)}}function Tg(c,n){return(n<<3)+(7&c)}function Sg(c){return c<<1^c>>31}function Ag(c,n){const a=c.loadGeometry(),p=c.type;let _=0,b=0;for(const x of a){let E=1;p===1&&(E=x.length),n.writeVarint(Tg(1,E));const P=p===3?x.length-1:x.length;for(let O=0;O<P;O++){O===1&&p!==1&&n.writeVarint(Tg(2,P-1));const B=x[O].x-_,F=x[O].y-b;n.writeVarint(Sg(B)),n.writeVarint(Sg(F)),_+=B,b+=F}c.type===3&&n.writeVarint(Tg(7,1))}}function jy(c,n){const a=typeof c;a==="string"?n.writeStringField(1,c):a==="boolean"?n.writeBooleanField(7,c):a==="number"&&(c%1!=0?n.writeDoubleField(3,c):c<0?n.writeSVarintField(6,c):n.writeVarintField(5,c))}class $y{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Jo(Be,16,0),this.grid3D=new Jo(Be,16,0),this.featureIndexArray=new te,this.promoteId=a}insert(n,a,p,_,b,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,_,b);const P=x?this.grid3D:this.grid;for(let O=0;O<a.length;O++){const B=a[O],F=[1/0,1/0,-1/0,-1/0];for(let V=0;V<B.length;V++){const j=B[V];F[0]=Math.min(F[0],j.x),F[1]=Math.min(F[1],j.y),F[2]=Math.max(F[2],j.x),F[3]=Math.max(F[3],j.y)}F[0]<Be&&F[1]<Be&&F[2]>=0&&F[3]>=0&&P.insert(E,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Oi(new Xp(this.rawTileData)).layers:new t_(this.rawTileData).layers,this.sourceLayerCoder=new Vm(this.vtLayers?Object.keys(this.vtLayers).sort():[ru])),this.vtLayers}query(n,a,p,_){this.loadVTLayers();const b=n.params,x=Be/n.tileSize/n.scale,E=es(b.filter,b.globalState),P=n.queryGeometry,O=n.queryPadding*x,B=Qc.fromPoints(P),F=this.grid.query(B.minX-O,B.minY-O,B.maxX+O,B.maxY+O),V=Qc.fromPoints(n.cameraQueryGeometry).expandBy(O),j=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,((Q,se,ge,ie)=>(function(ue,Te,Re,Ye,ft){for(const bt of ue)if(Te<=bt.x&&Re<=bt.y&&Ye>=bt.x&&ft>=bt.y)return!0;const dt=[new A(Te,Re),new A(Te,ft),new A(Ye,ft),new A(Ye,Re)];if(ue.length>2){for(const bt of dt)if(rl(ue,bt))return!0}for(let bt=0;bt<ue.length-1;bt++)if(W_(ue[bt],ue[bt+1],dt))return!0;return!1})(n.cameraQueryGeometry,Q-O,se-O,ge+O,ie+O)));for(const Q of j)F.push(Q);F.sort(u);const X={};let Z;for(let Q=0;Q<F.length;Q++){const se=F[Q];if(se===Z)continue;Z=se;const ge=this.featureIndexArray.get(se);let ie=null;this.loadMatchingFeature(X,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,E,b.layers,b.availableImages,a,p,_,((ue,Te,Re)=>(ie||(ie=xo(ue)),Te.queryIntersectsFeature({queryGeometry:P,feature:ue,featureState:Re,geometry:ie,zoom:this.z,transform:n.transform,pixelsToTileUnits:x,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation}))))}return X}loadMatchingFeature(n,a,p,_,b,x,E,P,O,B,F){const V=this.bucketLayerIDs[a];if(x&&!V.some((Q=>x.has(Q))))return;const j=this.sourceLayerCoder.decode(p),X=this.vtLayers[j].feature(_);if(b.needGeometry){const Q=va(X,!0);if(!b.filter(new Wi(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!b.filter(new Wi(this.tileID.overscaledZ),X))return;const Z=this.getId(X,j);for(let Q=0;Q<V.length;Q++){const se=V[Q];if(x&&!x.has(se))continue;const ge=P[se];if(!ge)continue;let ie={};Z&&B&&(ie=B.getState(ge.sourceLayer||ru,Z));const ue=Qt({},O[se]);ue.paint=Bd(ue.paint,ge.paint,X,ie,E),ue.layout=Bd(ue.layout,ge.layout,X,ie,E);const Te=!F||F(X,ge,ie);if(!Te)continue;const Re=new og(X,this.z,this.x,this.y,Z);Re.layer=ue;let Ye=n[se];Ye===void 0&&(Ye=n[se]=[]),Ye.push({featureIndex:_,feature:Re,intersectionZ:Te})}}lookupSymbolFeatures(n,a,p,_,b,x,E,P){const O={};this.loadVTLayers();const B=es(b.filterSpec,b.globalState);for(const F of n)this.loadMatchingFeature(O,p,_,F,B,x,E,P,a);return O}hasLayer(n){for(const a of this.bucketLayerIDs)for(const p of a)if(n===p)return!0;return!1}getId(n,a){var p;let _=n.id;return this.promoteId&&(_=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((p=n.properties)===null||p===void 0)&&p.cluster)&&this.promoteId&&(_=Number(n.properties.cluster_id))),_}}function Bd(c,n,a,p,_){return Mi(c,((b,x)=>{const E=n instanceof Ul?n.get(x):null;return E&&E.evaluate?E.evaluate(a,p,_):E}))}function u(c,n){return n-c}function f(c,n,a,p,_){const b=[];for(let x=0;x<c.length;x++){const E=c[x];let P;for(let O=0;O<E.length-1;O++){let B=E[O],F=E[O+1];B.x<n&&F.x<n||(B.x<n?B=new A(n,B.y+(n-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x<n&&(F=new A(n,B.y+(n-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y<a&&F.y<a||(B.y<a?B=new A(B.x+(a-B.y)/(F.y-B.y)*(F.x-B.x),a)._round():F.y<a&&(F=new A(B.x+(a-B.y)/(F.y-B.y)*(F.x-B.x),a)._round()),B.x>=p&&F.x>=p||(B.x>=p?B=new A(p,B.y+(p-B.x)/(F.x-B.x)*(F.y-B.y))._round():F.x>=p&&(F=new A(p,B.y+(p-B.x)/(F.x-B.x)*(F.y-B.y))._round()),B.y>=_&&F.y>=_||(B.y>=_?B=new A(B.x+(_-B.y)/(F.y-B.y)*(F.x-B.x),_)._round():F.y>=_&&(F=new A(B.x+(_-B.y)/(F.y-B.y)*(F.x-B.x),_)._round()),P&&B.equals(P[P.length-1])||(P=[B],b.push(P)),P.push(F)))))}}return b}function y(c,n,a,p,_){switch(n){case 1:return(function(b,x,E,P){const O=[];for(const B of b)for(const F of B){const V=P===0?F.x:F.y;V>=x&&V<=E&&O.push([F])}return O})(c,a,p,_);case 2:return D(c,a,p,_,!1);case 3:return D(c,a,p,_,!0)}return[]}function T(c,n,a,p,_){const b=p===0?L:q;let x=[];const E=[];for(let B=0;B<c.length-1;B++){const F=c[B],V=c[B+1],j=p===0?F.x:F.y,X=p===0?V.x:V.y;let Z=!1;j<n?X>n&&x.push(b(F,V,n)):j>a?X<a&&x.push(b(F,V,a)):x.push(F),X<n&&j>=n&&(x.push(b(F,V,n)),Z=!0),X>a&&j<=a&&(x.push(b(F,V,a)),Z=!0),!_&&Z&&(E.push(x),x=[])}const P=c.length-1,O=p===0?c[P].x:c[P].y;return O>=n&&O<=a&&x.push(c[P]),_&&x.length>0&&!x[0].equals(x[x.length-1])&&x.push(new A(x[0].x,x[0].y)),x.length>0&&E.push(x),E}function D(c,n,a,p,_){const b=[];for(const x of c){const E=T(x,n,a,p,_);E.length>0&&b.push(...E)}return b}function L(c,n,a){return new A(a,c.y+(a-c.x)/(n.x-c.x)*(n.y-c.y))}function q(c,n,a){return new A(c.x+(a-c.y)/(n.y-c.y)*(n.x-c.x),a)}Nt("FeatureIndex",$y,{omit:["rawTileData","sourceLayerCoder"]});class ae extends A{constructor(n,a,p,_){super(n,a),this.angle=p,_!==void 0&&(this.segment=_)}clone(){return new ae(this.x,this.y,this.angle,this.segment)}}function De(c,n,a,p,_){if(n.segment===void 0||a===0)return!0;let b=n,x=n.segment+1,E=0;for(;E>-a/2;){if(x--,x<0)return!1;E-=c[x].dist(b),b=c[x]}E+=c[x].dist(c[x+1]),x++;const P=[];let O=0;for(;E<a/2;){const B=c[x],F=c[x+1];if(!F)return!1;let V=c[x-1].angleTo(B)-B.angleTo(F);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:E,angleDelta:V}),O+=V;E-P[0].distance>p;)O-=P.shift().angleDelta;if(O>_)return!1;x++,E+=B.dist(F)}return!0}function rt(c){let n=0;for(let a=0;a<c.length-1;a++)n+=c[a].dist(c[a+1]);return n}function mt(c,n,a){return c?.6*n*a:0}function St(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function at(c,n,a,p,_,b){const x=mt(a,_,b),E=St(a,p)*b;let P=0;const O=rt(c)/2;for(let B=0;B<c.length-1;B++){const F=c[B],V=c[B+1],j=F.dist(V);if(P+j>O){const X=(O-P)/j,Z=xn.number(F.x,V.x,X),Q=xn.number(F.y,V.y,X),se=new ae(Z,Q,V.angleTo(F),B);return se._round(),!x||De(c,se,E,x,n)?se:void 0}P+=j}}function ht(c,n,a,p,_,b,x,E,P){const O=mt(p,b,x),B=St(p,_),F=B*x,V=c[0].x===0||c[0].x===P||c[0].y===0||c[0].y===P;return n-F<n/4&&(n=F+n/4),Zt(c,V?n/2*E%n:(B/2+2*b)*x*E%n,n,O,a,F,V,!1,P)}function Zt(c,n,a,p,_,b,x,E,P){const O=b/2,B=rt(c);let F=0,V=n-a,j=[];for(let X=0;X<c.length-1;X++){const Z=c[X],Q=c[X+1],se=Z.dist(Q),ge=Q.angleTo(Z);for(;V+a<F+se;){V+=a;const ie=(V-F)/se,ue=xn.number(Z.x,Q.x,ie),Te=xn.number(Z.y,Q.y,ie);if(ue>=0&&ue<P&&Te>=0&&Te<P&&V-O>=0&&V+O<=B){const Re=new ae(ue,Te,ge,X);Re._round(),p&&!De(c,Re,b,p,_)||j.push(Re)}}F+=se}return E||j.length||x||(j=Zt(c,F/2,a,p,_,b,x,!0,P)),j}function ui(c,n,a,p){const _=[],b=c.image,x=b.pixelRatio,E=b.paddedRect.w-2,P=b.paddedRect.h-2;let O={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const B=b.stretchX||[[0,E]],F=b.stretchY||[[0,P]],V=(ct,Vt)=>ct+Vt[1]-Vt[0],j=B.reduce(V,0),X=F.reduce(V,0),Z=E-j,Q=P-X;let se=0,ge=j,ie=0,ue=X,Te=0,Re=Z,Ye=0,ft=Q;if(b.content&&p){const ct=b.content,Vt=ct[2]-ct[0],qt=ct[3]-ct[1];(b.textFitWidth||b.textFitHeight)&&(O=tc(c)),se=an(B,0,ct[0]),ie=an(F,0,ct[1]),ge=an(B,ct[0],ct[2]),ue=an(F,ct[1],ct[3]),Te=ct[0]-se,Ye=ct[1]-ie,Re=Vt-ge,ft=qt-ue}const dt=O.x1,bt=O.y1,Bt=O.x2-dt,At=O.y2-bt,pt=(ct,Vt,qt,Kt)=>{const Gt=Le(ct.stretch-se,ge,Bt,dt),wi=it(ct.fixed-Te,Re,ct.stretch,j),jn=Le(Vt.stretch-ie,ue,At,bt),vr=it(Vt.fixed-Ye,ft,Vt.stretch,X),us=Le(qt.stretch-se,ge,Bt,dt),fl=it(qt.fixed-Te,Re,qt.stretch,j),ta=Le(Kt.stretch-ie,ue,At,bt),Xr=it(Kt.fixed-Ye,ft,Kt.stretch,X),hs=new A(Gt,jn),ir=new A(us,jn),Gr=new A(us,ta),ks=new A(Gt,ta),Ls=new A(wi/x,vr/x),Ta=new A(fl/x,Xr/x),fs=n*Math.PI/180;if(fs){const kr=Math.sin(fs),Gn=Math.cos(fs),br=[Gn,-kr,kr,Gn];hs._matMult(br),ir._matMult(br),ks._matMult(br),Gr._matMult(br)}const Sa=ct.stretch+ct.fixed,dl=Vt.stretch+Vt.fixed;return{tl:hs,tr:ir,bl:ks,br:Gr,tex:{x:b.paddedRect.x+1+Sa,y:b.paddedRect.y+1+dl,w:qt.stretch+qt.fixed-Sa,h:Kt.stretch+Kt.fixed-dl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ls,pixelOffsetBR:Ta,minFontScaleX:Re/x/Bt,minFontScaleY:ft/x/At,isSDF:a}};if(p&&(b.stretchX||b.stretchY)){const ct=He(B,Z,j),Vt=He(F,Q,X);for(let qt=0;qt<ct.length-1;qt++){const Kt=ct[qt],Gt=ct[qt+1];for(let wi=0;wi<Vt.length-1;wi++)_.push(pt(Kt,Vt[wi],Gt,Vt[wi+1]))}}else _.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:P+1}));return _}function an(c,n,a){let p=0;for(const _ of c)p+=Math.max(n,Math.min(a,_[1]))-Math.max(n,Math.min(a,_[0]));return p}function He(c,n,a){const p=[{fixed:-1,stretch:0}];for(const[_,b]of c){const x=p[p.length-1];p.push({fixed:_-x.stretch,stretch:x.stretch}),p.push({fixed:_-x.stretch,stretch:x.stretch+(b-_)})}return p.push({fixed:n+1,stretch:a}),p}function Le(c,n,a,p){return c/n*a+p}function it(c,n,a,p){return c-n*a/p}Nt("Anchor",ae);class vt{constructor(n,a,p,_,b,x,E,P,O,B){var F;if(this.boxStartIndex=n.length,O){let V=x.top,j=x.bottom;const X=x.collisionPadding;X&&(V-=X[1],j+=X[3]);let Z=j-V;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const V=!((F=x.image)===null||F===void 0)&&F.content&&(x.image.textFitWidth||x.image.textFitHeight)?tc(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};V.y1=V.y1*E-P[0],V.y2=V.y2*E+P[2],V.x1=V.x1*E-P[3],V.x2=V.x2*E+P[1];const j=x.collisionPadding;if(j&&(V.x1-=j[0]*E,V.y1-=j[1]*E,V.x2+=j[2]*E,V.y2+=j[3]*E),B){const X=new A(V.x1,V.y1),Z=new A(V.x2,V.y1),Q=new A(V.x1,V.y2),se=new A(V.x2,V.y2),ge=B*Math.PI/180;X._rotate(ge),Z._rotate(ge),Q._rotate(ge),se._rotate(ge),V.x1=Math.min(X.x,Z.x,Q.x,se.x),V.x2=Math.max(X.x,Z.x,Q.x,se.x),V.y1=Math.min(X.y,Z.y,Q.y,se.y),V.y2=Math.max(X.y,Z.y,Q.y,se.y)}n.emplaceBack(a.x,a.y,V.x1,V.y1,V.x2,V.y2,p,_,b)}this.boxEndIndex=n.length}}class si{constructor(n=[],a=(p,_)=>p<_?-1:p>_?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:p}=this,_=a[n];for(;n>0;){const b=n-1>>1,x=a[b];if(p(_,x)>=0)break;a[n]=x,n=b}a[n]=_}_down(n){const{data:a,compare:p}=this,_=this.length>>1,b=a[n];for(;n<_;){let x=1+(n<<1);const E=x+1;if(E<this.length&&p(a[E],a[x])<0&&(x=E),p(a[x],b)>=0)break;a[n]=a[x],n=x}a[n]=b}}function Ki(c,n=1,a=!1){const p=Qc.fromPoints(c[0]),_=Math.min(p.width(),p.height());let b=_/2;const x=new si([],ei),{minX:E,minY:P,maxX:O,maxY:B}=p;if(_===0)return new A(E,P);for(let j=E;j<O;j+=_)for(let X=P;X<B;X+=_)x.push(new yi(j+b,X+b,b,c));let F=(function(j){let X=0,Z=0,Q=0;const se=j[0];for(let ge=0,ie=se.length,ue=ie-1;ge<ie;ue=ge++){const Te=se[ge],Re=se[ue],Ye=Te.x*Re.y-Re.x*Te.y;Z+=(Te.x+Re.x)*Ye,Q+=(Te.y+Re.y)*Ye,X+=3*Ye}return new yi(Z/X,Q/X,0,j)})(c),V=x.length;for(;x.length;){const j=x.pop();(j.d>F.d||!F.d)&&(F=j,a&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,V)),j.max-F.d<=n||(b=j.h/2,x.push(new yi(j.p.x-b,j.p.y-b,b,c)),x.push(new yi(j.p.x+b,j.p.y-b,b,c)),x.push(new yi(j.p.x-b,j.p.y+b,b,c)),x.push(new yi(j.p.x+b,j.p.y+b,b,c)),V+=4)}return a&&(console.log(`num probes: ${V}`),console.log(`best distance: ${F.d}`)),F.p}function ei(c,n){return n.max-c.max}function yi(c,n,a,p){this.p=new A(c,n),this.h=a,this.d=(function(_,b){let x=!1,E=1/0;for(let P=0;P<b.length;P++){const O=b[P];for(let B=0,F=O.length,V=F-1;B<F;V=B++){const j=O[B],X=O[V];j.y>_.y!=X.y>_.y&&_.x<(X.x-j.x)*(_.y-j.y)/(X.y-j.y)+j.x&&(x=!x),E=Math.min(E,cm(_,j,X))}}return(x?1:-1)*Math.sqrt(E)})(this.p,p),this.max=this.d+this.h*Math.SQRT2}var li;g.aP=void 0,(li=g.aP||(g.aP={}))[li.center=1]="center",li[li.left=2]="left",li[li.right=3]="right",li[li.top=4]="top",li[li.bottom=5]="bottom",li[li["top-left"]=6]="top-left",li[li["top-right"]=7]="top-right",li[li["bottom-left"]=8]="bottom-left",li[li["bottom-right"]=9]="bottom-right";const $i=Number.POSITIVE_INFINITY;function oc(c,n){return n[1]!==$i?(function(a,p,_){let b=0,x=0;switch(p=Math.abs(p),_=Math.abs(_),a){case"top-right":case"top-left":case"top":x=_-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-_}switch(a){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,x]})(c,n[0],n[1]):(function(a,p){let _=0,b=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(a){case"top-right":case"top-left":b=x-7;break;case"bottom-right":case"bottom-left":b=7-x;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(a){case"top-right":case"bottom-right":_=-x;break;case"top-left":case"bottom-left":_=x;break;case"left":_=p;break;case"right":_=-p}return[_,b]})(c,n[0])}function Hy(c,n,a){var p;const _=c.layout,b=(p=_.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(n,{},a);if(b){const E=b.values,P=[];for(let O=0;O<E.length;O+=2){const B=P[O]=E[O],F=E[O+1].map((V=>V*cr));B.startsWith("top")?F[1]-=7:B.startsWith("bottom")&&(F[1]+=7),P[O+1]=F}return new Bn(P)}const x=_.get("text-variable-anchor");if(x){let E;E=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(n,{},a)*cr,$i]:_.get("text-offset").evaluate(n,{},a).map((O=>O*cr));const P=[];for(const O of x)P.push(O,oc(O,E));return new Bn(P)}return null}function v0(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sE(c,n,a,p,_,b,x,E,P,O,B,F){let V=b.textMaxSize.evaluate(n,{});V===void 0&&(V=x);const j=c.layers[0].layout,X=j.get("icon-offset").evaluate(n,{},B),Z=f1(a.horizontal),Q=x/24,se=c.tilePixelRatio*Q,ge=c.tilePixelRatio*V/24,ie=c.tilePixelRatio*E,ue=c.tilePixelRatio*j.get("symbol-spacing"),Te=j.get("text-padding")*c.tilePixelRatio,Re=(function(qt,Kt,Gt,wi=1){const jn=qt.get("icon-padding").evaluate(Kt,{},Gt),vr=jn&&jn.values;return[vr[0]*wi,vr[1]*wi,vr[2]*wi,vr[3]*wi]})(j,n,B,c.tilePixelRatio),Ye=j.get("text-max-angle")/180*Math.PI,ft=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",dt=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",bt=j.get("symbol-placement"),Bt=ue/2,At=j.get("icon-text-fit");let pt;p&&At!=="none"&&(c.allowVerticalPlacement&&a.vertical&&(pt=So(p,a.vertical,At,j.get("icon-text-fit-padding"),X,Q)),Z&&(p=So(p,Z,At,j.get("icon-text-fit-padding"),X,Q)));const ct=B?F.line.getGranularityForZoomLevel(B.z):1,Vt=(qt,Kt)=>{Kt.x<0||Kt.x>=Be||Kt.y<0||Kt.y>=Be||(function(Gt,wi,jn,vr,us,fl,ta,Xr,hs,ir,Gr,ks,Ls,Ta,fs,Sa,dl,kr,Gn,br,Jn,Lr,hh,lc,r_){const _f=Gt.addToLineVertexArray(wi,jn);let zd,Eg,Cg,Mg,m1=0,_1=0,y1=0,v1=0,C0=-1,M0=-1;const fh={};let b1=Un("");if(Gt.allowVerticalPlacement&&vr.vertical){const Bs=Xr.layout.get("text-rotate").evaluate(Jn,{},lc)+90;Cg=new vt(hs,wi,ir,Gr,ks,vr.vertical,Ls,Ta,fs,Bs),ta&&(Mg=new vt(hs,wi,ir,Gr,ks,ta,dl,kr,fs,Bs))}if(us){const Bs=Xr.layout.get("icon-rotate").evaluate(Jn,{}),Co=Xr.layout.get("icon-text-fit")!=="none",Fd=ui(us,Bs,hh,Co),uc=ta?ui(ta,Bs,hh,Co):void 0;Eg=new vt(hs,wi,ir,Gr,ks,us,dl,kr,!1,Bs),m1=4*Fd.length;const Nd=Gt.iconSizeData;let su=null;Nd.kind==="source"?(su=[xa*Xr.layout.get("icon-size").evaluate(Jn,{})],su[0]>Yc&&gn(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Nd.kind==="composite"&&(su=[xa*Lr.compositeIconSizes[0].evaluate(Jn,{},lc),xa*Lr.compositeIconSizes[1].evaluate(Jn,{},lc)],(su[0]>Yc||su[1]>Yc)&&gn(`${Gt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Fd,su,br,Gn,Jn,g.az.none,wi,_f.lineStartIndex,_f.lineLength,-1,lc),C0=Gt.icon.placedSymbolArray.length-1,uc&&(_1=4*uc.length,Gt.addSymbols(Gt.icon,uc,su,br,Gn,Jn,g.az.vertical,wi,_f.lineStartIndex,_f.lineLength,-1,lc),M0=Gt.icon.placedSymbolArray.length-1)}const x1=Object.keys(vr.horizontal);for(const Bs of x1){const Co=vr.horizontal[Bs];if(!zd){b1=Un(Co.text);const uc=Xr.layout.get("text-rotate").evaluate(Jn,{},lc);zd=new vt(hs,wi,ir,Gr,ks,Co,Ls,Ta,fs,uc)}const Fd=Co.positionedLines.length===1;if(y1+=h1(Gt,wi,Co,fl,Xr,fs,Jn,Sa,_f,vr.vertical?g.az.horizontal:g.az.horizontalOnly,Fd?x1:[Bs],fh,C0,Lr,lc),Fd)break}vr.vertical&&(v1+=h1(Gt,wi,vr.vertical,fl,Xr,fs,Jn,Sa,_f,g.az.vertical,["vertical"],fh,M0,Lr,lc));const lE=zd?zd.boxStartIndex:Gt.collisionBoxArray.length,cE=zd?zd.boxEndIndex:Gt.collisionBoxArray.length,uE=Cg?Cg.boxStartIndex:Gt.collisionBoxArray.length,hE=Cg?Cg.boxEndIndex:Gt.collisionBoxArray.length,fE=Eg?Eg.boxStartIndex:Gt.collisionBoxArray.length,dE=Eg?Eg.boxEndIndex:Gt.collisionBoxArray.length,pE=Mg?Mg.boxStartIndex:Gt.collisionBoxArray.length,gE=Mg?Mg.boxEndIndex:Gt.collisionBoxArray.length;let cc=-1;const qy=(Bs,Co)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,Co):Co;cc=qy(zd,cc),cc=qy(Cg,cc),cc=qy(Eg,cc),cc=qy(Mg,cc);const w1=cc>-1?1:0;w1&&(cc*=r_/cr),Gt.glyphOffsetArray.length>=uf.MAX_GLYPHS&&gn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jn.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Jn.sortKey);const mE=Hy(Xr,Jn,lc),[_E,yE]=(function(Bs,Co){const Fd=Bs.length,uc=Co?.values;if(uc?.length>0)for(let Nd=0;Nd<uc.length;Nd+=2){const su=uc[Nd+1];Bs.emplaceBack(g.aP[uc[Nd]],su[0],su[1])}return[Fd,Bs.length]})(Gt.textAnchorOffsets,mE);Gt.symbolInstances.emplaceBack(wi.x,wi.y,fh.right>=0?fh.right:-1,fh.center>=0?fh.center:-1,fh.left>=0?fh.left:-1,fh.vertical||-1,C0,M0,b1,lE,cE,uE,hE,fE,dE,pE,gE,ir,y1,v1,m1,_1,w1,0,Ls,cc,_E,yE)})(c,Kt,qt,a,p,_,pt,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,se,[Te,Te,Te,Te],ft,P,ie,Re,dt,X,n,b,O,B,x)};if(bt==="line")for(const qt of f(n.geometry,0,0,Be,Be)){const Kt=Yl(qt,ct),Gt=ht(Kt,ue,Ye,a.vertical||Z,p,24,ge,c.overscaling,Be);for(const wi of Gt)Z&&aE(c,Z.text,Bt,wi)||Vt(Kt,wi)}else if(bt==="line-center"){for(const qt of n.geometry)if(qt.length>1){const Kt=Yl(qt,ct),Gt=at(Kt,Ye,a.vertical||Z,p,24,ge);Gt&&Vt(Kt,Gt)}}else if(n.type==="Polygon")for(const qt of Cu(n.geometry,0)){const Kt=Ki(qt,16);Vt(Yl(qt[0],ct,!0),new ae(Kt.x,Kt.y,0))}else if(n.type==="LineString")for(const qt of n.geometry){const Kt=Yl(qt,ct);Vt(Kt,new ae(Kt[0].x,Kt[0].y,0))}else if(n.type==="Point")for(const qt of n.geometry)for(const Kt of qt)Vt([Kt],new ae(Kt.x,Kt.y,0))}function h1(c,n,a,p,_,b,x,E,P,O,B,F,V,j,X){const Z=(function(ge,ie,ue,Te,Re,Ye,ft,dt){const bt=Te.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Bt=[];for(const At of ie.positionedLines)for(const pt of At.positionedGlyphs){if(!pt.rect)continue;const ct=pt.rect||{};let Vt=4,qt=!0,Kt=1,Gt=0;const wi=(Re||dt)&&pt.vertical,jn=pt.metrics.advance*pt.scale/2;if(dt&&ie.verticalizable&&(Gt=At.lineOffset/2-(pt.imageName?-(cr-pt.metrics.width*pt.scale)/2:(pt.scale-1)*cr)),pt.imageName){const kr=ft[pt.imageName];qt=kr.sdf,Kt=kr.pixelRatio,Vt=1/Kt}const vr=Re?[pt.x+jn,pt.y]:[0,0];let us=Re?[0,0]:[pt.x+jn+ue[0],pt.y+ue[1]-Gt],fl=[0,0];wi&&(fl=us,us=[0,0]);const ta=pt.metrics.isDoubleResolution?2:1,Xr=(pt.metrics.left-Vt)*pt.scale-jn+us[0],hs=(-pt.metrics.top-Vt)*pt.scale+us[1],ir=Xr+ct.w/ta*pt.scale/Kt,Gr=hs+ct.h/ta*pt.scale/Kt,ks=new A(Xr,hs),Ls=new A(ir,hs),Ta=new A(Xr,Gr),fs=new A(ir,Gr);if(wi){const kr=new A(-jn,jn- -17),Gn=-Math.PI/2,br=12-jn,Jn=new A(22-br,-(pt.imageName?br:0)),Lr=new A(...fl);ks._rotateAround(Gn,kr)._add(Jn)._add(Lr),Ls._rotateAround(Gn,kr)._add(Jn)._add(Lr),Ta._rotateAround(Gn,kr)._add(Jn)._add(Lr),fs._rotateAround(Gn,kr)._add(Jn)._add(Lr)}if(bt){const kr=Math.sin(bt),Gn=Math.cos(bt),br=[Gn,-kr,kr,Gn];ks._matMult(br),Ls._matMult(br),Ta._matMult(br),fs._matMult(br)}const Sa=new A(0,0),dl=new A(0,0);Bt.push({tl:ks,tr:Ls,bl:Ta,br:fs,tex:ct,writingMode:ie.writingMode,glyphOffset:vr,sectionIndex:pt.sectionIndex,isSDF:qt,pixelOffsetTL:Sa,pixelOffsetBR:dl,minFontScaleX:0,minFontScaleY:0})}return Bt})(0,a,E,_,b,x,p,c.allowVerticalPlacement),Q=c.textSizeData;let se=null;Q.kind==="source"?(se=[xa*_.layout.get("text-size").evaluate(x,{})],se[0]>Yc&&gn(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Q.kind==="composite"&&(se=[xa*j.compositeTextSizes[0].evaluate(x,{},X),xa*j.compositeTextSizes[1].evaluate(x,{},X)],(se[0]>Yc||se[1]>Yc)&&gn(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,Z,se,E,b,x,O,n,P.lineStartIndex,P.lineLength,V,X);for(const ge of B)F[ge]=c.text.placedSymbolArray.length-1;return 4*Z.length}function f1(c){for(const n in c)return c[n];return null}function aE(c,n,a,p){const _=c.compareText;if(n in _){const b=_[n];for(let x=b.length-1;x>=0;x--)if(p.dist(b[x])<a)return!0}else _[n]=[];return _[n].push(p),!1}const d1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class b0{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,p]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=p>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const b=d1[15&p];if(!b)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[E]=new Uint32Array(n,4,1);return new b0(E,x,b,n)}constructor(n,a=64,p=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=p,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const b=d1.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,E=n*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-E%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+E+P,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+E+P),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+E+P,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=n,this.coords[this._pos++]=a,p}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return x0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,p,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:E}=this,P=[0,b.length-1,0],O=[];for(;P.length;){const B=P.pop()||0,F=P.pop()||0,V=P.pop()||0;if(F-V<=E){for(let Q=V;Q<=F;Q++){const se=x[2*Q],ge=x[2*Q+1];se>=n&&se<=p&&ge>=a&&ge<=_&&O.push(b[Q])}continue}const j=V+F>>1,X=x[2*j],Z=x[2*j+1];X>=n&&X<=p&&Z>=a&&Z<=_&&O.push(b[j]),(B===0?n<=X:a<=Z)&&(P.push(V),P.push(j-1),P.push(1-B)),(B===0?p>=X:_>=Z)&&(P.push(j+1),P.push(F),P.push(1-B))}return O}within(n,a,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:x}=this,E=[0,_.length-1,0],P=[],O=p*p;for(;E.length;){const B=E.pop()||0,F=E.pop()||0,V=E.pop()||0;if(F-V<=x){for(let Q=V;Q<=F;Q++)g1(b[2*Q],b[2*Q+1],n,a)<=O&&P.push(_[Q]);continue}const j=V+F>>1,X=b[2*j],Z=b[2*j+1];g1(X,Z,n,a)<=O&&P.push(_[j]),(B===0?n-p<=X:a-p<=Z)&&(E.push(V),E.push(j-1),E.push(1-B)),(B===0?n+p>=X:a+p>=Z)&&(E.push(j+1),E.push(F),E.push(1-B))}return P}}function x0(c,n,a,p,_,b){if(_-p<=a)return;const x=p+_>>1;p1(c,n,x,p,_,b),x0(c,n,a,p,x-1,1-b),x0(c,n,a,x+1,_,1-b)}function p1(c,n,a,p,_,b){for(;_>p;){if(_-p>600){const O=_-p+1,B=a-p+1,F=Math.log(O),V=.5*Math.exp(2*F/3),j=.5*Math.sqrt(F*V*(O-V)/O)*(B-O/2<0?-1:1);p1(c,n,a,Math.max(p,Math.floor(a-B*V/O+j)),Math.min(_,Math.floor(a+(O-B)*V/O+j)),b)}const x=n[2*a+b];let E=p,P=_;for(i_(c,n,p,a),n[2*_+b]>x&&i_(c,n,p,_);E<P;){for(i_(c,n,E,P),E++,P--;n[2*E+b]<x;)E++;for(;n[2*P+b]>x;)P--}n[2*p+b]===x?i_(c,n,p,P):(P++,i_(c,n,P,_)),P<=a&&(p=P+1),a<=P&&(_=P-1)}}function i_(c,n,a,p){w0(c,a,p),w0(n,2*a,2*p),w0(n,2*a+1,2*p+1)}function w0(c,n,a){const p=c[n];c[n]=c[a],c[a]=p}function g1(c,n,a,p){const _=c-a,b=n-p;return _*_+b*b}var T0;g.cI=void 0,(T0=g.cI||(g.cI={})).create="create",T0.load="load",T0.fullLoad="fullLoad";let Wy=null,n_=[];const S0=1e3/60,A0="loadTime",E0="fullLoadTime",oE={mark(c){performance.mark(c)},recordStartOfFrameAt(c){Wy!=null&&n_.push(c-Wy),Wy=c},resetRuntimeMetrics(){Wy=null,n_=[]},clearInitializationMetrics(){performance.clearMeasures(A0),performance.clearMeasures(E0);for(const c in g.cI)performance.clearMarks(g.cI[c])},remove(){this.resetRuntimeMetrics(),this.clearInitializationMetrics()},getPerformanceMetrics(){performance.measure(A0,g.cI.create,g.cI.load),performance.measure(E0,g.cI.create,g.cI.fullLoad);const c=performance.getEntriesByName(A0)[0].duration,n=performance.getEntriesByName(E0)[0].duration,a=n_.length;return{loadTimeMs:c,fullLoadTimeMs:n,averageFramesPerSecond:1/(n_.reduce(((p,_)=>p+_),0)/a/1e3),virtualDroppedFramesCount:n_.filter((p=>p>S0)).reduce(((p,_)=>p+(_-S0)/S0),0),totalFramesCount:a}}};g.$=ne,g.A=Se,g.B=fa,g.C=lr,g.D=Ut,g.E=ut,g.F=function([c,n,a]){return n+=90,n*=Math.PI/180,a*=Math.PI/180,{x:c*Math.cos(n)*Math.sin(a),y:c*Math.sin(n)*Math.sin(a),z:c*Math.cos(a)}},g.G=xn,g.H=Wi,g.I=sn,g.J=Vh,g.K=function(c){if(mn==null){const n=c.navigator?c.navigator.userAgent:null;mn=!!c.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return mn},g.L=class{constructor(c,n){this.target=c,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new rg((()=>this.process())),this.subscription=yc(this.target,"message",(a=>this.receive(a)),!1),this.globalScope=bi(self)?c:window}registerMessageHandler(c,n){this.messageHandlers[c]=n}unregisterMessageHandler(c){delete this.messageHandlers[c]}sendAsync(c,n){return new Promise(((a,p)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),b=n?yc(n.signal,"abort",(()=>{b?.unsubscribe(),delete this.resolveRejects[_];const P={id:_,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(P)}),zm):null;this.resolveRejects[_]={resolve:P=>{b?.unsubscribe(),a(P)},reject:P=>{b?.unsubscribe(),p(P)}};const x=[],E=Object.assign(Object.assign({},c),{id:_,sourceMapId:this.mapId,origin:location.origin,data:da(c.data,x)});this.target.postMessage(E,{transfer:x})}))}receive(c){const n=c.data,a=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[a];const p=this.abortControllers[a];return delete this.abortControllers[a],void(p&&p.abort())}if(bi(self)||n.mustQueue)return this.tasks[a]=n,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,n)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),n=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(c,n)}processTask(c,n){return o(this,void 0,void 0,(function*(){if(n.type==="<response>"){const _=this.resolveRejects[c];return delete this.resolveRejects[c],_?void(n.error?_.reject(Uc(n.error)):_.resolve(Uc(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=Uc(n.data),p=new AbortController;this.abortControllers[c]=p;try{const _=yield this.messageHandlers[n.type](n.sourceMapId,a,p);this.completeTask(c,null,_)}catch(_){this.completeTask(c,_)}}))}completeTask(c,n,a){const p=[];delete this.abortControllers[c];const _={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?da(n):null,data:da(a,p)};this.target.postMessage(_,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},g.M=K,g.N=function(){var c=new Se(16);return Se!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},g.O=function(c,n,a){var p,_,b,x,E,P,O,B,F,V,j,X,Z=a[0],Q=a[1],se=a[2];return n===c?(c[12]=n[0]*Z+n[4]*Q+n[8]*se+n[12],c[13]=n[1]*Z+n[5]*Q+n[9]*se+n[13],c[14]=n[2]*Z+n[6]*Q+n[10]*se+n[14],c[15]=n[3]*Z+n[7]*Q+n[11]*se+n[15]):(_=n[1],b=n[2],x=n[3],E=n[4],P=n[5],O=n[6],B=n[7],F=n[8],V=n[9],j=n[10],X=n[11],c[0]=p=n[0],c[1]=_,c[2]=b,c[3]=x,c[4]=E,c[5]=P,c[6]=O,c[7]=B,c[8]=F,c[9]=V,c[10]=j,c[11]=X,c[12]=p*Z+E*Q+F*se+n[12],c[13]=_*Z+P*Q+V*se+n[13],c[14]=b*Z+O*Q+j*se+n[14],c[15]=x*Z+B*Q+X*se+n[15]),c},g.P=A,g.Q=function(c,n,a){var p=a[0],_=a[1],b=a[2];return c[0]=n[0]*p,c[1]=n[1]*p,c[2]=n[2]*p,c[3]=n[3]*p,c[4]=n[4]*_,c[5]=n[5]*_,c[6]=n[6]*_,c[7]=n[7]*_,c[8]=n[8]*b,c[9]=n[9]*b,c[10]=n[10]*b,c[11]=n[11]*b,c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},g.R=as,g.S=function(c,n,a){var p=n[0],_=n[1],b=n[2],x=n[3],E=n[4],P=n[5],O=n[6],B=n[7],F=n[8],V=n[9],j=n[10],X=n[11],Z=n[12],Q=n[13],se=n[14],ge=n[15],ie=a[0],ue=a[1],Te=a[2],Re=a[3];return c[0]=ie*p+ue*E+Te*F+Re*Z,c[1]=ie*_+ue*P+Te*V+Re*Q,c[2]=ie*b+ue*O+Te*j+Re*se,c[3]=ie*x+ue*B+Te*X+Re*ge,c[4]=(ie=a[4])*p+(ue=a[5])*E+(Te=a[6])*F+(Re=a[7])*Z,c[5]=ie*_+ue*P+Te*V+Re*Q,c[6]=ie*b+ue*O+Te*j+Re*se,c[7]=ie*x+ue*B+Te*X+Re*ge,c[8]=(ie=a[8])*p+(ue=a[9])*E+(Te=a[10])*F+(Re=a[11])*Z,c[9]=ie*_+ue*P+Te*V+Re*Q,c[10]=ie*b+ue*O+Te*j+Re*se,c[11]=ie*x+ue*B+Te*X+Re*ge,c[12]=(ie=a[12])*p+(ue=a[13])*E+(Te=a[14])*F+(Re=a[15])*Z,c[13]=ie*_+ue*P+Te*V+Re*Q,c[14]=ie*b+ue*O+Te*j+Re*se,c[15]=ie*x+ue*B+Te*X+Re*ge,c},g.T=Lp,g.U=function(c,n){const a={};for(let p=0;p<n.length;p++){const _=n[p];_ in c&&(a[_]=c[_])}return a},g.V=ll,g.W=Ht,g.X=Fm,g.Y=Ty,g.Z=Lo,g._=o,g.a=fu,g.a$=kt,g.a0=Ie,g.a1=to,g.a2=Rs,g.a3=Ay,g.a4=bd,g.a5=Be,g.a6=function(c,n,a){if(!c)return n||{};if(!n)return c||{};const p=wd(c),_=wd(n);(function(x,E){E.removeAll&&(x.add.clear(),x.update.clear(),x.remove.clear(),E.remove.clear());for(const P of E.remove)x.add.delete(P),x.update.delete(P);for(const[P,O]of E.update){const B=x.update.get(P);B&&(E.update.set(P,Um(B,O)),x.update.delete(P))}})(p,_);const b={};if((p.removeAll||_.removeAll)&&(b.removeAll=!0),b.remove=new Set([...p.remove,..._.remove]),b.add=new Map([...p.add,..._.add]),b.update=new Map([...p.update,..._.update]),b.remove.size&&b.add.size)for(const x of b.add.keys())b.remove.delete(x);return(function(x){const E={};return x.removeAll&&(E.removeAll=x.removeAll),x.remove&&(E.remove=Array.from(x.remove)),x.add&&(E.add=Array.from(x.add.values())),x.update&&(E.update=Array.from(x.update.values())),E})(b)},g.a7=function(c,n){const a=new Map;if(c==null||c.type==null)return a;if(c.type==="Feature"){const p=xd(c,n);return p==null?void 0:(a.set(p,c),a)}if(c.type==="FeatureCollection"){const p=new Set;for(const _ of c.features){const b=xd(_,n);if(b==null||p.has(b))return;p.add(b),a.set(b,_)}return a}},g.a8=function(c,n,a){var p,_;const b=[];if(n.removeAll)c.clear();else if(n.remove)for(const x of n.remove){const E=c.get(x);E&&(b.push(E.geometry),c.delete(x))}if(n.add)for(const x of n.add){const E=xd(x,a);if(E==null)continue;const P=c.get(E);P&&b.push(P.geometry),b.push(x.geometry),c.set(E,x)}if(n.update)for(const x of n.update){const E=c.get(x.id);if(!E)continue;const P=!!x.newGeometry,O=x.removeAllProperties||((p=x.removeProperties)===null||p===void 0?void 0:p.length)>0||((_=x.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0;if(!P&&!O)continue;b.push(E.geometry);const B=Object.assign({},E);if(c.set(x.id,B),P&&(b.push(x.newGeometry),B.geometry=x.newGeometry),O){if(B.properties=x.removeAllProperties?{}:Object.assign({},B.properties||{}),x.removeProperties)for(const F of x.removeProperties)delete B.properties[F];if(x.addOrUpdateProperties)for(const{key:F,value:V}of x.addOrUpdateProperties)B.properties[F]=V}}return b},g.a9=Yi,g.aA=function(c,{uSize:n,uSizeT:a},{lowerSize:p,upperSize:_}){return c.kind==="source"?p/xa:c.kind==="composite"?xn.number(p/xa,_/xa,a):n},g.aB=function(c,n){var a=n[0],p=n[1],_=n[2],b=n[3],x=n[4],E=n[5],P=n[6],O=n[7],B=n[8],F=n[9],V=n[10],j=n[11],X=n[12],Z=n[13],Q=n[14],se=n[15],ge=a*E-p*x,ie=a*P-_*x,ue=a*O-b*x,Te=p*P-_*E,Re=p*O-b*E,Ye=_*O-b*P,ft=B*Z-F*X,dt=B*Q-V*X,bt=B*se-j*X,Bt=F*Q-V*Z,At=F*se-j*Z,pt=V*se-j*Q,ct=ge*pt-ie*At+ue*Bt+Te*bt-Re*dt+Ye*ft;return ct?(c[0]=(E*pt-P*At+O*Bt)*(ct=1/ct),c[1]=(_*At-p*pt-b*Bt)*ct,c[2]=(Z*Ye-Q*Re+se*Te)*ct,c[3]=(V*Re-F*Ye-j*Te)*ct,c[4]=(P*bt-x*pt-O*dt)*ct,c[5]=(a*pt-_*bt+b*dt)*ct,c[6]=(Q*ue-X*Ye-se*ie)*ct,c[7]=(B*Ye-V*ue+j*ie)*ct,c[8]=(x*At-E*bt+O*ft)*ct,c[9]=(p*bt-a*At-b*ft)*ct,c[10]=(X*Re-Z*ue+se*ge)*ct,c[11]=(F*ue-B*Re-j*ge)*ct,c[12]=(E*dt-x*Bt-P*ft)*ct,c[13]=(a*Bt-p*dt+_*ft)*ct,c[14]=(Z*ie-X*Te-Q*ge)*ct,c[15]=(B*Te-F*ie+V*ge)*ct,c):null},g.aC=be,g.aD=function(c){var n=c[0],a=c[1];return Math.sqrt(n*n+a*a)},g.aE=function(c){return c[0]=0,c[1]=0,c},g.aF=function(c,n,a){return c[0]=n[0]*a,c[1]=n[1]*a,c},g.aG=Om,g.aH=Pt,g.aI=function(c,n,a,p){const _=n.y-c.y,b=n.x-c.x,x=p.y-a.y,E=p.x-a.x,P=x*b-E*_;if(P===0)return null;const O=(E*(c.y-a.y)-x*(c.x-a.x))/P;return new A(c.x+O*b,c.y+O*_)},g.aJ=f,g.aK=Ju,g.aL=function(c){let n=1/0,a=1/0,p=-1/0,_=-1/0;for(const b of c)n=Math.min(n,b.x),a=Math.min(a,b.y),p=Math.max(p,b.x),_=Math.max(_,b.y);return[n,a,p,_]},g.aM=cr,g.aN=nt,g.aO=function(c,n,a,p,_=!1){if(!a[0]&&!a[1])return[0,0];const b=_?p==="map"?-c.bearingInRadians:0:p==="viewport"?c.bearingInRadians:0;if(b){const x=Math.sin(b),E=Math.cos(b);a=[a[0]*E-a[1]*x,a[0]*x+a[1]*E]}return[_?a[0]:nt(n,a[0],c.zoom),_?a[1]:nt(n,a[1],c.zoom)]},g.aQ=Jp,g.aR=v0,g.aS=Pm,g.aT=b0,g.aU=wn,g.aV=ud,g.aW=ce,g.aX=zt,g.aY=Qe,g.aZ=gs,g.a_=Nm,g.aa=Qc,g.ab=25,g.ac=Cr,g.ad=c=>{const n=window.document.createElement("video");return n.muted=!0,new Promise((a=>{n.onloadstart=()=>{a(n)};for(const p of c){const _=window.document.createElement("source");Xe(p)||(n.crossOrigin="Anonymous"),_.src=p,n.appendChild(_)}}))},g.ae=Tt,g.af=function(){return vi++},g.ag=v,g.ah=uf,g.ai=ru,g.aj=es,g.ak=va,g.al=og,g.am=function(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,p,_,b)=>{const x=_||b;return n[p]=!x||x.toLowerCase(),""})),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n},g.an=$t,g.ao=85.051129,g.ap=rr,g.aq=function(c){return Math.pow(2,c)},g.ar=st,g.as=Sy,g.at=function(c){return Math.log(c)/Math.LN2},g.au=function(c){var n=c[0],a=c[1];return n*n+a*a},g.av=function(c){if(!c.length)return new Set;const n=Math.max(...c.map((P=>P.canonical.z)));let a=1/0,p=-1/0,_=1/0,b=-1/0;const x=[];for(const P of c){const{x:O,y:B,z:F}=P.canonical,V=Math.pow(2,n-F),j=O*V,X=B*V;x.push({id:P,x:j,y:X}),j<a&&(a=j),j>p&&(p=j),X<_&&(_=X),X>b&&(b=X)}const E=new Set;for(const P of x)P.x!==a&&P.x!==p&&P.y!==_&&P.y!==b||E.add(P.id);return E},g.aw=function(c,n){const a=Math.abs(2*c.wrap)-+(c.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return c.overscaledZ-n.overscaledZ||p-a||n.canonical.y-c.canonical.y||n.canonical.x-c.canonical.x},g.ax=class{constructor(c,n){this.max=c,this.onRemove=n,this.reset()}reset(){for(const c in this.data)for(const n of this.data[c])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(c,n,a){const p=c.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:n,timeout:void 0};if(a!==void 0&&(_.timeout=setTimeout((()=>{this.remove(c,_)}),a)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const n=this.data[c].shift();return n.timeout&&clearTimeout(n.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),n.value}getByKey(c){const n=this.data[c];return n?n[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,n){if(!this.has(c))return this;const a=c.wrapped().key,p=n===void 0?0:this.data[a].indexOf(n),_=this.data[a][p];return this.data[a].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(_.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(c){const n=[];for(const a in this.data)for(const p of this.data[a])c(p.value)||n.push(p);for(const a of n)this.remove(a.value.tileID,a)}},g.ay=function(c,n){let a=0,p=0;if(c.kind==="constant")p=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:_,minZoom:b,maxZoom:x}=c,E=_?$t($r.interpolationFactor(_,n,b,x),0,1):0;c.kind==="camera"?p=xn.number(c.minSize,c.maxSize,E):a=E}return{uSizeT:a,uSize:p}},g.b=Ea,g.b$=ya,g.b0=lt,g.b1=function(c){var n=new Se(3);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n},g.b2=function(c,n,a){return c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],c},g.b3=function(c,n){var a=n[0],p=n[1],_=n[2],b=a*a+p*p+_*_;return b>0&&(b=1/Math.sqrt(b)),c[0]=n[0]*b,c[1]=n[1]*b,c[2]=n[2]*b,c},g.b4=xt,g.b5=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]},g.b6=function(c,n,a){return c[0]=n[0]*a[0],c[1]=n[1]*a[1],c[2]=n[2]*a[2],c[3]=n[3]*a[3],c},g.b7=wt,g.b8=function(c,n,a){const p=n[0]*a[0]+n[1]*a[1]+n[2]*a[2];return p===0?null:(-(c[0]*a[0]+c[1]*a[1]+c[2]*a[2])-a[3])/p},g.b9=Dt,g.bA=function(){return new Float64Array(3)},g.bB=re,g.bC=function(c,n,a){var p=a[0],_=a[1],b=a[2],x=a[3],E=n[0],P=n[1],O=n[2],B=_*O-b*P,F=b*E-p*O,V=p*P-_*E;return c[0]=E+x*(B+=B)+_*(V+=V)-b*(F+=F),c[1]=P+x*F+b*B-p*V,c[2]=O+x*V+p*F-_*B,c},g.bD=function(c,n,a){const p=(_=[c[0],c[1],c[2],n[0],n[1],n[2],a[0],a[1],a[2]])[0]*((B=_[8])*(x=_[4])-(E=_[5])*(O=_[7]))+_[1]*(-B*(b=_[3])+E*(P=_[6]))+_[2]*(O*b-x*P);var _,b,x,E,P,O,B;if(p===0)return null;const F=xt([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),V=xt([],[a[0],a[1],a[2]],[c[0],c[1],c[2]]),j=xt([],[c[0],c[1],c[2]],[n[0],n[1],n[2]]),X=kt([],F,-c[3]);return lt(X,X,kt([],V,-n[3])),lt(X,X,kt([],j,-a[3])),kt(X,X,1/p),X},g.bE=sg,g.bF=function(){return new Float64Array(4)},g.bG=function(c,n,a,p){var _=[],b=[];return _[0]=n[0]-a[0],_[1]=n[1]-a[1],_[2]=n[2]-a[2],b[0]=_[0]*Math.cos(p)-_[1]*Math.sin(p),b[1]=_[0]*Math.sin(p)+_[1]*Math.cos(p),b[2]=_[2],c[0]=b[0]+a[0],c[1]=b[1]+a[1],c[2]=b[2]+a[2],c},g.bH=function(c,n,a,p){var _=[],b=[];return _[0]=n[0]-a[0],_[1]=n[1]-a[1],_[2]=n[2]-a[2],b[0]=_[0],b[1]=_[1]*Math.cos(p)-_[2]*Math.sin(p),b[2]=_[1]*Math.sin(p)+_[2]*Math.cos(p),c[0]=b[0]+a[0],c[1]=b[1]+a[1],c[2]=b[2]+a[2],c},g.bI=function(c,n,a,p){var _=[],b=[];return _[0]=n[0]-a[0],_[1]=n[1]-a[1],_[2]=n[2]-a[2],b[0]=_[2]*Math.sin(p)+_[0]*Math.cos(p),b[1]=_[1],b[2]=_[2]*Math.cos(p)-_[0]*Math.sin(p),c[0]=b[0]+a[0],c[1]=b[1]+a[1],c[2]=b[2]+a[2],c},g.bJ=function(c,n,a){var p=Math.sin(a),_=Math.cos(a),b=n[0],x=n[1],E=n[2],P=n[3],O=n[8],B=n[9],F=n[10],V=n[11];return n!==c&&(c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=b*_-O*p,c[1]=x*_-B*p,c[2]=E*_-F*p,c[3]=P*_-V*p,c[8]=b*p+O*_,c[9]=x*p+B*_,c[10]=E*p+F*_,c[11]=P*p+V*_,c},g.bK=function(c,n){const a=he(c,360),p=he(n,360),_=p-a,b=p>a?_-360:_+360;return Math.abs(_)<Math.abs(b)?_:b},g.bL=function(c){return c[0]=0,c[1]=0,c[2]=0,c},g.bM=function(c,n,a,p){const _=Math.sqrt(c*c+n*n),b=Math.sqrt(a*a+p*p);c/=_,n/=_,a/=b,p/=b;const x=Math.acos(c*a+n*p);return-n*a+c*p>0?x:-x},g.bN=function(c,n){const a=he(c,2*Math.PI),p=he(n,2*Math.PI);return Math.min(Math.abs(a-p),Math.abs(a-p+2*Math.PI),Math.abs(a-p-2*Math.PI))},g.bO=function(){const c={},n=Ce.$version;for(const a in Ce.$root){const p=Ce.$root[a];if(p.required){let _=null;_=a==="version"?n:p.type==="array"?[]:{},_!=null&&(c[a]=_)}}return c},g.bP=ve,g.bQ=Hh,g.bR=function c(n,a){if(Array.isArray(n)){if(!Array.isArray(a)||n.length!==a.length)return!1;for(let p=0;p<n.length;p++)if(!c(n[p],a[p]))return!1;return!0}if(typeof n=="object"&&n!==null&&a!==null){if(typeof a!="object"||Object.keys(n).length!==Object.keys(a).length)return!1;for(const p in n)if(!c(n[p],a[p]))return!1;return!0}return n===a},g.bS=function(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=ai(c[a],n[c[a].ref]));return c},g.bT=function(c,n){if(c.type==="custom")return new Bm(c,n);switch(c.type){case"background":return new ki(c,n);case"circle":return new Dp(c,n);case"color-relief":return new K_(c,n);case"fill":return new iy(c,n);case"fill-extrusion":return new wm(c,n);case"heatmap":return new Z_(c,n);case"hillshade":return new Vn(c,n);case"line":return new Sm(c,n);case"raster":return new _o(c,n);case"symbol":return new Kc(c,n)}},g.bU=c=>c.type==="raster",g.bV=An,g.bW=function(c,n){if(!c)return[{command:"setStyle",args:[n]}];let a=[];try{if(!Jt(c.version,n.version))return[{command:"setStyle",args:[n]}];Jt(c.center,n.center)||a.push({command:"setCenter",args:[n.center]}),Jt(c.state,n.state)||a.push({command:"setGlobalState",args:[n.state]}),Jt(c.centerAltitude,n.centerAltitude)||a.push({command:"setCenterAltitude",args:[n.centerAltitude]}),Jt(c.zoom,n.zoom)||a.push({command:"setZoom",args:[n.zoom]}),Jt(c.bearing,n.bearing)||a.push({command:"setBearing",args:[n.bearing]}),Jt(c.pitch,n.pitch)||a.push({command:"setPitch",args:[n.pitch]}),Jt(c.roll,n.roll)||a.push({command:"setRoll",args:[n.roll]}),Jt(c.sprite,n.sprite)||a.push({command:"setSprite",args:[n.sprite]}),Jt(c.glyphs,n.glyphs)||a.push({command:"setGlyphs",args:[n.glyphs]}),Jt(c.transition,n.transition)||a.push({command:"setTransition",args:[n.transition]}),Jt(c.light,n.light)||a.push({command:"setLight",args:[n.light]}),Jt(c.terrain,n.terrain)||a.push({command:"setTerrain",args:[n.terrain]}),Jt(c.sky,n.sky)||a.push({command:"setSky",args:[n.sky]}),Jt(c.projection,n.projection)||a.push({command:"setProjection",args:[n.projection]});const p={},_=[];(function(x,E,P,O){let B;for(B in E=E||{},x=x||{})Object.prototype.hasOwnProperty.call(x,B)&&(Object.prototype.hasOwnProperty.call(E,B)||oi(B,P,O));for(B in E)Object.prototype.hasOwnProperty.call(E,B)&&(Object.prototype.hasOwnProperty.call(x,B)?Jt(x[B],E[B])||(x[B].type==="geojson"&&E[B].type==="geojson"&&kn(x,E,B)?ii(P,{command:"setGeoJSONSourceData",args:[B,E[B].data]}):_n(B,E,P,O)):ni(B,E,P))})(c.sources,n.sources,_,p);const b=[];c.layers&&c.layers.forEach((x=>{"source"in x&&p[x.source]?a.push({command:"removeLayer",args:[x.id]}):b.push(x)})),a=a.concat(_),(function(x,E,P){E=E||[];const O=(x=x||[]).map(Tr),B=E.map(Tr),F=x.reduce(yn,{}),V=E.reduce(yn,{}),j=O.slice(),X=Object.create(null);let Z,Q,se,ge,ie;for(let ue=0,Te=0;ue<O.length;ue++)Z=O[ue],Object.prototype.hasOwnProperty.call(V,Z)?Te++:(ii(P,{command:"removeLayer",args:[Z]}),j.splice(j.indexOf(Z,Te),1));for(let ue=0,Te=0;ue<B.length;ue++)Z=B[B.length-1-ue],j[j.length-1-ue]!==Z&&(Object.prototype.hasOwnProperty.call(F,Z)?(ii(P,{command:"removeLayer",args:[Z]}),j.splice(j.lastIndexOf(Z,j.length-Te),1)):Te++,ge=j[j.length-ue],ii(P,{command:"addLayer",args:[V[Z],ge]}),j.splice(j.length-ue,0,Z),X[Z]=!0);for(let ue=0;ue<B.length;ue++)if(Z=B[ue],Q=F[Z],se=V[Z],!X[Z]&&!Jt(Q,se))if(Jt(Q.source,se.source)&&Jt(Q["source-layer"],se["source-layer"])&&Jt(Q.type,se.type)){for(ie in En(Q.layout,se.layout,P,Z,null,"setLayoutProperty"),En(Q.paint,se.paint,P,Z,null,"setPaintProperty"),Jt(Q.filter,se.filter)||ii(P,{command:"setFilter",args:[Z,se.filter]}),Jt(Q.minzoom,se.minzoom)&&Jt(Q.maxzoom,se.maxzoom)||ii(P,{command:"setLayerZoomRange",args:[Z,se.minzoom,se.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?En(Q[ie],se[ie],P,Z,ie.slice(6),"setPaintProperty"):Jt(Q[ie],se[ie])||ii(P,{command:"setLayerProperty",args:[Z,ie,se[ie]]}));for(ie in se)Object.prototype.hasOwnProperty.call(se,ie)&&!Object.prototype.hasOwnProperty.call(Q,ie)&&ie!=="layout"&&ie!=="paint"&&ie!=="filter"&&ie!=="metadata"&&ie!=="minzoom"&&ie!=="maxzoom"&&(ie.indexOf("paint.")===0?En(Q[ie],se[ie],P,Z,ie.slice(6),"setPaintProperty"):Jt(Q[ie],se[ie])||ii(P,{command:"setLayerProperty",args:[Z,ie,se[ie]]}))}else ii(P,{command:"removeLayer",args:[Z]}),ge=j[j.lastIndexOf(Z)+1],ii(P,{command:"addLayer",args:[se,ge]})})(b,n.layers,a)}catch(p){console.warn("Unable to compute style diff:",p),a=[{command:"setStyle",args:[n]}]}return a},g.bX=function(c){const n=[],a=c.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},g.bY=Mi,g.bZ=Mr,g.b_=class extends rs{constructor(c,n){super(c,n),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},g.ba=function(c,n,a){return c[0]=n[0]*a,c[1]=n[1]*a,c[2]=n[2]*a,c[3]=n[3]*a,c},g.bb=function(c,n){return c[0]*n[0]+c[1]*n[1]+c[2]*n[2]+c[3]},g.bc=Ey,g.bd=ff,g.be=function(c,n,a,p,_){var b=1/Math.tan(n/2);if(c[0]=b/a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,_!=null&&_!==1/0){var x=1/(p-_);c[10]=(_+p)*x,c[14]=2*_*p*x}else c[10]=-1,c[14]=-2*p;return c},g.bf=function(c){var n=new Se(16);return n[0]=c[0],n[1]=c[1],n[2]=c[2],n[3]=c[3],n[4]=c[4],n[5]=c[5],n[6]=c[6],n[7]=c[7],n[8]=c[8],n[9]=c[9],n[10]=c[10],n[11]=c[11],n[12]=c[12],n[13]=c[13],n[14]=c[14],n[15]=c[15],n},g.bg=function(c,n,a){var p=Math.sin(a),_=Math.cos(a),b=n[0],x=n[1],E=n[2],P=n[3],O=n[4],B=n[5],F=n[6],V=n[7];return n!==c&&(c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[0]=b*_+O*p,c[1]=x*_+B*p,c[2]=E*_+F*p,c[3]=P*_+V*p,c[4]=O*_-b*p,c[5]=B*_-x*p,c[6]=F*_-E*p,c[7]=V*_-P*p,c},g.bh=function(c,n,a){var p=Math.sin(a),_=Math.cos(a),b=n[4],x=n[5],E=n[6],P=n[7],O=n[8],B=n[9],F=n[10],V=n[11];return n!==c&&(c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15]),c[4]=b*_+O*p,c[5]=x*_+B*p,c[6]=E*_+F*p,c[7]=P*_+V*p,c[8]=O*_-b*p,c[9]=B*_-x*p,c[10]=F*_-E*p,c[11]=V*_-P*p,c},g.bi=function(){const c=new Float32Array(16);return st(c),c},g.bj=function(){const c=new Float64Array(16);return st(c),c},g.bk=function(){return new Float64Array(16)},g.bl=function(c,n,a){const p=new Float64Array(4);return re(p,c,n-90,a),p},g.bm=function(c,n,a,p){var _,b,x,E,P,O=n[0],B=n[1],F=n[2],V=n[3],j=a[0],X=a[1],Z=a[2],Q=a[3];return(b=O*j+B*X+F*Z+V*Q)<0&&(b=-b,j=-j,X=-X,Z=-Z,Q=-Q),1-b>Ue?(_=Math.acos(b),x=Math.sin(_),E=Math.sin((1-p)*_)/x,P=Math.sin(p*_)/x):(E=1-p,P=p),c[0]=E*O+P*j,c[1]=E*B+P*X,c[2]=E*F+P*Z,c[3]=E*V+P*Q,c},g.bn=function(c){const n=new Float64Array(9);var a,p,_,b,x,E,P,O,B,F,V,j,X,Z,Q,se,ge,ie;F=(_=(p=c)[0])*(P=_+_),V=(b=p[1])*P,X=(x=p[2])*P,Z=x*(O=b+b),se=(E=p[3])*P,ge=E*O,ie=E*(B=x+x),(a=n)[0]=1-(j=b*O)-(Q=x*B),a[3]=V-ie,a[6]=X+ge,a[1]=V+ie,a[4]=1-F-Q,a[7]=Z-se,a[2]=X-ge,a[5]=Z+se,a[8]=1-F-j;const ue=gs(-Math.asin($t(n[2],-1,1)));let Te,Re;return Math.hypot(n[5],n[8])<.001?(Te=0,Re=-gs(Math.atan2(n[3],n[4]))):(Te=gs(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),Re=gs(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:Te,pitch:ue+90,bearing:Re}},g.bo=function(c,n){return c.roll==n.roll&&c.pitch==n.pitch&&c.bearing==n.bearing},g.bp=mi,g.bq=Wl,g.br=Ks,g.bs=wo,g.bt=Er,g.bu=Oe,g.bv=Je,g.bw=ar,g.bx=function(c,n,a,p,_){return Oe(p,_,$t((c-n)/(a-n),0,1))},g.by=function(c,n,a,p){return c[0]=n[0]+a[0]*p,c[1]=n[1]+a[1]*p,c[2]=n[2]+a[2]*p,c},g.bz=he,g.c=ze,g.c$=class{constructor(c){this.start=`${c}#start`,this.end=`${c}#end`,this.measure=c,performance.mark(this.start)}finish(){performance.mark(this.end);let c=performance.getEntriesByName(this.measure);return c.length===0&&(performance.measure(this.measure,this.start,this.end),c=performance.getEntriesByName(this.measure),performance.clearMarks(this.start),performance.clearMarks(this.end),performance.clearMeasures(this.measure)),c}},g.c0=class extends rs{constructor(c,n){super(c,n),this.current=ss}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let n=1;n<16;n++)if(c[n]!==this.current[n]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},g.c1=Wc,g.c2=class extends rs{constructor(c,n){super(c,n),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},g.c3=class extends rs{constructor(c,n){super(c,n),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},g.c4=Ve,g.c5=function(c,n){var a=Math.sin(n),p=Math.cos(n);return c[0]=p,c[1]=a,c[2]=0,c[3]=-a,c[4]=p,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},g.c6=function(c,n,a){var p=n[0],_=n[1],b=n[2];return c[0]=p*a[0]+_*a[3]+b*a[6],c[1]=p*a[1]+_*a[4]+b*a[7],c[2]=p*a[2]+_*a[5]+b*a[8],c},g.c7=function(c,n,a,p,_,b,x){var E=1/(n-a),P=1/(p-_),O=1/(b-x);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*P,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*O,c[11]=0,c[12]=(n+a)*E,c[13]=(_+p)*P,c[14]=(x+b)*O,c[15]=1,c},g.c8=class extends rs{constructor(c,n){super(c,n),this.current=new Array}set(c){if(c!=this.current){this.current=c;const n=new Float32Array(4*c.length);for(let a=0;a<c.length;a++)n[4*a]=c[a].r,n[4*a+1]=c[a].g,n[4*a+2]=c[a].b,n[4*a+3]=c[a].a;this.gl.uniform4fv(this.location,n)}}},g.c9=class extends rs{constructor(c,n){super(c,n),this.current=new Array}set(c){if(c!=this.current){this.current=c;const n=new Float32Array(c);this.gl.uniform1fv(this.location,n)}}},g.cA=function(c,n){var a;if(!io[n])return!1;const p=c?.target,_=((a=p?.ownerDocument)===null||a===void 0?void 0:a.defaultView)||window;return c instanceof _.MouseEvent||c instanceof _.WheelEvent},g.cB=function(c,n){return vc[n]&&"touches"in c},g.cC=function(c){return vc[c]||io[c]},g.cD=function(c,n,a){var p=n[0],_=n[1];return c[0]=a[0]*p+a[4]*_+a[12],c[1]=a[1]*p+a[5]*_+a[13],c},g.cE=function(c,n){const{x:a,y:p}=Yi.fromLngLat(n);return!(c<0||c>25||p<0||p>=1||a<0||a>=1)},g.cF=function(c,n){return c[0]=n[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=n[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=n[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},g.cG=class extends Vl{},g.cH=oE,g.cJ=ee,g.cK=function(c,n){ze.REGISTERED_PROTOCOLS[c]=n},g.cL=function(c){delete ze.REGISTERED_PROTOCOLS[c]},g.cM=function(c,n){const a={};for(let _=0;_<c.length;_++){const b=n&&n[c[_].id]||co(c[_]);n&&(n[c[_].id]=b);let x=a[b];x||(x=a[b]=[]),x.push(c[_])}const p=[];for(const _ in a)p.push(a[_]);return p},g.cN=Nt,g.cO=Vm,g.cP=$y,g.cQ=Yp,g.cR=function(c){var n;c.bucket.createArrays(),c.bucket.tilePixelRatio=Be/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],p=a.layout,_=a._unevaluatedLayout._values,b={layoutIconSize:_["icon-size"].possiblyEvaluate(new Wi(c.bucket.zoom+1),c.canonical),layoutTextSize:_["text-size"].possiblyEvaluate(new Wi(c.bucket.zoom+1),c.canonical),textMaxSize:_["text-size"].possiblyEvaluate(new Wi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:F}=c.bucket.textSizeData;b.compositeTextSizes=[_["text-size"].possiblyEvaluate(new Wi(B),c.canonical),_["text-size"].possiblyEvaluate(new Wi(F),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:F}=c.bucket.iconSizeData;b.compositeIconSizes=[_["icon-size"].possiblyEvaluate(new Wi(B),c.canonical),_["icon-size"].possiblyEvaluate(new Wi(F),c.canonical)]}const x=p.get("text-line-height")*cr,E=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point",P=p.get("text-keep-upright"),O=p.get("text-size");for(const B of c.bucket.features){const F=p.get("text-font").evaluate(B,{},c.canonical).join(","),V=O.evaluate(B,{},c.canonical),j=b.layoutTextSize.evaluate(B,{},c.canonical),X=b.layoutIconSize.evaluate(B,{},c.canonical),Z={horizontal:{},vertical:void 0},Q=B.text;let se,ge=[0,0];if(Q){const Te=Q.toString(),Re=p.get("text-letter-spacing").evaluate(B,{},c.canonical)*cr,Ye=Wh(Te)?Re:0,ft=p.get("text-anchor").evaluate(B,{},c.canonical),dt=Hy(a,B,c.canonical);if(!dt){const pt=p.get("text-radial-offset").evaluate(B,{},c.canonical);ge=pt?oc(ft,[pt*cr,$i]):p.get("text-offset").evaluate(B,{},c.canonical).map((ct=>ct*cr))}let bt=E?"center":p.get("text-justify").evaluate(B,{},c.canonical);const Bt=p.get("symbol-placement")==="point"?p.get("text-max-width").evaluate(B,{},c.canonical)*cr:1/0,At=()=>{c.bucket.allowVerticalPlacement&&qa(Te)&&(Z.vertical=_d(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Bt,x,ft,"left",Ye,ge,g.az.vertical,!0,j,V))};if(!E&&dt){const pt=new Set;if(bt==="auto")for(let Vt=0;Vt<dt.values.length;Vt+=2)pt.add(v0(dt.values[Vt]));else pt.add(bt);let ct=!1;for(const Vt of pt)if(!Z.horizontal[Vt])if(ct)Z.horizontal[Vt]=Z.horizontal[0];else{const qt=_d(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Bt,x,"center",Vt,Ye,ge,g.az.horizontal,!1,j,V);qt&&(Z.horizontal[Vt]=qt,ct=qt.positionedLines.length===1)}At()}else{bt==="auto"&&(bt=v0(ft));const pt=_d(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Bt,x,ft,bt,Ye,ge,g.az.horizontal,!1,j,V);pt&&(Z.horizontal[bt]=pt),At(),qa(Te)&&E&&P&&(Z.vertical=_d(Q,c.glyphMap,c.glyphPositions,c.imagePositions,F,Bt,x,ft,bt,Ye,ge,g.az.vertical,!1,j,V))}}let ie=!1;if(B.icon&&B.icon.name){const Te=c.imageMap[B.icon.name];Te&&(se=Rm(c.imagePositions[B.icon.name],p.get("icon-offset").evaluate(B,{},c.canonical),p.get("icon-anchor").evaluate(B,{},c.canonical)),ie=!!Te.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=ie:c.bucket.sdfIcons!==ie&&gn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Te.pixelRatio!==c.bucket.pixelRatio||p.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ue=f1(Z.horizontal)||Z.vertical;(n=c.bucket).iconsInText||(n.iconsInText=!!ue&&ue.iconsInText),(ue||se)&&sE(c.bucket,B,Z,se,c.imageMap,b,j,X,ge,ie,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},g.cS=th,g.cT=Xc,g.cU=nf,g.cV=function(c){const n=new Xp;return(function(a,p){for(const _ in a.layers)p.writeMessage(3,wg,a.layers[_])})(c,n),n.finish()},g.cW=function(c,n,a,p,_,b){let x=y(c,n,a,_,0);return x=y(x,n,p,b,1),x},g.cX=class{constructor(c){this.maxEntries=c,this.map=new Map}get(c){const n=this.map.get(c);return n!==void 0&&(this.map.delete(c),this.map.set(c,n)),n}set(c,n){if(this.map.has(c))this.map.delete(c);else if(this.map.size>=this.maxEntries){const a=this.map.keys().next().value;this.map.delete(a)}this.map.set(c,n)}clear(){this.map.clear()}},g.cY=Oi,g.cZ=Xp,g.c_=t_,g.ca=class extends vo{},g.cb=oy,g.cc=class extends Tn{},g.cd=id,g.ce=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},g.cf=al,g.cg=function(c,n,a){var p=n[0],_=n[1],b=n[2],x=a[3]*p+a[7]*_+a[11]*b+a[15];return c[0]=(a[0]*p+a[4]*_+a[8]*b+a[12])/(x=x||1),c[1]=(a[1]*p+a[5]*_+a[9]*b+a[13])/x,c[2]=(a[2]*p+a[6]*_+a[10]*b+a[14])/x,c},g.ch=class extends jl{},g.ci=class extends r{},g.cj=function(c,n){return c[0]===n[0]&&c[1]===n[1]&&c[2]===n[2]&&c[3]===n[3]&&c[4]===n[4]&&c[5]===n[5]&&c[6]===n[6]&&c[7]===n[7]&&c[8]===n[8]&&c[9]===n[9]&&c[10]===n[10]&&c[11]===n[11]&&c[12]===n[12]&&c[13]===n[13]&&c[14]===n[14]&&c[15]===n[15]},g.ck=function(c,n){var a=c[0],p=c[1],_=c[2],b=c[3],x=c[4],E=c[5],P=c[6],O=c[7],B=c[8],F=c[9],V=c[10],j=c[11],X=c[12],Z=c[13],Q=c[14],se=c[15],ge=n[0],ie=n[1],ue=n[2],Te=n[3],Re=n[4],Ye=n[5],ft=n[6],dt=n[7],bt=n[8],Bt=n[9],At=n[10],pt=n[11],ct=n[12],Vt=n[13],qt=n[14],Kt=n[15];return Math.abs(a-ge)<=Ue*Math.max(1,Math.abs(a),Math.abs(ge))&&Math.abs(p-ie)<=Ue*Math.max(1,Math.abs(p),Math.abs(ie))&&Math.abs(_-ue)<=Ue*Math.max(1,Math.abs(_),Math.abs(ue))&&Math.abs(b-Te)<=Ue*Math.max(1,Math.abs(b),Math.abs(Te))&&Math.abs(x-Re)<=Ue*Math.max(1,Math.abs(x),Math.abs(Re))&&Math.abs(E-Ye)<=Ue*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(P-ft)<=Ue*Math.max(1,Math.abs(P),Math.abs(ft))&&Math.abs(O-dt)<=Ue*Math.max(1,Math.abs(O),Math.abs(dt))&&Math.abs(B-bt)<=Ue*Math.max(1,Math.abs(B),Math.abs(bt))&&Math.abs(F-Bt)<=Ue*Math.max(1,Math.abs(F),Math.abs(Bt))&&Math.abs(V-At)<=Ue*Math.max(1,Math.abs(V),Math.abs(At))&&Math.abs(j-pt)<=Ue*Math.max(1,Math.abs(j),Math.abs(pt))&&Math.abs(X-ct)<=Ue*Math.max(1,Math.abs(X),Math.abs(ct))&&Math.abs(Z-Vt)<=Ue*Math.max(1,Math.abs(Z),Math.abs(Vt))&&Math.abs(Q-qt)<=Ue*Math.max(1,Math.abs(Q),Math.abs(qt))&&Math.abs(se-Kt)<=Ue*Math.max(1,Math.abs(se),Math.abs(Kt))},g.cl=function(c,n){return c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3],c[4]=n[4],c[5]=n[5],c[6]=n[6],c[7]=n[7],c[8]=n[8],c[9]=n[9],c[10]=n[10],c[11]=n[11],c[12]=n[12],c[13]=n[13],c[14]=n[14],c[15]=n[15],c},g.cm=c=>c.type==="symbol",g.cn=c=>c.type==="circle",g.co=c=>c.type==="heatmap",g.cp=c=>c.type==="line",g.cq=c=>c.type==="fill",g.cr=c=>c.type==="fill-extrusion",g.cs=c=>c.type==="hillshade",g.ct=c=>c.type==="color-relief",g.cu=c=>c.type==="background",g.cv=c=>c.type==="custom",g.cw=gt,g.cx=function(c,n,a){if(n<=0)return c;const p=1/n;return a===void 0||Math.abs(a)<1e-10?Math.round(c*p)/p:(a>0?Math.ceil(c*p-1e-9):Math.floor(c*p+1e-10))/p},g.cy=function(c,n,a){const p=_e(n.x-a.x,n.y-a.y),_=_e(c.x-a.x,c.y-a.y);var b,x;return gs(Math.atan2(p[0]*_[1]-p[1]*_[0],(b=p)[0]*(x=_)[0]+b[1]*x[1]))},g.cz=Mt,g.d=Xe,g.d0=function(c,n,a,p,_){return o(this,void 0,void 0,(function*(){if(Ie())try{return yield to(c,n,a,p,_)}catch{}return(function(b,x,E,P,O){const B=b.width,F=b.height;Ca&&oa||(Ca=new OffscreenCanvas(B,F),oa=Ca.getContext("2d",{willReadFrequently:!0})),Ca.width=B,Ca.height=F,oa.drawImage(b,0,0,B,F);const V=oa.getImageData(x,E,P,O);return oa.clearRect(0,0,B,F),V.data})(c,n,a,p,_)}))},g.d1=Qh,g.d2=M,g.d3=class{constructor(c,n){this.layers={[ru]:this},this.name=ru,this.version=n?n.version:1,this.extent=n?n.extent:4096,this.length=c.length,this.features=c}feature(c){return new y0(this.features[c],this.extent)}},g.d4=Lc,g.d5=Ws,g.e=Qt,g.f=c=>o(void 0,void 0,void 0,(function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(n)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),g.g=G,g.h=c=>new Promise(((n,a)=>{const p=new Image;p.onload=()=>{n(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame((()=>{p.src=ko}))},p.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(c)],{type:"image/png"});p.src=c.byteLength?URL.createObjectURL(_):ko})),g.i=bi,g.j=(c,n)=>Me(Qt(c,{type:"json"}),n),g.k=yt,g.l=qe,g.m=Me,g.n=(c,n)=>Me(Qt(c,{type:"arrayBuffer"}),n),g.o=function(c){return new Xp(c).readFields(my,[])},g.p=Mm,g.q=function(c){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))},g.r=td,g.s=yc,g.t=qn,g.u=Ce,g.v=Nu,g.w=gn,g.x=Xh,g.y=ha,g.z=mo})),l("worker",["./shared"],(function(g){class o{constructor(G,K){this.keyCache={},G&&this.replace(G,K)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ee){for(const Me of G){this._layerConfigs[Me.id]=Me;const Xe=this._layers[Me.id]=g.bT(Me,ee);Xe._featureFilter=g.aj(Xe.filter,ee),this.keyCache[Me.id]&&delete this.keyCache[Me.id]}for(const Me of K)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const ve=g.cM(Object.values(this._layerConfigs),this.keyCache);for(const Me of ve){const Xe=Me.map((Ce=>this._layers[Ce.id])),We=Xe[0];if(We.isHidden())continue;const Fe=We.source||"";let qe=this.familiesBySource[Fe];qe||(qe=this.familiesBySource[Fe]={});const yt=We.sourceLayer||g.ai;let ut=qe[yt];ut||(ut=qe[yt]=[]),ut.push(Xe)}}}class A{constructor(G){const K={},ee=[];for(const We in G){const Fe=G[We],qe=K[We]={};for(const yt in Fe){const ut=Fe[+yt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Ce={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};ee.push(Ce),qe[yt]={rect:Ce,metrics:ut.metrics}}}const{w:ve,h:Me}=g.p(ee),Xe=new g.r({width:ve||1,height:Me||1});for(const We in G){const Fe=G[We];for(const qe in Fe){const yt=Fe[+qe];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const ut=K[We][qe].rect;g.r.copy(yt.bitmap,Xe,{x:0,y:0},{x:ut.x+1,y:ut.y+1},yt.bitmap)}}this.image=Xe,this.positions=K}}g.cN("GlyphAtlas",A);class M{constructor(G){this.tileID=new g.a2(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,K,ee,ve,Me){return g._(this,void 0,void 0,(function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new g.ag;const Xe=new g.cO(Object.keys(G.layers).sort()),We=new g.cP(this.tileID,this.promoteId);We.bucketLayerIDs=[];const Fe={},qe={featureIndex:We,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ee,subdivisionGranularity:Me},yt=K.familiesBySource[this.source];for(const Li in yt){const ln=G.layers[Li];if(!ln)continue;ln.version===1&&g.w(`Vector tile source "${this.source}" layer "${Li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qr=Xe.encode(Li),Hi=[];for(let Ct=0;Ct<ln.length;Ct++){const ti=ln.feature(Ct),hi=We.getId(ti,Li);Hi.push({feature:ti,id:hi,index:Ct,sourceLayerIndex:Qr})}for(const Ct of yt[Li]){const ti=Ct[0];ti.source!==this.source&&g.w(`layer.source = ${ti.source} does not equal this.source = ${this.source}`),ti.isHidden(this.zoom,!0)||(I(Ct,this.zoom,ee),(Fe[ti.id]=ti.createBucket({index:We.bucketLayerIDs.length,layers:Ct,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qr,sourceID:this.source})).populate(Hi,qe,this.tileID.canonical),We.bucketLayerIDs.push(Ct.map((hi=>hi.id))))}}const ut=g.bY(qe.glyphDependencies,(Li=>Object.keys(Li).map(Number)));this.inFlightDependencies.forEach((Li=>Li?.abort())),this.inFlightDependencies=[];let Ce=Promise.resolve({});if(Object.keys(ut).length){const Li=new AbortController;this.inFlightDependencies.push(Li),Ce=ve.sendAsync({type:"GG",data:{stacks:ut,source:this.source,tileID:this.tileID,type:"glyphs"}},Li)}const Wt=Object.keys(qe.iconDependencies);let ai=Promise.resolve({});if(Wt.length){const Li=new AbortController;this.inFlightDependencies.push(Li),ai=ve.sendAsync({type:"GI",data:{icons:Wt,source:this.source,tileID:this.tileID,type:"icons"}},Li)}const Jt=Object.keys(qe.patternDependencies);let ii=Promise.resolve({});if(Jt.length){const Li=new AbortController;this.inFlightDependencies.push(Li),ii=ve.sendAsync({type:"GI",data:{icons:Jt,source:this.source,tileID:this.tileID,type:"patterns"}},Li)}const ni=qe.dashDependencies;let oi=Promise.resolve({});if(Object.keys(ni).length){const Li=new AbortController;this.inFlightDependencies.push(Li),oi=ve.sendAsync({type:"GDA",data:{dashes:ni}},Li)}const[_n,kn,En,Tr]=yield Promise.all([Ce,ai,ii,oi]),yn=new A(_n),Tt=new g.cQ(kn,En);for(const Li in Fe){const ln=Fe[Li];ln instanceof g.ah?(I(ln.layers,this.zoom,ee),g.cR({bucket:ln,glyphMap:_n,glyphPositions:yn.positions,imageMap:kn,imagePositions:Tt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:qe.subdivisionGranularity})):ln.hasDependencies&&(ln instanceof g.cS||ln instanceof g.cT||ln instanceof g.cU)&&(I(ln.layers,this.zoom,ee),ln.addFeatures(qe,this.tileID.canonical,Tt.patternPositions,Tr))}return this.status="done",{buckets:Object.values(Fe).filter((Li=>!Li.isEmpty())),featureIndex:We,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yn.image,imageAtlas:Tt,dashPositions:Tr,glyphMap:this.returnDependencies?_n:null,iconMap:this.returnDependencies?kn:null,glyphPositions:this.returnDependencies?yn.positions:null}}))}}function I(ze,G,K){const ee=new g.H(G);for(const ve of ze)ve.recalculate(ee,K)}class z{constructor(){this.loading={},this.loaded={},this.parsing={}}startLoading(G,K){this.loading[G]=K}finishLoading(G){delete this.loading[G]}abort(G){const K=this.loading[G];K?.abort&&(K.abort.abort(),delete this.loading[G])}setParsing(G,K){this.parsing[G]=K}consumeParsing(G){const K=this.parsing[G];if(K)return delete this.parsing[G],K}clearParsing(G){delete this.parsing[G]}markLoaded(G,K){this.loaded[G]=K}getLoaded(G){const K=this.loaded[G];if(K)return K}removeLoaded(G){delete this.loaded[G]}clearLoaded(){this.loaded={}}}class W{constructor(G,K,ee,ve,Me){this.type=G,this.properties=ee||{},this.extent=Me,this.pointsArray=K,this.id=ve}loadGeometry(){return this.pointsArray.map((G=>G.map((K=>new g.P(K.x,K.y)))))}}class J{constructor(G,K,ee){this.version=2,this._myFeatures=G,this.name=K,this.length=G.length,this.extent=ee}feature(G){return this._myFeatures[G]}}class oe{constructor(){this.layers={}}addLayer(G){this.layers[G.name]=G}}function le(ze){let G=g.cV(ze);return G.byteOffset===0&&G.byteLength===G.buffer.byteLength||(G=new Uint8Array(G)),{vectorTile:ze,rawData:G.buffer}}function ne(ze,G,K){const{extent:ee}=ze,ve=Math.pow(2,K.z-G.z),Me=(K.x-G.x*ve)*ee,Xe=(K.y-G.y*ve)*ee,We=[];for(let Fe=0;Fe<ze.length;Fe++){const qe=ze.feature(Fe);let yt=qe.loadGeometry();for(const Ce of yt)for(const Wt of Ce)Wt.x=Wt.x*ve-Me,Wt.y=Wt.y*ve-Xe;const ut=128;yt=g.cW(yt,qe.type,-ut,-ut,ee+ut,ee+ut),yt.length!==0&&We.push(new W(qe.type,yt,qe.properties,qe.id,ee))}return new J(We,ze.name,ee)}class Ie{constructor(G,K,ee){this.actor=G,this.layerIndex=K,this.availableImages=ee,this.tileState=new z,this.overzoomedTileResultCache=new g.cX(1e3)}loadVectorTile(G,K){return g._(this,void 0,void 0,(function*(){const ee=yield g.n(G.request,K);try{return{vectorTile:G.encoding!=="mlt"?new g.cY(new g.cZ(ee.data)):new g.c_(ee.data),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(ve){const Me=new Uint8Array(ee.data);let Xe=`Unable to parse the tile at ${G.request.url}, `;throw Xe+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ve.message}`,new Error(Xe)}}))}loadTile(G){return g._(this,void 0,void 0,(function*(){const{uid:K,overzoomParameters:ee}=G;ee&&(G.request=ee.overzoomRequest);const ve=this._startRequestTiming(G),Me=new M(G);this.tileState.startLoading(K,Me);const Xe=new AbortController;Me.abort=Xe;try{const We=yield this.loadVectorTile(G,Xe);if(this.tileState.finishLoading(K),!We)return null;let{vectorTile:Fe,rawData:qe}=We;ee&&({vectorTile:Fe,rawData:qe}=this._getOverzoomTile(G,We.vectorTile));const yt=this._getExpiryData(We),ut=this._finishRequestTiming(ve);Me.vectorTile=Fe,this.tileState.markLoaded(K,Me);const Ce={rawData:qe,cacheControl:yt,resourceTiming:ut};this.tileState.setParsing(K,Ce);try{return yield this._parseWorkerTile(Me,G,Ce)}finally{this.tileState.clearParsing(K)}}catch(We){throw this.tileState.finishLoading(K),Me.status="done",this.tileState.markLoaded(K,Me),We}}))}_parseWorkerTile(G,K,ee){return g._(this,void 0,void 0,(function*(){let ve=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);if(ee){const{rawData:Me,cacheControl:Xe,resourceTiming:We}=ee;ve=g.e({rawTileData:Me.slice(0),encoding:K.encoding},ve,Xe,We)}return ve}))}_getExpiryData(G){const{expires:K,cacheControl:ee}=G,ve={};return K&&(ve.expires=K),ee&&(ve.cacheControl=ee),ve}_startRequestTiming(G){var K;if(!((K=G.request)===null||K===void 0)&&K.collectResourceTiming)return new g.c$(G.request.url)}_finishRequestTiming(G){const K=G?.finish();return K?{resourceTiming:JSON.parse(JSON.stringify(K))}:{}}_getOverzoomTile(G,K){const{tileID:ee,source:ve,overzoomParameters:Me}=G,{maxZoomTileID:Xe}=Me,We=`${Xe.key}_${ee.key}`,Fe=this.overzoomedTileResultCache.get(We);if(Fe)return Fe;const qe=new oe,yt=this.layerIndex.familiesBySource[ve];for(const Ce in yt){const Wt=K.layers[Ce];if(!Wt)continue;const ai=ne(Wt,Xe,ee.canonical);ai.length>0&&qe.addLayer(ai)}const ut=le(qe);return this.overzoomedTileResultCache.set(We,ut),ut}reloadTile(G){return g._(this,void 0,void 0,(function*(){const K=G.uid,ee=this.tileState.getLoaded(K);if(!ee)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(ee.showCollisionBoxes=G.showCollisionBoxes,ee.status==="parsing"){const ve=this.tileState.consumeParsing(K);return yield this._parseWorkerTile(ee,G,ve)}if(ee.status==="done"&&ee.vectorTile)return yield this._parseWorkerTile(ee,G)}))}abortTile(G){return g._(this,void 0,void 0,(function*(){this.tileState.abort(G.uid)}))}removeTile(G){return g._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(G.uid)}))}}class Ue{constructor(){this.loaded={}}loadTile(G){return g._(this,void 0,void 0,(function*(){const{uid:K,encoding:ee,rawImageData:ve,redFactor:Me,greenFactor:Xe,blueFactor:We,baseShift:Fe}=G,qe=ve.width+2,yt=ve.height+2,ut=g.b(ve)?new g.R({width:qe,height:yt},yield g.d0(ve,-1,-1,qe,yt)):ve,Ce=new g.d1(K,ut,ee,Me,Xe,We,Fe);return this.loaded=this.loaded||{},this.loaded[K]=Ce,Ce}))}removeTile(G){const K=this.loaded,ee=G.uid;K&&K[ee]&&delete K[ee]}}var Se,Ve,st=(function(){if(Ve)return Se;function ze(K,ee){if(K.length!==0){G(K[0],ee);for(var ve=1;ve<K.length;ve++)G(K[ve],!ee)}}function G(K,ee){for(var ve=0,Me=0,Xe=0,We=K.length,Fe=We-1;Xe<We;Fe=Xe++){var qe=(K[Xe][0]-K[Fe][0])*(K[Fe][1]+K[Xe][1]),yt=ve+qe;Me+=Math.abs(ve)>=Math.abs(qe)?ve-yt+qe:qe-yt+ve,ve=yt}ve+Me>=0!=!!ee&&K.reverse()}return Ve=1,Se=function K(ee,ve){var Me,Xe=ee&&ee.type;if(Xe==="FeatureCollection")for(Me=0;Me<ee.features.length;Me++)K(ee.features[Me],ve);else if(Xe==="GeometryCollection")for(Me=0;Me<ee.geometries.length;Me++)K(ee.geometries[Me],ve);else if(Xe==="Feature")K(ee.geometry,ve);else if(Xe==="Polygon")ze(ee.coordinates,ve);else if(Xe==="MultiPolygon")for(Me=0;Me<ee.coordinates.length;Me++)ze(ee.coordinates[Me],ve);return ee}})(),ot=g.d2(st);const wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},Ft=Math.fround||(lt=new Float32Array(1),ze=>(lt[0]=+ze,lt[0]));var lt;class kt{constructor(G){this.options=Object.assign(Object.create(wt),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:K,minZoom:ee,maxZoom:ve}=this.options;K&&console.time("total time");const Me=`prepare ${G.length} points`;K&&console.time(Me),this.points=G;const Xe=[];for(let Fe=0;Fe<G.length;Fe++){const qe=G[Fe];if(!qe.geometry)continue;const[yt,ut]=qe.geometry.coordinates,Ce=Ft(Dt(yt)),Wt=Ft(Pt(ut));Xe.push(Ce,Wt,1/0,Fe,-1,1),this.options.reduce&&Xe.push(0)}let We=this.trees[ve+1]=this._createTree(Xe);K&&console.timeEnd(Me);for(let Fe=ve;Fe>=ee;Fe--){const qe=+Date.now();We=this.trees[Fe]=this._createTree(this._cluster(We,Fe)),K&&console.log("z%d: %d clusters in %dms",Fe,We.numItems,+Date.now()-qe)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ee=((G[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,G[1]));let Me=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ee=-180,Me=180;else if(ee>Me){const ut=this.getClusters([ee,ve,180,Xe],K),Ce=this.getClusters([-180,ve,Me,Xe],K);return ut.concat(Ce)}const We=this.trees[this._limitZoom(K)],Fe=We.range(Dt(ee),Pt(Xe),Dt(Me),Pt(ve)),qe=We.data,yt=[];for(const ut of Fe){const Ce=this.stride*ut;yt.push(qe[Ce+5]>1?xt(qe,Ce,this.clusterProps):this.points[qe[Ce+3]])}return yt}getChildren(G){const K=this._getOriginId(G),ee=this._getOriginZoom(G),ve="No cluster with the specified id.",Me=this.trees[ee];if(!Me)throw new Error(ve);const Xe=Me.data;if(K*this.stride>=Xe.length)throw new Error(ve);const We=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Fe=Me.within(Xe[K*this.stride],Xe[K*this.stride+1],We),qe=[];for(const yt of Fe){const ut=yt*this.stride;Xe[ut+4]===G&&qe.push(Xe[ut+5]>1?xt(Xe,ut,this.clusterProps):this.points[Xe[ut+3]])}if(qe.length===0)throw new Error(ve);return qe}getLeaves(G,K,ee){const ve=[];return this._appendLeaves(ve,G,K=K||10,ee=ee||0,0),ve}getTile(G,K,ee){const ve=this.trees[this._limitZoom(G)],Me=Math.pow(2,G),{extent:Xe,radius:We}=this.options,Fe=We/Xe,qe=(ee-Fe)/Me,yt=(ee+1+Fe)/Me,ut={features:[]};return this._addTileFeatures(ve.range((K-Fe)/Me,qe,(K+1+Fe)/Me,yt),ve.data,K,ee,Me,ut),K===0&&this._addTileFeatures(ve.range(1-Fe/Me,qe,1,yt),ve.data,Me,ee,Me,ut),K===Me-1&&this._addTileFeatures(ve.range(0,qe,Fe/Me,yt),ve.data,-1,ee,Me,ut),ut.features.length?ut:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){const ee=this.getChildren(G);if(K++,ee.length!==1)break;G=ee[0].properties.cluster_id}return K}_appendLeaves(G,K,ee,ve,Me){const Xe=this.getChildren(K);for(const We of Xe){const Fe=We.properties;if(Fe&&Fe.cluster?Me+Fe.point_count<=ve?Me+=Fe.point_count:Me=this._appendLeaves(G,Fe.cluster_id,ee,ve,Me):Me<ve?Me++:G.push(We),G.length===ee)break}return Me}_createTree(G){const K=new g.aT(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<G.length;ee+=this.stride)K.add(G[ee],G[ee+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ee,ve,Me,Xe){for(const We of G){const Fe=We*this.stride,qe=K[Fe+5]>1;let yt,ut,Ce;if(qe)yt=Lt(K,Fe,this.clusterProps),ut=K[Fe],Ce=K[Fe+1];else{const Jt=this.points[K[Fe+3]];yt=Jt.properties;const[ii,ni]=Jt.geometry.coordinates;ut=Dt(ii),Ce=Pt(ni)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(ut*Me-ee)),Math.round(this.options.extent*(Ce*Me-ve))]],tags:yt};let ai;ai=qe||this.options.generateId?K[Fe+3]:this.points[K[Fe+3]].id,ai!==void 0&&(Wt.id=ai),Xe.features.push(Wt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){const{radius:ee,extent:ve,reduce:Me,minPoints:Xe}=this.options,We=ee/(ve*Math.pow(2,K)),Fe=G.data,qe=[],yt=this.stride;for(let ut=0;ut<Fe.length;ut+=yt){if(Fe[ut+2]<=K)continue;Fe[ut+2]=K;const Ce=Fe[ut],Wt=Fe[ut+1],ai=G.within(Fe[ut],Fe[ut+1],We),Jt=Fe[ut+5];let ii=Jt;for(const ni of ai){const oi=ni*yt;Fe[oi+2]>K&&(ii+=Fe[oi+5])}if(ii>Jt&&ii>=Xe){let ni,oi=Ce*Jt,_n=Wt*Jt,kn=-1;const En=(ut/yt<<5)+(K+1)+this.points.length;for(const Tr of ai){const yn=Tr*yt;if(Fe[yn+2]<=K)continue;Fe[yn+2]=K;const Tt=Fe[yn+5];oi+=Fe[yn]*Tt,_n+=Fe[yn+1]*Tt,Fe[yn+4]=En,Me&&(ni||(ni=this._map(Fe,ut,!0),kn=this.clusterProps.length,this.clusterProps.push(ni)),Me(ni,this._map(Fe,yn)))}Fe[ut+4]=En,qe.push(oi/ii,_n/ii,1/0,En,-1,ii),Me&&qe.push(kn)}else{for(let ni=0;ni<yt;ni++)qe.push(Fe[ut+ni]);if(ii>1)for(const ni of ai){const oi=ni*yt;if(!(Fe[oi+2]<=K)){Fe[oi+2]=K;for(let _n=0;_n<yt;_n++)qe.push(Fe[oi+_n])}}}}return qe}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ee){if(G[K+5]>1){const Xe=this.clusterProps[G[K+6]];return ee?Object.assign({},Xe):Xe}const ve=this.points[G[K+3]].properties,Me=this.options.map(ve);return ee&&Me===ve?Object.assign({},Me):Me}}function xt(ze,G,K){return{type:"Feature",id:ze[G+3],properties:Lt(ze,G,K),geometry:{type:"Point",coordinates:[(ee=ze[G],360*(ee-.5)),Yt(ze[G+1])]}};var ee}function Lt(ze,G,K){const ee=ze[G+5],ve=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Me=ze[G+6],Xe=Me===-1?{}:Object.assign({},K[Me]);return Object.assign(Xe,{cluster:!0,cluster_id:ze[G+3],point_count:ee,point_count_abbreviated:ve})}function Dt(ze){return ze/360+.5}function Pt(ze){const G=Math.sin(ze*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Yt(ze){const G=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function re(ze,G,K,ee){let ve=ee;const Me=G+(K-G>>1);let Xe,We=K-G;const Fe=ze[G],qe=ze[G+1],yt=ze[K],ut=ze[K+1];for(let Ce=G+3;Ce<K;Ce+=3){const Wt=be(ze[Ce],ze[Ce+1],Fe,qe,yt,ut);if(Wt>ve)Xe=Ce,ve=Wt;else if(Wt===ve){const ai=Math.abs(Ce-Me);ai<We&&(Xe=Ce,We=ai)}}ve>ee&&(Xe-G>3&&re(ze,G,Xe,ee),ze[Xe+2]=ve,K-Xe>3&&re(ze,Xe,K,ee))}function be(ze,G,K,ee,ve,Me){let Xe=ve-K,We=Me-ee;if(Xe!==0||We!==0){const Fe=((ze-K)*Xe+(G-ee)*We)/(Xe*Xe+We*We);Fe>1?(K=ve,ee=Me):Fe>0&&(K+=Xe*Fe,ee+=We*Fe)}return Xe=ze-K,We=G-ee,Xe*Xe+We*We}function _e(ze,G,K,ee){const ve={type:G,geom:K},Me={id:ze??null,type:ve.type,geometry:ve.geom,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(ve.type){case"Point":case"MultiPoint":case"LineString":Be(Me,ve.geom);break;case"Polygon":Be(Me,ve.geom[0]);break;case"MultiLineString":for(const Xe of ve.geom)Be(Me,Xe);break;case"MultiPolygon":for(const Xe of ve.geom)Be(Me,Xe[0])}return Me}function Be(ze,G){for(let K=0;K<G.length;K+=3)ze.minX=Math.min(ze.minX,G[K]),ze.minY=Math.min(ze.minY,G[K+1]),ze.maxX=Math.max(ze.maxX,G[K]),ze.maxY=Math.max(ze.maxY,G[K+1])}function nt(ze,G){const K=[];switch(ze.type){case"FeatureCollection":for(let ee=0;ee<ze.features.length;ee++)he(K,ze.features[ee],G,ee);break;case"Feature":he(K,ze,G);break;default:he(K,{geometry:ze,properties:void 0},G)}return K}function he(ze,G,K,ee){if(!G.geometry)return;if(G.geometry.type==="GeometryCollection"){for(const We of G.geometry.geometries)he(ze,{id:G.id,geometry:We,properties:G.properties},K,ee);return}if(!G.geometry.coordinates?.length)return;const Me=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Xe=G.id;switch(K.promoteId?Xe=G.properties?.[K.promoteId]:K.generateId&&(Xe=ee||0),G.geometry.type){case"Point":{const We=[];return Oe(G.geometry.coordinates,We),void ze.push(_e(Xe,G.geometry.type,We,G.properties))}case"MultiPoint":{const We=[];for(const Fe of G.geometry.coordinates)Oe(Fe,We);return void ze.push(_e(Xe,G.geometry.type,We,G.properties))}case"LineString":{const We=[];return Je(G.geometry.coordinates,We,Me,!1),void ze.push(_e(Xe,G.geometry.type,We,G.properties))}case"MultiLineString":{if(K.lineMetrics){for(const Fe of G.geometry.coordinates){const qe=[];Je(Fe,qe,Me,!1),ze.push(_e(Xe,"LineString",qe,G.properties))}return}const We=[];return gt(G.geometry.coordinates,We,Me,!1),void ze.push(_e(Xe,G.geometry.type,We,G.properties))}case"Polygon":{const We=[];return gt(G.geometry.coordinates,We,Me,!0),void ze.push(_e(Xe,G.geometry.type,We,G.properties))}case"MultiPolygon":{const We=[];for(const Fe of G.geometry.coordinates){const qe=[];gt(Fe,qe,Me,!0),We.push(qe)}return void ze.push(_e(Xe,G.geometry.type,We,G.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Oe(ze,G){G.push(Mt(ze[0]),$t(ze[1]),0)}function Je(ze,G,K,ee){let ve,Me,Xe=0;for(let Fe=0;Fe<ze.length;Fe++){const qe=Mt(ze[Fe][0]),yt=$t(ze[Fe][1]);G.push(qe,yt,0),Fe>0&&(Xe+=ee?(ve*yt-qe*Me)/2:Math.sqrt(Math.pow(qe-ve,2)+Math.pow(yt-Me,2))),ve=qe,Me=yt}const We=G.length-3;G[2]=1,K>0&&re(G,0,We,K),G[We+2]=1,G.size=Math.abs(Xe),G.start=0,G.end=G.size}function gt(ze,G,K,ee){for(let ve=0;ve<ze.length;ve++){const Me=[];Je(ze[ve],Me,K,ee),G.push(Me)}}function Mt(ze){return ze/360+.5}function $t(ze){const G=Math.sin(ze*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Ht(ze,G,K,ee,ve,Me,Xe,We){if(ee/=G,Me>=(K/=G)&&Xe<ee)return ze;if(Xe<K||Me>=ee)return null;const Fe=[];for(const qe of ze){const yt=ve===0?qe.minX:qe.minY,ut=ve===0?qe.maxX:qe.maxY;if(yt>=K&&ut<ee)Fe.push(qe);else if(!(ut<K||yt>=ee))switch(qe.type){case"Point":case"MultiPoint":{const Ce=[];if(Qt(qe.geometry,Ce,K,ee,ve),!Ce.length)continue;Fe.push(_e(qe.id,Ce.length===3?"Point":"MultiPoint",Ce,qe.tags));continue}case"LineString":{const Ce=[];if(vi(qe.geometry,Ce,K,ee,ve,!1,We.lineMetrics),!Ce.length)continue;if(We.lineMetrics){for(const Wt of Ce)Fe.push(_e(qe.id,qe.type,Wt,qe.tags));continue}if(Ce.length>1){Fe.push(_e(qe.id,"MultiLineString",Ce,qe.tags));continue}Fe.push(_e(qe.id,qe.type,Ce[0],qe.tags));continue}case"MultiLineString":{const Ce=[];if(Mr(qe.geometry,Ce,K,ee,ve,!1),!Ce.length)continue;if(Ce.length===1){Fe.push(_e(qe.id,"LineString",Ce[0],qe.tags));continue}Fe.push(_e(qe.id,qe.type,Ce,qe.tags));continue}case"Polygon":{const Ce=[];if(Mr(qe.geometry,Ce,K,ee,ve,!0),!Ce.length)continue;Fe.push(_e(qe.id,qe.type,Ce,qe.tags));continue}case"MultiPolygon":{const Ce=[];for(const Wt of qe.geometry){const ai=[];Mr(Wt,ai,K,ee,ve,!0),ai.length&&Ce.push(ai)}if(!Ce.length)continue;Fe.push(_e(qe.id,qe.type,Ce,qe.tags));continue}}}return Fe.length?Fe:null}function Qt(ze,G,K,ee,ve){for(let Me=0;Me<ze.length;Me+=3){const Xe=ze[Me+ve];Xe>=K&&Xe<=ee&&An(G,ze[Me],ze[Me+1],ze[Me+2])}}function vi(ze,G,K,ee,ve,Me,Xe){let We=Mi(ze);const Fe=ve===0?Oo:gn;let qe,yt,ut=ze.start;for(let ii=0;ii<ze.length-3;ii+=3){const ni=ze[ii],oi=ze[ii+1],_n=ze[ii+2],kn=ze[ii+3],En=ze[ii+4],Tr=ve===0?ni:oi,yn=ve===0?kn:En;let Tt=!1;Xe&&(qe=Math.sqrt(Math.pow(ni-kn,2)+Math.pow(oi-En,2))),Tr<K?yn>K&&(yt=Fe(We,ni,oi,kn,En,K),Xe&&(We.start=ut+qe*yt)):Tr>ee?yn<ee&&(yt=Fe(We,ni,oi,kn,En,ee),Xe&&(We.start=ut+qe*yt)):An(We,ni,oi,_n),yn<K&&Tr>=K&&(yt=Fe(We,ni,oi,kn,En,K),Tt=!0),yn>ee&&Tr<=ee&&(yt=Fe(We,ni,oi,kn,En,ee),Tt=!0),!Me&&Tt&&(Xe&&(We.end=ut+qe*yt),G.push(We),We=Mi(ze)),Xe&&(ut+=qe)}let Ce=ze.length-3;const Wt=ze[Ce],ai=ze[Ce+1],Jt=ve===0?Wt:ai;Jt>=K&&Jt<=ee&&An(We,Wt,ai,ze[Ce+2]),Ce=We.length-3,Me&&Ce>=3&&(We[Ce]!==We[0]||We[Ce+1]!==We[1])&&An(We,We[0],We[1],We[2]),We.length&&G.push(We)}function Mi(ze){const G=[];return G.size=ze.size,G.start=ze.start,G.end=ze.end,G}function Mr(ze,G,K,ee,ve,Me){for(const Xe of ze)vi(Xe,G,K,ee,ve,Me,!1)}function An(ze,G,K,ee){ze.push(G,K,ee)}function Oo(ze,G,K,ee,ve,Me){const Xe=(Me-G)/(ee-G);return An(ze,Me,K+(ve-K)*Xe,1),Xe}function gn(ze,G,K,ee,ve,Me){const Xe=(Me-K)/(ve-K);return An(ze,G+(ee-G)*Xe,Me,1),Xe}function gi(ze,G){const K=G.buffer/G.extent;let ee=ze;const ve=Ht(ze,1,-1-K,K,0,-1,2,G),Me=Ht(ze,1,1-K,2+K,0,-1,2,G);return(ve||Me)&&(ee=Ht(ze,1,-K,1+K,0,-1,2,G)||[],ve&&(ee=bi(ve,1).concat(ee)),Me&&(ee=ee.concat(bi(Me,-1)))),ee}function bi(ze,G){const K=[];for(const ee of ze)switch(ee.type){case"Point":case"MultiPoint":case"LineString":{const ve=mn(ee.geometry,G);K.push(_e(ee.id,ee.type,ve,ee.tags));continue}case"MultiLineString":case"Polygon":{const ve=[];for(const Me of ee.geometry)ve.push(mn(Me,G));K.push(_e(ee.id,ee.type,ve,ee.tags));continue}case"MultiPolygon":{const ve=[];for(const Me of ee.geometry){const Xe=[];for(const We of Me)Xe.push(mn(We,G));ve.push(Xe)}K.push(_e(ee.id,ee.type,ve,ee.tags));continue}}return K}function mn(ze,G){const K=[];K.size=ze.size,ze.start!==void 0&&(K.start=ze.start,K.end=ze.end);for(let ee=0;ee<ze.length;ee+=3)K.push(ze[ee]+G,ze[ee+1],ze[ee+2]);return K}function Ea(ze,G){if(ze.transformed)return ze;const K=1<<ze.z,ee=ze.x,ve=ze.y;for(const Me of ze.features){if(Me.type===1){const We=[];for(let Fe=0;Fe<Me.geometry.length;Fe+=2)We.push(ko(Me.geometry[Fe],Me.geometry[Fe+1],G,K,ee,ve));Me.geometry=We;continue}const Xe=[];for(const We of Me.geometry){const Fe=[];for(let qe=0;qe<We.length;qe+=2)Fe.push(ko(We[qe],We[qe+1],G,K,ee,ve));Xe.push(Fe)}Me.geometry=Xe}return ze.transformed=!0,ze}function ko(ze,G,K,ee,ve,Me){return[Math.round(K*(ze*ee-ve)),Math.round(K*(G*ee-Me))]}function to(ze,G,K,ee,ve){const Me=G===ve.maxZoom?0:ve.tolerance/((1<<G)*ve.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:ze.length,source:null,x:K,y:ee,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of ze)Ca(Xe,We,Me,ve);return Xe}function Ca(ze,G,K,ee){ze.minX=Math.min(ze.minX,G.minX),ze.minY=Math.min(ze.minY,G.minY),ze.maxX=Math.max(ze.maxX,G.maxX),ze.maxY=Math.max(ze.maxY,G.maxY);let ve,Me=G.tags||null;switch(G.type){case"Point":case"MultiPoint":{const Xe=[];for(let We=0;We<G.geometry.length;We+=3)Xe.push(G.geometry[We],G.geometry[We+1]),ze.numPoints++,ze.numSimplified++;if(!Xe.length)return;ve={type:1,tags:Me,geometry:Xe};break}case"LineString":{const Xe=[];if(oa(Xe,G.geometry,ze,K,!1,!1),!Xe.length)return;if(ee.lineMetrics){Me={};for(const We in G.tags)Me[We]=G.tags[We];Me.mapbox_clip_start=G.geometry.start/G.geometry.size,Me.mapbox_clip_end=G.geometry.end/G.geometry.size}ve={type:2,tags:Me,geometry:Xe};break}case"MultiLineString":case"Polygon":{const Xe=[];for(let We=0;We<G.geometry.length;We++)oa(Xe,G.geometry[We],ze,K,G.type==="Polygon",We===0);if(!Xe.length)return;ve={type:G.type==="Polygon"?3:2,tags:Me,geometry:Xe};break}case"MultiPolygon":{const Xe=[];for(let We=0;We<G.geometry.length;We++){const Fe=G.geometry[We];for(let qe=0;qe<Fe.length;qe++)oa(Xe,Fe[qe],ze,K,!0,qe===0)}if(!Xe.length)return;ve={type:3,tags:Me,geometry:Xe};break}}G.id!==null&&(ve.id=G.id),ze.features.push(ve)}function oa(ze,G,K,ee,ve,Me){const Xe=ee*ee;if(ee>0&&G.size<(ve?Xe:ee))return void(K.numPoints+=G.length/3);const We=[];for(let Fe=0;Fe<G.length;Fe+=3)(ee===0||G[Fe+2]>Xe)&&(K.numSimplified++,We.push(G[Fe],G[Fe+1])),K.numPoints++;ve&&(function(Fe,qe){let yt=0;for(let ut=0,Ce=Fe.length,Wt=Ce-2;ut<Ce;Wt=ut,ut+=2)yt+=(Fe[ut]-Fe[Wt])*(Fe[ut+1]+Fe[Wt+1]);if(yt>0===qe)for(let ut=0,Ce=Fe.length;ut<Ce/2;ut+=2){const Wt=Fe[ut],ai=Fe[ut+1];Fe[ut]=Fe[Ce-2-ut],Fe[ut+1]=Fe[Ce-1-ut],Fe[Ce-2-ut]=Wt,Fe[Ce-1-ut]=ai}})(We,Me),ze.push(We)}function yc(ze,G,K){const ee=!!G.newGeometry,ve=G.removeAllProperties||G.removeProperties?.length>0||G.addOrUpdateProperties?.length>0;if(ee){let Me=nt({type:"FeatureCollection",features:[{type:"Feature",id:ze.id,geometry:G.newGeometry,properties:ve?rr(ze.tags,G):ze.tags}]},K);return Me=gi(Me,K),Me[0]}if(ve){const Me={...ze};return Me.tags=rr(Me.tags,G),Me}return null}function rr(ze,G){if(G.removeAllProperties)return{};const K={...ze||{}};if(G.removeProperties)for(const ee of G.removeProperties)delete K[ee];if(G.addOrUpdateProperties)for(const{key:ee,value:ve}of G.addOrUpdateProperties)K[ee]=ve;return K}const gs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class vc{options;tiles;tileCoords;stats={};total=0;source;constructor(G,K){const ee=(K=this.options=Object.assign({},gs,K)).debug;if(ee&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=nt(G,K);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=gi(ve,K),ve.length&&this.splitTile(ve,0,0,0),K.updateable&&(this.source=ve),ee&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ee,ve,Me,Xe,We){const Fe=[G,K,ee,ve],qe=this.options,yt=qe.debug;for(;Fe.length;){ve=Fe.pop(),ee=Fe.pop(),K=Fe.pop(),G=Fe.pop();const ut=1<<K,Ce=io(K,ee,ve);let Wt=this.tiles[Ce];if(!Wt&&(yt>1&&console.time("creation"),Wt=this.tiles[Ce]=to(G,K,ee,ve,qe),this.tileCoords.push({z:K,x:ee,y:ve,id:Ce}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ee,ve,Wt.numFeatures,Wt.numPoints,Wt.numSimplified),console.timeEnd("creation"));const Tt=`z${K}`;this.stats[Tt]=(this.stats[Tt]||0)+1,this.total++}if(Wt.source=G,Me==null){if(K===qe.indexMaxZoom||Wt.numPoints<=qe.indexMaxPoints)continue}else{if(K===qe.maxZoom||K===Me)continue;if(Me!=null){const Tt=Me-K;if(ee!==Xe>>Tt||ve!==We>>Tt)continue}}if(Wt.source=null,!G.length)continue;yt>1&&console.time("clipping");const ai=.5*qe.buffer/qe.extent,Jt=.5-ai,ii=.5+ai,ni=1+ai;let oi=null,_n=null,kn=null,En=null;const Tr=Ht(G,ut,ee-ai,ee+ii,0,Wt.minX,Wt.maxX,qe),yn=Ht(G,ut,ee+Jt,ee+ni,0,Wt.minX,Wt.maxX,qe);Tr&&(oi=Ht(Tr,ut,ve-ai,ve+ii,1,Wt.minY,Wt.maxY,qe),_n=Ht(Tr,ut,ve+Jt,ve+ni,1,Wt.minY,Wt.maxY,qe)),yn&&(kn=Ht(yn,ut,ve-ai,ve+ii,1,Wt.minY,Wt.maxY,qe),En=Ht(yn,ut,ve+Jt,ve+ni,1,Wt.minY,Wt.maxY,qe)),yt>1&&console.timeEnd("clipping"),Fe.push(oi||[],K+1,2*ee,2*ve),Fe.push(_n||[],K+1,2*ee,2*ve+1),Fe.push(kn||[],K+1,2*ee+1,2*ve),Fe.push(En||[],K+1,2*ee+1,2*ve+1)}}getTile(G,K,ee){G=+G,K=+K,ee=+ee;const ve=this.options,{extent:Me,debug:Xe}=ve;if(G<0||G>24)return null;const We=1<<G,Fe=io(G,K=K+We&We-1,ee);if(this.tiles[Fe])return Ea(this.tiles[Fe],Me);Xe>1&&console.log("drilling down to z%d-%d-%d",G,K,ee);let qe,yt=G,ut=K,Ce=ee;for(;!qe&&yt>0;)yt--,ut>>=1,Ce>>=1,qe=this.tiles[io(yt,ut,Ce)];return qe?.source?(Xe>1&&(console.log("found parent tile z%d-%d-%d",yt,ut,Ce),console.time("drilling down")),this.splitTile(qe.source,yt,ut,Ce,G,K,ee),Xe>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Ea(this.tiles[Fe],Me):null):null}invalidateTiles(G){const K=this.options,{debug:ee}=K;let ve=1/0,Me=-1/0,Xe=1/0,We=-1/0;for(const yt of G)ve=Math.min(ve,yt.minX),Me=Math.max(Me,yt.maxX),Xe=Math.min(Xe,yt.minY),We=Math.max(We,yt.maxY);const Fe=K.buffer/K.extent,qe=new Set;for(const yt in this.tiles){const ut=this.tiles[yt],Ce=1<<ut.z,Wt=(ut.x-Fe)/Ce,ai=(ut.x+1+Fe)/Ce,Jt=(ut.y-Fe)/Ce,ii=(ut.y+1+Fe)/Ce;if(Me<Wt||ve>=ai||We<Jt||Xe>=ii)continue;let ni=!1;for(const oi of G)if(oi.maxX>=Wt&&oi.minX<ai&&oi.maxY>=Jt&&oi.minY<ii){ni=!0;break}if(ni){if(ee){ee>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ut.z,ut.x,ut.y,ut.numFeatures,ut.numPoints,ut.numSimplified);const oi=`z${ut.z}`;this.stats[oi]=(this.stats[oi]||0)-1,this.total--}delete this.tiles[yt],qe.add(yt)}}qe.size&&(this.tileCoords=this.tileCoords.filter((yt=>!qe.has(yt.id))))}updateData(G){const K=this.options,ee=K.debug;if(!K.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:ve,source:Me}=(function(ut,Ce,Wt){const ai=(function(ii){return ii?{removeAll:ii.removeAll,remove:new Set(ii.remove||[]),add:new Map(ii.add?.map((ni=>[ni.id,ni]))),update:new Map(ii.update?.map((ni=>[ni.id,ni])))}:{remove:new Set,add:new Map,update:new Map}})(Ce);let Jt=[];if(ai.removeAll&&(Jt=ut,ut=[]),ai.remove.size||ai.add.size){const ii=[];for(const ni of ut){const{id:oi}=ni;(ai.remove.has(oi)||ai.add.has(oi))&&ii.push(ni)}if(ii.length){Jt.push(...ii);const ni=new Set(ii.map((oi=>oi.id)));ut=ut.filter((oi=>!ni.has(oi.id)))}if(ai.add.size){let ni=nt({type:"FeatureCollection",features:Array.from(ai.add.values())},Wt);ni=gi(ni,Wt),Jt.push(...ni),ut.push(...ni)}}if(ai.update.size)for(const[ii,ni]of ai.update){const oi=ut.findIndex((En=>En.id===ii));if(oi===-1)continue;const _n=ut[oi],kn=yc(_n,ni,Wt);kn&&(Jt.push(_n,kn),ut[oi]=kn)}return{affected:Jt,source:ut}})(this.source,G,K);if(!ve.length)return;this.source=Me,ee>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(ve),ee>1&&console.timeEnd("invalidating");const[Xe,We,Fe]=[0,0,0],qe=to(this.source,Xe,We,Fe,this.options);qe.source=this.source;const yt=io(Xe,We,Fe);if(this.tiles[yt]=qe,this.tileCoords.push({z:Xe,x:We,y:Fe,id:yt}),ee){const ut=`z${Xe}`;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}}}function io(ze,G,K){return 32*((1<<ze)*K+G)+ze}class no{constructor(G,K,ee,ve=fu){this._dataUpdateable=new Map,this.actor=G,this.layerIndex=K,this.availableImages=ee,this.tileState=new z,this._createGeoJSONIndex=ve}loadVectorTile(G){if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const{z:K,x:ee,y:ve}=G.tileID.canonical,Me=this._geoJSONIndex.getTile(K,ee,ve);return Me?le(new g.d3(Me.features,{version:2,extent:g.a5})):null}loadTile(G){return g._(this,void 0,void 0,(function*(){const{uid:K}=G,ee=new M(G);ee.abort=new AbortController;try{const ve=this.loadVectorTile(G);if(!ve)return null;const{vectorTile:Me,rawData:Xe}=ve;ee.vectorTile=Me,this.tileState.markLoaded(K,ee);const We={rawData:Xe};this.tileState.setParsing(K,We);try{return yield this._parseWorkerTile(ee,G,We)}finally{this.tileState.clearParsing(K)}}catch(ve){throw ee.status="done",this.tileState.markLoaded(K,ee),ve}}))}_reloadLoadedTile(G){return g._(this,void 0,void 0,(function*(){const K=G.uid,ee=this.tileState.getLoaded(K);if(!ee)throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");if(ee.showCollisionBoxes=G.showCollisionBoxes,ee.status==="parsing"){const ve=this.tileState.consumeParsing(K);return yield this._parseWorkerTile(ee,G,ve)}if(ee.status==="done"&&ee.vectorTile)return yield this._parseWorkerTile(ee,G)}))}_parseWorkerTile(G,K,ee){return g._(this,void 0,void 0,(function*(){let ve=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,K.subdivisionGranularity);if(ee){const{rawData:Me}=ee;ve=g.e({rawTileData:Me.slice(0)},ve)}return ve}))}abortTile(G){return g._(this,void 0,void 0,(function*(){this.tileState.abort(G.uid)}))}removeTile(G){return g._(this,void 0,void 0,(function*(){this.tileState.removeLoaded(G.uid)}))}loadData(G){return g._(this,void 0,void 0,(function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ee=this._startRequestTiming(G);this._pendingRequest=new AbortController;try{(!this._pendingData||G.request||G.data||G.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(G,this._pendingRequest));const ve=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ve,G),this.tileState.clearLoaded();const Me={};return G.request&&(Me.data=ve),this._finishRequestTiming(ee,G,Me),Me}catch(ve){if(delete this._pendingRequest,g.Z(ve))return{abandoned:!0};throw ve}}))}_startRequestTiming(G){var K;if(!((K=G.request)===null||K===void 0)&&K.collectResourceTiming)return new g.c$(G.request.url)}_finishRequestTiming(G,K,ee){const ve=G?.finish();ve&&(ee.resourceTiming={[K.source]:JSON.parse(JSON.stringify(ve))})}getData(){return g._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(G){return this.tileState.getLoaded(G.uid)?this._reloadLoadedTile(G):this.loadTile(G)}loadAndProcessGeoJSON(G,K){return g._(this,void 0,void 0,(function*(){let ee;if(G.request?ee=yield this.loadGeoJSONFromUrl(G.request,G.promoteId,K):G.data?ee=this._loadGeoJSONFromObject(G.data,G.promoteId):G.dataDiff&&(ee=this._loadGeoJSONFromDiff(G.dataDiff,G.promoteId,G.source)),delete this._pendingRequest,typeof ee!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);return ot(ee,!0),G.filter&&(ee=this._filterGeoJSON(ee,G.filter)),ee}))}loadGeoJSONFromUrl(G,K,ee){return g._(this,void 0,void 0,(function*(){const ve=yield g.j(G,ee);return this._dataUpdateable=g.a7(ve.data,K),ve.data}))}_loadGeoJSONFromObject(G,K){return this._dataUpdateable=g.a7(G,K),G}_loadGeoJSONFromDiff(G,K,ee){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ee}`);g.a8(this._dataUpdateable,G,K);const ve=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ve)}_filterGeoJSON(G,K){const ee=g.d4(K,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map((Me=>`${Me.key}: ${Me.message}`)).join(", "));const ve=G.features.filter((Me=>ee.value.evaluate({zoom:0},Me)));return this._toFeatureCollection(ve)}_toFeatureCollection(G){return{type:"FeatureCollection",features:G}}removeSource(G){return g._(this,void 0,void 0,(function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort()}))}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}function fu(ze,G){return G.cluster?new kt((function({superclusterOptions:K,clusterProperties:ee}){if(!ee||!K)return K;const ve={},Me={},Xe={accumulated:null,zoom:0},We={properties:null},Fe=Object.keys(ee);for(const qe of Fe){const[yt,ut]=ee[qe],Ce=g.d4(ut),Wt=g.d4(typeof yt=="string"?[yt,["accumulated"],["get",qe]]:yt);ve[qe]=Ce.value,Me[qe]=Wt.value}return K.map=qe=>{We.properties=qe;const yt={};for(const ut of Fe)yt[ut]=ve[ut].evaluate(Xe,We);return yt},K.reduce=(qe,yt)=>{We.properties=yt;for(const ut of Fe)Xe.accumulated=qe[ut],qe[ut]=Me[ut].evaluate(Xe,We)},K})(G)).load(ze.features):(function(K,ee){return new vc(K,ee)})(ze,G.geojsonVtOptions)}class Lo{constructor(G){this.self=G,this.actor=new g.L(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(K,ee)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ee},this.self.addProtocol=g.cK,this.self.removeProtocol=g.cL,this.self.registerRTLTextPlugin=K=>{g.d5.setMethods(K)},this.actor.registerMessageHandler("LDT",((K,ee)=>this._getDEMWorkerSource(K,ee.source).loadTile(ee))),this.actor.registerMessageHandler("RDT",((K,ee)=>g._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(K,ee.source).removeTile(ee)})))),this.actor.registerMessageHandler("GCEZ",((K,ee)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ee.type,ee.source).getClusterExpansionZoom(ee)})))),this.actor.registerMessageHandler("GCC",((K,ee)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ee.type,ee.source).getClusterChildren(ee)})))),this.actor.registerMessageHandler("GCL",((K,ee)=>g._(this,void 0,void 0,(function*(){return this._getWorkerSource(K,ee.type,ee.source).getClusterLeaves(ee)})))),this.actor.registerMessageHandler("LD",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).loadData(ee))),this.actor.registerMessageHandler("GD",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).getData())),this.actor.registerMessageHandler("LT",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).loadTile(ee))),this.actor.registerMessageHandler("RT",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).reloadTile(ee))),this.actor.registerMessageHandler("AT",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).abortTile(ee))),this.actor.registerMessageHandler("RMT",((K,ee)=>this._getWorkerSource(K,ee.type,ee.source).removeTile(ee))),this.actor.registerMessageHandler("RS",((K,ee)=>g._(this,void 0,void 0,(function*(){if(!this.workerSources[K]||!this.workerSources[K][ee.type]||!this.workerSources[K][ee.type][ee.source])return;const ve=this.workerSources[K][ee.type][ee.source];delete this.workerSources[K][ee.type][ee.source],ve.removeSource!==void 0&&ve.removeSource(ee)})))),this.actor.registerMessageHandler("RM",(K=>g._(this,void 0,void 0,(function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K],this.globalStates.delete(K)})))),this.actor.registerMessageHandler("SR",((K,ee)=>g._(this,void 0,void 0,(function*(){this.referrer=ee})))),this.actor.registerMessageHandler("SRPS",((K,ee)=>this._syncRTLPluginState(K,ee))),this.actor.registerMessageHandler("IS",((K,ee)=>g._(this,void 0,void 0,(function*(){this.self.importScripts(ee)})))),this.actor.registerMessageHandler("SI",((K,ee)=>this._setImages(K,ee))),this.actor.registerMessageHandler("UL",((K,ee)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(K).update(ee.layers,ee.removedIds,this._getGlobalState(K))})))),this.actor.registerMessageHandler("UGS",((K,ee)=>g._(this,void 0,void 0,(function*(){const ve=this._getGlobalState(K);for(const Me in ee)ve[Me]=ee[Me]})))),this.actor.registerMessageHandler("SL",((K,ee)=>g._(this,void 0,void 0,(function*(){this._getLayerIndex(K).replace(ee,this._getGlobalState(K))}))))}_getGlobalState(G){let K=this.globalStates.get(G);return K||(K={},this.globalStates.set(G,K)),K}_setImages(G,K){return g._(this,void 0,void 0,(function*(){this.availableImages[G]=K;for(const ee in this.workerSources[G]){const ve=this.workerSources[G][ee];for(const Me in ve)ve[Me].availableImages=K}}))}_syncRTLPluginState(G,K){return g._(this,void 0,void 0,(function*(){return yield g.d5.syncState(K,this.self.importScripts)}))}_getAvailableImages(G){let K=this.availableImages[G];return K||(K=[]),K}_getLayerIndex(G){let K=this.layerIndexes[G];return K||(K=this.layerIndexes[G]=new o),K}_getWorkerSource(G,K,ee){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][K]||(this.workerSources[G][K]={}),!this.workerSources[G][K][ee]){const ve={sendAsync:(Me,Xe)=>(Me.targetMapId=G,this.actor.sendAsync(Me,Xe))};switch(K){case"vector":this.workerSources[G][K][ee]=new Ie(ve,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][K][ee]=new no(ve,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][K][ee]=new this.externalWorkerSourceTypes[K](ve,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][K][ee]}_getDEMWorkerSource(G,K){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][K]||(this.demWorkerSources[G][K]=new Ue),this.demWorkerSources[G][K]}}return g.i(self)&&(self.worker=new Lo(self)),Lo})),l("index",["exports","./shared"],(function(g,o){var A="5.18.0";function M(){var w=new o.A(4);return o.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}let I,z,W;const J={frame(w,r,h,m){const v=m||window,S=v.requestAnimationFrame((R=>{C(),r(R)})),{unsubscribe:C}=o.s(w.signal,"abort",(()=>{C(),v.cancelAnimationFrame(S),h(new o.a(w.signal.reason))}),!1)},frameAsync(w,r){return new Promise(((h,m)=>{this.frame(w,h,m,r)}))},getImageData(w,r=0){return this.getImageCanvasContext(w).getImageData(-r,-r,w.width+2*r,w.height+2*r)},getImageCanvasContext(w){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=w.width,r.height=w.height,h.drawImage(w,0,0,w.width,w.height),h},resolveURL:w=>(I||(I=document.createElement("a")),I.href=w,I.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return W!==void 0?W:!!matchMedia&&(z==null&&(z=matchMedia("(prefers-reduced-motion: reduce)")),z.matches)},set prefersReducedMotion(w){W=w}},oe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(w){this._frozenAt=w}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function le(){return oe.getCurrentTime()}class ne{static testProp(r){if(!ne.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in ne.docStyle)return r[h];return r[0]}static create(r,h,m){const v=window.document.createElement(r);return h!==void 0&&(v.className=h),m&&m.appendChild(v),v}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){ne.docStyle&&ne.selectProp&&(ne.userSelect=ne.docStyle[ne.selectProp],ne.docStyle[ne.selectProp]="none")}static enableDrag(){ne.docStyle&&ne.selectProp&&(ne.docStyle[ne.selectProp]=ne.userSelect)}static setTransform(r,h){r.style[ne.transformProp]=h}static addEventListener(r,h,m,v={}){r.addEventListener(h,m,"passive"in v?v:v.capture)}static removeEventListener(r,h,m,v={}){r.removeEventListener(h,m,"passive"in v?v:v.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",ne.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ne.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ne.suppressClickInternal,!0)}),0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,m){const v=h.boundingClientRect;return new o.P((m.clientX-v.left)/h.x-r.clientLeft,(m.clientY-v.top)/h.y-r.clientTop)}static mousePos(r,h){const m=ne.getScale(r);return ne.getPoint(r,m,h)}static touchPos(r,h){const m=[],v=ne.getScale(r);for(let S=0;S<h.length;S++)m.push(ne.getPoint(r,v,h[S]));return m}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}static sanitize(r){const h=new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),m=h.querySelectorAll("script");for(const v of m)v.remove();return ne.clean(h),h.innerHTML}static isPossiblyDangerous(r,h){const m=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(r)||!m.includes("javascript:")&&!m.includes("data:"))||!!r.startsWith("on")||void 0}static clean(r){const h=r.children;for(const m of h)ne.removeAttributes(m),ne.clean(m)}static removeAttributes(r){for(const{name:h,value:m}of r.attributes)ne.isPossiblyDangerous(h,m)&&r.removeAttribute(h)}}ne.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ne.selectProp=ne.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ne.transformProp=ne.testProp(["transform","WebkitTransform"]);const Ie={supported:!1,testSupport:function(w){!Ve&&Se&&(st?ot(w):Ue=w)}};let Ue,Se,Ve=!1,st=!1;function ot(w){const r=w.createTexture();w.bindTexture(w.TEXTURE_2D,r);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,Se),w.isContextLost())return;Ie.supported=!0}catch{}w.deleteTexture(r),Ve=!0}var wt;typeof document<"u"&&(Se=document.createElement("img"),Se.onload=()=>{Ue&&ot(Ue),Ue=null,st=!0},Se.onerror=()=>{Ve=!0,Ue=null},Se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(w){let r,h,m,v;w.resetRequestQueue=()=>{r=[],h=0,m=0,v={}},w.addThrottleControl=k=>{const N=m++;return v[N]=k,N},w.removeThrottleControl=k=>{delete v[k],C()},w.getImage=(k,N,U=!0)=>new Promise(((H,$)=>{Ie.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),o.e(k,{type:"image"}),r.push({abortController:N,requestParameters:k,supportImageRefresh:U,state:"queued",onError:Y=>{$(Y)},onSuccess:Y=>{H(Y)}}),C()}));const S=k=>o._(this,void 0,void 0,(function*(){k.state="running";const{requestParameters:N,supportImageRefresh:U,onError:H,onSuccess:$,abortController:Y}=k,te=U===!1&&!o.i(self)&&!o.g(N.url)&&(!N.headers||Object.keys(N.headers).reduce(((fe,ye)=>fe&&ye==="accept"),!0));h++;const ce=te?R(N,Y):o.m(N,Y);try{const fe=yield ce;delete k.abortController,k.state="completed",fe.data instanceof HTMLImageElement||o.b(fe.data)?$(fe):fe.data&&$({data:yield(de=fe.data,typeof createImageBitmap=="function"?o.f(de):o.h(de)),cacheControl:fe.cacheControl,expires:fe.expires})}catch(fe){delete k.abortController,H(fe)}finally{h--,C()}var de})),C=()=>{const k=(()=>{for(const N of Object.keys(v))if(v[N]())return!0;return!1})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let N=h;N<k&&r.length>0;N++){const U=r.shift();U.abortController.signal.aborted?N--:S(U)}},R=(k,N)=>new Promise(((U,H)=>{const $=new Image,Y=k.url,te=k.credentials;te&&te==="include"?$.crossOrigin="use-credentials":(te&&te==="same-origin"||!o.d(Y))&&($.crossOrigin="anonymous"),N.signal.addEventListener("abort",(()=>{$.src="",H(new o.a(N.signal.reason))})),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,U({data:$})},$.onerror=()=>{$.onerror=$.onload=null,N.signal.aborted||H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=Y}))})(wt||(wt={})),wt.resetRequestQueue();class Ft{constructor(r){this._transformRequestFn=r??null}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function lt(w){const r=[];if(typeof w=="string")r.push({id:"default",url:w});else if(w&&w.length>0){const h=[];for(const{id:m,url:v}of w){const S=`${m}${v}`;h.indexOf(S)===-1&&(h.push(S),r.push({id:m,url:v}))}}return r}function kt(w,r,h){try{const m=new URL(w);return m.pathname+=`${r}${h}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${w}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function xt(w){const{userImage:r}=w;return!!(r&&r.render&&r.render())&&(w.data.replace(new Uint8Array(r.data.buffer)),!0)}class Lt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const r of Object.keys(this.images))this.removeImage(r);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:m}of this.requestors)m(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const m=h.spriteData;h.data=new o.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let m=!0;const v=h.data||h.spriteData;return this._validateStretch(h.stretchX,v&&v.width)||(this.fire(new o.k(new Error(`Image "${r}" has invalid "stretchX" value`))),m=!1),this._validateStretch(h.stretchY,v&&v.height)||(this.fire(new o.k(new Error(`Image "${r}" has invalid "stretchY" value`))),m=!1),this._validateContent(h.content,h)||(this.fire(new o.k(new Error(`Image "${r}" has invalid "content" value`))),m=!1),m}_validateStretch(r,h){if(!r)return!0;let m=0;for(const v of r){if(v[0]<m||v[1]<v[0]||h<v[1])return!1;m=v[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const m=h.spriteData,v=m&&m.width||h.data.width,S=m&&m.height||h.data.height;return!(r[0]<0||v<r[0]||r[1]<0||S<r[1]||r[2]<0||v<r[2]||r[3]<0||S<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,m=!0){const v=this.getImage(r);if(m&&(v.data.width!==h.data.width||v.data.height!==h.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=v.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise(((h,m)=>{let v=!0;if(!this.isLoaded())for(const S of r)this.images[S]||(v=!1);this.isLoaded()||v?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})}))}_getImagesForIds(r){const h={};for(const m of r){let v=this.getImage(m);v||(this.fire(new o.l("styleimagemissing",{id:m})),v=this.getImage(m)),v?h[m]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],m=this.getImage(r);if(!m)return null;if(h&&h.position.version===m.version)return h.position;if(h)h.position.version=m.version;else{const v={w:m.data.width+2,h:m.data.height+2,x:0,y:0},S=new o.I(v,m);this.patterns[r]={bin:v,position:S}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const S in this.patterns)r.push(this.patterns[S].bin);const{w:h,h:m}=o.p(r),v=this.atlasImage;v.resize({width:h||1,height:m||1});for(const S in this.patterns){const{bin:C}=this.patterns[S],R=C.x+1,k=C.y+1,N=this.getImage(S).data,U=N.width,H=N.height;o.R.copy(N,v,{x:0,y:0},{x:R,y:k},{width:U,height:H}),o.R.copy(N,v,{x:0,y:H-1},{x:R,y:k-1},{width:U,height:1}),o.R.copy(N,v,{x:0,y:0},{x:R,y:k+H},{width:U,height:1}),o.R.copy(N,v,{x:U-1,y:0},{x:R-1,y:k},{width:1,height:H}),o.R.copy(N,v,{x:0,y:0},{x:R+U,y:k},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const m=this.getImage(h);m||o.w(`Image with ID: "${h}" was not found`),xt(m)&&this.updateImage(h,m)}}cloneImages(){const r={};for(const h in this.images){const m=this.images[h];r[h]=Object.assign(Object.assign({},m),{data:m.data?m.data.clone():null})}return r}}const Dt=1e20;function Pt(w,r,h,m,v,S,C,R,k){for(let N=r;N<r+m;N++)Yt(w,h*S+N,S,v,C,R,k);for(let N=h;N<h+v;N++)Yt(w,N*S+r,1,m,C,R,k)}function Yt(w,r,h,m,v,S,C){S[0]=0,C[0]=-Dt,C[1]=Dt,v[0]=w[r];for(let R=1,k=0,N=0;R<m;R++){v[R]=w[r+R*h];const U=R*R;do{const H=S[k];N=(v[R]-v[H]+U-H*H)/(R-H)/2}while(N<=C[k]&&--k>-1);k++,S[k]=R,C[k]=N,C[k+1]=Dt}for(let R=0,k=0;R<m;R++){for(;C[k+1]<R;)k++;const N=S[k],U=R-N;w[r+R*h]=v[N]+U*U}}const re=o.v.layout_symbol["text-font"].default.join(",");class be{constructor(r,h,m){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={},this.lang=m}setURL(r){this.url=r}getGlyphs(r){return o._(this,void 0,void 0,(function*(){const h=[];for(const S in r)for(const C of r[S])h.push(this._getAndCacheGlyphsPromise(S,C));const m=yield Promise.all(h),v={};for(const{stack:S,id:C,glyph:R}of m)v[S]||(v[S]={}),v[S][C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return v}))}_getAndCacheGlyphsPromise(r,h){return o._(this,void 0,void 0,(function*(){let m=this.entries[r];m||(m=this.entries[r]={glyphs:{},requests:{},ranges:{}});let v=m.glyphs[h];return v!==void 0?{stack:r,id:h,glyph:v}:!this.url||this._charUsesLocalIdeographFontFamily(h)?(v=m.glyphs[h]=this._drawGlyph(m,r,h),{stack:r,id:h,glyph:v}):yield this._downloadAndCacheRangePromise(r,h)}))}_downloadAndCacheRangePromise(r,h){return o._(this,void 0,void 0,(function*(){const m=this.entries[r],v=Math.floor(h/256);if(m.ranges[v])return{stack:r,id:h,glyph:null};if(!m.requests[v]){const S=be.loadGlyphRange(r,v,this.url,this.requestManager);m.requests[v]=S}try{const S=yield m.requests[v];for(const C in S)m.glyphs[+C]=S[+C];return m.ranges[v]=!0,{stack:r,id:h,glyph:S[h]||null}}catch(S){const C=m.glyphs[h]=this._drawGlyph(m,r,h);return this._warnOnMissingGlyphRange(C,v,h,S),{stack:r,id:h,glyph:C}}}))}_warnOnMissingGlyphRange(r,h,m,v){const S=256*h,C=S+255,R=m.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${h}, ${S}-${C}. Rendering codepoint U+${R} locally instead. ${v}`)}_charUsesLocalIdeographFontFamily(r){return!!this.localIdeographFontFamily&&o.q(r)}_drawGlyph(r,h,m){const v=h===re&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(m),S=v?"ideographTinySDF":"tinySDF";r[S]||(r[S]=this._createTinySDF(v?this.localIdeographFontFamily:h));const C=r[S].draw(String.fromCodePoint(m)),R=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(m));return{id:m,bitmap:new o.r({width:C.width||60,height:C.height||60},C.data),metrics:{width:R?0:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:R?0:C.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(r){const h=r?r.split(","):[];h.push("sans-serif");const m=h.map((v=>/[-\w]+/.test(v)?v:`'${CSS.escape(v)}'`)).join(",");return new be.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:this._fontWeight(h[0]),fontStyle:this._fontStyle(h[0]),lang:this.lang})}_fontStyle(r){return/italic/i.test(r)?"italic":/oblique/i.test(r)?"oblique":"normal"}_fontWeight(r){const h={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let m;for(const[v,S]of Object.entries(h))new RegExp(`\\b${v}\\b`,"i").test(r)&&(m=`${S}`);return m}destroy(){for(const r in this.entries){const h=this.entries[r];h.tinySDF&&(h.tinySDF=null),h.ideographTinySDF&&(h.ideographTinySDF=null),h.glyphs={},h.requests={},h.ranges={}}this.entries={}}}be.loadGlyphRange=function(w,r,h,m){return o._(this,void 0,void 0,(function*(){const v=256*r,S=v+255,C=m.transformRequest(h.replace("{fontstack}",w).replace("{range}",`${v}-${S}`),"Glyphs"),R=yield o.n(C,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${r}, ${v}-${S}`);const k={};for(const N of o.o(R.data))k[N.id]=N;return k}))},be.TinySDF=class{constructor({fontSize:w=24,buffer:r=3,radius:h=8,cutoff:m=.25,fontFamily:v="sans-serif",fontWeight:S="normal",fontStyle:C="normal",lang:R=null}={}){this.buffer=r,this.cutoff=m,this.radius=h,this.lang=R;const k=this.size=w+4*r,N=this._createCanvas(k),U=this.ctx=N.getContext("2d",{willReadFrequently:!0});U.font=`${C} ${S} ${w}px ${v}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(w){const r=document.createElement("canvas");return r.width=r.height=w,r}draw(w){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m,actualBoundingBoxLeft:v,actualBoundingBoxRight:S}=this.ctx.measureText(w),C=Math.ceil(h),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-v))),k=Math.min(this.size-this.buffer,C+Math.ceil(m)),N=R+2*this.buffer,U=k+2*this.buffer,H=Math.max(N*U,0),$=new Uint8ClampedArray(H),Y={data:$,width:N,height:U,glyphWidth:R,glyphHeight:k,glyphTop:C,glyphLeft:0,glyphAdvance:r};if(R===0||k===0)return Y;const{ctx:te,buffer:ce,gridInner:de,gridOuter:fe}=this;this.lang&&(te.lang=this.lang),te.clearRect(ce,ce,R,k),te.fillText(w,ce,ce+C);const ye=te.getImageData(ce,ce,R,k);fe.fill(Dt,0,H),de.fill(0,0,H);for(let Ee=0;Ee<k;Ee++)for(let me=0;me<R;me++){const Ae=ye.data[4*(Ee*R+me)+3]/255;if(Ae===0)continue;const Pe=(Ee+ce)*N+me+ce;if(Ae===1)fe[Pe]=0,de[Pe]=Dt;else{const we=.5-Ae;fe[Pe]=we>0?we*we:0,de[Pe]=we<0?we*we:0}}Pt(fe,0,0,N,U,N,this.f,this.v,this.z),Pt(de,ce,ce,R,k,N,this.f,this.v,this.z);for(let Ee=0;Ee<H;Ee++){const me=Math.sqrt(fe[Ee])-Math.sqrt(de[Ee]);$[Ee]=Math.round(255-255*(me/this.radius+this.cutoff))}return Y}};class _e{constructor(){this.specification=o.u.light.position}possiblyEvaluate(r,h){return o.F(r.expression.evaluate(h))}interpolate(r,h,m){return{x:o.G.number(r.x,h.x,m),y:o.G.number(r.y,h.y,m),z:o.G.number(r.z,h.z,m)}}}let Be;class nt extends o.E{constructor(r){super(),Be=Be||new o.t({anchor:new o.D(o.u.light.anchor),position:new _e,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(Be,void 0),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(o.y,r,h))for(const m in r){const v=r[m];m.endsWith(o.z)?this._transitionable.setTransition(m.slice(0,-o.z.length),v):this._transitionable.setValue(m,v)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,m){return(!m||m.validate!==!1)&&o.B(this,r.call(o.C,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}const he=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class Oe extends o.E{constructor(r){super(),this._transitionable=new o.x(he,void 0),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(r,h={}){if(!this._validate(o.J,r,h)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in r){const v=r[m];m.endsWith(o.z)?this._transitionable.setTransition(m.slice(0,-o.z.length),v):this._transitionable.setValue(m,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,m={}){return m?.validate!==!1&&o.B(this,r.call(o.C,o.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class Je{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const m=r.join(",")+String(h);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(r,h)),this.dashEntry[m]}getDashRanges(r,h,m){const v=[];let S=r.length%2==1?-r[r.length-1]*m:0,C=r[0]*m,R=!0;v.push({left:S,right:C,isDash:R,zeroLength:r[0]===0});let k=r[0];for(let N=1;N<r.length;N++){R=!R;const U=r[N];S=k*m,k+=U,C=k*m,v.push({left:S,right:C,isDash:R,zeroLength:U===0})}return v}addRoundDash(r,h,m){const v=h/2;for(let S=-m;S<=m;S++){const C=this.width*(this.nextRow+m+S);let R=0,k=r[R];for(let N=0;N<this.width;N++){N/k.right>1&&(k=r[++R]);const U=Math.abs(N-k.left),H=Math.abs(N-k.right),$=Math.min(U,H);let Y;const te=S/m*(v+1);if(k.isDash){const ce=v-Math.abs(te);Y=Math.sqrt($*$+ce*ce)}else Y=v-Math.sqrt($*$+te*te);this.data[C+N]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(r){for(let R=r.length-1;R>=0;--R){const k=r[R],N=r[R+1];k.zeroLength?r.splice(R,1):N&&N.isDash===k.isDash&&(N.left=k.left,r.splice(R,1))}const h=r[0],m=r[r.length-1];h.isDash===m.isDash&&(h.left=m.left-this.width,m.right=h.right+this.width);const v=this.width*this.nextRow;let S=0,C=r[S];for(let R=0;R<this.width;R++){R/C.right>1&&(C=r[++S]);const k=Math.abs(R-C.left),N=Math.abs(R-C.right),U=Math.min(k,N);this.data[v+R]=Math.max(0,Math.min(255,(C.isDash?U:-U)+128))}}addDash(r,h){const m=h?7:0,v=2*m+1;if(this.nextRow+v>this.height)return o.w("LineAtlas out of space"),null;let S=0;for(let R=0;R<r.length;R++)S+=r[R];if(S!==0){const R=this.width/S,k=this.getDashRanges(r,this.width,R);h?this.addRoundDash(k,R,m):this.addRegularDash(k)}const C={y:this.nextRow+m,height:2*m,width:S};return this.nextRow+=v,this.dirty=!0,C}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const gt="maplibre_preloaded_worker_pool";class Mt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Mt.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach((h=>{h.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}const $t=Math.floor(J.hardwareConcurrency/2);let Ht,Qt;function vi(){return Ht||(Ht=new Mt),Ht}Mt.workerCount=o.K(globalThis)?Math.max(Math.min($t,3),1):1;class Mi{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const m=this.workerPool.acquire(h);for(let v=0;v<m.length;v++){const S=new o.L(m[v],h);S.name=`Worker ${v}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const m=[];for(const v of this.actors)m.push(v.sendAsync({type:r,data:h}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach((h=>{h.remove()})),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const m of this.actors)m.registerMessageHandler(r,h)}unregisterMessageHandler(r){for(const h of this.actors)h.unregisterMessageHandler(r)}}function Mr(){return Qt||(Qt=new Mi(vi(),o.M),Qt.registerMessageHandler("GR",((w,r,h)=>o.m(r,h)))),Qt}function An(w,r){const h=o.N();return o.O(h,h,[1,1,0]),o.Q(h,h,[.5*w.width,.5*w.height,1]),w.calculatePosMatrix?o.S(h,h,w.calculatePosMatrix(r.toUnwrapped())):h}function Oo(w,r,h,m,v,S,C){var R;const k=(function($,Y,te){if($)for(const ce of $){const de=Y[ce];if(de&&de.source===te&&de.type==="fill-extrusion")return!0}else for(const ce in Y){const de=Y[ce];if(de.source===te&&de.type==="fill-extrusion")return!0}return!1})((R=v?.layers)!==null&&R!==void 0?R:null,r,w.id),N=S.maxPitchScaleFactor(),U=w.tilesIn(m,N,k);U.sort(gn);const H=[];for(const $ of U)H.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(r,h,w.getState(),$.queryGeometry,$.cameraQueryGeometry,$.scale,v,S,N,An(S,$.tileID),C?(Y,te)=>C($.tileID,Y,te):void 0)});return(function($,Y){for(const te in $)for(const ce of $[te])gi(ce,Y);return $})((function($){const Y={},te={};for(const ce of $){const de=ce.queryResults,fe=ce.wrappedTileID,ye=te[fe]=te[fe]||{};for(const Ee in de){const me=de[Ee],Ae=ye[Ee]=ye[Ee]||{},Pe=Y[Ee]=Y[Ee]||[];for(const we of me)Ae[we.featureIndex]||(Ae[we.featureIndex]=!0,Pe.push(we))}}return Y})(H),w)}function gn(w,r){const h=w.tileID,m=r.tileID;return h.overscaledZ-m.overscaledZ||h.canonical.y-m.canonical.y||h.wrap-m.wrap||h.canonical.x-m.canonical.x}function gi(w,r){const h=w.feature,m=r.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=m}function bi(w,r,h,m){return o._(this,void 0,void 0,(function*(){let v=w;if(w.url?v=(yield o.j(r.transformRequest(w.url,"Source"),h)).data:yield J.frameAsync(h,m),!v)return null;const S=o.U(o.e(v,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in v&&v.vector_layers&&(S.vectorLayerIds=v.vector_layers.map((C=>C.id))),S}))}class mn{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof o.V?new o.V(r.lng,r.lat):o.V.convert(r),this}setSouthWest(r){return this._sw=r instanceof o.V?new o.V(r.lng,r.lat):o.V.convert(r),this}extend(r){const h=this._sw,m=this._ne;let v,S;if(r instanceof o.V)v=r,S=r;else{if(!(r instanceof mn))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(mn.convert(r)):this.extend(o.V.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(o.V.convert(r)):this;if(v=r._sw,S=r._ne,!v||!S)return this}return h||m?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),m.lng=Math.max(S.lng,m.lng),m.lat=Math.max(S.lat,m.lat)):(this._sw=new o.V(v.lng,v.lat),this._ne=new o.V(S.lng,S.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:m}=o.V.convert(r);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&v}intersects(r){if(!((r=mn.convert(r)).getNorth()>=this.getSouth()&&r.getSouth()<=this.getNorth()))return!1;const h=Math.abs(this.getEast()-this.getWest()),m=Math.abs(r.getEast()-r.getWest());if(h>=360||m>=360)return!0;const v=o.W(this.getWest(),-180,180),S=o.W(this.getEast(),-180,180),C=o.W(r.getWest(),-180,180),R=o.W(r.getEast(),-180,180),k=v>S,N=C>R;return!(!k||!N)||(k?R>=v||C<=S:N?S>=C||v<=R:C<=S&&R>=v)}static convert(r){return r instanceof mn?r:r&&new mn(r)}static fromLngLat(r,h=0){const m=360*h/40075017,v=m/Math.cos(Math.PI/180*r.lat);return new mn(new o.V(r.lng-v,r.lat-m),new o.V(r.lng+v,r.lat+m))}adjustAntiMeridian(){const r=new o.V(this._sw.lng,this._sw.lat),h=new o.V(this._ne.lng,this._ne.lat);return new mn(r,r.lng>h.lng?new o.V(h.lng+360,h.lat):h)}}class Ea{constructor(r,h,m){this.bounds=mn.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=m||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),m=Math.floor(o.Y(this.bounds.getWest())*h),v=Math.floor(o.X(this.bounds.getNorth())*h),S=Math.ceil(o.Y(this.bounds.getEast())*h),C=Math.ceil(o.X(this.bounds.getSouth())*h);return r.x>=m&&r.x<S&&r.y>=v&&r.y<C}}class ko extends o.E{constructor(r,h,m,v){if(super(),this.id=r,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(h,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield bi(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),r&&(o.e(this,r),r.bounds&&(this.tileBounds=new Ea(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,o.Z(r)||this.fire(new o.k(r))}}))}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty((()=>{this._options.tiles=r})),this}setUrl(r){return this.setSourceProperty((()=>{this.url=r,this._options.url=r})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(r){return o._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(r)};m.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise(((S,C)=>{r.reloadPromise={resolve:S,reject:C}}))}else r.actor=this.dispatcher.getActor(),v="LT";r.abortController=new AbortController;try{const S=yield r.actor.sendAsync({type:v,data:m},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,S)}catch(S){if(delete r.abortController,r.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(r,null)}}))}_getOverzoomParameters(r){if(r.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const h=r.tileID.scaledTo(this.maxzoom).canonical,m=h.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:h,overzoomRequest:this.map._requestManager.transformRequest(m,"Tile")}}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const m=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(m.resolve).catch(m.reject)}}abortTile(r){return o._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))}))}unloadTile(r){return o._(this,void 0,void 0,(function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class to extends o.E{constructor(r,h,m,v){super(),this.id=r,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},h),o.e(this,o.U(h,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(r=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield bi(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,h&&(o.e(this,h),h.bounds&&(this.tileBounds=new Ea(h.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:r})))}catch(h){this._tileJSONRequest=null,this._loaded=!0,o.Z(h)||this.fire(new o.k(h))}}))}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load(!0)}setTiles(r){return this.setSourceProperty((()=>{this._options.tiles=r})),this}setUrl(r){return this.setSourceProperty((()=>{this.url=r,this._options.url=r})),this}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return o._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const m=yield wt.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const v=this.map.painter.context,S=v.gl,C=m.data;r.texture=this.map.painter.getTileTexture(C.width),r.texture?r.texture.update(C,{useMipmap:!0}):(r.texture=new o.T(v,C,S.RGBA,{useMipmap:!0}),r.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}}))}abortTile(r){return o._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)}))}unloadTile(r){return o._(this,void 0,void 0,(function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)}))}hasTransition(){return!1}}class Ca extends to{constructor(r,h,m,v){super(r,h,m,v),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return o._(this,void 0,void 0,(function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const v=yield wt.getImage(m,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(v&&v.data){const S=v.data;this.map._refreshExpiredTiles&&(v.cacheControl||v.expires)&&r.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const C=o.b(S)&&o.$()?S:yield this.readImageNow(S),R={type:this.type,uid:r.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const k=yield r.actor.sendAsync({type:"LDT",data:R});r.dem=k,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(v){if(delete r.abortController,r.aborted)r.state="unloaded";else if(v)throw r.state="errored",v}}))}readImageNow(r){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.a0()){const h=r.width+2,m=r.height+2;try{return new o.R({width:h,height:m},yield o.a1(r,-1,-1,h,m))}catch{}}return J.getImageData(r,1)}))}_getNeighboringTiles(r){const h=r.canonical,m=Math.pow(2,h.z),v=(h.x-1+m)%m,S=h.x===0?r.wrap-1:r.wrap,C=(h.x+1+m)%m,R=h.x+1===m?r.wrap+1:r.wrap,k={};return k[new o.a2(r.overscaledZ,S,h.z,v,h.y).key]={backfilled:!1},k[new o.a2(r.overscaledZ,R,h.z,C,h.y).key]={backfilled:!1},h.y>0&&(k[new o.a2(r.overscaledZ,S,h.z,v,h.y-1).key]={backfilled:!1},k[new o.a2(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},k[new o.a2(r.overscaledZ,R,h.z,C,h.y-1).key]={backfilled:!1}),h.y+1<m&&(k[new o.a2(r.overscaledZ,S,h.z,v,h.y+1).key]={backfilled:!1},k[new o.a2(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},k[new o.a2(r.overscaledZ,R,h.z,C,h.y+1).key]={backfilled:!1}),k}unloadTile(r){return o._(this,void 0,void 0,(function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))}))}}function oa(w){return w.type==="GeometryCollection"?w.geometries.map((r=>r.coordinates)).flat(1/0):w.coordinates.flat(1/0)}function yc(w){const r=new mn;let h;switch(w.type){case"FeatureCollection":h=w.features.map((m=>oa(m.geometry))).flat(1/0);break;case"Feature":h=oa(w.geometry);break;default:h=oa(w)}if(h.length==0)return r;for(let m=0;m<h.length-1;m+=2)r.extend([h[m],h[m+1]]);return r}class rr extends o.E{constructor(r,h,m,v){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:h.data},this.actor=m.getActor(),this.setEventedParent(v),this._data=typeof h.data=="string"?{url:h.data}:{geojson:h.data},this._options=o.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:o.a5,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(h.clusterMaxZoom),minPoints:Math.max(2,h.clusterMinPoints||2),extent:o.a5,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(r){return r*(o.a5/this.tileSize)}_getClusterMaxZoom(r){const h=r?Math.round(r):this.maxzoom-1;return Number.isInteger(r)||r===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${r}" rounded to "${h}"`),h}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(r){this.map=r,this.load()}setData(r,h){this._data=typeof r=="string"?{url:r}:{geojson:r},this._pendingWorkerUpdate={data:r};const m=this._updateWorkerData();return h?m:this}updateData(r,h){this._pendingWorkerUpdate.diff=o.a6(this._pendingWorkerUpdate.diff,r);const m=this._updateWorkerData();return h?m:this}getData(){return o._(this,void 0,void 0,(function*(){const r=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})}))}getBounds(){return o._(this,void 0,void 0,(function*(){return yc(yield this.getData())}))}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(r.clusterRadius)),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(r.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:m}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:r,diff:h}=this._pendingWorkerUpdate,m=this._getLoadGeoJSONParameters(r,h);r!==void 0?this._pendingWorkerUpdate.data=void 0:h&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(m)}))}_getLoadGeoJSONParameters(r,h){const m=o.e({type:this.type},this.workerOptions);return typeof r=="string"?(m.request=this.map._requestManager.transformRequest(J.resolveURL(r),"Source"),m.request.collectResourceTiming=this._collectResourceTiming,m):r!==void 0?(m.data=r,m):(h&&(m.dataDiff=h),m)}_dispatchWorkerUpdate(r){return o._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:r});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));h.data&&(this._data={geojson:h.data});const m=this._applyDiffToSource(r.dataDiff),v=this._getShouldReloadTileOptions(m),S={dataType:"source"};this._applyResourceTiming(S,h),this.fire(new o.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content",shouldReloadTileOptions:v})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(r,h){var m;if(!this._collectResourceTiming)return;const v=(m=h.resourceTiming)===null||m===void 0?void 0:m[this.id];if(!v)return;const S=v.slice(0);S?.length&&o.e(r,{resourceTiming:S})}_applyDiffToSource(r){if(!r)return;const h=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const v=o.a7(this._data.geojson,h);if(!v)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:v}}if(!this._data.updateable)return;const m=o.a8(this._data.updateable,r,h);return r.removeAll||this._options.cluster?void 0:m}_getShouldReloadTileOptions(r){if(r)return{affectedBounds:r.filter(Boolean).map((h=>yc(h)))}}shouldReloadTile(r,{affectedBounds:h}){if(r.state==="loading")return!0;if(r.state==="unloaded")return!1;const{buffer:m,extent:v}=this.workerOptions.geojsonVtOptions,S=(function({x:C,y:R,z:k},N=0){const U=o.a3((C-N)/Math.pow(2,k)),H=o.a4((R+1+N)/Math.pow(2,k)),$=o.a3((C+1+N)/Math.pow(2,k)),Y=o.a4((R-N)/Math.pow(2,k));return new mn([U,H],[$,Y])})(r.tileID.canonical,m/v);for(const C of h)if(S.intersects(C))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(r){return o._(this,void 0,void 0,(function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const m={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};r.abortController=new AbortController;const v=yield this.actor.sendAsync({type:h,data:m},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(v,this.map.painter,h==="RT")}))}abortTile(r){return o._(this,void 0,void 0,(function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0}))}unloadTile(r){return o._(this,void 0,void 0,(function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class gs extends o.E{constructor(r,h,m,v){super(),this.flippedWindingOrder=!1,this.id=r,this.dispatcher=m,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(r){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield wt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,o.Z(h)||this.fire(new o.k(h))}}))}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(o.a9.fromLngLat);var m;return this.tileID=(function(v){const S=o.aa.fromPoints(v),C=S.width(),R=S.height(),k=Math.max(C,R),N=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),U=Math.pow(2,N);return new o.ac(N,Math.floor((S.minX+S.maxX)/2*U),Math.floor((S.minY+S.maxY)/2*U))})(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map((v=>this.tileID.getTilePoint(v)._round())),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.texture||(this.texture=new o.T(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const v in this.tiles){const S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(r){const{minX:h,minY:m,maxX:v,maxY:S}=o.aa.fromPoints(r),C={};for(let R=0;R<=o.ab;R++){const k=Math.pow(2,R),N=Math.floor(h*k),U=Math.floor(m*k),H=Math.floor(v*k),$=Math.floor(S*k),Y=(N%k+k)%k,te=H%k,ce=Math.floor(N/k),de=Math.floor(H/k);C[R]={minWrap:ce,maxWrap:de,minTileXWrapped:Y,maxTileXWrapped:te,minTileY:U,maxTileY:$}}return C}}class vc extends gs{constructor(r,h,m,v){super(r,h,m,v),this.roundZoom=!0,this.type="video",this.options=h}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield o.ad(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new o.k(h))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new o.k(new o.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const v in this.tiles){const S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class io extends gs{constructor(r,h,m,v){super(r,h,m,v),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some((S=>!Array.isArray(S)||S.length!==2||S.some((C=>typeof C!="number"))))||this.fire(new o.k(new o.ae(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.ae(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new o.k(new o.ae(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.ae(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.ae(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,m=h.gl;this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new o.T(h,this.canvas,m.RGBA,{premultiply:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let v=!1;for(const S in this.tiles){const C=this.tiles[S];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,v=!0)}v&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const no={},fu=w=>{switch(w){case"geojson":return rr;case"image":return gs;case"raster":return to;case"raster-dem":return Ca;case"vector":return ko;case"video":return vc;case"canvas":return io}return no[w]},Lo="RTLPluginLoaded";class ze extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Mr()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch((h=>{throw this.status="error",h}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return o._(this,arguments,void 0,(function*(h,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=J.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Lo))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let G=null;function K(){return G||(G=new ze),G}var ee,ve;(function(w){w[w.Base=0]="Base",w[w.Parent=1]="Parent"})(ee||(ee={})),(function(w){w[w.Departing=0]="Departing",w[w.Incoming=1]="Incoming"})(ve||(ve={}));class Me{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=r,this.uid=o.af(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttFingerprint={},this.expiredRequestCount=0,this.state="loading"}isRenderable(r){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(r||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:r,fadingDirection:h,fadingParentID:m,fadeEndTime:v}){this.resetFadeLogic(),this.fadingRole=r,this.fadingDirection=h,this.fadingParentID=m,this.fadeEndTime=v}setSelfFadeLogic(r){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=r}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=le(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData,this.latestFeatureIndex.encoding=r.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=(function(v,S){const C={};if(!S)return C;for(const R of v){const k=R.layerIds.map((N=>S.getLayer(N))).filter(Boolean);if(k.length!==0){R.layers=k,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((N=>k.filter((U=>U.id===N))[0])));for(const N of k)C[N.id]=R}}return C})(r.buckets,h?.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const S=this.buckets[v];if(S instanceof o.ah){if(this.hasSymbolBuckets=!0,!m)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const S=this.buckets[v];if(S instanceof o.ah&&S.hasRTLText){this.hasRTLText=!0,K().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const S=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(v).queryRadius(S))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),this.dashPositions=r.dashPositions}else this.collisionBoxArray=new o.ag}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const m in this.buckets){const v=this.buckets[m];v.uploadPending()&&v.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,m,v,S,C,R,k,N,U,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:S,scale:C,tileSize:this.tileSize,pixelPosMatrix:U,transform:k,params:R,queryPadding:this.queryPadding*N,getElevation:H},r,h,m):{}}querySourceFeatures(r,h){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),S=h&&h.sourceLayer?h.sourceLayer:"",C=v[o.ai]||v[S];if(!C)return;const R=o.aj(h?.filter,h?.globalState),{z:k,x:N,y:U}=this.tileID.canonical,H={z:k,x:N,y:U};for(let $=0;$<C.length;$++){const Y=C.feature($);if(R.needGeometry){const de=o.ak(Y,!0);if(!R.filter(new o.H(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!R.filter(new o.H(this.tileID.overscaledZ),Y))continue;const te=m.getId(Y,S),ce=new o.al(Y,k,N,U,te);ce.tile=H,r.push(ce)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const m=o.am(r.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const S=this.expirationTime-h;S?this.expirationTime=m+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!h.style.hasLayer(v))continue;const S=this.buckets[v],C=S.layers[0].sourceLayer||o.ai,R=m[C],k=r[C];if(!R||!k||Object.keys(k).length===0)continue;S.update(k,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const N=h&&h.style&&h.style.getLayer(v);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(S)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<le()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(r){this.symbolFadeHoldUntil=le()+r}setDependencies(r,h){const m={};for(const v of h)m[v]=!0;this.dependencies[r]=m}hasDependency(r,h){for(const m of r){const v=this.dependencies[m];if(v){for(const S of h)if(v[S])return!0}}return!1}}class Xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={},this.revision=0}updateState(r,h,m){const v=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][v]=this.stateChanges[r][v]||{},o.e(this.stateChanges[r][v],m),this.deletedStates[r]===null){this.deletedStates[r]={};for(const S in this.state[r])S!==v&&(this.deletedStates[r][S]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][v]===null){this.deletedStates[r][v]={};for(const S in this.state[r][v])m[S]||(this.deletedStates[r][v][S]=null)}else for(const S in m)this.deletedStates[r]&&this.deletedStates[r][v]&&this.deletedStates[r][v][S]===null&&delete this.deletedStates[r][v][S]}removeFeatureState(r,h,m){if(this.deletedStates[r]===null)return;const v=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},m&&h!==void 0)this.deletedStates[r][v]!==null&&(this.deletedStates[r][v]=this.deletedStates[r][v]||{},this.deletedStates[r][v][m]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][v])for(m in this.deletedStates[r][v]={},this.stateChanges[r][v])this.deletedStates[r][v][m]=null;else this.deletedStates[r][v]=null;else this.deletedStates[r]=null}getState(r,h){const m=String(h),v=o.e({},(this.state[r]||{})[m],(this.stateChanges[r]||{})[m]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const S=this.deletedStates[r][h];if(S===null)return{};for(const C in S)delete v[C]}return v}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const S={};for(const C in this.stateChanges[v])this.state[v][C]||(this.state[v][C]={}),o.e(this.state[v][C],this.stateChanges[v][C]),S[C]=this.state[v][C];m[v]=S}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const S={};if(this.deletedStates[v]===null)for(const C in this.state[v])S[C]={},this.state[v][C]={};else for(const C in this.deletedStates[v]){if(this.deletedStates[v][C]===null)this.state[v][C]={};else for(const R of Object.keys(this.deletedStates[v][C]))delete this.state[v][C][R];S[C]=this.state[v][C]}m[v]=m[v]||{},o.e(m[v],S)}this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0&&(this.revision++,r.setFeatureState(m,h))}}const We=89.25;function Fe(w,r){const h=o.an(r.lat,-o.ao,o.ao);return new o.P(o.Y(r.lng)*w,o.X(h)*w)}function qe(w,r){return new o.a9(r.x/w,r.y/w).toLngLat()}function yt(w){return w.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-w.pitch)),Math.tan(o.ap(We-w.pitch)))}function ut(w,r){const h=w.canonical,m=r/o.aq(h.z),v=h.x+Math.pow(2,h.z)*w.wrap,S=o.ar(new Float64Array(16));return o.O(S,S,[v*m,h.y*m,0]),o.Q(S,S,[m/o.a5,m/o.a5,1]),S}function Ce(w,r,h,m,v){const S=o.a9.fromLngLat(w,r),C=v*o.as(1,w.lat),{x:R,y:k,z:N}=Wt(h,m);return new o.a9(S.x+C*-R,S.y+C*-k,S.z+C*-N)}function Wt(w,r){const h=o.ap(w),m=o.ap(r),v=Math.cos(-h),S=Math.sin(h);return{x:S*Math.sin(m),y:-S*Math.cos(m),z:v}}function ai(w,r,h){const m=r.intersectsFrustum(w);if(!h||m===0)return m;const v=r.intersectsPlane(h);return v===0?0:m===2&&v===2?2:1}function Jt(w,r,h){let m=0;const v=(h-r)/10;for(let S=0;S<10;S++)m+=v*Math.pow(Math.cos(r+(S+.5)/10*(h-r)),w);return m}function ii(w,r){return function(h,m,v,S,C){const R=2*((w-1)/o.at(Math.cos(o.ap(We-C))/Math.cos(o.ap(We)))-1),k=Math.acos(v/S),N=2*Jt(R-1,0,o.ap(C/2)),U=Math.min(o.ap(We),k+o.ap(C/2)),H=Jt(R-1,Math.min(U,k-o.ap(C/2)),U),$=Math.atan(m/v),Y=Math.hypot(m,v);let te=h;return te+=o.at(S/Y/Math.max(.5,Math.cos(o.ap(C/2)))),te+=R*o.at(Math.cos($))/2,te-=o.at(Math.max(1,H/N/r))/2,te}}const ni=ii(9.314,3);function oi(w,r){const h=(r.roundZoom?Math.round:Math.floor)(w.zoom+o.at(w.tileSize/r.tileSize));return Math.max(0,h)}function _n(w,r){const h=w.getCameraFrustum(),m=w.getClippingPlane(),v=w.screenPointToMercatorCoordinate(w.getCameraPoint()),S=o.a9.fromLngLat(w.center,w.elevation);v.z=S.z+Math.cos(w.pitchInRadians)*w.cameraToCenterDistance/w.worldSize;const C=w.getCoveringTilesDetailsProvider(),R=C.allowVariableZoom(w,r),k=oi(w,r),N=r.minzoom||0,U=r.maxzoom!==void 0?r.maxzoom:w.maxZoom,H=Math.min(Math.max(0,k),U),$=Math.pow(2,H),Y=[$*v.x,$*v.y,0],te=[$*S.x,$*S.y,0],ce=Math.hypot(S.x-v.x,S.y-v.y),de=Math.abs(S.z-v.z),fe=Math.hypot(ce,de),ye=Ae=>({zoom:0,x:0,y:0,wrap:Ae,fullyVisible:!1}),Ee=[],me=[];if(w.renderWorldCopies&&C.allowWorldCopies())for(let Ae=1;Ae<=3;Ae++)Ee.push(ye(-Ae)),Ee.push(ye(Ae));for(Ee.push(ye(0));Ee.length>0;){const Ae=Ee.pop(),Pe=Ae.x,we=Ae.y;let ke=Ae.fullyVisible;const et={x:Pe,y:we,z:Ae.zoom},Ze=C.getTileBoundingVolume(et,Ae.wrap,w.elevation,r);if(!ke){const Ot=ai(h,Ze,m);if(Ot===0)continue;ke=Ot===2}const Ke=C.distanceToTile2d(v.x,v.y,et,Ze);let Qe=k;R&&(Qe=(r.calculateTileZoom||ni)(w.zoom+o.at(w.tileSize/r.tileSize),Ke,de,fe,w.fov)),Qe=(r.roundZoom?Math.round:Math.floor)(Qe),Qe=Math.max(0,Qe);const Rt=Math.min(Qe,U);if(Ae.wrap=C.getWrap(S,et,Ae.wrap),Ae.zoom>=Rt){if(Ae.zoom<N)continue;const Ot=H-Ae.zoom,_t=Y[0]-.5-(Pe<<Ot),zt=Y[1]-.5-(we<<Ot),ci=r.reparseOverscaled?Math.max(Ae.zoom,Qe):Ae.zoom;me.push({tileID:new o.a2(Ae.zoom===U?ci:Ae.zoom,Ae.wrap,Ae.zoom,Pe,we),distanceSq:o.au([te[0]-.5-Pe,te[1]-.5-we]),tileDistanceToCamera:Math.sqrt(_t*_t+zt*zt)})}else for(let Ot=0;Ot<4;Ot++)Ee.push({zoom:Ae.zoom+1,x:(Pe<<1)+Ot%2,y:(we<<1)+(Ot>>1),wrap:Ae.wrap,fullyVisible:ke})}return me.sort(((Ae,Pe)=>Ae.distanceSq-Pe.distanceSq)).map((Ae=>Ae.tileID))}const kn=o.aa.fromPoints([new o.P(0,0),new o.P(o.a5,o.a5)]);function En(w){return w==="raster"||w==="image"||w==="video"}function Tr(w,r,h,m,v,S,C){if(!r.hasData())return!1;const{tileID:R,fadingRole:k,fadingDirection:N,fadingParentID:U}=r;if(k===ee.Base&&N===ve.Incoming&&U)return h[U.key]=U,!0;const H=Math.max(R.overscaledZ-v,S);for(let $=R.overscaledZ-1;$>=H;$--){const Y=R.scaledTo($),te=w.getLoadedTile(Y);if(te)return r.setCrossFadeLogic({fadingRole:ee.Base,fadingDirection:ve.Incoming,fadingParentID:te.tileID,fadeEndTime:m+C}),te.setCrossFadeLogic({fadingRole:ee.Parent,fadingDirection:ve.Departing,fadeEndTime:m+C}),h[Y.key]=Y,!0}return!1}function yn(w,r,h,m,v,S){if(!r.hasData())return!1;const C=r.tileID.children(v);let R=Tt(w,r,C,h,m,v,S);if(R)return!0;for(const k of C)Tt(w,r,k.children(v),h,m,v,S)&&(R=!0);return R}function Tt(w,r,h,m,v,S,C){if(h[0].overscaledZ>=S)return!1;let R=!1;for(const k of h){const N=w.getLoadedTile(k);if(!N)continue;const{fadingRole:U,fadingDirection:H,fadingParentID:$}=N;U===ee.Base&&H===ve.Departing&&$||(N.setCrossFadeLogic({fadingRole:ee.Base,fadingDirection:ve.Departing,fadingParentID:r.tileID,fadeEndTime:v+C}),r.setCrossFadeLogic({fadingRole:ee.Parent,fadingDirection:ve.Incoming,fadeEndTime:v+C})),m[k.key]=k,R=!0}return R}function Li(w,r,h,m){const v=w.tileID;return!!w.selfFading||!w.hasData()&&!!r.has(v)&&(w.setSelfFadeLogic(h+m),!0)}function ln(w,r){var h;w.needsHillshadePrepare=!0,w.needsTerrainPrepare=!0;let m=r.tileID.canonical.x-w.tileID.canonical.x;const v=r.tileID.canonical.y-w.tileID.canonical.y,S=Math.pow(2,w.tileID.canonical.z),C=r.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+S)===1?m+=S:Math.abs(m-S)===1&&(m-=S)),r.dem&&w.dem&&(w.dem.backfillBorder(r.dem,m,v),!((h=w.neighboringTiles)===null||h===void 0)&&h[C]&&(w.neighboringTiles[C].backfilled=!0)))}class Qr{constructor(){this._tiles={}}handleWrapJump(r){const h={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+r),h[v.tileID.key]=v}this._tiles=h}setFeatureState(r,h){for(const m in this._tiles)this._tiles[m].setFeatureState(r,h)}getAllTiles(){return Object.values(this._tiles)}getAllIds(r=!1){return r?Object.values(this._tiles).map((h=>h.tileID)).sort(o.aw).map((h=>h.key)):Object.keys(this._tiles)}getTileById(r){return this._tiles[r]}setTile(r,h){this._tiles[r]=h}deleteTileById(r){delete this._tiles[r]}getLoadedTile(r){const h=this.getTileById(r.key);return h?.hasData()?h:null}isIdRenderable(r,h=!1){var m;return(m=this.getTileById(r))===null||m===void 0?void 0:m.isRenderable(h)}getRenderableIds(r=0,h){const m=[];for(const v of this.getAllIds())this.isIdRenderable(v,h)&&m.push(this.getTileById(v));return h?m.sort(((v,S)=>{const C=v.tileID,R=S.tileID,k=new o.P(C.canonical.x,C.canonical.y)._rotate(-r),N=new o.P(R.canonical.x,R.canonical.y)._rotate(-r);return C.overscaledZ-R.overscaledZ||N.y-k.y||N.x-k.x})).map((v=>v.tileID.key)):m.map((v=>v.tileID)).sort(o.aw).map((v=>v.key))}}class Hi extends o.E{constructor(r,h,m){super(),this.id=r,this.dispatcher=m,this.on("data",(v=>this._dataHandler(v))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((v,S,C,R)=>{const k=new(fu(S.type))(v,S,C,R);if(k.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${k.id}`);return k})(r,h,m,this),this._inViewTiles=new Qr,this._outOfViewCache=new o.ax(0,(v=>this._unloadTile(v))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Xe,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){for(const h of this._inViewTiles.getAllTiles())h.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r),this._inViewTiles=new Qr}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,m){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,m)}catch(v){r.state="errored",v.status!==404?this._source.fire(new o.k(v,{tile:r})):this.update(this.transform,this.terrain)}}))}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new o.l("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const h of this._inViewTiles.getAllTiles())h.upload(r),h.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(r){var h;return this._inViewTiles.getRenderableIds((h=this.transform)===null||h===void 0?void 0:h.bearingInRadians,r)}hasRenderableParent(r){const h=r.overscaledZ-1;if(h>=this._source.minzoom){const m=this.getLoadedTile(r.scaledTo(h));if(m)return this._inViewTiles.isIdRenderable(m.tileID.key)}return!1}reload(r,h=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const m of this._inViewTiles.getAllIds()){const v=this._inViewTiles.getTileById(m);h&&!this._source.shouldReloadTile(v,h)||(r?this._reloadTile(m,"expired"):v.state!=="errored"&&this._reloadTile(m,"reloading"))}}}_reloadTile(r,h){return o._(this,void 0,void 0,(function*(){const m=this._inViewTiles.getTileById(r);m&&(m.state!=="loading"&&(m.state=h),yield this._loadTile(m,r,h))}))}_tileLoaded(r,h,m){r.timeAdded=le(),r.selfFading&&(r.fadeEndTime=r.timeAdded+this._rasterFadeDuration),m==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&(function(v,S){var C,R;const k=S.getRenderableIds();for(const N of k){if(!v.neighboringTiles||!v.neighboringTiles[N])continue;const U=S.getTileById(N);v.neighboringTiles[N].backfilled||ln(v,U),!((R=(C=U.neighboringTiles)===null||C===void 0?void 0:C[v.tileID.key])===null||R===void 0)&&R.backfilled||ln(U,v)}})(r,this._inViewTiles),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:r,coord:r.tileID}))}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._inViewTiles.getTileById(r)}_retainLoadedChildren(r,h){const m=this._getLoadedDescendents(h),v=new Set;for(const S of h){const C=m[S.key];if(!C?.length){v.add(S);continue}const R=S.overscaledZ+Hi.maxOverzooming,k=C.filter((H=>H.tileID.overscaledZ<=R));if(!k.length){v.add(S);continue}const N=Math.min(...k.map((H=>H.tileID.overscaledZ))),U=k.filter((H=>H.tileID.overscaledZ===N)).map((H=>H.tileID));for(const H of U)r[H.key]=H;this._areDescendentsComplete(U,N,S.overscaledZ)||v.add(S)}return v}_getLoadedDescendents(r){var h;const m={};for(const v of this._inViewTiles.getAllTiles().filter((S=>S.hasData())))for(const S of r)v.tileID.isChildOf(S)&&(m[h=S.key]||(m[h]=[])).push(v);return m}_areDescendentsComplete(r,h,m){return r.length===1&&r[0].isOverscaled()?r[0].overscaledZ===h:Math.pow(4,h-m)===r.length}getLoadedTile(r){return this._inViewTiles.getLoadedTile(r)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,m=Math.ceil(r.height/this._source.tileSize)+1,v=Math.floor(h*m*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._outOfViewCache.setMaxSize(S)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);this._prevLng=r,h&&(this._inViewTiles.handleWrapJump(h),this._resetTileReloadTimers())}update(r,h){if(!this._sourceLoaded||this._paused)return;let m;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?m=r.getVisibleUnwrappedCoordinates(this._source.tileID).map((k=>new o.a2(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y))):(m=_n(r,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?r.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter((k=>this._source.hasTile(k))))):m=[],this.usedForTerrain&&(m=this._addTerrainIdealTiles(m));const v=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=oi(r,this._source),C=this._updateRetainedTiles(m,S),R=En(this._source.type);R&&this._rasterFadeDuration>0&&!h&&(function(k,N,U,H,$,Y,te){const ce=le(),de=o.av(N);for(const fe of N){const ye=k.getTileById(fe.key);ye.fadingDirection!==ve.Departing&&ye.fadeOpacity!==0||ye.resetFadeLogic(),Tr(k,ye,U,ce,H,$,te)||yn(k,ye,U,ce,Y,te)||Li(ye,de,ce,te)||ye.resetFadeLogic()}})(this._inViewTiles,m,C,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),R?this._cleanUpRasterTiles(C):this._cleanUpVectorTiles(C)}_cleanUpRasterTiles(r){for(const h of this._inViewTiles.getAllIds())r[h]||this._removeTile(h)}_cleanUpVectorTiles(r){for(const h of this._inViewTiles.getAllIds()){const m=this._inViewTiles.getTileById(h);r[h]?m.clearSymbolFadeHold():m.hasSymbolBuckets?m.holdingForSymbolFade()?m.symbolFadeFinished()&&this._removeTile(h):m.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(h)}}_addTerrainIdealTiles(r){const h=[];for(const m of r)if(m.canonical.z>this._source.minzoom){const v=m.scaledTo(m.canonical.z-1);h.push(v);const S=m.scaledTo(Math.max(this._source.minzoom,Math.min(m.canonical.z,5)));h.push(S)}return r.concat(h)}releaseSymbolFadeTiles(){for(const r of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(r).holdingForSymbolFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){var m;const v=new Set;for(const N of r)this._addTile(N).hasData()||v.add(N);const S=r.reduce(((N,U)=>(N[U.key]=U,N)),{}),C=this._retainLoadedChildren(S,v),R={},k=Math.max(h-Hi.maxUnderzooming,this._source.minzoom);for(const N of C){let U=this._inViewTiles.getTileById(N.key),H=U?.wasRequested();for(let $=N.overscaledZ-1;$>=k;--$){const Y=N.scaledTo($);if(R[Y.key])break;if(R[Y.key]=!0,U=this.getTile(Y),!U&&H&&(U=this._addTile(Y)),U){const te=U.hasData();if((te||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||H)&&(S[Y.key]=Y),H=U.wasRequested(),te)break}}}return S}_addTile(r){let h=this._inViewTiles.getTileById(r.key);if(h)return h;h=this._outOfViewCache.getAndRemove(r),h&&(h.resetFadeLogic(),this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null));const m=h;return h||(h=new Me(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._inViewTiles.setTile(r.key,h),m||this._source.fire(new o.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){this._clearTileReloadTimer(r);const m=h.getExpiryTimeout();m&&(this._timers[r]=setTimeout((()=>{this._reloadTile(r,"expired"),delete this._timers[r]}),m))}_clearTileReloadTimer(r){const h=this._timers[r];h&&(clearTimeout(h),delete this._timers[r])}_resetTileReloadTimers(){for(const r in this._timers)clearTimeout(this._timers[r]),delete this._timers[r];for(const r of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(r);this._setTileReloadTimer(r,h)}}refreshTiles(r){for(const h of this._inViewTiles.getAllIds()){const m=this._inViewTiles.getTileById(h);(this._inViewTiles.isIdRenderable(h)||m.state=="errored")&&r.some((v=>v.equals(m.tileID.canonical)))&&this._reloadTile(h,"expired")}}_removeTile(r){const h=this._inViewTiles.getTileById(r);h&&(h.uses--,this._inViewTiles.deleteTileById(r),this._clearTileReloadTimer(r),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._outOfViewCache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){r.dataType==="source"&&(r.sourceDataType!=="metadata"?r.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(r.sourceDataChanged,r.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r of this._inViewTiles.getAllIds())this._removeTile(r);this._outOfViewCache.reset()}tilesIn(r,h,m){const v=[],S=this.transform;if(!S)return v;const C=S.getCoveringTilesDetailsProvider().allowWorldCopies(),R=m?S.getCameraQueryGeometry(r):r,k=Y=>S.screenPointToMercatorCoordinate(Y,this.terrain),N=this.transformBbox(r,k,!C),U=this.transformBbox(R,k,!C),H=this.getIds(),$=o.aa.fromPoints(U);for(let Y=0;Y<H.length;Y++){const te=this._inViewTiles.getTileById(H[Y]);if(te.holdingForSymbolFade())continue;const ce=C?[te.tileID]:[te.tileID.unwrapTo(-1),te.tileID.unwrapTo(0)],de=Math.pow(2,S.zoom-te.tileID.overscaledZ),fe=h*te.queryPadding*o.a5/te.tileSize/de;for(const ye of ce){const Ee=$.map((me=>ye.getTilePoint(new o.a9(me.x,me.y))));if(Ee.expandBy(fe),Ee.intersects(kn)){const me=N.map((Pe=>ye.getTilePoint(Pe))),Ae=U.map((Pe=>ye.getTilePoint(Pe)));v.push({tile:te,tileID:C?ye:ye.unwrapTo(0),queryGeometry:me,cameraQueryGeometry:Ae,scale:de})}}}return v}transformBbox(r,h,m){let v=r.map(h);if(m){const S=o.aa.fromPoints(r);S.shrinkBy(.001*Math.min(S.width(),S.height()));const C=S.map(h);o.aa.fromPoints(v).covers(C)||(v=v.map((R=>R.x>.5?new o.a9(R.x-1,R.y,R.z):R)))}return v}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map((m=>this._inViewTiles.getTileById(m).tileID));return this.transform&&this.transform.populateCache(h),h}hasTransition(){return!!this._source.hasTransition()||!(!En(this._source.type)||!(function(r,h){if(h<=0)return!1;const m=le();for(const v of r.getAllTiles())if(v.fadeEndTime>=m)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(r){this._rasterFadeDuration=r}setFeatureState(r,h,m){this._state.updateState(r=r||o.ai,h,m)}removeFeatureState(r,h,m){this._state.removeFeatureState(r=r||o.ai,h,m)}getFeatureState(r,h){return this._state.getState(r=r||o.ai,h)}setDependencies(r,h,m){const v=this._inViewTiles.getTileById(r);v&&v.setDependencies(h,m)}reloadTilesForDependencies(r,h){for(const m of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(m).hasDependency(r,h)&&this._reloadTile(m,"reloading");this._outOfViewCache.filter((m=>!m.hasDependency(r,h)))}areTilesLoaded(){for(const r of this._inViewTiles.getAllTiles())if(r.state!=="loaded"&&r.state!=="errored")return!1;return!0}}Hi.maxUnderzooming=10,Hi.maxOverzooming=3;class Ct{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.an(r,0,1);let h=1,m=this._distances[h];const v=r*this.paddedLength+this.padding;for(;m<v&&h<this._distances.length;)m=this._distances[++h];const S=h-1,C=this._distances[S],R=m-C,k=R>0?(v-C)/R:0;return this.points[S].mult(1-k).add(this.points[h].mult(k))}}function ti(w,r){let h=!0;return w==="always"||w!=="never"&&r!=="never"||(h=!1),h}class hi{constructor(r,h,m){const v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(r/m),this.yCellCount=Math.ceil(h/m);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,m,v,S){this._forEachCell(h,m,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(r,h,m,v){this._forEachCell(h-v,m-v,h+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(m),this.circles.push(v)}_insertBoxCell(r,h,m,v,S,C){this.boxCells[S].push(C)}_insertCircleCell(r,h,m,v,S,C){this.circleCells[S].push(C)}_query(r,h,m,v,S,C,R){if(m<0||r>this.width||v<0||h>this.height)return[];const k=[];if(r<=0&&h<=0&&this.width<=m&&this.height<=v){if(S)return[{key:null,x1:r,y1:h,x2:m,y2:v}];for(let N=0;N<this.boxKeys.length;N++)k.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const U=this.circles[3*N],H=this.circles[3*N+1],$=this.circles[3*N+2];k.push({key:this.circleKeys[N],x1:U-$,y1:H-$,x2:U+$,y2:H+$})}}else this._forEachCell(r,h,m,v,this._queryCell,k,{hitTest:S,overlapMode:C,seenUids:{box:{},circle:{}}},R);return k}query(r,h,m,v){return this._query(r,h,m,v,!1,null)}hitTest(r,h,m,v,S,C){return this._query(r,h,m,v,!0,S,C).length>0}hitTestCircle(r,h,m,v,S){const C=r-m,R=r+m,k=h-m,N=h+m;if(R<0||C>this.width||N<0||k>this.height)return!1;const U=[];return this._forEachCell(C,k,R,N,this._queryCellCircle,U,{hitTest:!0,overlapMode:v,circle:{x:r,y:h,radius:m},seenUids:{box:{},circle:{}}},S),U.length>0}_queryCell(r,h,m,v,S,C,R,k){const{seenUids:N,hitTest:U,overlapMode:H}=R,$=this.boxCells[S];if($!==null){const te=this.bboxes;for(const ce of $)if(!N.box[ce]){N.box[ce]=!0;const de=4*ce,fe=this.boxKeys[ce];if(r<=te[de+2]&&h<=te[de+3]&&m>=te[de+0]&&v>=te[de+1]&&(!k||k(fe))&&(!U||!ti(H,fe.overlapMode))&&(C.push({key:fe,x1:te[de],y1:te[de+1],x2:te[de+2],y2:te[de+3]}),U))return!0}}const Y=this.circleCells[S];if(Y!==null){const te=this.circles;for(const ce of Y)if(!N.circle[ce]){N.circle[ce]=!0;const de=3*ce,fe=this.circleKeys[ce];if(this._circleAndRectCollide(te[de],te[de+1],te[de+2],r,h,m,v)&&(!k||k(fe))&&(!U||!ti(H,fe.overlapMode))){const ye=te[de],Ee=te[de+1],me=te[de+2];if(C.push({key:fe,x1:ye-me,y1:Ee-me,x2:ye+me,y2:Ee+me}),U)return!0}}}return!1}_queryCellCircle(r,h,m,v,S,C,R,k){const{circle:N,seenUids:U,overlapMode:H}=R,$=this.boxCells[S];if($!==null){const te=this.bboxes;for(const ce of $)if(!U.box[ce]){U.box[ce]=!0;const de=4*ce,fe=this.boxKeys[ce];if(this._circleAndRectCollide(N.x,N.y,N.radius,te[de+0],te[de+1],te[de+2],te[de+3])&&(!k||k(fe))&&!ti(H,fe.overlapMode))return C.push(!0),!0}}const Y=this.circleCells[S];if(Y!==null){const te=this.circles;for(const ce of Y)if(!U.circle[ce]){U.circle[ce]=!0;const de=3*ce,fe=this.circleKeys[ce];if(this._circlesCollide(te[de],te[de+1],te[de+2],N.x,N.y,N.radius)&&(!k||k(fe))&&!ti(H,fe.overlapMode))return C.push(!0),!0}}}_forEachCell(r,h,m,v,S,C,R,k){const N=this._convertToXCellCoord(r),U=this._convertToYCellCoord(h),H=this._convertToXCellCoord(m),$=this._convertToYCellCoord(v);for(let Y=N;Y<=H;Y++)for(let te=U;te<=$;te++)if(S.call(this,r,h,m,v,this.xCellCount*te+Y,C,R,k))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,m,v,S,C){const R=v-r,k=S-h,N=m+C;return N*N>R*R+k*k}_circleAndRectCollide(r,h,m,v,S,C,R){const k=(C-v)/2,N=Math.abs(r-(v+k));if(N>k+m)return!1;const U=(R-S)/2,H=Math.abs(h-(S+U));if(H>U+m)return!1;if(N<=k||H<=U)return!0;const $=N-k,Y=H-U;return $*$+Y*Y<=m*m}}function ms(w,r,h){const m=o.N();if(!w){const{vecSouth:H,vecEast:$}=Ma(r),Y=M();Y[0]=$[0],Y[1]=$[1],Y[2]=H[0],Y[3]=H[1],v=Y,(U=(C=(S=Y)[0])*(N=S[3])-(k=S[2])*(R=S[1]))&&(v[0]=N*(U=1/U),v[1]=-R*U,v[2]=-k*U,v[3]=C*U),m[0]=Y[0],m[1]=Y[1],m[4]=Y[2],m[5]=Y[3]}var v,S,C,R,k,N,U;return o.Q(m,m,[1/h,1/h,1]),m}function bh(w,r,h,m){if(w){const v=o.N();if(!r){const{vecSouth:S,vecEast:C}=Ma(h);v[0]=C[0],v[1]=C[1],v[4]=S[0],v[5]=S[1]}return o.Q(v,v,[m,m,1]),v}return h.pixelsToClipSpaceMatrix}function Ma(w){const r=Math.cos(w.rollInRadians),h=Math.sin(w.rollInRadians),m=Math.cos(w.pitchInRadians),v=Math.cos(w.bearingInRadians),S=Math.sin(w.bearingInRadians),C=o.aC();C[0]=-v*m*h-S*r,C[1]=-S*m*h+v*r;const R=o.aD(C);R<1e-9?o.aE(C):o.aF(C,C,1/R);const k=o.aC();k[0]=v*m*r-S*h,k[1]=S*m*r+v*h;const N=o.aD(k);return N<1e-9?o.aE(k):o.aF(k,k,1/N),{vecEast:k,vecSouth:C}}function fi(w,r,h,m){let v;m?(v=[w,r,m(w,r),1],o.aH(v,v,h)):(v=[w,r,0,1],zs(v,v,h));const S=v[3];return{point:new o.P(v[0]/S,v[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function bl(w,r){return .5+w/r*.5}function Pa(w,r){return w.x>=-r[0]&&w.x<=r[0]&&w.y>=-r[1]&&w.y<=r[1]}function ro(w,r,h,m,v,S,C,R,k,N,U,H,$){const Y=h?w.textSizeData:w.iconSizeData,te=o.ay(Y,r.transform.zoom),ce=[256/r.width*2+1,256/r.height*2+1],de=h?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;de.clear();const fe=w.lineVertexArray,ye=h?w.text.placedSymbolArray:w.icon.placedSymbolArray,Ee=r.transform.width/r.transform.height;let me=!1;for(let Ae=0;Ae<ye.length;Ae++){const Pe=ye.get(Ae);if(Pe.hidden||Pe.writingMode===o.az.vertical&&!me){Da(Pe.numGlyphs,de);continue}me=!1;const we=new o.P(Pe.anchorX,Pe.anchorY),ke={getElevation:$,pitchedLabelPlaneMatrix:m,lineVertexArray:fe,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:r.transform,tileAnchorPoint:we,unwrappedTileID:k,width:N,height:U,translation:H},et=xc(Pe.anchorX,Pe.anchorY,ke);if(!Pa(et.point,ce)){Da(Pe.numGlyphs,de);continue}const Ze=bl(r.transform.cameraToCenterDistance,et.signedDistanceFromCamera),Ke=o.aA(Y,te,Pe),Qe=S?Ke*r.transform.getPitchedTextCorrection(Pe.anchorX,Pe.anchorY,k)/Ze:Ke*Ze,Rt=Ln({projectionContext:ke,pitchedLabelPlaneMatrixInverse:v,symbol:Pe,fontSize:Qe,flip:!1,keepUpright:C,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:Ee,rotateToLine:R});me=Rt.useVertical,(Rt.notEnoughRoom||me||Rt.needsFlipping&&Ln({projectionContext:ke,pitchedLabelPlaneMatrixInverse:v,symbol:Pe,fontSize:Qe,flip:!0,keepUpright:C,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:de,aspectRatio:Ee,rotateToLine:R}).notEnoughRoom)&&Da(Pe.numGlyphs,de)}h?w.text.dynamicLayoutVertexBuffer.updateData(de):w.icon.dynamicLayoutVertexBuffer.updateData(de)}function Ia(w,r,h,m,v,S,C,R){const k=S.glyphStartIndex+S.numGlyphs,N=S.lineStartIndex,U=S.lineStartIndex+S.lineLength,H=r.getoffsetX(S.glyphStartIndex),$=r.getoffsetX(k-1),Y=la(w*H,h,m,v,S.segment,N,U,R,C);if(!Y)return null;const te=la(w*$,h,m,v,S.segment,N,U,R,C);return te?R.projectionCache.anyProjectionOccluded?null:{first:Y,last:te}:null}function Ra(w,r,h,m){return w===o.az.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*m?{useVertical:!0}:(w===o.az.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function Ln(w){const{projectionContext:r,pitchedLabelPlaneMatrixInverse:h,symbol:m,fontSize:v,flip:S,keepUpright:C,glyphOffsetArray:R,dynamicLayoutVertexArray:k,aspectRatio:N,rotateToLine:U}=w,H=v/24,$=m.lineOffsetX*H,Y=m.lineOffsetY*H;let te;if(m.numGlyphs>1){const ce=m.glyphStartIndex+m.numGlyphs,de=m.lineStartIndex,fe=m.lineStartIndex+m.lineLength,ye=Ia(H,R,$,Y,S,m,U,r);if(!ye)return{notEnoughRoom:!0};const Ee=so(ye.first.point.x,ye.first.point.y,r,h),me=so(ye.last.point.x,ye.last.point.y,r,h);if(C&&!S){const Ae=Ra(m.writingMode,Ee,me,N);if(Ae)return Ae}te=[ye.first];for(let Ae=m.glyphStartIndex+1;Ae<ce-1;Ae++){const Pe=la(H*R.getoffsetX(Ae),$,Y,S,m.segment,de,fe,r,U);if(!Pe)return{notEnoughRoom:!0};te.push(Pe)}te.push(ye.last)}else{if(C&&!S){const de=Ii(r.tileAnchorPoint.x,r.tileAnchorPoint.y,r).point,fe=m.lineStartIndex+m.segment+1,ye=new o.P(r.lineVertexArray.getx(fe),r.lineVertexArray.gety(fe)),Ee=Ii(ye.x,ye.y,r),me=Ee.signedDistanceFromCamera>0?Ee.point:bc(r.tileAnchorPoint,ye,de,1,r),Ae=so(de.x,de.y,r,h),Pe=so(me.x,me.y,r,h),we=Ra(m.writingMode,Ae,Pe,N);if(we)return we}const ce=la(H*R.getoffsetX(m.glyphStartIndex),$,Y,S,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,r,U);if(!ce||r.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};te=[ce]}for(const ce of te)o.aG(k,ce.point,ce.angle);return{}}function bc(w,r,h,m,v){const S=w.add(w.sub(r)._unit()),C=Ii(S.x,S.y,v).point,R=h.sub(C);return h.add(R._mult(m/R.mag()))}function Pr(w,r,h){const m=r.projectionCache;if(m.projections[w])return m.projections[w];const v=new o.P(r.lineVertexArray.getx(w),r.lineVertexArray.gety(w)),S=Ii(v.x,v.y,r);if(S.signedDistanceFromCamera>0)return m.projections[w]=S.point,m.anyProjectionOccluded=m.anyProjectionOccluded||S.isOccluded,S.point;const C=w-h.direction;return bc(h.distanceFromAnchor===0?r.tileAnchorPoint:new o.P(r.lineVertexArray.getx(C),r.lineVertexArray.gety(C)),v,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,r)}function Ii(w,r,h){const m=w+h.translation[0],v=r+h.translation[1];let S;return h.pitchWithMap?(S=fi(m,v,h.pitchedLabelPlaneMatrix,h.getElevation),S.isOccluded=!1):(S=h.transform.projectTileCoordinates(m,v,h.unwrappedTileID,h.getElevation),S.point.x=(.5*S.point.x+.5)*h.width,S.point.y=(.5*-S.point.y+.5)*h.height),S}function so(w,r,h,m){if(h.pitchWithMap){const v=[w,r,0,1];return o.aH(v,v,m),h.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],h.unwrappedTileID,h.getElevation).point}return{x:w/h.width*2-1,y:1-r/h.height*2}}function xc(w,r,h){return h.transform.projectTileCoordinates(w,r,h.unwrappedTileID,h.getElevation)}function wc(w,r,h){return w._unit()._perp()._mult(r*h)}function Bo(w,r,h,m,v,S,C,R,k){if(R.projectionCache.offsets[w])return R.projectionCache.offsets[w];const N=h.add(r);if(w+k.direction<m||w+k.direction>=v)return R.projectionCache.offsets[w]=N,N;const U=Pr(w+k.direction,R,k),H=wc(U.sub(h),C,k.direction),$=h.add(H),Y=U.add(H);return R.projectionCache.offsets[w]=o.aI(S,N,$,Y)||N,R.projectionCache.offsets[w]}function la(w,r,h,m,v,S,C,R,k){const N=m?w-r:w+r;let U=N>0?1:-1,H=0;m&&(U*=-1,H=Math.PI),U<0&&(H+=Math.PI);let $,Y=U>0?S+v:S+v+1;R.projectionCache.cachedAnchorPoint?$=R.projectionCache.cachedAnchorPoint:($=Ii(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=$);let te,ce,de=$,fe=$,ye=0,Ee=0;const me=Math.abs(N),Ae=[];let Pe;for(;ye+Ee<=me;){if(Y+=U,Y<S||Y>=C)return null;ye+=Ee,fe=de,ce=te;const et={absOffsetX:me,direction:U,distanceFromAnchor:ye,previousVertex:fe};if(de=Pr(Y,R,et),h===0)Ae.push(fe),Pe=de.sub(fe);else{let Ze;const Ke=de.sub(fe);Ze=Ke.mag()===0?wc(Pr(Y+U,R,et).sub(de),h,U):wc(Ke,h,U),ce||(ce=fe.add(Ze)),te=Bo(Y,Ze,de,S,C,ce,h,R,et),Ae.push(ce),Pe=te.sub(ce)}Ee=Pe.mag()}const we=Pe._mult((me-ye)/Ee)._add(ce||fe),ke=H+Math.atan2(de.y-fe.y,de.x-fe.x);return Ae.push(we),{point:we,angle:k?ke:0,path:Ae}}const du=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Da(w,r){for(let h=0;h<w;h++){const m=r.length;r.resize(m+4),r.float32.set(du,3*m)}}function zs(w,r,h){const m=r[0],v=r[1];return w[0]=h[0]*m+h[4]*v+h[12],w[1]=h[1]*m+h[5]*v+h[13],w[3]=h[3]*m+h[7]*v+h[15],w}const Bi=100;class Rf{constructor(r,h=new hi(r.width+200,r.height+200,25),m=new hi(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=m,this.pitchFactor=Math.cos(r.pitch*Math.PI/180)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Bi,this.screenBottomBoundary=r.height+Bi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,m,v,S,C,R,k,N,U,H,$){const Y=this.projectAndGetPerspectiveRatio(r.anchorPointX+k[0],r.anchorPointY+k[1],S,U,$),te=m*Y.perspectiveRatio;let ce;if(C||R)ce=this._projectCollisionBox(r,te,v,S,C,R,k,Y,U,H,$);else{const Pe=Y.x+(H?H.x*te:0),we=Y.y+(H?H.y*te:0);ce={allPointsOccluded:!1,box:[Pe+r.x1*te,we+r.y1*te,Pe+r.x2*te,we+r.y2*te]}}const[de,fe,ye,Ee]=ce.box,me=C?ce.allPointsOccluded:Y.isOccluded;let Ae=me;return Ae||(Ae=Y.perspectiveRatio<this.perspectiveRatioCutoff),Ae||(Ae=!this.isInsideGrid(de,fe,ye,Ee)),Ae||h!=="always"&&this.grid.hitTest(de,fe,ye,Ee,h,N)?{box:[de,fe,ye,Ee],placeable:!1,offscreen:!1,occluded:me}:{box:[de,fe,ye,Ee],placeable:!0,offscreen:this.isOffscreen(de,fe,ye,Ee),occluded:me}}placeCollisionCircles(r,h,m,v,S,C,R,k,N,U,H,$,Y,te){const ce=[],de=new o.P(h.anchorX,h.anchorY),fe=this.getPerspectiveRatio(de.x,de.y,C,te),ye=(N?S*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,C)/fe:S*fe)/o.aM,Ee={getElevation:te,pitchedLabelPlaneMatrix:R,lineVertexArray:m,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:de,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:Y},me=Ia(ye,v,h.lineOffsetX*ye,h.lineOffsetY*ye,!1,h,!1,Ee);let Ae=!1,Pe=!1,we=!0;if(me){const ke=.5*H*fe+$,et=new o.P(-100,-100),Ze=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new Ct,Qe=me.first,Rt=me.last;let Ot=[];for(let ci=Qe.path.length-1;ci>=1;ci--)Ot.push(Qe.path[ci]);for(let ci=1;ci<Rt.path.length;ci++)Ot.push(Rt.path[ci]);const _t=2.5*ke;if(N){const ci=this.projectPathToScreenSpace(Ot,Ee);Ot=ci.some((ji=>ji.signedDistanceFromCamera<=0))?[]:ci.map((ji=>ji.point))}let zt=[];if(Ot.length>0){const ci=Ot[0].clone(),ji=Ot[0].clone();for(let on=1;on<Ot.length;on++)ci.x=Math.min(ci.x,Ot[on].x),ci.y=Math.min(ci.y,Ot[on].y),ji.x=Math.max(ji.x,Ot[on].x),ji.y=Math.max(ji.y,Ot[on].y);zt=ci.x>=et.x&&ji.x<=Ze.x&&ci.y>=et.y&&ji.y<=Ze.y?[Ot]:ji.x<et.x||ci.x>Ze.x||ji.y<et.y||ci.y>Ze.y?[]:o.aJ([Ot],et.x,et.y,Ze.x,Ze.y)}for(const ci of zt){Ke.reset(ci,.25*ke);let ji=0;ji=Ke.length<=.5*ke?1:Math.ceil(Ke.paddedLength/_t)+1;for(let on=0;on<ji;on++){const tn=on/Math.max(ji-1,1),fn=Ke.lerp(tn),Zi=fn.x+Bi,Pn=fn.y+Bi;ce.push(Zi,Pn,ke,0);const dn=Zi-ke,fr=Pn-ke,Nn=Zi+ke,Un=Pn+ke;if(we=we&&this.isOffscreen(dn,fr,Nn,Un),Pe=Pe||this.isInsideGrid(dn,fr,Nn,Un),r!=="always"&&this.grid.hitTestCircle(Zi,Pn,ke,r,U)&&(Ae=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!k&&Ae||!Pe||fe<this.perspectiveRatioCutoff?[]:ce,offscreen:we,collisionDetected:Ae}}projectPathToScreenSpace(r,h){const m=(function(v,S){const C=o.N();return o.aB(C,S.pitchedLabelPlaneMatrix),v.map((R=>{const k=fi(R.x,R.y,C,S.getElevation),N=S.transform.projectTileCoordinates(k.point.x,k.point.y,S.unwrappedTileID,S.getElevation);return N.point.x=(.5*N.point.x+.5)*S.width,N.point.y=(.5*-N.point.y+.5)*S.height,N}))})(r,h);return(function(v){let S=0,C=0,R=0,k=0;for(let N=0;N<v.length;N++)v[N].isOccluded?(R=N+1,k=0):(k++,k>C&&(C=k,S=R));return v.slice(S,S+C)})(m)}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[],m=new o.aa;for(const H of r){const $=new o.P(H.x+Bi,H.y+Bi);m.extend($),h.push($)}const{minX:v,minY:S,maxX:C,maxY:R}=m,k=this.grid.query(v,S,C,R).concat(this.ignoredGrid.query(v,S,C,R)),N={},U={};for(const H of k){const $=H.key;if(N[$.bucketInstanceId]===void 0&&(N[$.bucketInstanceId]={}),N[$.bucketInstanceId][$.featureIndex])continue;const Y=[new o.P(H.x1,H.y1),new o.P(H.x2,H.y1),new o.P(H.x2,H.y2),new o.P(H.x1,H.y2)];o.aK(h,Y)&&(N[$.bucketInstanceId][$.featureIndex]=!0,U[$.bucketInstanceId]===void 0&&(U[$.bucketInstanceId]=[]),U[$.bucketInstanceId].push($.featureIndex))}return U}insertCollisionBox(r,h,m,v,S,C){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:C,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,m,v,S,C){const R=m?this.ignoredGrid:this.grid,k={bucketInstanceId:v,featureIndex:S,collisionGroupID:C,overlapMode:h};for(let N=0;N<r.length;N+=4)R.insertCircle(k,r[N],r[N+1],r[N+2])}projectAndGetPerspectiveRatio(r,h,m,v,S){if(S){let C;v?(C=[r,h,v(r,h),1],o.aH(C,C,S)):(C=[r,h,0,1],zs(C,C,S));const R=C[3];return{x:(C[0]/R+1)/2*this.transform.width+Bi,y:(-C[1]/R+1)/2*this.transform.height+Bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const C=this.transform.projectTileCoordinates(r,h,m,v);return{x:(C.point.x+1)/2*this.transform.width+Bi,y:(1-C.point.y)/2*this.transform.height+Bi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(r,h,m,v){const S=this.transform.projectTileCoordinates(r,h,m,v);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(r,h,m,v){return m<Bi||r>=this.screenRightBoundary||v<Bi||h>this.screenBottomBoundary}isInsideGrid(r,h,m,v){return m>=0&&r<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=o.ar([]);return o.O(r,r,[-100,-100,0]),r}_projectCollisionBox(r,h,m,v,S,C,R,k,N,U,H){let $=1,Y=0,te=0,ce=1;const de=r.anchorPointX+R[0],fe=r.anchorPointY+R[1];if(C&&!S){const Ot=this.projectAndGetPerspectiveRatio(de+1,fe,v,N,H),_t=Ot.x-k.x,zt=Math.atan((Ot.y-k.y)/_t)+(_t<0?Math.PI:0),ci=Math.sin(zt),ji=Math.cos(zt);$=ji,Y=ci,te=-ci,ce=ji}else if(!C&&S){const Ot=Ma(this.transform);$=Ot.vecEast[0],Y=Ot.vecEast[1],te=Ot.vecSouth[0],ce=Ot.vecSouth[1]}let ye=k.x,Ee=k.y,me=h;S&&(ye=de,Ee=fe,me=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),me*=this.transform.getPitchedTextCorrection(de,fe,v),U||(me*=o.an(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(ye+=$*U.x*me+te*U.y*me,Ee+=Y*U.x*me+ce*U.y*me);const Ae=r.x1*me,Pe=r.x2*me,we=(Ae+Pe)/2,ke=r.y1*me,et=r.y2*me,Ze=(ke+et)/2,Ke=[{offsetX:Ae,offsetY:ke},{offsetX:we,offsetY:ke},{offsetX:Pe,offsetY:ke},{offsetX:Pe,offsetY:Ze},{offsetX:Pe,offsetY:et},{offsetX:we,offsetY:et},{offsetX:Ae,offsetY:et},{offsetX:Ae,offsetY:Ze}];let Qe=[];for(const{offsetX:Ot,offsetY:_t}of Ke)Qe.push(new o.P(ye+$*Ot+te*_t,Ee+Y*Ot+ce*_t));let Rt=!1;if(S){const Ot=Qe.map((_t=>this.projectAndGetPerspectiveRatio(_t.x,_t.y,v,N,H)));Rt=Ot.some((_t=>!_t.isOccluded)),Qe=Ot.map((_t=>new o.P(_t.x,_t.y)))}else Rt=!0;return{box:o.aL(Qe),allPointsOccluded:!Rt}}}class sp{constructor(r,h,m,v){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class xl{constructor(r,h,m,v,S){this.text=new sp(r?r.text:null,h,m,S),this.icon=new sp(r?r.icon:null,h,v,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Df{constructor(r,h,m){this.text=r,this.icon=h,this.skipFade=m}}class pu{constructor(r,h,m,v,S){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=S}}class ap{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:m=>m.collisionGroupID===h}}return this.collisionGroups[r]}}function Nr(w,r,h,m,v){const{horizontalAlign:S,verticalAlign:C}=o.aS(w);return new o.P(-(S-.5)*r+m[0]*v,-(C-.5)*h+m[1]*v)}class gu{constructor(r,h,m,v,S){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Rf(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new ap(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){const h=this.terrain;return h?(m,v)=>h.getElevation(r,m,v):null}getBucketParts(r,h,m,v){const S=m.getBucket(h),C=m.latestFeatureIndex;if(!S||!C||h.id!==S.layerIds[0])return;const R=m.collisionBoxArray,k=S.layers[0].layout,N=S.layers[0].paint,U=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),H=m.tileSize/o.a5,$=m.tileID.toUnwrapped(),Y=k.get("text-rotation-alignment")==="map",te=o.aN(m,1,this.transform.zoom),ce=o.aO(this.collisionIndex.transform,m,N.get("text-translate"),N.get("text-translate-anchor")),de=o.aO(this.collisionIndex.transform,m,N.get("icon-translate"),N.get("icon-translate-anchor")),fe=ms(Y,this.transform,te);this.retainedQueryData[S.bucketInstanceId]=new pu(S.bucketInstanceId,C,S.sourceLayerIndex,S.index,m.tileID);const ye={bucket:S,layout:k,translationText:ce,translationIcon:de,unwrappedTileID:$,pitchedLabelPlaneMatrix:fe,scale:U,textPixelRatio:H,holdingForFade:m.holdingForSymbolFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.ay(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(v)for(const Ee of S.sortKeyRanges){const{sortKey:me,symbolInstanceStart:Ae,symbolInstanceEnd:Pe}=Ee;r.push({sortKey:me,symbolInstanceStart:Ae,symbolInstanceEnd:Pe,parameters:ye})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(r,h,m,v,S,C,R,k,N,U,H,$,Y,te,ce,de,fe,ye,Ee,me){const Ae=o.aP[r.textAnchor],Pe=[r.textOffset0,r.textOffset1],we=Nr(Ae,m,v,Pe,S),ke=this.collisionIndex.placeCollisionBox(h,$,k,N,U,R,C,de,H.predicate,Ee,we,me);if((!ye||this.collisionIndex.placeCollisionBox(ye,$,k,N,U,R,C,fe,H.predicate,Ee,we,me).placeable)&&ke.placeable){let et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(et=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Pe,width:m,height:v,anchor:Ae,textBoxScale:S,prevAnchor:et},this.markUsedJustification(te,Ae,Y,ce),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ce,Y),this.placedOrientations[Y.crossTileID]=ce),{shift:we,placedGlyphBoxes:ke}}}placeLayerBucketPart(r,h,m){const{bucket:v,layout:S,translationText:C,translationIcon:R,unwrappedTileID:k,pitchedLabelPlaneMatrix:N,textPixelRatio:U,holdingForFade:H,collisionBoxArray:$,partiallyEvaluatedTextSize:Y,collisionGroup:te}=r.parameters,ce=S.get("text-optional"),de=S.get("icon-optional"),fe=o.aQ(S,"text-overlap","text-allow-overlap"),ye=fe==="always",Ee=o.aQ(S,"icon-overlap","icon-allow-overlap"),me=Ee==="always",Ae=S.get("text-rotation-alignment")==="map",Pe=S.get("text-pitch-alignment")==="map",we=S.get("icon-text-fit")!=="none",ke=S.get("symbol-z-order")==="viewport-y",et=ye&&(me||!v.hasIconData()||de),Ze=me&&(ye||!v.hasTextData()||ce);!v.collisionArrays&&$&&v.deserializeCollisionBoxes($);const Ke=this.retainedQueryData[v.bucketInstanceId].tileID,Qe=this._getTerrainElevationFunc(Ke),Rt=this.transform.getFastPathSimpleProjectionMatrix(Ke),Ot=(_t,zt,ci)=>{var ji,on;if(h[_t.crossTileID])return;if(H)return void(this.placements[_t.crossTileID]=new Df(!1,!1,!1));let tn=!1,fn=!1,Zi=!0,Pn=null,dn={box:null,placeable:!1,offscreen:null,occluded:!1},fr={placeable:!1},Nn=null,Un=null,dr=null,Ka=0,Qa=0,_a=0;zt.textFeatureIndex?Ka=zt.textFeatureIndex:_t.useRuntimeCollisionCircles&&(Ka=_t.featureIndex),zt.verticalTextFeatureIndex&&(Qa=zt.verticalTextFeatureIndex);const rs=zt.textBox;if(rs){const ss=qi=>{let nn=o.az.horizontal;if(v.allowVerticalPlacement&&!qi&&this.prevPlacement){const Kn=this.prevPlacement.placedOrientations[_t.crossTileID];Kn&&(this.placedOrientations[_t.crossTileID]=Kn,nn=Kn,this.markUsedOrientation(v,nn,_t))}return nn},Cs=(qi,nn)=>{if(v.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&zt.verticalTextBox){for(const Kn of v.writingModes)if(Kn===o.az.vertical?(dn=nn(),fr=dn):dn=qi(),dn&&dn.placeable)break}else dn=qi()},Gs=_t.textAnchorOffsetStartIndex,Zs=_t.textAnchorOffsetEndIndex;if(Zs===Gs){const qi=(nn,Kn)=>{const tr=this.collisionIndex.placeCollisionBox(nn,fe,U,Ke,k,Pe,Ae,C,te.predicate,Qe,void 0,Rt);return tr&&tr.placeable&&(this.markUsedOrientation(v,Kn,_t),this.placedOrientations[_t.crossTileID]=Kn),tr};Cs((()=>qi(rs,o.az.horizontal)),(()=>{const nn=zt.verticalTextBox;return v.allowVerticalPlacement&&_t.numVerticalGlyphVertices>0&&nn?qi(nn,o.az.vertical):{box:null,offscreen:null}})),ss(dn&&dn.placeable)}else{let qi=o.aP[(on=(ji=this.prevPlacement)===null||ji===void 0?void 0:ji.variableOffsets[_t.crossTileID])===null||on===void 0?void 0:on.anchor];const nn=(tr,Gh,Zh)=>{const il=tr.x2-tr.x1,Sp=tr.y2-tr.y1,nl=_t.textBoxScale,Yh=we&&Ee==="never"?Gh:null;let bo=null,xo=fe==="never"?1:2,va="never";qi&&xo++;for(let Kh=0;Kh<xo;Kh++){for(let Ku=Gs;Ku<Zs;Ku++){const Qu=v.textAnchorOffsets.get(Ku);if(qi&&Qu.textAnchor!==qi)continue;const Ju=this.attemptAnchorPlacement(Qu,tr,il,Sp,nl,Ae,Pe,U,Ke,k,te,va,_t,v,Zh,C,R,Yh,Qe);if(Ju&&(bo=Ju.placedGlyphBoxes,bo&&bo.placeable))return tn=!0,Pn=Ju.shift,bo}qi?qi=null:va=fe}return m&&!bo&&(bo={box:this.collisionIndex.placeCollisionBox(rs,"always",U,Ke,k,Pe,Ae,C,te.predicate,Qe,void 0,Rt).box,offscreen:!1,placeable:!1,occluded:!1}),bo};Cs((()=>nn(rs,zt.iconBox,o.az.horizontal)),(()=>{const tr=zt.verticalTextBox;return v.allowVerticalPlacement&&(!dn||!dn.placeable)&&_t.numVerticalGlyphVertices>0&&tr?nn(tr,zt.verticalIconBox,o.az.vertical):{box:null,occluded:!0,offscreen:null}})),dn&&(tn=dn.placeable,Zi=dn.offscreen);const Kn=ss(dn&&dn.placeable);if(!tn&&this.prevPlacement){const tr=this.prevPlacement.variableOffsets[_t.crossTileID];tr&&(this.variableOffsets[_t.crossTileID]=tr,this.markUsedJustification(v,tr.anchor,_t,Kn))}}}if(Nn=dn,tn=Nn&&Nn.placeable,Zi=Nn&&Nn.offscreen,_t.useRuntimeCollisionCircles&&_t.centerJustifiedTextSymbolIndex>=0){const ss=v.text.placedSymbolArray.get(_t.centerJustifiedTextSymbolIndex),Cs=o.aA(v.textSizeData,Y,ss),Gs=S.get("text-padding");Un=this.collisionIndex.placeCollisionCircles(fe,ss,v.lineVertexArray,v.glyphOffsetArray,Cs,k,N,m,Pe,te.predicate,_t.collisionCircleDiameter,Gs,C,Qe),Un.circles.length&&Un.collisionDetected&&!m&&o.w("Collisions detected, but collision boxes are not shown"),tn=ye||Un.circles.length>0&&!Un.collisionDetected,Zi=Zi&&Un.offscreen}if(zt.iconFeatureIndex&&(_a=zt.iconFeatureIndex),zt.iconBox){const ss=Cs=>this.collisionIndex.placeCollisionBox(Cs,Ee,U,Ke,k,Pe,Ae,R,te.predicate,Qe,we&&Pn?Pn:void 0,Rt);fr&&fr.placeable&&zt.verticalIconBox?(dr=ss(zt.verticalIconBox),fn=dr.placeable):(dr=ss(zt.iconBox),fn=dr.placeable),Zi=Zi&&dr.offscreen}const Wl=ce||_t.numHorizontalGlyphVertices===0&&_t.numVerticalGlyphVertices===0,Wc=de||_t.numIconVertices===0;Wl||Wc?Wc?Wl||(fn=fn&&tn):tn=fn&&tn:fn=tn=fn&&tn;const ya=fn&&dr.placeable;if(tn&&Nn.placeable&&this.collisionIndex.insertCollisionBox(Nn.box,fe,S.get("text-ignore-placement"),v.bucketInstanceId,fr&&fr.placeable&&Qa?Qa:Ka,te.ID),ya&&this.collisionIndex.insertCollisionBox(dr.box,Ee,S.get("icon-ignore-placement"),v.bucketInstanceId,_a,te.ID),Un&&tn&&this.collisionIndex.insertCollisionCircles(Un.circles,fe,S.get("text-ignore-placement"),v.bucketInstanceId,Ka,te.ID),m&&this.storeCollisionData(v.bucketInstanceId,ci,zt,Nn,dr,Un),_t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[_t.crossTileID]=new Df((tn||et)&&!Nn?.occluded,(fn||Ze)&&!dr?.occluded,Zi||v.justReloaded),h[_t.crossTileID]=!0};if(ke){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const _t=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let zt=_t.length-1;zt>=0;--zt){const ci=_t[zt];Ot(v.symbolInstances.get(ci),v.collisionArrays[ci],ci)}}else for(let _t=r.symbolInstanceStart;_t<r.symbolInstanceEnd;_t++)Ot(v.symbolInstances.get(_t),v.collisionArrays[_t],_t);v.justReloaded=!1}storeCollisionData(r,h,m,v,S,C){if(m.textBox||m.iconBox){let R,k;this.collisionBoxArrays.has(r)?R=this.collisionBoxArrays.get(r):(R=new Map,this.collisionBoxArrays.set(r,R)),R.has(h)?k=R.get(h):(k={text:null,icon:null},R.set(h,k)),m.textBox&&(k.text=v.box),m.iconBox&&(k.icon=S.box)}if(C){let R=this.collisionCircleArrays[r];R===void 0&&(R=this.collisionCircleArrays[r]=[]);for(let k=0;k<C.circles.length;k+=4)R.push(C.circles[k+0]-Bi),R.push(C.circles[k+1]-Bi),R.push(C.circles[k+2]),R.push(C.collisionDetected?1:0)}}markUsedJustification(r,h,m,v){let S;S=v===o.az.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.aR(h)];const C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of C)R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=S>=0&&R!==S?0:m.crossTileID)}markUsedOrientation(r,h,m){const v=h===o.az.horizontal||h===o.az.horizontalOnly?h:0,S=h===o.az.vertical?h:0,C=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of C)r.text.placedSymbolArray.get(R).placedOrientation=v;m.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let m=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(r):1,S=h?h.opacities:{},C=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(const k in this.placements){const N=this.placements[k],U=S[k];U?(this.opacities[k]=new xl(U,v,N.text,N.icon),m=m||N.text!==U.text.placed||N.icon!==U.icon.placed):(this.opacities[k]=new xl(null,v,N.text,N.icon,N.skipFade),m=m||N.text||N.icon)}for(const k in S){const N=S[k];if(!this.opacities[k]){const U=new xl(N,v,!1,!1);U.isHidden()||(this.opacities[k]=U,m=m||N.text.placed||N.icon.placed)}}for(const k in C)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=C[k]);for(const k in R)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=R[k]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const m={};for(const v of h){const S=v.getBucket(r);S&&v.latestFeatureIndex&&r.id===S.layerIds[0]&&this.updateBucketOpacities(S,v.tileID,m,v.collisionBoxArray)}}updateBucketOpacities(r,h,m,v){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const S=r.layers[0],C=S.layout,R=new xl(null,0,!1,!1,!0),k=C.get("text-allow-overlap"),N=C.get("icon-allow-overlap"),U=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),H=C.get("text-rotation-alignment")==="map",$=C.get("text-pitch-alignment")==="map",Y=C.get("icon-text-fit")!=="none",te=new xl(null,0,k&&(N||!r.hasIconData()||C.get("icon-optional")),N&&(k||!r.hasTextData()||C.get("text-optional")),!0);!r.collisionArrays&&v&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(v);const ce=(fe,ye,Ee)=>{for(let me=0;me<ye/4;me++)fe.opacityVertexArray.emplaceBack(Ee);fe.hasVisibleVertices=fe.hasVisibleVertices||Ee!==Tl},de=this.collisionBoxArrays.get(r.bucketInstanceId);for(let fe=0;fe<r.symbolInstances.length;fe++){const ye=r.symbolInstances.get(fe),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:me,crossTileID:Ae}=ye;let Pe=this.opacities[Ae];m[Ae]?Pe=R:Pe||(Pe=te,this.opacities[Ae]=Pe),m[Ae]=!0;const we=ye.numIconVertices>0,ke=this.placedOrientations[ye.crossTileID],et=ke===o.az.vertical,Ze=ke===o.az.horizontal||ke===o.az.horizontalOnly;if(Ee>0||me>0){const Qe=wh(Pe.text);ce(r.text,Ee,et?Tl:Qe),ce(r.text,me,Ze?Tl:Qe);const Rt=Pe.text.isHidden();[ye.rightJustifiedTextSymbolIndex,ye.centerJustifiedTextSymbolIndex,ye.leftJustifiedTextSymbolIndex].forEach((zt=>{zt>=0&&(r.text.placedSymbolArray.get(zt).hidden=Rt||et?1:0)})),ye.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ye.verticalPlacedTextSymbolIndex).hidden=Rt||Ze?1:0);const Ot=this.variableOffsets[ye.crossTileID];Ot&&this.markUsedJustification(r,Ot.anchor,ye,ke);const _t=this.placedOrientations[ye.crossTileID];_t&&(this.markUsedJustification(r,"left",ye,_t),this.markUsedOrientation(r,_t,ye))}if(we){const Qe=wh(Pe.icon),Rt=!(Y&&ye.verticalPlacedIconSymbolIndex&&et);ye.placedIconSymbolIndex>=0&&(ce(r.icon,ye.numIconVertices,Rt?Qe:Tl),r.icon.placedSymbolArray.get(ye.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ye.verticalPlacedIconSymbolIndex>=0&&(ce(r.icon,ye.numVerticalIconVertices,Rt?Tl:Qe),r.icon.placedSymbolArray.get(ye.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const Ke=de&&de.has(fe)?de.get(fe):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Qe=r.collisionArrays[fe];if(Qe){let Rt=new o.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let Ot=!0;if(U){const _t=this.variableOffsets[Ae];_t?(Rt=Nr(_t.anchor,_t.width,_t.height,_t.textOffset,_t.textBoxScale),H&&Rt._rotate($?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ot=!1}if(Qe.textBox||Qe.verticalTextBox){let _t;Qe.textBox&&(_t=et),Qe.verticalTextBox&&(_t=Ze),xh(r.textCollisionBox.collisionVertexArray,Pe.text.placed,!Ot||_t,Ke.text,Rt.x,Rt.y)}}if(Qe.iconBox||Qe.verticalIconBox){const Ot=!!(!Ze&&Qe.verticalIconBox);let _t;Qe.iconBox&&(_t=Ot),Qe.verticalIconBox&&(_t=!Ot),xh(r.iconCollisionBox.collisionVertexArray,Pe.icon.placed,_t,Ke.icon,Y?Rt.x:0,Y?Rt.y:0)}}}}if(r.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);r.bucketInstanceId in this.collisionCircleArrays&&(r.collisionCircleArray=this.collisionCircleArrays[r.bucketInstanceId],delete this.collisionCircleArrays[r.bucketInstanceId])}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const m=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*m>r}setStale(){this.stale=!0}}function xh(w,r,h,m,v,S){m&&m.length!==0||(m=[0,0,0,0]);const C=m[0]-Bi,R=m[1]-Bi,k=m[2]-Bi,N=m[3]-Bi;w.emplaceBack(r?1:0,h?1:0,v||0,S||0,C,R),w.emplaceBack(r?1:0,h?1:0,v||0,S||0,k,R),w.emplaceBack(r?1:0,h?1:0,v||0,S||0,k,N),w.emplaceBack(r?1:0,h?1:0,v||0,S||0,C,N)}const mu=Math.pow(2,25),zo=Math.pow(2,24),op=Math.pow(2,17),Tc=Math.pow(2,16),ao=Math.pow(2,9),lp=Math.pow(2,8),wl=Math.pow(2,1);function wh(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const r=w.placed?1:0,h=Math.floor(127*w.opacity);return h*mu+r*zo+h*op+r*Tc+h*ao+r*lp+h*wl+r}const Tl=0;class Fo{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,m,v,S){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(C,v,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((R,k)=>R.sortKey-k.sortKey)));this._currentPartIndex<C.length;)if(h.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,S())return!0;return!1}}class Sc{constructor(r,h,m,v,S,C,R,k){this.placement=new gu(r,h,C,R,k),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(r,h,m){const v=le(),S=()=>!this._forceFullPlacement&&le()-v>2;for(;this._currentPlacementIndex>=0;){const C=h[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Fo(C)),this._inProgressLayer.continuePlacement(m[C.source],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const mi=512/o.a5/2;class ca{constructor(r,h,m){this.tileID=r,this.bucketInstanceId=m,this._symbolsByKey={};const v=new Map;for(let S=0;S<h.length;S++){const C=h.get(S),R=C.key,k=v.get(R);k?k.push(C):v.set(R,[C])}for(const[S,C]of v){const R={positions:C.map((k=>({x:Math.floor(k.anchorX*mi),y:Math.floor(k.anchorY*mi)}))),crossTileIDs:C.map((k=>k.crossTileID))};if(R.positions.length>128){const k=new o.aT(R.positions.length,16,Uint16Array);for(const{x:N,y:U}of R.positions)k.add(N,U);k.finish(),delete R.positions,R.index=k}this._symbolsByKey[S]=R}}getScaledCoordinates(r,h){const{x:m,y:v,z:S}=this.tileID.canonical,{x:C,y:R,z:k}=h.canonical,N=mi/Math.pow(2,k-S),U=(R*o.a5+r.anchorY)*N,H=v*o.a5*mi;return{x:Math.floor((C*o.a5+r.anchorX)*N-m*o.a5*mi),y:Math.floor(U-H)}}findMatches(r,h,m){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let S=0;S<r.length;S++){const C=r.get(S);if(C.crossTileID)continue;const R=this._symbolsByKey[C.key];if(!R)continue;const k=this.getScaledCoordinates(C,h);if(R.index){const N=R.index.range(k.x-v,k.y-v,k.x+v,k.y+v).sort();for(const U of N){const H=R.crossTileIDs[U];if(!m[H]){m[H]=!0,C.crossTileID=H;break}}}else if(R.positions)for(let N=0;N<R.positions.length;N++){const U=R.positions[N],H=R.crossTileIDs[N];if(Math.abs(U.x-k.x)<=v&&Math.abs(U.y-k.y)<=v&&!m[H]){m[H]=!0,C.crossTileID=H;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:r})=>r))}}class Of{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _u{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const m in this.indexes){const v=this.indexes[m],S={};for(const C in v){const R=v[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),S[R.tileID.key]=R}this.indexes[m]=S}this.lng=r}addBucket(r,h,m){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const v=this.usedCrossTileIDs[r.overscaledZ];for(const S in this.indexes){const C=this.indexes[S];if(Number(S)>r.overscaledZ)for(const R in C){const k=C[R];k.tileID.isChildOf(r)&&k.findMatches(h.symbolInstances,r,v)}else{const R=C[r.scaledTo(Number(S)).key];R&&R.findMatches(h.symbolInstances,r,v)}}for(let S=0;S<h.symbolInstances.length;S++){const C=h.symbolInstances.get(S);C.crossTileID||(C.crossTileID=m.generate(),v[C.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ca(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const m of h.getCrossTileIDsLists())for(const v of m)delete this.usedCrossTileIDs[r][v]}removeStaleBuckets(r){let h=!1;for(const m in this.indexes){const v=this.indexes[m];for(const S in v)r[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[S]),delete v[S],h=!0)}return h}}class sr{constructor(){this.layerIndexes={},this.crossTileIDs=new Of,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,m){let v=this.layerIndexes[r.id];v===void 0&&(v=this.layerIndexes[r.id]=new _u);let S=!1;const C={};v.handleWrapJump(m);for(const R of h){const k=R.getBucket(r);k&&r.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(R.tileID,k,this.crossTileIDs)&&(S=!0),C[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(r){const h={};r.forEach((m=>{h[m]=!0}));for(const m in this.layerIndexes)h[m]||delete this.layerIndexes[m]}}var Zn="void main() {fragColor=vec4(1.0);}";const vn={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ri("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ri("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri(Zn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ri(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ri(Zn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ri(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ri(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ri(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ri("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ri(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(w,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=r.match(/in ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=S?S.concat(v):v,R={};return{fragmentSource:w=w.replace(h,((k,N,U,H,$)=>(R[$]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${U} ${H} ${$};
#else
uniform ${U} ${H} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${U} ${H} ${$} = u_${$};
#endif
`))),vertexSource:r=r.replace(h,((k,N,U,H,$)=>{const Y=H==="float"?"vec2":"vec4",te=$.match(/color/)?"color":Y;return R[$]?N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Y} a_${$};
out ${U} ${H} ${$};
#else
uniform ${U} ${H} u_${$};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${U} ${H} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${te}(a_${$}, u_${$}_t);
#else
    ${U} ${H} ${$} = u_${$};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${U} ${Y} a_${$};
#else
uniform ${U} ${H} u_${$};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${H} ${$} = a_${$};
#else
    ${U} ${H} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${U} ${H} ${$} = unpack_mix_${te}(a_${$}, u_${$}_t);
#else
    ${U} ${H} ${$} = u_${$};
#endif
`})),staticAttributes:m,staticUniforms:C}}class Ji{constructor(r,h,m){this.vertexBuffer=r,this.indexBuffer=h,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Fs=o.aU([{name:"a_pos",type:"Int16",components:2}]);const Bn="#define PROJECTION_MERCATOR",Ur="mercator";class ar{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ur}get shaderDefine(){return Bn}get shaderPreludeCode(){return vn.projectionMercator}get vertexShaderPreludeCode(){return vn.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(r){}getMeshFromTileID(r,h,m,v,S){if(this._cachedMesh)return this._cachedMesh;const C=new o.aW;C.emplaceBack(0,0),C.emplaceBack(o.a5,0),C.emplaceBack(0,o.a5),C.emplaceBack(o.a5,o.a5);const R=r.createVertexBuffer(C,Fs.members),k=o.aX.simpleSegment(0,0,4,2),N=new o.aY;N.emplaceBack(1,0,2),N.emplaceBack(1,2,3);const U=r.createIndexBuffer(N);return this._cachedMesh=new Ji(R,U,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(r){}}class _s{constructor(r=0,h=0,m=0,v=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=m,this.right=v}interpolate(r,h,m){return h.top!=null&&r.top!=null&&(this.top=o.G.number(r.top,h.top,m)),h.bottom!=null&&r.bottom!=null&&(this.bottom=o.G.number(r.bottom,h.bottom,m)),h.left!=null&&r.left!=null&&(this.left=o.G.number(r.left,h.left,m)),h.right!=null&&r.right!=null&&(this.right=o.G.number(r.right,h.right,m)),this}getCenter(r,h){const m=o.an((this.left+r-this.right)/2,0,r),v=o.an((this.top+h-this.bottom)/2,0,h);return new o.P(m,v)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new _s(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Oa(w,r){if(!w.renderWorldCopies||w.lngRange)return;const h=r.lng-w.center.lng;r.lng+=h>180?-360:h<-180?360:0}function bn(w){return Math.max(0,Math.floor(w))}class No{constructor(r,h){var m;this.applyConstrain=(v,S)=>this._constrainOverride!==null?this._constrainOverride(v,S):this._callbacks.defaultConstrain(v,S),this._callbacks=r,this._tileSize=512,this._renderWorldCopies=h?.renderWorldCopies===void 0||!!h?.renderWorldCopies,this._minZoom=h?.minZoom||0,this._maxZoom=h?.maxZoom||22,this._minPitch=h?.minPitch==null?0:h?.minPitch,this._maxPitch=h?.maxPitch==null?60:h?.maxPitch,this._constrainOverride=(m=h?.constrainOverride)!==null&&m!==void 0?m:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=bn(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new _s,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(r,h,m){this._constrainOverride=r.constrainOverride,this._latRange=r.latRange,this._lngRange=r.lngRange,this._width=r.width,this._height=r.height,this._center=r.center,this._elevation=r.elevation,this._minElevationForCurrentTile=r.minElevationForCurrentTile,this._zoom=r.zoom,this._tileZoom=bn(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=r.bearingInRadians,this._fovInRadians=r.fovInRadians,this._pitchInRadians=r.pitchInRadians,this._rollInRadians=r.rollInRadians,this._unmodified=r.unmodified,this._edgeInsets=new _s(r.padding.top,r.padding.bottom,r.padding.left,r.padding.right),this._minZoom=r.minZoom,this._maxZoom=r.maxZoom,this._minPitch=r.minPitch,this._maxPitch=r.maxPitch,this._renderWorldCopies=r.renderWorldCopies,this._cameraToCenterDistance=r.cameraToCenterDistance,this._nearZ=r.nearZ,this._farZ=r.farZ,this._autoCalculateNearFarZ=!m&&r.autoCalculateNearFarZ,h&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(r){this._minElevationForCurrentTile=r}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(r){this._minZoom!==r&&(this._minZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(r){this._minPitch!==r&&(this._minPitch=r,this.setPitch(Math.max(this.pitch,r)))}get maxPitch(){return this._maxPitch}setMaxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.setPitch(Math.min(this.pitch,r)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get constrainOverride(){return this._constrainOverride}setConstrainOverride(r){r===void 0&&(r=null),this._constrainOverride!==r&&(this._constrainOverride=r,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(r){const h=o.W(r,-180,180)*Math.PI/180;var m,v,S,C,R,k,N,U,H;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=M(),m=this._rotationMatrix,S=-this._bearingInRadians,C=(v=this._rotationMatrix)[0],R=v[1],k=v[2],N=v[3],U=Math.sin(S),H=Math.cos(S),m[0]=C*H+k*U,m[1]=R*H+N*U,m[2]=C*-U+k*H,m[3]=R*-U+N*H)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(r){const h=o.an(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(r){const h=r/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aZ(this._fovInRadians)}setFov(r){r=o.an(r,.1,150),this.fov!==r&&(this._unmodified=!1,this._fovInRadians=o.ap(r),this._calcMatrices())}get zoom(){return this._zoom}setZoom(r){const h=this.applyConstrain(this._center,r).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=o.aq(h),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(r){r!==this._elevation&&(this._elevation=r,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(r,h){this._autoCalculateNearFarZ=!1,this._nearZ=r,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,m){this._unmodified=!1,this._edgeInsets.interpolate(r,h,m),this.constrainInternal(),this._calcMatrices()}resize(r,h,m=!0){this._width=r,this._height=h,m&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new mn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(r){r?(this._lngRange=[r.getWest(),r.getEast()],this._latRange=[r.getSouth(),r.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(r,h){if(h.length===1)return[h[0],r];{const{minX:m,minY:v,maxX:S,maxY:C}=o.aa.fromPoints(h).extend(r);return[new o.P(m,v),new o.P(S,v),new o.P(S,C),new o.P(m,C),new o.P(m,v)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:m}=this.applyConstrain(this.center,this.zoom);this.setCenter(h),this.setZoom(m),this._unmodified=r,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let r=o.ar(new Float64Array(16));o.Q(r,r,[this._width/2,-this._height/2,1]),o.O(r,r,[1,-1,0]),this._clipSpaceToPixelsMatrix=r,r=o.ar(new Float64Array(16)),o.Q(r,r,[1,-1,1]),o.O(r,r,[-1,-1,0]),o.Q(r,r,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=r,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(r,h,m,v){const S=m!==void 0?m:this.bearing,C=v=v!==void 0?v:this.pitch,{distanceToCenter:R,clampedElevation:k}=this._distanceToCenterFromAltElevationPitch(h,this.elevation,C),{x:N,y:U}=Wt(C,S),H=o.a9.fromLngLat(r,h);let $,Y,te=o.a_(1,H.y),ce=0;do{if(ce+=1,ce>10)break;Y=R/te,$=new o.a9(H.x+N*Y,H.y+U*Y),te=1/$.meterInMercatorCoordinateUnits()}while(Math.abs(R-Y*te)>1e-12);return{center:$.toLngLat(),elevation:k,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/Y/this.tileSize)}}recalculateZoomAndCenter(r){if(this.elevation-r==0)return;const h=1/this.worldSize,m=o.as(1,this.center.lat)*this.worldSize,v=o.a9.fromLngLat(this.center,this.elevation),S=v.x/h,C=v.y/h,R=v.z/h,k=this.pitch,N=this.bearing,{x:U,y:H,z:$}=Wt(k,N),Y=this.cameraToCenterDistance,te=S+Y*-U,ce=C+Y*-H,de=R+Y*$,{distanceToCenter:fe,clampedElevation:ye}=this._distanceToCenterFromAltElevationPitch(de/m,r,k),Ee=fe*m,me=new o.a9((te+U*Ee)*h,(ce+H*Ee)*h,0).toLngLat(),Ae=o.as(1,me.lat),Pe=o.at(this.height/2/Math.tan(this.fovInRadians/2)/fe/Ae/this.tileSize);this._elevation=ye,this._center=me,this.setZoom(Pe)}_distanceToCenterFromAltElevationPitch(r,h,m){const v=-Math.cos(o.ap(m)),S=r-h;let C,R=h;return v*S>=0||Math.abs(v)<.1?(C=1e4,R=r+C*v):C=-S/v,{distanceToCenter:C,clampedElevation:R}}getCameraPoint(){const r=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(r*Math.sin(this.rollInRadians),r*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const r=o.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/r).toLngLat()}getMercatorTileCoordinates(r){if(!r)return[0,0,1,1];const h=r.canonical.z>=0?1<<r.canonical.z:Math.pow(2,r.canonical.z);return[r.canonical.x/h,r.canonical.y/h,1/h/o.a5,1/h/o.a5]}}class ys{constructor(r,h){this.min=r,this.max=h,this.center=o.a$([],o.b0([],this.min,this.max),.5)}quadrant(r){const h=[r%2==0,r<2],m=o.b1(this.min),v=o.b1(this.max);for(let S=0;S<h.length;S++)m[S]=h[S]?this.min[S]:this.center[S],v[S]=h[S]?this.center[S]:this.max[S];return v[2]=this.max[2],new ys(m,v)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersectsFrustum(r){let h=!0;for(let m=0;m<r.planes.length;m++){const v=this.intersectsPlane(r.planes[m]);if(v===0)return 0;v===1&&(h=!1)}return h?2:r.aabb.min[0]>this.max[0]||r.aabb.min[1]>this.max[1]||r.aabb.min[2]>this.max[2]||r.aabb.max[0]<this.min[0]||r.aabb.max[1]<this.min[1]||r.aabb.max[2]<this.min[2]?0:1}intersectsPlane(r){let h=r[3],m=r[3];for(let v=0;v<3;v++)r[v]>0?(h+=r[v]*this.min[v],m+=r[v]*this.max[v]):(m+=r[v]*this.min[v],h+=r[v]*this.max[v]);return h>=0?2:m<0?0:1}}class Sl{distanceToTile2d(r,h,m,v){const S=v.distanceX([r,h]),C=v.distanceY([r,h]);return Math.hypot(S,C)}getWrap(r,h,m){return m}getTileBoundingVolume(r,h,m,v){var S,C;let R=0,k=0;if(v?.terrain){const U=new o.a2(r.z,h,r.z,r.x,r.y),H=v.terrain.getMinMaxElevation(U);R=(S=H.minElevation)!==null&&S!==void 0?S:Math.min(0,m),k=(C=H.maxElevation)!==null&&C!==void 0?C:Math.max(0,m)}const N=1<<r.z;return new ys([h+r.x/N,r.y/N,R],[h+(r.x+1)/N,(r.y+1)/N,k])}allowVariableZoom(r,h){const m=r.fov*(Math.abs(Math.cos(r.rollInRadians))*r.height+Math.abs(Math.sin(r.rollInRadians))*r.width)/r.height,v=o.an(78.5-m/2,0,60);return!!h.terrain||r.pitch>v}allowWorldCopies(){return!0}prepareNextFrame(){}}class Vr{constructor(r,h,m){this.points=r,this.planes=h,this.aabb=m}static fromInvProjectionMatrix(r,h=1,m=0,v,S){const C=S?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,m),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(($=>(function(Y,te,ce,de){const fe=o.aH([],Y,te),ye=1/fe[3]/ce*de;return o.b6(fe,fe,[ye,ye,1/fe[3],ye])})($,r,h,R)));v&&(function($,Y,te,ce){const de=ce?4:0,fe=ce?0:4;let ye=0;const Ee=[],me=[];for(let we=0;we<4;we++){const ke=o.b2([],$[we+fe],$[we+de]),et=o.b7(ke);o.a$(ke,ke,1/et),Ee.push(et),me.push(ke)}for(let we=0;we<4;we++){const ke=o.b8($[we+de],me[we],te);ye=ke!==null&&ke>=0?Math.max(ye,ke):Math.max(ye,Ee[we])}const Ae=(function(we,ke){const et=o.b2([],we[ke[0]],we[ke[1]]),Ze=o.b2([],we[ke[2]],we[ke[1]]),Ke=[0,0,0,0];return o.b3(Ke,o.b4([],et,Ze)),Ke[3]=-o.b5(Ke,we[ke[0]]),Ke})($,Y),Pe=(function(we,ke){const et=o.b9(we),Ze=o.ba([],we,1/et),Ke=o.b2([],ke,o.a$([],Ze,o.b5(ke,Ze))),Qe=o.b9(Ke);if(Qe>0){const Rt=Math.sqrt(1-Ze[3]*Ze[3]),Ot=o.a$([],Ze,-Ze[3]),_t=o.b0([],Ot,o.a$([],Ke,Rt/Qe));return o.bb(ke,_t)}return null})(te,Ae);if(Pe!==null){const we=Pe/o.b5(me[0],Ae);ye=Math.min(ye,we)}for(let we=0;we<4;we++){const ke=Math.min(ye,Ee[we]);$[we+fe]=[$[we+de][0]+me[we][0]*ke,$[we+de][1]+me[we][1]*ke,$[we+de][2]+me[we][2]*ke,1]}})(k,C[0],v,S);const N=C.map(($=>{const Y=o.b2([],k[$[0]],k[$[1]]),te=o.b2([],k[$[2]],k[$[1]]),ce=o.b3([],o.b4([],Y,te)),de=-o.b5(ce,k[$[1]]);return ce.concat(de)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],H=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const $ of k)for(let Y=0;Y<3;Y++)U[Y]=Math.min(U[Y],$[Y]),H[Y]=Math.max(H[Y],$[Y]);return new Vr(k,N,new ys(U,H))}}class er{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h,m=!0){this._helper.resize(r,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r,h){}constructor(r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(h,m)=>{m=o.an(+m,this.minZoom,this.maxZoom);const v={center:new o.V(h.lng,h.lat),zoom:m};let S=this._helper._lngRange;if(!this._helper._renderWorldCopies&&S===null){const me=179.9999999999;S=[-me,me]}const C=this.tileSize*o.aq(v.zoom);let R=0,k=C,N=0,U=C,H=0,$=0;const{x:Y,y:te}=this.size;if(this._helper._latRange){const me=this._helper._latRange;R=o.X(me[1])*C,k=o.X(me[0])*C,k-R<te&&(H=te/(k-R))}S&&(N=o.W(o.Y(S[0])*C,0,C),U=o.W(o.Y(S[1])*C,0,C),U<N&&(U+=C),U-N<Y&&($=Y/(U-N)));const{x:ce,y:de}=Fe(C,h);let fe,ye;const Ee=Math.max($||0,H||0);if(Ee){const me=new o.P($?(U+N)/2:ce,H?(k+R)/2:de);return v.center=qe(C,me).wrap(),v.zoom+=o.at(Ee),v}if(this._helper._latRange){const me=te/2;de-me<R&&(ye=R+me),de+me>k&&(ye=k-me)}if(S){const me=(N+U)/2;let Ae=ce;this._helper._renderWorldCopies&&(Ae=o.W(ce,me-C/2,me+C/2));const Pe=Y/2;Ae-Pe<N&&(fe=N+Pe),Ae+Pe>U&&(fe=U-Pe)}if(fe!==void 0||ye!==void 0){const me=new o.P(fe??ce,ye??de);v.center=qe(C,me).wrap()}return v},this.applyConstrain=(h,m)=>this._helper.applyConstrain(h,m),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,m)=>this.defaultConstrain(h,m)},r),this._coveringTilesDetailsProvider=new Sl}clone(){const r=new er;return r.apply(this,!1),r}apply(r,h,m){this._helper.apply(r,h,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(r){const h=[new o.bc(0,r)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new o.P(0,0)),v=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),R=Math.floor(Math.min(m.x,v.x,S.x,C.x)),k=Math.floor(Math.max(m.x,v.x,S.x,C.x)),N=1;for(let U=R-N;U<=k+N;U++)U!==0&&h.push(new o.bc(U,r))}return h}getCameraFrustum(){return Vr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){const h=this.screenPointToLocation(this.centerPoint,r),m=r?r.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(r,h){const m=o.as(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(h,m),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),C=o.a9.fromLngLat(r),R=new o.a9(C.x-(v.x-S.x),C.y-(v.y-S.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(r,h){return h?this.coordinatePoint(o.a9.fromLngLat(r),h.getElevationForLngLat(r,this),this._pixelMatrix3D):this.coordinatePoint(o.a9.fromLngLat(r))}screenPointToLocation(r,h){var m;return(m=this.screenPointToMercatorCoordinate(r,h))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(r,h){if(h){const m=h.pointCoordinate(r);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(r)}screenPointToMercatorCoordinateAtZ(r,h){const m=h||0,v=[r.x,r.y,0,1],S=[r.x,r.y,1,1];o.aH(v,v,this._pixelMatrixInverse),o.aH(S,S,this._pixelMatrixInverse);const C=v[3],R=S[3],k=v[1]/C,N=S[1]/R,U=v[2]/C,H=S[2]/R,$=U===H?0:(m-U)/(H-U);return new o.a9(o.G.number(v[0]/C,S[0]/R,$)/this.worldSize,o.G.number(k,N,$)/this.worldSize,m)}coordinatePoint(r,h=0,m=this._pixelMatrix){const v=[r.x*this.worldSize,r.y*this.worldSize,h,1];return o.aH(v,v,m),new o.P(v[0]/v[3],v[1]/v[3])}getBounds(){const r=Math.max(0,this._helper._height/2-yt(this));return new mn().extend(this.screenPointToLocation(new o.P(0,r))).extend(this.screenPointToLocation(new o.P(this._helper._width,r))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(r,h){return h?h.pointCoordinate(r)!=null:r.y>this.height/2-yt(this)}calculatePosMatrix(r,h=!1,m){var v;const S=(v=r.key)!==null&&v!==void 0?v:o.bd(r.wrap,r.canonical.z,r.canonical.z,r.canonical.x,r.canonical.y),C=h?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(S)){const N=C.get(S);return m?N.f32:N.f64}const R=ut(r,this.worldSize);o.S(R,h?this._alignedProjMatrix:this._viewProjMatrix,R);const k={f64:R,f32:new Float32Array(R)};return C.set(S,k),m?k.f32:k.f64}calculateFogMatrix(r){const h=r.key,m=this._fogMatrixCacheF32;if(m.has(h))return m.get(h);const v=ut(r,this.worldSize);return o.S(v,this._fogMatrix,v),m.set(h,new Float32Array(v)),m.get(h)}calculateCenterFromCameraLngLatAlt(r,h,m,v){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,v)}_calculateNearFarZIfNeeded(r,h,m){if(!this._helper.autoCalculateNearFarZ)return;const v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=r-v*this._helper._pixelPerMeter/Math.cos(h),C=v<0?S:r,R=Math.PI/2+this.pitchInRadians,k=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+m.y/this.height),N=Math.sin(k)*C/Math.sin(o.an(Math.PI-R-k,.01,Math.PI-.01)),U=yt(this),H=Math.atan(U/this._helper.cameraToCenterDistance),$=o.ap(.75),Y=H>$?2*H*(.5+m.y/(2*U)):$,te=Math.sin(Y)*C/Math.sin(o.an(Math.PI-R-Y,.01,Math.PI-.01)),ce=Math.min(N,te);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*ce+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const r=this.centerOffset,h=Fe(this.worldSize,this.center),m=h.x,v=h.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;const S=o.ap(Math.min(this.pitch,We)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S));let R;this._calculateNearFarZIfNeeded(C,S,r),R=new Float64Array(16),o.be(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aB(this._invProjMatrix,R),R[8]=2*-r.x/this._helper._width,R[9]=2*r.y/this._helper._height,this._projectionMatrix=o.bf(R),o.Q(R,R,[1,-1,1]),o.O(R,R,[0,0,-this._helper.cameraToCenterDistance]),o.bg(R,R,-this.rollInRadians),o.bh(R,R,this.pitchInRadians),o.bg(R,R,-this.bearingInRadians),o.O(R,R,[-m,-v,0]),this._mercatorMatrix=o.Q([],R,[this.worldSize,this.worldSize,this.worldSize]),o.Q(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),o.O(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=o.aB([],R);const k=[0,0,-1,1];o.aH(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),o.be(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-r.x/this.width,this._fogMatrix[9]=2*r.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-m,-v,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const N=this._helper._width%2/2,U=this._helper._height%2/2,H=Math.cos(this.bearingInRadians),$=Math.sin(-this.bearingInRadians),Y=m-Math.round(m)+H*N+$*U,te=v-Math.round(v)+H*U+$*N,ce=new Float64Array(R);if(o.O(ce,ce,[Y>.5?Y-1:Y,te>.5?te-1:te,0]),this._alignedProjMatrix=ce,R=o.aB(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const r=this.screenPointToMercatorCoordinate(new o.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return o.aH(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const r=o.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/r).toLngLat()}lngLatToCameraDepth(r,h){const m=o.a9.fromLngLat(r),v=[m.x*this.worldSize,m.y*this.worldSize,h,1];return o.aH(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(r){const{overscaledTileID:h,aligned:m,applyTerrainMatrix:v}=r,S=this._helper.getMercatorTileCoordinates(h),C=h?this.calculatePosMatrix(h,m,!0):null;let R;return R=h&&h.terrainRttPosMatrix32f&&v?h.terrainRttPosMatrix32f:C||o.bi(),{mainMatrix:R,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(r){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(r,h,m){return 1}transformLightDirection(r){return o.b1(r)}getRayDirectionFromPixel(r){throw new Error("Not implemented.")}projectTileCoordinates(r,h,m,v){const S=this.calculatePosMatrix(m);let C;v?(C=[r,h,v(r,h),1],o.aH(C,C,S)):(C=[r,h,0,1],zs(C,C,S));const R=C[3];return{point:new o.P(C[0]/R,C[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(r){for(const h of r)this.calculatePosMatrix(h)}getMatrixForModel(r,h){const m=o.a9.fromLngLat(r,h),v=m.meterInMercatorCoordinateUnits(),S=o.bj();return o.O(S,S,[m.x,m.y,m.z]),o.bg(S,S,Math.PI),o.bh(S,S,Math.PI/2),o.Q(S,S,[-v,v,v]),S}getProjectionDataForCustomLayer(r=!0){const h=new o.a2(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:r}),v=ut(h,this.worldSize);o.S(v,this._viewProjMatrix,v),m.tileMercatorCoords=[0,0,1,1];const S=[o.a5,o.a5,this.worldSize/this._helper.pixelsPerMeter],C=o.bk();return o.Q(C,v,S),m.fallbackMatrix=C,m.mainMatrix=C,m}getFastPathSimpleProjectionMatrix(r){return this.calculatePosMatrix(r)}}function jr(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function yu(w){if(w.useSlerp)if(w.k<1){const r=o.bl(w.startEulerAngles.roll,w.startEulerAngles.pitch,w.startEulerAngles.bearing),h=o.bl(w.endEulerAngles.roll,w.endEulerAngles.pitch,w.endEulerAngles.bearing),m=new Float64Array(4);o.bm(m,r,h,w.k);const v=o.bn(m);w.tr.setRoll(v.roll),w.tr.setPitch(v.pitch),w.tr.setBearing(v.bearing)}else w.tr.setRoll(w.endEulerAngles.roll),w.tr.setPitch(w.endEulerAngles.pitch),w.tr.setBearing(w.endEulerAngles.bearing);else w.tr.setRoll(o.G.number(w.startEulerAngles.roll,w.endEulerAngles.roll,w.k)),w.tr.setPitch(o.G.number(w.startEulerAngles.pitch,w.endEulerAngles.pitch,w.k)),w.tr.setBearing(o.G.number(w.startEulerAngles.bearing,w.endEulerAngles.bearing,w.k))}function Al(w,r,h,m,v){const S=v.padding,C=Fe(v.worldSize,h.getNorthWest()),R=Fe(v.worldSize,h.getNorthEast()),k=Fe(v.worldSize,h.getSouthEast()),N=Fe(v.worldSize,h.getSouthWest()),U=o.ap(-m),H=C.rotate(U),$=R.rotate(U),Y=k.rotate(U),te=N.rotate(U),ce=new o.P(Math.max(H.x,$.x,te.x,Y.x),Math.max(H.y,$.y,te.y,Y.y)),de=new o.P(Math.min(H.x,$.x,te.x,Y.x),Math.min(H.y,$.y,te.y,Y.y)),fe=ce.sub(de),ye=(v.width-(S.left+S.right+r.left+r.right))/fe.x,Ee=(v.height-(S.top+S.bottom+r.top+r.bottom))/fe.y;if(Ee<0||ye<0)return void jr();const me=Math.min(o.at(v.scale*Math.min(ye,Ee)),w.maxZoom),Ae=o.P.convert(w.offset),Pe=new o.P((r.left-r.right)/2,(r.top-r.bottom)/2).rotate(o.ap(m)),we=Ae.add(Pe).mult(v.scale/o.aq(me));return{center:qe(v.worldSize,C.add(k).div(2).sub(we)),zoom:me,bearing:m}}class El{get useGlobeControls(){return!1}handlePanInertia(r,h){const m=r.mag(),v=Math.abs(yt(h));return{easingOffset:r.mult(Math.min(.75*v/m,1)),easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(r,h){r.bearingDelta&&h.setBearing(h.bearing+r.bearingDelta),r.pitchDelta&&h.setPitch(h.pitch+r.pitchDelta),r.rollDelta&&h.setRoll(h.roll+r.rollDelta),r.zoomDelta&&h.setZoom(h.zoom+r.zoomDelta)}handleMapControlsPan(r,h,m){r.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(m,r.around)}cameraForBoxAndBearing(r,h,m,v,S){return Al(r,h,m,v,S)}handleJumpToCenterZoom(r,h){r.zoom!==(h.zoom!==void 0?+h.zoom:r.zoom)&&r.setZoom(+h.zoom),h.center!==void 0&&r.setCenter(o.V.convert(h.center))}handleEaseTo(r,h){const m=r.zoom,v=r.padding,S={roll:r.roll,pitch:r.pitch,bearing:r.bearing},C={roll:h.roll===void 0?r.roll:h.roll,pitch:h.pitch===void 0?r.pitch:h.pitch,bearing:h.bearing===void 0?r.bearing:h.bearing},R=h.zoom!==void 0,k=!r.isPaddingEqual(h.padding);let N=!1;const U=R?+h.zoom:r.zoom;let H=r.centerPoint.add(h.offsetAsPoint);const $=r.screenPointToLocation(H),{center:Y,zoom:te}=r.applyConstrain(o.V.convert(h.center||$),U??m);Oa(r,Y);const ce=Fe(r.worldSize,$),de=Fe(r.worldSize,Y).sub(ce),fe=o.aq(te-m);return N=te!==m,{easeFunc:ye=>{if(N&&r.setZoom(o.G.number(m,te,ye)),o.bo(S,C)||yu({startEulerAngles:S,endEulerAngles:C,tr:r,k:ye,useSlerp:S.roll!=C.roll}),k&&(r.interpolatePadding(v,h.padding,ye),H=r.centerPoint.add(h.offsetAsPoint)),h.around)r.setLocationAtPoint(h.around,h.aroundPoint);else{const Ee=o.aq(r.zoom-m),me=te>m?Math.min(2,fe):Math.max(.5,fe),Ae=Math.pow(me,1-ye),Pe=qe(r.worldSize,ce.add(de.mult(ye*Ae)).mult(Ee));r.setLocationAtPoint(r.renderWorldCopies?Pe.wrap():Pe,H)}},isZooming:N,elevationCenter:Y}}handleFlyTo(r,h){const m=h.zoom!==void 0,v=r.zoom,S=r.applyConstrain(o.V.convert(h.center||h.locationAtOffset),m?+h.zoom:v),C=S.center,R=S.zoom;Oa(r,C);const k=Fe(r.worldSize,h.locationAtOffset),N=Fe(r.worldSize,C).sub(k),U=N.mag(),H=o.aq(R-v);let $;if(h.minZoom!==void 0){const Y=Math.min(+h.minZoom,v,R),te=r.applyConstrain(C,Y).zoom;$=o.aq(te-v)}return{easeFunc:(Y,te,ce,de)=>{r.setZoom(Y===1?R:v+o.at(te));const fe=Y===1?C:qe(r.worldSize,k.add(N.mult(ce)).mult(te));r.setLocationAtPoint(r.renderWorldCopies?fe.wrap():fe,de)},scaleOfZoom:H,targetCenter:C,scaleOfMinZoom:$,pixelPathLength:U}}}class Gi{constructor(r,h,m){this.blendFunction=r,this.blendColor=h,this.mask=m}}Gi.Replace=[1,0],Gi.disabled=new Gi(Gi.Replace,o.bp.transparent,[!1,!1,!1,!1]),Gi.unblended=new Gi(Gi.Replace,o.bp.transparent,[!0,!0,!0,!0]),Gi.alphaBlended=new Gi([1,771],o.bp.transparent,[!0,!0,!0,!0]);const Uo=2305;class Ai{constructor(r,h,m){this.enable=r,this.mode=h,this.frontFace=m}}Ai.disabled=new Ai(!1,1029,Uo),Ai.backCCW=new Ai(!0,1029,Uo),Ai.frontCCW=new Ai(!0,1028,Uo);class di{constructor(r,h,m){this.func=r,this.mask=h,this.range=m}}di.ReadOnly=!1,di.ReadWrite=!0,di.disabled=new di(519,di.ReadOnly,[0,1]);const Cl=7680;class Ri{constructor(r,h,m,v,S,C){this.test=r,this.ref=h,this.mask=m,this.fail=v,this.depthFail=S,this.pass=C}}Ri.disabled=new Ri({func:519,mask:0},0,0,Cl,Cl,Cl);const vu=new WeakMap;function Ns(w){var r;if(vu.has(w))return vu.get(w);{const h=(r=w.getParameter(w.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return vu.set(w,h),h}}class Vo{get awaitingQuery(){return!!this._readbackQueue}constructor(r){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=r;const h=r.context,m=h.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const v=new o.aW;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);const S=new o.aY;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Ji(h.createVertexBuffer(v,Fs.members),h.createIndexBuffer(S),o.aX.simpleSegment(0,0,v.length,S.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(m.TEXTURE1);const C=m.createTexture();m.bindTexture(m.TEXTURE_2D,C),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Ns(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const r=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),r.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(r,h){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(r,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const r=this._cachedRenderContext.context,h=r.gl;r.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),r.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(r,h){const m=this._cachedRenderContext.context,v=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:o.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,v.TRIANGLES,di.disabled,Ri.disabled,Gi.unblended,Ai.disabled,((S,C)=>({u_input:S,u_output_expected:C}))(r,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ns(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);const S=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const r=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ns(r)){const h=r.clientWaitSync(this._readbackQueue.sync,0,0);if(h===r.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===r.TIMEOUT_EXPIRED)return;r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Vo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(r){let h=0;return h+=r[0]/256,h+=r[1]/65536,h+=r[2]/16777216,r[3]<127&&(h=-h),h/128}}const jo=o.a5/128;function cp(w,r){const h=w.granularity!==void 0?Math.max(w.granularity,1):1,m=h+(w.generateBorders?2:0),v=h+(w.extendToNorthPole||w.generateBorders?1:0)+(w.extendToSouthPole||w.generateBorders?1:0),S=m+1,C=v+1,R=w.generateBorders?-1:0,k=w.generateBorders||w.extendToNorthPole?-1:0,N=h+(w.generateBorders?1:0),U=h+(w.generateBorders||w.extendToSouthPole?1:0),H=S*C,$=m*v*6,Y=S*C>65536;if(Y&&r==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const te=Y||r==="32bit",ce=new Int16Array(2*H);let de=0;for(let Ee=k;Ee<=U;Ee++)for(let me=R;me<=N;me++){let Ae=me/h*o.a5;me===-1&&(Ae=-jo),me===h+1&&(Ae=o.a5+jo);let Pe=Ee/h*o.a5;Ee===-1&&(Pe=w.extendToNorthPole?o.br:-jo),Ee===h+1&&(Pe=w.extendToSouthPole?o.bs:o.a5+jo),ce[de++]=Ae,ce[de++]=Pe}const fe=te?new Uint32Array($):new Uint16Array($);let ye=0;for(let Ee=0;Ee<v;Ee++)for(let me=0;me<m;me++){const Ae=me+1+Ee*S,Pe=me+(Ee+1)*S,we=me+1+(Ee+1)*S;fe[ye++]=me+Ee*S,fe[ye++]=Pe,fe[ye++]=Ae,fe[ye++]=Ae,fe[ye++]=Pe,fe[ye++]=we}return{vertices:ce.buffer.slice(0),indices:fe.buffer.slice(0),uses32bitIndices:te}}const bu=new o.aV({fill:new o.bt(128,2),line:new o.bt(512,0),tile:new o.bt(128,32),stencil:new o.bt(128,1),circle:3});class kf{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return vn.projectionGlobe}get vertexShaderPreludeCode(){return vn.projectionMercator.vertexSource}get subdivisionGranularity(){return bu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(r){this._errorMeasurement||(this._errorMeasurement=new Vo(r));const h=o.X(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(h,m),S=le();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=S);const C=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bv(C))}_getMeshKey(r){return`${r.granularity.toString(36)}_${r.generateBorders?"b":""}${r.extendToNorthPole?"n":""}${r.extendToSouthPole?"s":""}`}getMeshFromTileID(r,h,m,v,S){const C=(S==="stencil"?bu.stencil:bu.tile).getGranularityForZoomLevel(h.z);return this._getMesh(r,{granularity:C,generateBorders:m,extendToNorthPole:h.y===0&&v,extendToSouthPole:h.y===(1<<h.z)-1&&v})}_getMesh(r,h){const m=this._getMeshKey(h);if(m in this._tileMeshCache)return this._tileMeshCache[m];const v=(function(S,C){const R=cp(C,"16bit"),k=o.aW.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),N=o.aY.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Ji(S.createVertexBuffer(k,Fs.members),S.createIndexBuffer(N),o.aX.simpleSegment(0,0,k.length,N.length))})(r,h);return this._tileMeshCache[m]=v,v}recalculate(r){}hasTransition(){const r=le();let h=!1;return h=h||(r-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(r){this._errorQueryLatitudeDegrees=r}}const sm=new o.t({type:new o.D(o.u.projection.type)});class Lf extends o.E{constructor(r){super(),this._transitionable=new o.x(sm,void 0),this.setProjection(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new ar,this._verticalPerspectiveProjection=new kf}get transitionState(){const r=this.properties.get("type");if(typeof r=="string"&&r==="mercator")return 0;if(typeof r=="string"&&r==="vertical-perspective")return 1;if(r instanceof o.bw){if(r.from==="vertical-perspective"&&r.to==="mercator")return 1-r.transition;if(r.from==="mercator"&&r.to==="vertical-perspective")return r.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(r){this._mercatorProjection.updateGPUdependent(r),this._verticalPerspectiveProjection.updateGPUdependent(r)}getMeshFromTileID(r,h,m,v,S){return this.currentProjection.getMeshFromTileID(r,h,m,v,S)}setProjection(r){this._transitionable.setValue("type",r?.type||"mercator")}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}setErrorQueryLatitudeDegrees(r){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(r),this._mercatorProjection.setErrorQueryLatitudeDegrees(r)}}function $r(w){const r=Ml(w.worldSize,w.center.lat);return 2*Math.PI*r}function ka(w,r,h,m,v){const S=1/(1<<v),C=r/o.a5*S+m*S,R=o.bz((w/o.a5*S+h*S)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,N=Math.cos(k),U=new Float64Array(3);return U[0]=Math.sin(R)*N,U[1]=Math.sin(k),U[2]=Math.cos(R)*N,U}function xn(w){return(function(r,h){const m=Math.cos(h),v=new Float64Array(3);return v[0]=Math.sin(r)*m,v[1]=Math.sin(h),v[2]=Math.cos(r)*m,v})(w.lng*Math.PI/180,w.lat*Math.PI/180)}function Ml(w,r){return w/(2*Math.PI)/Math.cos(r*Math.PI/180)}function xu(w){const r=Math.asin(w[1])/Math.PI*180,h=Math.sqrt(w[0]*w[0]+w[2]*w[2]);if(h>1e-6){const m=w[0]/h,v=Math.acos(w[2]/h),S=(m>0?v:-v)/Math.PI*180;return new o.V(o.W(S,-180,180),r)}return new o.V(0,r)}function wu(w){return Math.cos(w*Math.PI/180)}function zn(w,r){const h=wu(w),m=wu(r);return o.at(m/h)}function up(w,r){const h=w.rotate(r.bearingInRadians),m=r.zoom+zn(r.center.lat,0),v=o.bu(1/wu(r.center.lat),1/wu(Math.min(Math.abs(r.center.lat),60)),o.bx(m,7,3,0,1)),S=360/$r({worldSize:r.worldSize,center:{lat:r.center.lat}});return new o.V(r.center.lng-h.x*S*v,o.an(r.center.lat+h.y*S,-o.ao,o.ao))}function Th(w){const r=.5*w,h=Math.sin(r),m=Math.cos(r);return Math.log(h+m)-Math.log(m-h)}function hp(w,r,h,m){const v=w.lat+h*m;if(Math.abs(h)>1){const S=(Math.sign(w.lat+h)!==Math.sign(w.lat)?-Math.abs(w.lat):Math.abs(w.lat))*Math.PI/180,C=Math.abs(w.lat+h)*Math.PI/180,R=Th(S+m*(C-S)),k=Th(S),N=Th(C);return new o.V(w.lng+r*((R-k)/(N-k)),v)}return new o.V(w.lng+r*m,v)}class am{constructor(r){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=r}swapBuffers(){if(!this._hadAnyChanges)return;const r=this._cachePrevious;this._cachePrevious=this._cache,this._cache=r,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(r,h,m,v){const S=`${r.z}_${r.x}_${r.y}_${v?.terrain?"t":""}`,C=this._cache.get(S);if(C)return C;const R=this._cachePrevious.get(S);if(R)return this._cache.set(S,R),R;const k=this._boundingVolumeFactory(r,h,m,v);return this._cache.set(S,k),this._hadAnyChanges=!0,k}}class Ac{constructor(r,h,m,v){this.min=m,this.max=v,this.points=r,this.planes=h}static fromAabb(r,h){const m=[];for(let v=0;v<8;v++)m.push([1&~v?r[0]:h[0],(v>>1&1)==1?h[1]:r[1],(v>>2&1)==1?h[2]:r[2]]);return new Ac(m,[[-1,0,0,h[0]],[1,0,0,-r[0]],[0,-1,0,h[1]],[0,1,0,-r[1]],[0,0,-1,h[2]],[0,0,1,-r[2]]],r,h)}static fromCenterSizeAngles(r,h,m){const v=o.bB([],m[0],m[1],m[2]),S=o.bC([],[h[0],0,0],v),C=o.bC([],[0,h[1],0],v),R=o.bC([],[0,0,h[2]],v),k=[...r],N=[...r];for(let H=0;H<8;H++)for(let $=0;$<3;$++){const Y=r[$]+S[$]*(1&~H?-1:1)+C[$]*((H>>1&1)==1?1:-1)+R[$]*((H>>2&1)==1?1:-1);k[$]=Math.min(k[$],Y),N[$]=Math.max(N[$],Y)}const U=[];for(let H=0;H<8;H++){const $=[...r];o.b0($,$,o.a$([],S,1&~H?-1:1)),o.b0($,$,o.a$([],C,(H>>1&1)==1?1:-1)),o.b0($,$,o.a$([],R,(H>>2&1)==1?1:-1)),U.push($)}return new Ac(U,[[...S,-o.b5(S,U[0])],[...C,-o.b5(C,U[0])],[...R,-o.b5(R,U[0])],[-S[0],-S[1],-S[2],-o.b5(S,U[7])],[-C[0],-C[1],-C[2],-o.b5(C,U[7])],[-R[0],-R[1],-R[2],-o.b5(R,U[7])]],k,N)}intersectsFrustum(r){let h=!0;const m=this.points.length,v=this.planes.length,S=r.planes.length,C=r.points.length;for(let R=0;R<S;R++){const k=r.planes[R];let N=0;for(let U=0;U<m;U++){const H=this.points[U];k[0]*H[0]+k[1]*H[1]+k[2]*H[2]+k[3]>=0&&N++}if(N===0)return 0;N<m&&(h=!1)}if(h)return 2;for(let R=0;R<v;R++){const k=this.planes[R];let N=0;for(let U=0;U<C;U++){const H=r.points[U];k[0]*H[0]+k[1]*H[1]+k[2]*H[2]+k[3]>=0&&N++}if(N===0)return 0}return 1}intersectsPlane(r){const h=this.points.length;let m=0;for(let v=0;v<h;v++){const S=this.points[v];r[0]*S[0]+r[1]*S[1]+r[2]*S[2]+r[3]>=0&&m++}return m===h?2:m===0?0:1}}function Sh(w,r,h){const m=w-r;return m<0?-m:Math.max(0,m-h)}function Ec(w,r,h,m,v){const S=w-h;let C;return C=S<0?Math.min(-S,1+S-v):S>1?Math.min(Math.max(S-v,0),1-S):0,Math.max(C,Sh(r,m,v))}class Bf{constructor(){this._boundingVolumeCache=new am(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(r,h,m,v){const S=1<<m.z,C=1/S,R=m.x/S,k=m.y/S;let N=2;return N=Math.min(N,Ec(r,h,R,k,C)),N=Math.min(N,Ec(r,h,R+.5,-k-C,C)),N=Math.min(N,Ec(r,h,R+.5,2-k-C,C)),N}getWrap(r,h,m){const v=1<<h.z,S=1/v,C=h.x/v,R=Sh(r.x,C,S),k=Sh(r.x,C-1,S),N=Sh(r.x,C+1,S),U=Math.min(R,k,N);return U===N?1:U===k?-1:0}allowVariableZoom(r,h){return oi(r,h)>4}allowWorldCopies(){return!1}getTileBoundingVolume(r,h,m,v){return this._boundingVolumeCache.getTileBoundingVolume(r,h,m,v)}_computeTileBoundingVolume(r,h,m,v){var S,C;let R=0,k=0;if(v?.terrain){const N=new o.a2(r.z,h,r.z,r.x,r.y),U=v.terrain.getMinMaxElevation(N);R=(S=U.minElevation)!==null&&S!==void 0?S:Math.min(0,m),k=(C=U.maxElevation)!==null&&C!==void 0?C:Math.max(0,m)}if(R/=o.bE,k/=o.bE,R+=1,k+=1,r.z<=0)return Ac.fromAabb([-k,-k,-k],[k,k,k]);if(r.z===1)return Ac.fromAabb([r.x===0?-k:0,r.y===0?0:-k,-k],[r.x===0?0:k,r.y===0?k:0,k]);{const N=[ka(0,0,r.x,r.y,r.z),ka(o.a5,0,r.x,r.y,r.z),ka(o.a5,o.a5,r.x,r.y,r.z),ka(0,o.a5,r.x,r.y,r.z)],U=[];for(const Ke of N)U.push(o.a$([],Ke,k));if(k!==R)for(const Ke of N)U.push(o.a$([],Ke,R));r.y===0&&U.push([0,1,0]),r.y===(1<<r.z)-1&&U.push([0,-1,0]);const H=[1,1,1],$=[-1,-1,-1];for(const Ke of U)for(let Qe=0;Qe<3;Qe++)H[Qe]=Math.min(H[Qe],Ke[Qe]),$[Qe]=Math.max($[Qe],Ke[Qe]);const Y=ka(o.a5/2,o.a5/2,r.x,r.y,r.z),te=o.b4([],[0,1,0],Y);o.b3(te,te);const ce=o.b4([],Y,te);o.b3(ce,ce);const de=o.b4([],N[2],N[1]);o.b3(de,de);const fe=o.b4([],N[0],N[3]);o.b3(fe,fe),U.push(o.a$([],Y,k)),r.y>=(1<<r.z)/2&&U.push(o.a$([],ka(o.a5/2,0,r.x,r.y,r.z),k)),r.y<(1<<r.z)/2&&U.push(o.a$([],ka(o.a5/2,o.a5,r.x,r.y,r.z),k));const ye=Tu(Y,U),Ee=Tu(ce,U),me=[-Y[0],-Y[1],-Y[2],ye.max],Ae=[Y[0],Y[1],Y[2],-ye.min],Pe=[-ce[0],-ce[1],-ce[2],Ee.max],we=[ce[0],ce[1],ce[2],-Ee.min],ke=[...de,0],et=[...fe,0],Ze=[];return r.y===0?Ze.push(o.bD(et,ke,me),o.bD(et,ke,Ae)):Ze.push(o.bD(Pe,ke,me),o.bD(Pe,ke,Ae),o.bD(Pe,et,me),o.bD(Pe,et,Ae)),r.y===(1<<r.z)-1?Ze.push(o.bD(et,ke,me),o.bD(et,ke,Ae)):Ze.push(o.bD(we,ke,me),o.bD(we,ke,Ae),o.bD(we,et,me),o.bD(we,et,Ae)),new Ac(Ze,[me,Ae,Pe,we,ke,et],H,$)}}}function Tu(w,r){let h=1/0,m=-1/0;for(const v of r){const S=o.b5(w,v);h=Math.min(h,S),m=Math.max(m,S)}return{min:h,max:m}}class Cc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h){this._helper.resize(r,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r){}constructor(r){this._cachedClippingPlane=o.bF(),this._projectionMatrix=o.bj(),this._globeViewProjMatrix32f=o.bi(),this._globeViewProjMatrixNoCorrection=o.bj(),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),this._globeProjMatrixInverted=o.bj(),this._cameraPosition=o.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(h,m)=>{const v=o.an(h.lat,-o.ao,o.ao),S=o.an(+m,this.minZoom+zn(0,v),this.maxZoom);return{center:new o.V(h.lng,v),zoom:S}},this.applyConstrain=(h,m)=>this._helper.applyConstrain(h,m),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,m)=>this.defaultConstrain(h,m)},r),this._coveringTilesDetailsProvider=new Bf}clone(){const r=new Cc;return r.apply(this,!1),r}apply(r,h,m){this._globeLatitudeErrorCorrectionRadians=m||0,this._helper.apply(r,h)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const r=o.bA();return r[0]=this._cameraPosition[0],r[1]=this._cameraPosition[1],r[2]=this._cameraPosition[2],r}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(r){const{overscaledTileID:h,applyGlobeMatrix:m}=r,v=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(r){const h=this.pitchInRadians,m=this.cameraToCenterDistance/r,v=Math.sin(h)*m,S=Math.cos(h)*m+1,C=1/Math.sqrt(v*v+S*S)*1;let R=-v,k=S;const N=Math.sqrt(R*R+k*k);R/=N,k/=N;const U=[0,R,k];o.bG(U,U,[0,0,0],-this.bearingInRadians),o.bH(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),o.bI(U,U,[0,0,0],this.center.lng*Math.PI/180);const H=1/o.b7(U);return o.a$(U,U,H),[...U,-C*H]}isLocationOccluded(r){return!this.isSurfacePointVisible(xn(r))}transformLightDirection(r){const h=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,v=Math.cos(m),S=[Math.sin(h)*v,Math.sin(m),Math.cos(h)*v],C=[S[2],0,-S[0]],R=[0,0,0];o.b4(R,C,S),o.b3(C,C),o.b3(R,R);const k=[0,0,0];return o.b3(k,[C[0]*r[0]+R[0]*r[1]+S[0]*r[2],C[1]*r[0]+R[1]*r[1]+S[1]*r[2],C[2]*r[0]+R[2]*r[1]+S[2]*r[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(r,h,m){const v=(function(R,k,N){const U=1/(1<<N.z);return new o.a9(R/o.a5*U+N.x*U,k/o.a5*U+N.y*U)})(r,h,m.canonical),S=(C=v.y,[o.bz(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(r,h,m,v){const S=m.canonical,C=ka(r,h,S.x,S.y,S.z),R=1+(v?v(r,h):0)/o.bE,k=[C[0]*R,C[1]*R,C[2]*R,1];o.aH(k,k,this._globeViewProjMatrixNoCorrection);const N=this._cachedClippingPlane,U=N[0]*C[0]+N[1]*C[1]+N[2]*C[2]+N[3]<0;return{point:new o.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const r=Ml(this.worldSize,this.center.lat),h=o.bk(),m=o.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*r),o.be(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const v=this.centerOffset;h[8]=2*-v.x/this._helper._width,h[9]=2*v.y/this._helper._height,this._projectionMatrix=o.bf(h),this._globeProjMatrixInverted=o.bk(),o.aB(this._globeProjMatrixInverted,h),o.O(h,h,[0,0,-this.cameraToCenterDistance]),o.bg(h,h,this.rollInRadians),o.bh(h,h,-this.pitchInRadians),o.bg(h,h,this.bearingInRadians),o.O(h,h,[0,0,-r]);const S=o.bA();S[0]=r,S[1]=r,S[2]=r,o.bh(m,h,this.center.lat*Math.PI/180),o.bJ(m,m,-this.center.lng*Math.PI/180),o.Q(m,m,S),this._globeViewProjMatrixNoCorrection=m,o.bh(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bJ(h,h,-this.center.lng*Math.PI/180),o.Q(h,h,S),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=o.bk(),o.aB(this._globeViewProjMatrixNoCorrectionInverted,m);const C=o.bA();this._cameraPosition=o.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/r,o.bG(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),o.bH(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),o.bG(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),o.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bH(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),o.bI(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(r);const R=o.bf(this._globeViewProjMatrixNoCorrectionInverted);o.Q(R,R,[1,1,-1]),this._cachedFrustum=Vr.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(r){o.w("calculateFogMatrix is not supported on globe projection.");const h=o.bk();return o.ar(h),h}getVisibleUnwrappedCoordinates(r){return[new o.bc(0,r)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){r&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=xn(r);o.a$(m,m,1+h/o.bE);const v=o.bF();return o.aH(v,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(r){}getBounds(){const r=.5*this.width,h=.5*this.height,m=[new o.P(0,0),new o.P(r,0),new o.P(this.width,0),new o.P(this.width,h),new o.P(this.width,this.height),new o.P(r,this.height),new o.P(0,this.height),new o.P(0,h)],v=[];for(const H of m)v.push(this.unprojectScreenPoint(H));let S=0,C=0,R=0,k=0;const N=this.center;for(const H of v){const $=o.bK(N.lng,H.lng),Y=o.bK(N.lat,H.lat);$<C&&(C=$),$>S&&(S=$),Y<k&&(k=Y),Y>R&&(R=Y)}const U=[N.lng+C,N.lat+k,N.lng+S,N.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new mn(U)}calculateCenterFromCameraLngLatAlt(r,h,m,v){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,v)}setLocationAtPoint(r,h){const m=xn(this.unprojectScreenPoint(h)),v=xn(r),S=o.bA();o.bL(S);const C=o.bA();o.bI(C,m,S,-this.center.lng*Math.PI/180),o.bH(C,C,S,this.center.lat*Math.PI/180);const R=v[0]*v[0]+v[2]*v[2],k=C[0]*C[0];if(R<k)return;const N=Math.sqrt(R-k),U=-N,H=o.bM(v[0],v[2],C[0],N),$=o.bM(v[0],v[2],C[0],U),Y=o.bA();o.bI(Y,v,S,-H);const te=o.bM(Y[1],Y[2],C[1],C[2]),ce=o.bA();o.bI(ce,v,S,-$);const de=o.bM(ce[1],ce[2],C[1],C[2]),fe=.5*Math.PI,ye=te>=-fe&&te<=fe,Ee=de>=-fe&&de<=fe;let me,Ae;if(ye&&Ee){const et=this.center.lng*Math.PI/180,Ze=this.center.lat*Math.PI/180;o.bN(H,et)+o.bN(te,Ze)<o.bN($,et)+o.bN(de,Ze)?(me=H,Ae=te):(me=$,Ae=de)}else if(ye)me=H,Ae=te;else{if(!Ee)return;me=$,Ae=de}const Pe=me/Math.PI*180,we=Ae/Math.PI*180,ke=this.center.lat;this.setCenter(new o.V(Pe,o.an(we,-90,90))),this.setZoom(this.zoom+zn(ke,this.center.lat))}locationToScreenPoint(r,h){const m=xn(r);if(h){const v=h.getElevationForLngLatZoom(r,this._helper._tileZoom);o.a$(m,m,1+v/o.bE)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(r){const h=o.bF();return o.aH(h,[...r,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new o.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(r,h){if(h){const m=h.pointCoordinate(r);if(m)return m}return o.a9.fromLngLat(this.unprojectScreenPoint(r))}screenPointToLocation(r,h){var m;return(m=this.screenPointToMercatorCoordinate(r,h))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(r,h){const m=this._cameraPosition,v=this.getRayDirectionFromPixel(r);return!!this.rayPlanetIntersection(m,v)}getRayDirectionFromPixel(r){const h=o.bF();h[0]=r.x/this.width*2-1,h[1]=-1*(r.y/this.height*2-1),h[2]=1,h[3]=1,o.aH(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const m=o.bA();m[0]=h[0]-this._cameraPosition[0],m[1]=h[1]-this._cameraPosition[1],m[2]=h[2]-this._cameraPosition[2];const v=o.bA();return o.b3(v,m),v}isSurfacePointVisible(r){const h=this._cachedClippingPlane;return h[0]*r[0]+h[1]*r[1]+h[2]*r[2]+h[3]>=0}isSurfacePointOnScreen(r){if(!this.isSurfacePointVisible(r))return!1;const h=o.bF();return o.aH(h,[...r,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(r,h){const m=o.b5(r,h),v=o.bA(),S=o.bA();o.a$(S,h,m),o.b2(v,r,S);const C=1-o.b5(v,v);if(C<0)return null;const R=o.b5(r,r)-1,k=-m+(m<0?1:-1)*Math.sqrt(C),N=R/k,U=k;return{tMin:Math.min(N,U),tMax:Math.max(N,U)}}unprojectScreenPoint(r){const h=this._cameraPosition,m=this.getRayDirectionFromPixel(r),v=this.rayPlanetIntersection(h,m);if(v){const U=o.bA();o.b0(U,h,[m[0]*v.tMin,m[1]*v.tMin,m[2]*v.tMin]);const H=o.bA();return o.b3(H,U),xu(H)}const S=this._cachedClippingPlane,C=S[0]*m[0]+S[1]*m[1]+S[2]*m[2],R=-o.bb(S,h)/C,k=o.bA();if(R>0)o.b0(k,h,[m[0]*R,m[1]*R,m[2]*R]);else{const U=o.bA();o.b0(U,h,[2*m[0],2*m[1],2*m[2]]);const H=o.bb(this._cachedClippingPlane,U);o.b2(k,U,[this._cachedClippingPlane[0]*H,this._cachedClippingPlane[1]*H,this._cachedClippingPlane[2]*H])}const N=(function(U){const H=o.bA();return H[0]=U[0]*-U[3],H[1]=U[1]*-U[3],H[2]=U[2]*-U[3],{center:H,radius:Math.sqrt(1-U[3]*U[3])}})(S);return xu((function(U,H,$){const Y=o.bA();o.b2(Y,$,U);const te=o.bA();return o.by(te,U,Y,H/o.b9(Y)),te})(N.center,N.radius,k))}getMatrixForModel(r,h){const m=o.V.convert(r),v=1/o.bE,S=o.bj();return o.bJ(S,S,m.lng/180*Math.PI),o.bh(S,S,-m.lat/180*Math.PI),o.O(S,S,[0,0,1+h/o.bE]),o.bh(S,S,.5*Math.PI),o.Q(S,S,[v,v,v]),S}getProjectionDataForCustomLayer(r=!0){const h=this.getProjectionData({overscaledTileID:new o.a2(0,0,0,0,0),applyGlobeMatrix:r});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(r){}}class Mc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,h,m){return this._helper.interpolatePadding(r,h,m)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,h,m=!0){this._helper.resize(r,h,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}setConstrainOverride(r){this._helper.setConstrainOverride(r)}overrideNearFarZ(r,h){this._helper.overrideNearFarZ(r,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(r,h){this._globeness=r,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(r){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(h,m)=>this.currentTransform.defaultConstrain(h,m),this.applyConstrain=(h,m)=>this._helper.applyConstrain(h,m),this._helper=new No({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(h,m)=>this.defaultConstrain(h,m)},r),this._globeness=1,this._mercatorTransform=new er,this._verticalPerspectiveTransform=new Cc}clone(){const r=new Mc;return r._globeness=this._globeness,r._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,r.apply(this,!1),r}apply(r,h){this._helper.apply(r,h),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(r){const h=this._mercatorTransform.getProjectionData(r),m=this._verticalPerspectiveTransform.getProjectionData(r);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:h.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:r.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(r){return this.currentTransform.isLocationOccluded(r)}transformLightDirection(r){return this.currentTransform.transformLightDirection(r)}getPixelScale(){return o.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(r,h,m){const v=this._mercatorTransform.getPitchedTextCorrection(r,h,m),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(r,h,m);return o.bu(v,S,this._globeness)}projectTileCoordinates(r,h,m,v){return this.currentTransform.projectTileCoordinates(r,h,m,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(r){return this.currentTransform.calculateFogMatrix(r)}getVisibleUnwrappedCoordinates(r){return this.currentTransform.getVisibleUnwrappedCoordinates(r)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(r){this._mercatorTransform.recalculateZoomAndCenter(r),this._verticalPerspectiveTransform.recalculateZoomAndCenter(r)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,h){return this.currentTransform.lngLatToCameraDepth(r,h)}populateCache(r){this._mercatorTransform.populateCache(r),this._verticalPerspectiveTransform.populateCache(r)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(r,h,m,v){return this._helper.calculateCenterFromCameraLngLatAlt(r,h,m,v)}setLocationAtPoint(r,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(r,h),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(r,h),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(r,h){return this.currentTransform.locationToScreenPoint(r,h)}screenPointToMercatorCoordinate(r,h){return this.currentTransform.screenPointToMercatorCoordinate(r,h)}screenPointToLocation(r,h){return this.currentTransform.screenPointToLocation(r,h)}isPointOnMapSurface(r,h){return this.currentTransform.isPointOnMapSurface(r,h)}getRayDirectionFromPixel(r){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(r)}getMatrixForModel(r,h){return this.currentTransform.getMatrixForModel(r,h)}getProjectionDataForCustomLayer(r=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(r);if(!this.isGlobeRendering)return h;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(r);return m.fallbackMatrix=h.mainMatrix,m}getFastPathSimpleProjectionMatrix(r){return this.currentTransform.getFastPathSimpleProjectionMatrix(r)}}class Hn{get useGlobeControls(){return!0}handlePanInertia(r,h){const m=up(r,h);return Math.abs(m.lng-h.center.lng)>180&&(m.lng=h.center.lng+179.5*Math.sign(m.lng-h.center.lng)),{easingCenter:m,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(r,h){const m=r.around,v=h.screenPointToLocation(m);r.bearingDelta&&h.setBearing(h.bearing+r.bearingDelta),r.pitchDelta&&h.setPitch(h.pitch+r.pitchDelta),r.rollDelta&&h.setRoll(h.roll+r.rollDelta);const S=h.zoom;r.zoomDelta&&h.setZoom(h.zoom+r.zoomDelta);const C=h.zoom-S;if(C===0)return;const R=o.bK(h.center.lng,v.lng),k=R/(Math.abs(R/180)+1),N=o.bK(h.center.lat,v.lat),U=h.getRayDirectionFromPixel(m),H=h.cameraPosition,$=-1*o.b5(H,U),Y=o.bA();o.b0(Y,H,[U[0]*$,U[1]*$,U[2]*$]);const te=o.b7(Y)-1,ce=Math.exp(.5*-Math.max(te-.3,0)),de=Ml(h.worldSize,h.center.lat)/Math.min(h.width,h.height),fe=o.bx(de,.9,.5,1,.25),ye=(1-o.aq(-C))*Math.min(ce,fe),Ee=h.center.lat,me=h.zoom,Ae=new o.V(h.center.lng+k*ye,o.an(h.center.lat+N*ye,-o.ao,o.ao));h.setLocationAtPoint(v,m);const Pe=h.center,we=o.bx(Math.abs(R),45,85,0,1),ke=o.bx(de,.75,.35,0,1),et=Math.pow(Math.max(we,ke),.25),Ze=o.bK(Pe.lng,Ae.lng),Ke=o.bK(Pe.lat,Ae.lat);h.setCenter(new o.V(Pe.lng+Ze*et,Pe.lat+Ke*et).wrap()),h.setZoom(me+zn(Ee,h.center.lat))}handleMapControlsPan(r,h,m){if(!r.panDelta)return;const v=h.center.lat,S=h.zoom;h.setCenter(up(r.panDelta,h).wrap()),h.setZoom(S+zn(v,h.center.lat))}cameraForBoxAndBearing(r,h,m,v,S){const C=Al(r,h,m,v,S),R=h.left/S.width*2-1,k=(S.width-h.right)/S.width*2-1,N=h.top/S.height*-2+1,U=(S.height-h.bottom)/S.height*-2+1,H=o.bK(m.getWest(),m.getEast())<0,$=H?m.getEast():m.getWest(),Y=H?m.getWest():m.getEast(),te=Math.max(m.getNorth(),m.getSouth()),ce=Math.min(m.getNorth(),m.getSouth()),de=$+.5*o.bK($,Y),fe=te+.5*o.bK(te,ce),ye=S.clone();ye.setCenter(C.center),ye.setBearing(C.bearing),ye.setPitch(0),ye.setRoll(0),ye.setZoom(C.zoom);const Ee=ye.modelViewProjectionMatrix,me=[xn(m.getNorthWest()),xn(m.getNorthEast()),xn(m.getSouthWest()),xn(m.getSouthEast()),xn(new o.V(Y,fe)),xn(new o.V($,fe)),xn(new o.V(de,te)),xn(new o.V(de,ce))],Ae=xn(C.center);let Pe=Number.POSITIVE_INFINITY;for(const we of me)R<0&&(Pe=Hn.getLesserNonNegativeNonNull(Pe,Hn.solveVectorScale(we,Ae,Ee,"x",R))),k>0&&(Pe=Hn.getLesserNonNegativeNonNull(Pe,Hn.solveVectorScale(we,Ae,Ee,"x",k))),N>0&&(Pe=Hn.getLesserNonNegativeNonNull(Pe,Hn.solveVectorScale(we,Ae,Ee,"y",N))),U<0&&(Pe=Hn.getLesserNonNegativeNonNull(Pe,Hn.solveVectorScale(we,Ae,Ee,"y",U)));if(Number.isFinite(Pe)&&Pe!==0)return C.zoom=ye.zoom+o.at(Pe),C;jr()}handleJumpToCenterZoom(r,h){const m=r.center.lat,v=r.applyConstrain(h.center?o.V.convert(h.center):r.center,r.zoom).center;r.setCenter(v.wrap());const S=h.zoom!==void 0?+h.zoom:r.zoom+zn(m,v.lat);r.zoom!==S&&r.setZoom(S)}handleEaseTo(r,h){const m=r.zoom,v=r.center,S=r.padding,C={roll:r.roll,pitch:r.pitch,bearing:r.bearing},R={roll:h.roll===void 0?r.roll:h.roll,pitch:h.pitch===void 0?r.pitch:h.pitch,bearing:h.bearing===void 0?r.bearing:h.bearing},k=h.zoom!==void 0,N=!r.isPaddingEqual(h.padding);let U=!1;const H=h.center?o.V.convert(h.center):v,$=r.applyConstrain(H,m).center;Oa(r,$);const Y=r.clone();Y.setCenter($),Y.setZoom(k?+h.zoom:m+zn(v.lat,H.lat)),Y.setBearing(h.bearing);const te=new o.P(o.an(r.centerPoint.x+h.offsetAsPoint.x,0,r.width),o.an(r.centerPoint.y+h.offsetAsPoint.y,0,r.height));Y.setLocationAtPoint($,te);const ce=(h.offset&&h.offsetAsPoint.mag())>0?Y.center:$,de=k?+h.zoom:m+zn(v.lat,ce.lat),fe=m+zn(v.lat,0),ye=de+zn(ce.lat,0),Ee=o.bK(v.lng,ce.lng),me=o.bK(v.lat,ce.lat),Ae=o.aq(ye-fe);return U=de!==m,{easeFunc:Pe=>{if(o.bo(C,R)||yu({startEulerAngles:C,endEulerAngles:R,tr:r,k:Pe,useSlerp:C.roll!=R.roll}),N&&r.interpolatePadding(S,h.padding,Pe),h.around)o.w("Easing around a point is not supported under globe projection."),r.setLocationAtPoint(h.around,h.aroundPoint);else{const we=ye>fe?Math.min(2,Ae):Math.max(.5,Ae),ke=Math.pow(we,1-Pe),et=hp(v,Ee,me,Pe*ke);r.setCenter(et.wrap())}if(U){const we=o.G.number(fe,ye,Pe)+zn(0,r.center.lat);r.setZoom(we)}},isZooming:U,elevationCenter:ce}}handleFlyTo(r,h){const m=h.zoom!==void 0,v=r.center,S=r.zoom,C=r.padding,R=!r.isPaddingEqual(h.padding),k=r.applyConstrain(o.V.convert(h.center||h.locationAtOffset),S).center,N=m?+h.zoom:r.zoom+zn(r.center.lat,k.lat),U=r.clone();U.setCenter(k),U.setZoom(N),U.setBearing(h.bearing);const H=new o.P(o.an(r.centerPoint.x+h.offsetAsPoint.x,0,r.width),o.an(r.centerPoint.y+h.offsetAsPoint.y,0,r.height));U.setLocationAtPoint(k,H);const $=U.center;Oa(r,$);const Y=(function(me,Ae,Pe){const we=xn(Ae),ke=xn(Pe),et=o.b5(we,ke),Ze=Math.acos(et),Ke=$r(me);return Ze/(2*Math.PI)*Ke})(r,v,$),te=S+zn(v.lat,0),ce=N+zn($.lat,0),de=o.aq(ce-te);let fe;if(typeof h.minZoom=="number"){const me=+h.minZoom+zn($.lat,0),Ae=Math.min(me,te,ce)+zn(0,$.lat),Pe=r.applyConstrain($,Ae).zoom+zn($.lat,0);fe=o.aq(Pe-te)}const ye=o.bK(v.lng,$.lng),Ee=o.bK(v.lat,$.lat);return{easeFunc:(me,Ae,Pe,we)=>{const ke=hp(v,ye,Ee,Pe);R&&r.interpolatePadding(C,h.padding,me);const et=me===1?$:ke;r.setCenter(et.wrap());const Ze=te+o.at(Ae);r.setZoom(me===1?N:Ze+zn(0,et.lat))},scaleOfZoom:de,targetCenter:$,scaleOfMinZoom:fe,pixelPathLength:Y}}static solveVectorScale(r,h,m,v,S){const C=v==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],R=[m[3],m[7],m[11],m[15]],k=r[0]*C[0]+r[1]*C[1]+r[2]*C[2],N=r[0]*R[0]+r[1]*R[1]+r[2]*R[2],U=h[0]*C[0]+h[1]*C[1]+h[2]*C[2],H=h[0]*R[0]+h[1]*R[1]+h[2]*R[2];return U+S*N===k+S*H||R[3]*(k-U)+C[3]*(H-N)+k*H==U*N?null:(U+C[3]-S*H-S*R[3])/(U-k-S*H+S*N)}static getLesserNonNegativeNonNull(r,h){return h!==null&&h>=0&&h<r?h:r}}class Pc{constructor(r){this._globe=r,this._mercatorCameraHelper=new El,this._verticalPerspectiveCameraHelper=new Hn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(r,h){return this.currentHelper.handlePanInertia(r,h)}handleMapControlsRollPitchBearingZoom(r,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(r,h)}handleMapControlsPan(r,h,m){this.currentHelper.handleMapControlsPan(r,h,m)}cameraForBoxAndBearing(r,h,m,v,S){return this.currentHelper.cameraForBoxAndBearing(r,h,m,v,S)}handleJumpToCenterZoom(r,h){this.currentHelper.handleJumpToCenterZoom(r,h)}handleEaseTo(r,h){return this.currentHelper.handleEaseTo(r,h)}handleFlyTo(r,h){return this.currentHelper.handleFlyTo(r,h)}}const Ic=(w,r)=>o.B(w,r&&r.filter((h=>h.identifier!=="source.canvas"))),Rc=o.bO();class $o extends o.E{constructor(r,h={}){var m,v;super(),this._rtlPluginLoaded=()=>{for(const C in this.tileManagers){const R=this.tileManagers[C].getSource().type;R!=="vector"&&R!=="geojson"||this.tileManagers[C].reload()}},this.map=r,this.dispatcher=new Mi(vi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",((C,R)=>this.getGlyphs(C,R))),this.dispatcher.registerMessageHandler("GI",((C,R)=>this.getImages(C,R))),this.dispatcher.registerMessageHandler("GDA",((C,R)=>this.getDashes(C,R))),this.imageManager=new Lt,this.imageManager.setEventedParent(this);const S=((m=r._container)===null||m===void 0?void 0:m.lang)||typeof document<"u"&&((v=document.documentElement)===null||v===void 0?void 0:v.lang)||void 0;this.glyphManager=new be(r._requestManager,h.localIdeographFontFamily,S),this.lineAtlas=new Je(256,512),this.crossTileSymbolIndex=new sr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bP()),K().on(Lo,this._rtlPluginLoaded),this.on("data",(C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const R=this.tileManagers[C.sourceId];if(!R)return;const k=R.getSource();if(k&&k.vectorLayerIds)for(const N in this._layers){const U=this._layers[N];U.source===k.id&&this._validateLayer(U)}}))}_setInitialValues(){var r;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((r=this.crossTileSymbolIndex)===null||r===void 0?void 0:r.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(r,h){var m,v,S;this._checkLoaded();const C=h===null?(S=(v=(m=this.stylesheet.state)===null||m===void 0?void 0:m[r])===null||v===void 0?void 0:v.default)!==null&&S!==void 0?S:null:h;if(o.bR(C,this._globalState[r]))return this;this._globalState[r]=C,this._applyGlobalStateChanges([r])}getGlobalState(){return this._globalState}setGlobalState(r){this._checkLoaded();const h=[];for(const m in r)!o.bR(this._globalState[m],r[m].default)&&(h.push(m),this._globalState[m]=r[m].default);this._applyGlobalStateChanges(h)}_applyGlobalStateChanges(r){if(r.length===0)return;const h=new Set,m={};for(const v of r){m[v]=this._globalState[v];for(const S in this._layers){const C=this._layers[S],R=C.getLayoutAffectingGlobalStateRefs(),k=C.getPaintAffectingGlobalStateRefs(),N=C.getVisibilityAffectingGlobalStateRefs();if(R.has(v)&&h.add(C.source),k.has(v))for(const{name:U,value:H}of k.get(v))this._updatePaintProperty(C,U,H);N?.has(v)&&(C.recalculateVisibility(),this._updateLayer(C))}}this.dispatcher.broadcast("UGS",m);for(const v in this.tileManagers)h.has(v)&&(this._reloadSource(v),this._changed=!0)}loadURL(r,h={},m){this.fire(new o.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const v=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;const S=this._loadStyleRequest;o.j(v,this._loadStyleRequest).then((C=>{this._loadStyleRequest=null,this._load(C.data,h,m)})).catch((C=>{this._loadStyleRequest=null,C&&!S.signal.aborted&&this.fire(new o.k(C))}))}loadJSON(r,h={},m){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,J.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,m)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Rc,{validate:!1})}_load(r,h,m){var v,S;let C=h.transformStyle?h.transformStyle(m,r):r;if(!h.validate||!Ic(this,o.C(C))){C=Object.assign({},C),this._loaded=!0,this.stylesheet=C;for(const R in C.sources)this.addSource(R,C.sources[R],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new nt(this.stylesheet.light),this._setProjectionInternal(((v=this.stylesheet.projection)===null||v===void 0?void 0:v.type)||"mercator"),this.sky=new Oe(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var r,h,m;const v=o.bS(this.stylesheet.layers);this.setGlobalState((r=this.stylesheet.state)!==null&&r!==void 0?r:null),this.dispatcher.broadcast("SL",v),this._order=v.map((S=>S.id)),this._layers={},this._serializedLayers=null;for(const S of v){const C=o.bT(S,this._globalState);if(C.setEventedParent(this,{layer:{id:S.id}}),this._layers[S.id]=C,o.bU(C)&&this.tileManagers[C.source]){const R=(m=(h=S.paint)===null||h===void 0?void 0:h["raster-fade-duration"])!==null&&m!==void 0?m:C.paint.get("raster-fade-duration");this.tileManagers[C.source].setRasterFadeDuration(R)}}}_loadSprite(r,h=!1,m=void 0){this.imageManager.setLoaded(!1);const v=new AbortController;let S;this._spriteRequest=v,(function(C,R,k,N){return o._(this,void 0,void 0,(function*(){const U=lt(C),H=k>1?"@2x":"",$={},Y={};for(const{id:te,url:ce}of U){const de=R.transformRequest(kt(ce,H,".json"),"SpriteJSON");$[te]=o.j(de,N);const fe=R.transformRequest(kt(ce,H,".png"),"SpriteImage");Y[te]=wt.getImage(fe,N)}return yield Promise.all([...Object.values($),...Object.values(Y)]),(function(te,ce){return o._(this,void 0,void 0,(function*(){const de={};for(const fe in te){de[fe]={};const ye=J.getImageCanvasContext((yield ce[fe]).data),Ee=(yield te[fe]).data;for(const me in Ee){const{width:Ae,height:Pe,x:we,y:ke,sdf:et,pixelRatio:Ze,stretchX:Ke,stretchY:Qe,content:Rt,textFitWidth:Ot,textFitHeight:_t}=Ee[me];de[fe][me]={data:null,pixelRatio:Ze,sdf:et,stretchX:Ke,stretchY:Qe,content:Rt,textFitWidth:Ot,textFitHeight:_t,spriteData:{width:Ae,height:Pe,x:we,y:ke,context:ye}}}}return de}))})($,Y)}))})(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((C=>{if(this._spriteRequest=null,C)for(const R in C){this._spritesImagesIds[R]=[];const k=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter((N=>!(N in C))):[];for(const N of k)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in C[R]){const U=R==="default"?N:`${R}:${N}`;this._spritesImagesIds[R].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,C[R][N],!1):this.imageManager.addImage(U,C[R][N]),h&&(this._changedImages[U]=!0)}}})).catch((C=>{this._spriteRequest=null,S=C,v.signal.aborted||this.fire(new o.k(S))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),m&&m(S)}))}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(r){const h=this.tileManagers[r.source];if(!h)return;const m=r.sourceLayer;if(!m)return;const v=h.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.k(new Error(`Source layer "${m}" does not exist on source "${v.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.tileManagers)if(!this.tileManagers[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,h=!1){const m=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h?o.bV(m):m);const v=[];for(const S of r)if(m[S]){const C=h?o.bV(m[S]):m[S];v.push(C)}return v}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const m of h){const v=this._layers[m];v.type!=="custom"&&(r[m]=v.serialize())}return r}hasTransitions(){var r,h,m;if(!((r=this.light)===null||r===void 0)&&r.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const v in this.tileManagers)if(this.tileManagers[v].hasTransition())return!0;for(const v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const v=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(v.length||S.length)&&this._updateWorkerLayers(v,S);for(const C in this._updatedSources){const R=this._updatedSources[C];if(R==="reload")this._reloadSource(C);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}const m={};for(const v in this.tileManagers){const S=this.tileManagers[v];m[v]=S.used,S.used=!1}for(const v of this._order){const S=this._layers[v];S.recalculate(r,this._availableImages),!S.isHidden(r.zoom)&&S.source&&(this.tileManagers[S.source].used=!0)}for(const v in m){const S=this.tileManagers[v];!!m[v]!=!!S.used&&S.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(r),this.sky.recalculate(r),this.projection.recalculate(r),this.z=r.zoom,h&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.tileManagers)this.tileManagers[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var m;this._checkLoaded();const v=this.serialize();if(r=h.transformStyle?h.transformStyle(v,r):r,((m=h.validate)===null||m===void 0||m)&&Ic(this,o.C(r)))return!1;(r=o.bV(r)).layers=o.bS(r.layers);const S=o.bW(v,r),C=this._getOperationsToPerform(S);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const R of C.operations)R();return this.stylesheet=r,this._serializedLayers=null,this.fire(new o.l("style.load",{style:this})),!0}_getOperationsToPerform(r){const h=[],m=[];for(const v of r)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push((()=>this.addLayer.apply(this,v.args)));break;case"removeLayer":h.push((()=>this.removeLayer.apply(this,v.args)));break;case"setPaintProperty":h.push((()=>this.setPaintProperty.apply(this,v.args)));break;case"setLayoutProperty":h.push((()=>this.setLayoutProperty.apply(this,v.args)));break;case"setFilter":h.push((()=>this.setFilter.apply(this,v.args)));break;case"addSource":h.push((()=>this.addSource.apply(this,v.args)));break;case"removeSource":h.push((()=>this.removeSource.apply(this,v.args)));break;case"setLayerZoomRange":h.push((()=>this.setLayerZoomRange.apply(this,v.args)));break;case"setLight":h.push((()=>this.setLight.apply(this,v.args)));break;case"setGeoJSONSourceData":h.push((()=>this.setGeoJSONSourceData.apply(this,v.args)));break;case"setGlyphs":h.push((()=>this.setGlyphs.apply(this,v.args)));break;case"setSprite":h.push((()=>this.setSprite.apply(this,v.args)));break;case"setTerrain":h.push((()=>this.map.setTerrain.apply(this,v.args)));break;case"setSky":h.push((()=>this.setSky.apply(this,v.args)));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setGlobalState":h.push((()=>this.setGlobalState.apply(this,v.args)));break;case"setTransition":h.push((()=>{}));break;default:m.push(v.command)}return{operations:h,unimplemented:m}}addImage(r,h){if(this.getImage(r))return this.fire(new o.k(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new o.k(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,m={}){if(this._checkLoaded(),this.tileManagers[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(o.C.source,`sources.${r}`,h,null,m))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=this.tileManagers[r]=new Hi(r,h,this.dispatcher);v.style=this,v.setEventedParent(this,(()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:r}))),v.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===r)return this.fire(new o.k(new Error(`Source "${r}" cannot be removed while layer "${m}" is using it.`)));const h=this.tileManagers[r];delete this.tileManagers[r],delete this._updatedSources[r],h.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.tileManagers[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const m=this.tileManagers[r].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(h),this._changed=!0}getSource(r){return this.tileManagers[r]&&this.tileManagers[r].getSource()}addLayer(r,h,m={}){this._checkLoaded();const v=r.id;if(this.getLayer(v))return void this.fire(new o.k(new Error(`Layer "${v}" already exists on this map.`)));let S;if(r.type==="custom"){if(Ic(this,o.bX(r)))return;S=o.bT(r,this._globalState)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(v,r.source),r=o.bV(r),r=o.e(r,{source:v})),this._validate(o.C.layer,`layers.${v}`,r,{arrayIndex:-1},m))return;S=o.bT(r,this._globalState),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}const C=h?this._order.indexOf(h):this._order.length;if(h&&C===-1)this.fire(new o.k(new Error(`Cannot add layer "${v}" before non-existing layer "${h}".`)));else{if(this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=S,this._removedLayers[v]&&S.source&&S.type!=="custom"){const R=this._removedLayers[v];delete this._removedLayers[v],R.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.tileManagers[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new o.k(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const m=this._order.indexOf(r);this._order.splice(m,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new o.k(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(v,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const m=this._order.indexOf(r);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,m){this._checkLoaded();const v=this.getLayer(r);v?v.minzoom===h&&v.maxzoom===m||(h!=null&&(v.minzoom=h),m!=null&&(v.maxzoom=m),this._updateLayer(v)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,m={}){this._checkLoaded();const v=this.getLayer(r);if(v){if(!o.bR(v.filter,h))return h==null?(v.setFilter(void 0),void this._updateLayer(v)):void(this._validate(o.C.filter,`layers.${v.id}.filter`,h,null,m)||(v.setFilter(o.bV(h)),this._updateLayer(v)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return o.bV(this.getLayer(r).filter)}setLayoutProperty(r,h,m,v={}){this._checkLoaded();const S=this.getLayer(r);S?o.bR(S.getLayoutProperty(h),m)||(S.setLayoutProperty(h,m,v),this._updateLayer(S)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const m=this.getLayer(r);if(m)return m.getLayoutProperty(h);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,m,v={}){this._checkLoaded();const S=this.getLayer(r);S?o.bR(S.getPaintProperty(h),m)||this._updatePaintProperty(S,h,m,v):this.fire(new o.k(new Error(`Cannot style non-existing layer "${r}".`)))}_updatePaintProperty(r,h,m,v={}){r.setPaintProperty(h,m,v)&&this._updateLayer(r),o.bU(r)&&h==="raster-fade-duration"&&this.tileManagers[r.source].setRasterFadeDuration(m),this._changed=!0,this._updatedPaintProps[r.id]=!0,this._serializedLayers=null}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const m=r.source,v=r.sourceLayer,S=this.tileManagers[m];if(S===void 0)return void this.fire(new o.k(new Error(`The source '${m}' does not exist in the map's style.`)));const C=S.getSource().type;C==="geojson"&&v?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||v?(r.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(v,r.id,h)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const m=r.source,v=this.tileManagers[m];if(v===void 0)return void this.fire(new o.k(new Error(`The source '${m}' does not exist in the map's style.`)));const S=v.getSource().type,C=S==="vector"?r.sourceLayer:void 0;S!=="vector"||C?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(C,r.id,h):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,m=r.sourceLayer,v=this.tileManagers[h];if(v!==void 0)return v.getSource().type!=="vector"||m?(r.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(m,r.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=o.bY(this.tileManagers,(S=>S.serialize())),h=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,v=this.stylesheet;return o.bZ({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:r,layers:h,terrain:m},(S=>S!==void 0))}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.tileManagers[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.tileManagers[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=C=>this._layers[C].type==="fill-extrusion",m={},v=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(h(R)){m[R]=C;for(const k of r){const N=k[R];if(N)for(const U of N)v.push(U)}}}v.sort(((C,R)=>R.intersectionZ-C.intersectionZ));const S=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(h(R))for(let k=v.length-1;k>=0;k--){const N=v[k].feature;if(m[N.layer.id]<C)break;S.push(N),v.pop()}else for(const k of r){const N=k[R];if(N)for(const U of N)S.push(U.feature)}}return S}queryRenderedFeatures(r,h,m){h&&h.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const N of h.layers){const U=this._layers[N];if(!U)return this.fire(new o.k(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];v[U.source]=!0}}const S=[];h.availableImages=this._availableImages;const C=this._serializedAllLayers(),R=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,k=Object.assign(Object.assign({},h),{layers:R,globalState:this._globalState});for(const N in this.tileManagers)h.layers&&!v[N]||S.push(Oo(this.tileManagers[N],this._layers,C,r,k,m,this.map.terrain?(U,H,$)=>this.map.terrain.getElevation(U,H,$):void 0));return this.placement&&S.push((function(N,U,H,$,Y,te,ce){const de={},fe=te.queryRenderedSymbols($),ye=[];for(const Ee of Object.keys(fe).map(Number))ye.push(ce[Ee]);ye.sort(gn);for(const Ee of ye){const me=Ee.featureIndex.lookupSymbolFeatures(fe[Ee.bucketInstanceId],U,Ee.bucketIndex,Ee.sourceLayerIndex,{filterSpec:Y.filter,globalState:Y.globalState},Y.layers,Y.availableImages,N);for(const Ae in me){const Pe=de[Ae]=de[Ae]||[],we=me[Ae];we.sort(((ke,et)=>{const Ze=Ee.featureSortOrder;if(Ze){const Ke=Ze.indexOf(ke.featureIndex);return Ze.indexOf(et.featureIndex)-Ke}return et.featureIndex-ke.featureIndex}));for(const ke of we)Pe.push(ke)}}return(function(Ee,me,Ae){for(const Pe in Ee)for(const we of Ee[Pe])gi(we,Ae[me[Pe].source]);return Ee})(de,N,H)})(this._layers,C,this.tileManagers,r,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(r,h){h?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",h.filter,null,h);const m=this.tileManagers[r];return m?(function(v,S){const C=v.getRenderableIds().map((N=>v.getTileByID(N))),R=[],k={};for(let N=0;N<C.length;N++){const U=C[N],H=U.tileID.canonical.key;k[H]||(k[H]=!0,U.querySourceFeatures(R,S))}return R})(m,h?Object.assign(Object.assign({},h),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const m=this.light.getLight();let v=!1;for(const C in r)if(!o.bR(r[C],m[C])){v=!0;break}if(!v)return;const S={now:le(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(S)}getProjection(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.projection}setProjection(r){if(this._checkLoaded(),this.stylesheet.projection=r,this.projection){if(this.projection.name===r.type)return;this.projection.destroy(),delete this.projection}this._setProjectionInternal(r.type)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,h={}){this._checkLoaded();const m=this.getSky();let v=!1;if(!r&&!m)return;if(r&&!m)v=!0;else if(!r&&m)v=!0;else for(const C in r)if(!o.bR(r[C],m[C])){v=!0;break}if(!v)return;const S={now:le(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,h),this.sky.updateTransitions(S)}_setProjectionInternal(r){const h=(function(m,v){const S={constrainOverride:v};if(Array.isArray(m)){const C=new Lf({type:m});return{projection:C,transform:new Mc(S),cameraHelper:new Pc(C)}}switch(m){case"mercator":return{projection:new ar,transform:new er(S),cameraHelper:new El};case"globe":{const C=new Lf({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:C,transform:new Mc(S),cameraHelper:new Pc(C)}}case"vertical-perspective":return{projection:new kf,transform:new Cc(S),cameraHelper:new Hn};default:return o.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new ar,transform:new er(S),cameraHelper:new El}}})(r,this.map.transformConstrain);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const m in this.tileManagers)this.tileManagers[m].reload()}_validate(r,h,m,v,S={}){return(!S||S.validate!==!1)&&Ic(this,r.call(o.C,o.e({key:h,style:this.serialize(),value:m,styleSpec:o.u},v)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),K().off(Lo,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.tileManagers){const m=this.tileManagers[h];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.tileManagers[r].clearTiles()}_reloadSource(r){this.tileManagers[r].resume(),this.tileManagers[r].reload()}_updateSources(r){for(const h in this.tileManagers)this.tileManagers[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.tileManagers)this._reloadSource(r)}_updatePlacement(r,h,m,v,S=!1){let C=!1,R=!1;const k={};for(const N of this._order){const U=this._layers[N];if(U.type!=="symbol")continue;if(!k[U.source]){const $=this.tileManagers[U.source];k[U.source]=$.getRenderableIds(!0).map((Y=>$.getTileByID(Y))).sort(((Y,te)=>te.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(te.tileID)?-1:1)))}const H=this.crossTileSymbolIndex.addLayer(U,k[U.source],r.center.lng);C=C||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(le(),r.zoom))&&(this.pauseablePlacement=new Sc(r,this.map.terrain,this._order,S,h,m,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(le()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C)for(const N of this._order){const U=this._layers[N];U.type==="symbol"&&this.placement.updateLayerOpacities(U,k[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(le())}_releaseSymbolFadeTiles(){for(const r in this.tileManagers)this.tileManagers[r].releaseSymbolFadeTiles()}getImages(r,h){return o._(this,void 0,void 0,(function*(){const m=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const v=this.tileManagers[h.source];return v&&v.setDependencies(h.tileID.key,h.type,h.icons),m}))}getGlyphs(r,h){return o._(this,void 0,void 0,(function*(){const m=yield this.glyphManager.getGlyphs(h.stacks),v=this.tileManagers[h.source];return v&&v.setDependencies(h.tileID.key,h.type,[""]),m}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(o.C.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}getDashes(r,h){return o._(this,void 0,void 0,(function*(){const m={};for(const[v,S]of Object.entries(h.dashes))m[v]=this.lineAtlas.getDash(S.dasharray,S.round);return m}))}addSprite(r,h,m={},v){this._checkLoaded();const S=[{id:r,url:h}],C=[...lt(this.stylesheet.sprite),...S];this._validate(o.C.sprite,"sprite",C,null,m)||(this.stylesheet.sprite=C,this._loadSprite(S,!0,v))}removeSprite(r){this._checkLoaded();const h=lt(this.stylesheet.sprite);if(h.find((m=>m.id===r))){if(this._spritesImagesIds[r])for(const m of this._spritesImagesIds[r])this.imageManager.removeImage(m),this._changedImages[m]=!0;h.splice(h.findIndex((m=>m.id===r)),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return lt(this.stylesheet.sprite)}setSprite(r,h={},m){this._checkLoaded(),r&&this._validate(o.C.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,m):(this._unloadSprite(),m&&m(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const r in this.tileManagers){const h=this.tileManagers[r];h.setEventedParent(null),h.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const r in this._layers){const h=this._layers[r];h.setEventedParent(null),h.onRemove&&h.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var fp=o.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Su{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,m,v,S,C,R,k,N){this.context=r;let U=this.boundPaintVertexBuffers.length!==v.length;for(let H=0;!U&&H<v.length;H++)this.boundPaintVertexBuffers[H]!==v[H]&&(U=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==m||U||this.boundIndexBuffer!==S||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==N?this.freshBind(h,m,v,S,C,R,k,N):(r.bindVertexArray.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),k&&k.bind(),N&&N.bind())}freshBind(r,h,m,v,S,C,R,k){const N=r.numAttributes,U=this.context,H=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=k,h.enableAttributes(H,r);for(const $ of m)$.enableAttributes(H,r);C&&C.enableAttributes(H,r),R&&R.enableAttributes(H,r),k&&k.enableAttributes(H,r),h.bind(),h.setVertexAttribPointers(H,r,S);for(const $ of m)$.bind(),$.setVertexAttribPointers(H,r,S);C&&(C.bind(),C.setVertexAttribPointers(H,r,S)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(H,r,S)),k&&(k.bind(),k.setVertexAttribPointers(H,r,S)),U.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const dp=(w,r,h,m,v)=>({u_texture:0,u_ele_delta:w,u_fog_matrix:r,u_fog_color:h?h.properties.get("fog-color"):o.bp.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:h?h.calculateFogBlendOpacity(m):0,u_horizon_color:h?h.properties.get("horizon-color"):o.bp.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),ua={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ah(w){const r=[];for(let h=0;h<w.length;h++){if(w[h]===null)continue;const m=w[h].split(" ");r.push(m.pop())}return r}class pp{constructor(r,h,m,v,S,C,R,k,N=[]){const U=r.gl;this.program=U.createProgram();const H=Ah(h.staticAttributes),$=m?m.getBinderAttributes():[],Y=H.concat($),te=vn.prelude.staticUniforms?Ah(vn.prelude.staticUniforms):[],ce=R.staticUniforms?Ah(R.staticUniforms):[],de=h.staticUniforms?Ah(h.staticUniforms):[],fe=m?m.getBinderUniforms():[],ye=te.concat(ce).concat(de).concat(fe),Ee=[];for(const Ze of ye)Ee.indexOf(Ze)<0&&Ee.push(Ze);const me=m?m.defines():[];Ns(U)&&me.unshift("#version 300 es"),S&&me.push("#define OVERDRAW_INSPECTOR;"),C&&me.push("#define TERRAIN3D;"),k&&me.push(k),N&&me.push(...N);let Ae=me.concat(vn.prelude.fragmentSource,R.fragmentSource,h.fragmentSource).join(`
`),Pe=me.concat(vn.prelude.vertexSource,R.vertexSource,h.vertexSource).join(`
`);Ns(U)||(Ae=(function(Ze){return Ze.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ae),Pe=(function(Ze){return Ze.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Pe));const we=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(we,Ae),U.compileShader(we),!U.getShaderParameter(we,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(we)}`);U.attachShader(this.program,we);const ke=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(ke,Pe),U.compileShader(ke),!U.getShaderParameter(ke,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(ke)}`);U.attachShader(this.program,ke),this.attributes={};const et={};this.numAttributes=Y.length;for(let Ze=0;Ze<this.numAttributes;Ze++)Y[Ze]&&(U.bindAttribLocation(this.program,Ze,Y[Ze]),this.attributes[Y[Ze]]=Ze);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(ke),U.deleteShader(we);for(let Ze=0;Ze<Ee.length;Ze++){const Ke=Ee[Ze];if(Ke&&!et[Ke]){const Qe=U.getUniformLocation(this.program,Ke);Qe&&(et[Ke]=Qe)}}this.fixedUniforms=v(r,et),this.terrainUniforms=((Ze,Ke)=>({u_depth:new o.b_(Ze,Ke.u_depth),u_terrain:new o.b_(Ze,Ke.u_terrain),u_terrain_dim:new o.bq(Ze,Ke.u_terrain_dim),u_terrain_matrix:new o.c0(Ze,Ke.u_terrain_matrix),u_terrain_unpack:new o.c1(Ze,Ke.u_terrain_unpack),u_terrain_exaggeration:new o.bq(Ze,Ke.u_terrain_exaggeration)}))(r,et),this.projectionUniforms=((Ze,Ke)=>({u_projection_matrix:new o.c0(Ze,Ke.u_projection_matrix),u_projection_tile_mercator_coords:new o.c1(Ze,Ke.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c1(Ze,Ke.u_projection_clipping_plane),u_projection_transition:new o.bq(Ze,Ke.u_projection_transition),u_projection_fallback_matrix:new o.c0(Ze,Ke.u_projection_fallback_matrix)}))(r,et),this.binderUniforms=m?m.getUniforms(r,et):[]}draw(r,h,m,v,S,C,R,k,N,U,H,$,Y,te,ce,de,fe,ye,Ee){const me=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(m),r.setStencilMode(v),r.setColorMode(S),r.setCullFace(C),k){r.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,k.depthTexture),r.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,k.texture);for(const Pe in this.terrainUniforms)this.terrainUniforms[Pe].set(k[Pe])}if(N)for(const Pe in N)this.projectionUniforms[ua[Pe]].set(N[Pe]);if(R)for(const Pe in this.fixedUniforms)this.fixedUniforms[Pe].set(R[Pe]);de&&de.setUniforms(r,this.binderUniforms,te,{zoom:ce});let Ae=0;switch(h){case me.LINES:Ae=2;break;case me.TRIANGLES:Ae=3;break;case me.LINE_STRIP:Ae=1}for(const Pe of Y.get()){const we=Pe.vaos||(Pe.vaos={});(we[U]||(we[U]=new Su)).bind(r,this,H,de?de.getPaintVertexBuffers():[],$,Pe.vertexOffset,fe,ye,Ee),me.drawElements(h,Pe.primitiveLength*Ae,me.UNSIGNED_SHORT,Pe.primitiveOffset*Ae*2)}}}function gp(w,r,h){const m=1/o.aN(h,1,r.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),S=h.tileSize*Math.pow(2,r.transform.tileZoom)/v,C=S*(h.tileID.canonical.x+h.tileID.wrap*v),R=S*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[m,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[C>>16,R>>16],u_pixel_coord_lower:[65535&C,65535&R]}}const Eh=(w,r,h,m)=>{const v=w.style.light,S=v.properties.get("position"),C=[S.x,S.y,S.z],R=o.c4();v.properties.get("anchor")==="viewport"&&o.c5(R,w.transform.bearingInRadians),o.c6(C,C,R);const k=w.transform.transformLightDirection(C),N=v.properties.get("color");return{u_lightpos:C,u_lightpos_globe:k,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+r,u_opacity:h,u_fill_translate:m}},Ch=(w,r,h,m,v,S,C)=>o.e(Eh(w,r,h,m),gp(S,w,C),{u_height_factor:-Math.pow(2,v.overscaledZ)/C.tileSize/8}),Pl=(w,r,h,m)=>o.e(gp(r,w,h),{u_fill_translate:m}),Dc=(w,r)=>({u_world:w,u_fill_translate:r}),mp=(w,r,h,m,v)=>o.e(Pl(w,r,h,v),{u_world:m}),Au=(w,r,h,m,v)=>{const S=w.transform;let C,R,k=0;if(h.paint.get("circle-pitch-alignment")==="map"){const N=o.aN(r,1,S.zoom);C=!0,R=[N,N],k=N/(o.a5*Math.pow(2,r.tileID.overscaledZ))*2*Math.PI*v}else C=!1,R=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:k,u_translate:m}},Ho=w=>({u_pixel_extrude_scale:[1/w.width,1/w.height]}),zf=w=>({u_viewport_size:[w.width,w.height]}),Eu=(w,r=1)=>({u_color:w,u_overlay:0,u_overlay_scale:r}),Wo=(w,r,h,m)=>{const v=o.aN(w,1,r)/(o.a5*Math.pow(2,w.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:o.aN(w,1,r),u_intensity:h,u_globe_extrude_scale:v}},Ff=(w,r,h,m)=>{const v=o.N();o.c7(v,0,w.width,w.height,0,0,1);const S=w.context.gl;return{u_matrix:v,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:h,u_color_ramp:m,u_opacity:r.paint.get("heatmap-opacity")}},Cu=(w,r,h)=>{const m=h.paint.get("hillshade-accent-color");let v;switch(h.paint.get("hillshade-method")){case"basic":v=4;break;case"combined":v=1;break;case"igor":v=2;break;case"multidirectional":v=3;break;default:v=0}const S=h.getIlluminationProperties();for(let C=0;C<S.directionRadians.length;C++)h.paint.get("hillshade-illumination-anchor")==="viewport"&&(S.directionRadians[C]+=w.transform.bearingInRadians);return{u_image:0,u_latrange:om(0,r.tileID),u_exaggeration:h.paint.get("hillshade-exaggeration"),u_altitudes:S.altitudeRadians,u_azimuths:S.directionRadians,u_accent:m,u_method:v,u_highlights:S.highlightColor,u_shadows:S.shadowColor}},_p=(w,r)=>{const h=r.stride,m=o.N();return o.c7(m,0,o.a5,-o.a5,0,0,1),o.O(m,m,[0,-o.a5,0]),{u_matrix:m,u_image:1,u_dimension:[h,h],u_zoom:w.overscaledZ,u_unpack:r.getUnpackVector()}};function om(w,r){const h=Math.pow(2,r.canonical.z),m=r.canonical.y;return[new o.a9(0,m/h).toLngLat().lat,new o.a9(0,(m+1)/h).toLngLat().lat]}const yp=(w,r,h=0)=>({u_image:0,u_unpack:r.getUnpackVector(),u_dimension:[r.stride,r.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:h,u_opacity:w.paint.get("color-relief-opacity")}),Mu=(w,r,h,m)=>{const v=w.transform;return{u_translation:Pu(w,r,h),u_ratio:m/o.aN(r,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},vp=(w,r,h,m,v)=>o.e(Mu(w,r,h,m),{u_image:0,u_image_height:v}),Nf=(w,r,h,m,v)=>{const S=w.transform,C=Us(r,S);return{u_translation:Pu(w,r,h),u_texsize:r.imageAtlasTexture.size,u_ratio:m/o.aN(r,1,S.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[C,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Jr=(w,r,h,m,v)=>{const S=Us(r,w.transform);return o.e(Mu(w,r,h,m),{u_tileratio:S,u_crossfade_from:v.fromScale,u_crossfade_to:v.toScale,u_image:0,u_mix:v.t,u_lineatlas_width:w.lineAtlas.width,u_lineatlas_height:w.lineAtlas.height})},qo=(w,r,h,m,v,S)=>{const C=Us(r,w.transform);return o.e(Mu(w,r,h,m),{u_image:0,u_image_height:S,u_tileratio:C,u_crossfade_from:v.fromScale,u_crossfade_to:v.toScale,u_image_dash:1,u_mix:v.t,u_lineatlas_width:w.lineAtlas.width,u_lineatlas_height:w.lineAtlas.height})};function Us(w,r){return 1/o.aN(w,1,r.tileZoom)}function Pu(w,r,h){return o.aO(w.transform,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Mh=(w,r,h,m,v)=>{return{u_tl_parent:w,u_scale_parent:r,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(C=m.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(S=m.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Ph(m.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var S,C};function Ph(w){w*=Math.PI/180;const r=Math.sin(w),h=Math.cos(w);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const Iu=(w,r,h,m,v,S,C,R,k,N,U,H,$)=>{const Y=C.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_pitch:Y.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Y.width/Y.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:k,u_is_text:+U,u_pitch_with_map:+m,u_is_along_line:v,u_is_variable_anchor:S,u_texsize:H,u_texture:0,u_translation:N,u_pitched_scale:$}},Ih=(w,r,h,m,v,S,C,R,k,N,U,H,$,Y)=>{const te=C.transform;return o.e(Iu(w,r,h,m,v,S,C,R,k,N,U,H,Y),{u_gamma_scale:m?Math.cos(te.pitch*Math.PI/180)*te.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Vs=(w,r,h,m,v,S,C,R,k,N,U,H,$)=>o.e(Ih(w,r,h,m,v,S,C,R,k,N,!0,U,0,$),{u_texsize_icon:H,u_texture_icon:1}),Ru=(w,r)=>({u_opacity:w,u_color:r}),Du=(w,r,h,m,v)=>o.e((function(S,C,R,k){const N=R.imageManager.getPattern(S.from.toString()),U=R.imageManager.getPattern(S.to.toString()),{width:H,height:$}=R.imageManager.getPixelSize(),Y=Math.pow(2,k.tileID.overscaledZ),te=k.tileSize*Math.pow(2,R.transform.tileZoom)/Y,ce=te*(k.tileID.canonical.x+k.tileID.wrap*Y),de=te*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[H,$],u_mix:C.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/o.aN(k,1,R.transform.tileZoom),u_pixel_coord_upper:[ce>>16,de>>16],u_pixel_coord_lower:[65535&ce,65535&de]}})(h,v,r,m),{u_opacity:w}),Rh=(w,r)=>{},bp={fillExtrusion:(w,r)=>({u_lightpos:new o.c2(w,r.u_lightpos),u_lightpos_globe:new o.c2(w,r.u_lightpos_globe),u_lightintensity:new o.bq(w,r.u_lightintensity),u_lightcolor:new o.c2(w,r.u_lightcolor),u_vertical_gradient:new o.bq(w,r.u_vertical_gradient),u_opacity:new o.bq(w,r.u_opacity),u_fill_translate:new o.c3(w,r.u_fill_translate)}),fillExtrusionPattern:(w,r)=>({u_lightpos:new o.c2(w,r.u_lightpos),u_lightpos_globe:new o.c2(w,r.u_lightpos_globe),u_lightintensity:new o.bq(w,r.u_lightintensity),u_lightcolor:new o.c2(w,r.u_lightcolor),u_vertical_gradient:new o.bq(w,r.u_vertical_gradient),u_height_factor:new o.bq(w,r.u_height_factor),u_opacity:new o.bq(w,r.u_opacity),u_fill_translate:new o.c3(w,r.u_fill_translate),u_image:new o.b_(w,r.u_image),u_texsize:new o.c3(w,r.u_texsize),u_pixel_coord_upper:new o.c3(w,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(w,r.u_pixel_coord_lower),u_scale:new o.c2(w,r.u_scale),u_fade:new o.bq(w,r.u_fade)}),fill:(w,r)=>({u_fill_translate:new o.c3(w,r.u_fill_translate)}),fillPattern:(w,r)=>({u_image:new o.b_(w,r.u_image),u_texsize:new o.c3(w,r.u_texsize),u_pixel_coord_upper:new o.c3(w,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(w,r.u_pixel_coord_lower),u_scale:new o.c2(w,r.u_scale),u_fade:new o.bq(w,r.u_fade),u_fill_translate:new o.c3(w,r.u_fill_translate)}),fillOutline:(w,r)=>({u_world:new o.c3(w,r.u_world),u_fill_translate:new o.c3(w,r.u_fill_translate)}),fillOutlinePattern:(w,r)=>({u_world:new o.c3(w,r.u_world),u_image:new o.b_(w,r.u_image),u_texsize:new o.c3(w,r.u_texsize),u_pixel_coord_upper:new o.c3(w,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(w,r.u_pixel_coord_lower),u_scale:new o.c2(w,r.u_scale),u_fade:new o.bq(w,r.u_fade),u_fill_translate:new o.c3(w,r.u_fill_translate)}),circle:(w,r)=>({u_camera_to_center_distance:new o.bq(w,r.u_camera_to_center_distance),u_scale_with_map:new o.b_(w,r.u_scale_with_map),u_pitch_with_map:new o.b_(w,r.u_pitch_with_map),u_extrude_scale:new o.c3(w,r.u_extrude_scale),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_globe_extrude_scale:new o.bq(w,r.u_globe_extrude_scale),u_translate:new o.c3(w,r.u_translate)}),collisionBox:(w,r)=>({u_pixel_extrude_scale:new o.c3(w,r.u_pixel_extrude_scale)}),collisionCircle:(w,r)=>({u_viewport_size:new o.c3(w,r.u_viewport_size)}),debug:(w,r)=>({u_color:new o.b$(w,r.u_color),u_overlay:new o.b_(w,r.u_overlay),u_overlay_scale:new o.bq(w,r.u_overlay_scale)}),depth:Rh,clippingMask:Rh,heatmap:(w,r)=>({u_extrude_scale:new o.bq(w,r.u_extrude_scale),u_intensity:new o.bq(w,r.u_intensity),u_globe_extrude_scale:new o.bq(w,r.u_globe_extrude_scale)}),heatmapTexture:(w,r)=>({u_matrix:new o.c0(w,r.u_matrix),u_world:new o.c3(w,r.u_world),u_image:new o.b_(w,r.u_image),u_color_ramp:new o.b_(w,r.u_color_ramp),u_opacity:new o.bq(w,r.u_opacity)}),hillshade:(w,r)=>({u_image:new o.b_(w,r.u_image),u_latrange:new o.c3(w,r.u_latrange),u_exaggeration:new o.bq(w,r.u_exaggeration),u_altitudes:new o.c9(w,r.u_altitudes),u_azimuths:new o.c9(w,r.u_azimuths),u_accent:new o.b$(w,r.u_accent),u_method:new o.b_(w,r.u_method),u_shadows:new o.c8(w,r.u_shadows),u_highlights:new o.c8(w,r.u_highlights)}),hillshadePrepare:(w,r)=>({u_matrix:new o.c0(w,r.u_matrix),u_image:new o.b_(w,r.u_image),u_dimension:new o.c3(w,r.u_dimension),u_zoom:new o.bq(w,r.u_zoom),u_unpack:new o.c1(w,r.u_unpack)}),colorRelief:(w,r)=>({u_image:new o.b_(w,r.u_image),u_unpack:new o.c1(w,r.u_unpack),u_dimension:new o.c3(w,r.u_dimension),u_elevation_stops:new o.b_(w,r.u_elevation_stops),u_color_stops:new o.b_(w,r.u_color_stops),u_color_ramp_size:new o.b_(w,r.u_color_ramp_size),u_opacity:new o.bq(w,r.u_opacity)}),line:(w,r)=>({u_translation:new o.c3(w,r.u_translation),u_ratio:new o.bq(w,r.u_ratio),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_units_to_pixels:new o.c3(w,r.u_units_to_pixels)}),lineGradient:(w,r)=>({u_translation:new o.c3(w,r.u_translation),u_ratio:new o.bq(w,r.u_ratio),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_units_to_pixels:new o.c3(w,r.u_units_to_pixels),u_image:new o.b_(w,r.u_image),u_image_height:new o.bq(w,r.u_image_height)}),linePattern:(w,r)=>({u_translation:new o.c3(w,r.u_translation),u_texsize:new o.c3(w,r.u_texsize),u_ratio:new o.bq(w,r.u_ratio),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_image:new o.b_(w,r.u_image),u_units_to_pixels:new o.c3(w,r.u_units_to_pixels),u_scale:new o.c2(w,r.u_scale),u_fade:new o.bq(w,r.u_fade)}),lineSDF:(w,r)=>({u_translation:new o.c3(w,r.u_translation),u_ratio:new o.bq(w,r.u_ratio),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_units_to_pixels:new o.c3(w,r.u_units_to_pixels),u_image:new o.b_(w,r.u_image),u_mix:new o.bq(w,r.u_mix),u_tileratio:new o.bq(w,r.u_tileratio),u_crossfade_from:new o.bq(w,r.u_crossfade_from),u_crossfade_to:new o.bq(w,r.u_crossfade_to),u_lineatlas_width:new o.bq(w,r.u_lineatlas_width),u_lineatlas_height:new o.bq(w,r.u_lineatlas_height)}),lineGradientSDF:(w,r)=>({u_translation:new o.c3(w,r.u_translation),u_ratio:new o.bq(w,r.u_ratio),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_units_to_pixels:new o.c3(w,r.u_units_to_pixels),u_image:new o.b_(w,r.u_image),u_image_height:new o.bq(w,r.u_image_height),u_tileratio:new o.bq(w,r.u_tileratio),u_crossfade_from:new o.bq(w,r.u_crossfade_from),u_crossfade_to:new o.bq(w,r.u_crossfade_to),u_image_dash:new o.b_(w,r.u_image_dash),u_mix:new o.bq(w,r.u_mix),u_lineatlas_width:new o.bq(w,r.u_lineatlas_width),u_lineatlas_height:new o.bq(w,r.u_lineatlas_height)}),raster:(w,r)=>({u_tl_parent:new o.c3(w,r.u_tl_parent),u_scale_parent:new o.bq(w,r.u_scale_parent),u_buffer_scale:new o.bq(w,r.u_buffer_scale),u_fade_t:new o.bq(w,r.u_fade_t),u_opacity:new o.bq(w,r.u_opacity),u_image0:new o.b_(w,r.u_image0),u_image1:new o.b_(w,r.u_image1),u_brightness_low:new o.bq(w,r.u_brightness_low),u_brightness_high:new o.bq(w,r.u_brightness_high),u_saturation_factor:new o.bq(w,r.u_saturation_factor),u_contrast_factor:new o.bq(w,r.u_contrast_factor),u_spin_weights:new o.c2(w,r.u_spin_weights),u_coords_top:new o.c1(w,r.u_coords_top),u_coords_bottom:new o.c1(w,r.u_coords_bottom)}),symbolIcon:(w,r)=>({u_is_size_zoom_constant:new o.b_(w,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(w,r.u_is_size_feature_constant),u_size_t:new o.bq(w,r.u_size_t),u_size:new o.bq(w,r.u_size),u_camera_to_center_distance:new o.bq(w,r.u_camera_to_center_distance),u_pitch:new o.bq(w,r.u_pitch),u_rotate_symbol:new o.b_(w,r.u_rotate_symbol),u_aspect_ratio:new o.bq(w,r.u_aspect_ratio),u_fade_change:new o.bq(w,r.u_fade_change),u_label_plane_matrix:new o.c0(w,r.u_label_plane_matrix),u_coord_matrix:new o.c0(w,r.u_coord_matrix),u_is_text:new o.b_(w,r.u_is_text),u_pitch_with_map:new o.b_(w,r.u_pitch_with_map),u_is_along_line:new o.b_(w,r.u_is_along_line),u_is_variable_anchor:new o.b_(w,r.u_is_variable_anchor),u_texsize:new o.c3(w,r.u_texsize),u_texture:new o.b_(w,r.u_texture),u_translation:new o.c3(w,r.u_translation),u_pitched_scale:new o.bq(w,r.u_pitched_scale)}),symbolSDF:(w,r)=>({u_is_size_zoom_constant:new o.b_(w,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(w,r.u_is_size_feature_constant),u_size_t:new o.bq(w,r.u_size_t),u_size:new o.bq(w,r.u_size),u_camera_to_center_distance:new o.bq(w,r.u_camera_to_center_distance),u_pitch:new o.bq(w,r.u_pitch),u_rotate_symbol:new o.b_(w,r.u_rotate_symbol),u_aspect_ratio:new o.bq(w,r.u_aspect_ratio),u_fade_change:new o.bq(w,r.u_fade_change),u_label_plane_matrix:new o.c0(w,r.u_label_plane_matrix),u_coord_matrix:new o.c0(w,r.u_coord_matrix),u_is_text:new o.b_(w,r.u_is_text),u_pitch_with_map:new o.b_(w,r.u_pitch_with_map),u_is_along_line:new o.b_(w,r.u_is_along_line),u_is_variable_anchor:new o.b_(w,r.u_is_variable_anchor),u_texsize:new o.c3(w,r.u_texsize),u_texture:new o.b_(w,r.u_texture),u_gamma_scale:new o.bq(w,r.u_gamma_scale),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_is_halo:new o.b_(w,r.u_is_halo),u_translation:new o.c3(w,r.u_translation),u_pitched_scale:new o.bq(w,r.u_pitched_scale)}),symbolTextAndIcon:(w,r)=>({u_is_size_zoom_constant:new o.b_(w,r.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(w,r.u_is_size_feature_constant),u_size_t:new o.bq(w,r.u_size_t),u_size:new o.bq(w,r.u_size),u_camera_to_center_distance:new o.bq(w,r.u_camera_to_center_distance),u_pitch:new o.bq(w,r.u_pitch),u_rotate_symbol:new o.b_(w,r.u_rotate_symbol),u_aspect_ratio:new o.bq(w,r.u_aspect_ratio),u_fade_change:new o.bq(w,r.u_fade_change),u_label_plane_matrix:new o.c0(w,r.u_label_plane_matrix),u_coord_matrix:new o.c0(w,r.u_coord_matrix),u_is_text:new o.b_(w,r.u_is_text),u_pitch_with_map:new o.b_(w,r.u_pitch_with_map),u_is_along_line:new o.b_(w,r.u_is_along_line),u_is_variable_anchor:new o.b_(w,r.u_is_variable_anchor),u_texsize:new o.c3(w,r.u_texsize),u_texsize_icon:new o.c3(w,r.u_texsize_icon),u_texture:new o.b_(w,r.u_texture),u_texture_icon:new o.b_(w,r.u_texture_icon),u_gamma_scale:new o.bq(w,r.u_gamma_scale),u_device_pixel_ratio:new o.bq(w,r.u_device_pixel_ratio),u_is_halo:new o.b_(w,r.u_is_halo),u_translation:new o.c3(w,r.u_translation),u_pitched_scale:new o.bq(w,r.u_pitched_scale)}),background:(w,r)=>({u_opacity:new o.bq(w,r.u_opacity),u_color:new o.b$(w,r.u_color)}),backgroundPattern:(w,r)=>({u_opacity:new o.bq(w,r.u_opacity),u_image:new o.b_(w,r.u_image),u_pattern_tl_a:new o.c3(w,r.u_pattern_tl_a),u_pattern_br_a:new o.c3(w,r.u_pattern_br_a),u_pattern_tl_b:new o.c3(w,r.u_pattern_tl_b),u_pattern_br_b:new o.c3(w,r.u_pattern_br_b),u_texsize:new o.c3(w,r.u_texsize),u_mix:new o.bq(w,r.u_mix),u_pattern_size_a:new o.c3(w,r.u_pattern_size_a),u_pattern_size_b:new o.c3(w,r.u_pattern_size_b),u_scale_a:new o.bq(w,r.u_scale_a),u_scale_b:new o.bq(w,r.u_scale_b),u_pixel_coord_upper:new o.c3(w,r.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(w,r.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bq(w,r.u_tile_units_to_pixels)}),terrain:(w,r)=>({u_texture:new o.b_(w,r.u_texture),u_ele_delta:new o.bq(w,r.u_ele_delta),u_fog_matrix:new o.c0(w,r.u_fog_matrix),u_fog_color:new o.b$(w,r.u_fog_color),u_fog_ground_blend:new o.bq(w,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bq(w,r.u_fog_ground_blend_opacity),u_horizon_color:new o.b$(w,r.u_horizon_color),u_horizon_fog_blend:new o.bq(w,r.u_horizon_fog_blend),u_is_globe_mode:new o.bq(w,r.u_is_globe_mode)}),terrainDepth:(w,r)=>({u_ele_delta:new o.bq(w,r.u_ele_delta)}),terrainCoords:(w,r)=>({u_texture:new o.b_(w,r.u_texture),u_terrain_coords_id:new o.bq(w,r.u_terrain_coords_id),u_ele_delta:new o.bq(w,r.u_ele_delta)}),projectionErrorMeasurement:(w,r)=>({u_input:new o.bq(w,r.u_input),u_output_expected:new o.bq(w,r.u_output_expected)}),atmosphere:(w,r)=>({u_sun_pos:new o.c2(w,r.u_sun_pos),u_atmosphere_blend:new o.bq(w,r.u_atmosphere_blend),u_globe_position:new o.c2(w,r.u_globe_position),u_globe_radius:new o.bq(w,r.u_globe_radius),u_inv_proj_matrix:new o.c0(w,r.u_inv_proj_matrix)}),sky:(w,r)=>({u_sky_color:new o.b$(w,r.u_sky_color),u_horizon_color:new o.b$(w,r.u_horizon_color),u_horizon:new o.c3(w,r.u_horizon),u_horizon_normal:new o.c3(w,r.u_horizon_normal),u_sky_horizon_blend:new o.bq(w,r.u_sky_horizon_blend),u_sky_blend:new o.bq(w,r.u_sky_blend)})};class Il{constructor(r,h,m){this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Uf{constructor(r,h,m,v){this.length=h.length,this.attributes=m,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=r;const S=r.gl;this.buffer=S.createBuffer(),r.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let m=0;m<this.attributes.length;m++){const v=h.attributes[this.attributes[m].name];v!==void 0&&r.enableVertexAttribArray(v)}}setVertexAttribPointers(r,h,m){for(let v=0;v<this.attributes.length;v++){const S=this.attributes[v],C=h.attributes[S.name];C!==void 0&&r.vertexAttribPointer(C,S.components,r[Rl[S.type]],!1,this.itemSize,S.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zi{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class La extends zi{getDefault(){return o.bp.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ou extends zi{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ku extends zi{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Dh extends zi{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Dl extends zi{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Lu extends zi{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Oc extends zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class vs extends zi{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Vf extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class Oh extends zi{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class bs extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Ba extends zi{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Hr extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class oo extends zi{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ol extends zi{getDefault(){return o.bp.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class kl extends zi{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Bu extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class Xo extends zi{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class js extends zi{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class jf extends zi{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class kc extends zi{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class pi extends zi{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kh extends zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class xs extends zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Lh extends zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ws extends zi{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class xp extends zi{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Bh extends zi{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const m=this.gl;Ns(m)?m.bindVertexArray(r):(h=m.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Go extends zi{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class $f extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class zh extends zi{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Zo extends zi{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class Lc extends Zo{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Wr extends Zo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Yo extends Zo{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}const Ko="Framebuffer is not complete";class Ll{constructor(r,h,m,v,S){this.context=r,this.width=h,this.height=m;const C=r.gl,R=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Lc(r,R),v)this.depthAttachment=S?new Yo(r,R):new Wr(r,R);else if(S)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Ko)}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const m=this.depthAttachment.get();m&&r.deleteRenderbuffer(m)}r.deleteFramebuffer(this.framebuffer)}}class Qo{constructor(r){var h,m;if(this.gl=r,this.clearColor=new La(this),this.clearDepth=new Ou(this),this.clearStencil=new ku(this),this.colorMask=new Dh(this),this.depthMask=new Dl(this),this.stencilMask=new Lu(this),this.stencilFunc=new Oc(this),this.stencilOp=new vs(this),this.stencilTest=new Vf(this),this.depthRange=new Oh(this),this.depthTest=new bs(this),this.depthFunc=new Ba(this),this.blend=new Hr(this),this.blendFunc=new oo(this),this.blendColor=new Ol(this),this.blendEquation=new kl(this),this.cullFace=new Bu(this),this.cullFaceSide=new Xo(this),this.frontFace=new js(this),this.program=new jf(this),this.activeTexture=new kc(this),this.viewport=new pi(this),this.bindFramebuffer=new kh(this),this.bindRenderbuffer=new xs(this),this.bindTexture=new Lh(this),this.bindVertexBuffer=new ws(this),this.bindElementBuffer=new xp(this),this.bindVertexArray=new Bh(this),this.pixelStoreUnpack=new Go(this),this.pixelStoreUnpackPremultiplyAlpha=new $f(this),this.pixelStoreUnpackFlipY=new zh(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),Ns(r)){this.HALF_FLOAT=r.HALF_FLOAT;const v=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:v?.RGBA16F_EXT,this.RGB16F=(m=r.RGB16F)!==null&&m!==void 0?m:v?.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const v=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new Il(this,r,h)}createVertexBuffer(r,h,m){return new Uf(this,r,h,m)}createRenderbuffer(r,h,m){const v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,r,h,m),this.bindRenderbuffer.set(null),S}createFramebuffer(r,h,m,v){return new Ll(this,r,h,m,v)}clear({color:r,depth:h,stencil:m}){const v=this.gl;let S=0;r&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),m!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bR(r.blendFunction,Gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return Ns(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return Ns(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}let or;function ur(w,r,h,m,v){const S=w.context,C=w.transform,R=S.gl,k=w.useProgram("collisionBox"),N=[];let U=0,H=0;for(let fe=0;fe<m.length;fe++){const ye=m[fe],Ee=r.getTile(ye).getBucket(h);if(!Ee)continue;const me=v?Ee.textCollisionBox:Ee.iconCollisionBox,Ae=Ee.collisionCircleArray;Ae.length>0&&(N.push({circleArray:Ae,circleOffset:H,coord:ye}),U+=Ae.length/4,H=U),me&&k.draw(S,R.LINES,di.disabled,Ri.disabled,w.colorModeForRenderPass(),Ai.disabled,Ho(w.transform),w.style.map.terrain&&w.style.map.terrain.getTerrainData(ye),C.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,w.transform.zoom,null,null,me.collisionVertexBuffer)}if(!v||!N.length)return;const $=w.useProgram("collisionCircle"),Y=new o.ca;Y.resize(4*U),Y._trim();let te=0;for(const fe of N)for(let ye=0;ye<fe.circleArray.length/4;ye++){const Ee=4*ye,me=fe.circleArray[Ee+0],Ae=fe.circleArray[Ee+1],Pe=fe.circleArray[Ee+2],we=fe.circleArray[Ee+3];Y.emplace(te++,me,Ae,Pe,we,0),Y.emplace(te++,me,Ae,Pe,we,1),Y.emplace(te++,me,Ae,Pe,we,2),Y.emplace(te++,me,Ae,Pe,we,3)}(!or||or.length<2*U)&&(or=(function(fe){const ye=2*fe,Ee=new o.cc;Ee.resize(ye),Ee._trim();for(let me=0;me<ye;me++){const Ae=6*me;Ee.uint16[Ae+0]=4*me+0,Ee.uint16[Ae+1]=4*me+1,Ee.uint16[Ae+2]=4*me+2,Ee.uint16[Ae+3]=4*me+2,Ee.uint16[Ae+4]=4*me+3,Ee.uint16[Ae+5]=4*me+0}return Ee})(U));const ce=S.createIndexBuffer(or,!0),de=S.createVertexBuffer(Y,o.cb.members,!0);for(const fe of N){const ye=zf(w.transform);$.draw(S,R.TRIANGLES,di.disabled,Ri.disabled,w.colorModeForRenderPass(),Ai.disabled,ye,w.style.map.terrain&&w.style.map.terrain.getTerrainData(fe.coord),null,h.id,de,ce,o.aX.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,w.transform.zoom,null,null,null)}de.destroy(),ce.destroy()}const za=o.ar(new Float32Array(16));function Fa(w,r,h,m,v,S){const{horizontalAlign:C,verticalAlign:R}=o.aS(w);return new o.P((-(C-.5)*r/v+m[0])*S,(-(R-.5)*h/v+m[1])*S)}function es(w,r,h,m,v,S){const C=r.tileAnchorPoint.add(new o.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let R=m.mult(S);h||(R=R.rotate(-v));const k=C.add(R);return fi(k.x,k.y,r.pitchedLabelPlaneMatrix,r.getElevation).point}if(h){const R=Ii(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(w),k=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return w.add(m.rotate(k))}return w.add(m)}function lo(w,r,h,m,v,S,C,R,k,N,U,H){const $=w.text.placedSymbolArray,Y=w.text.dynamicLayoutVertexArray,te=w.icon.dynamicLayoutVertexArray,ce={};Y.clear();for(let de=0;de<$.length;de++){const fe=$.get(de),ye=fe.hidden||!fe.crossTileID||w.allowVerticalPlacement&&!fe.placedOrientation?null:m[fe.crossTileID];if(ye){const Ee=new o.P(fe.anchorX,fe.anchorY),me={getElevation:H,width:v.width,height:v.height,pitchedLabelPlaneMatrix:S,pitchWithMap:h,transform:v,tileAnchorPoint:Ee,translation:N,unwrappedTileID:U},Ae=h?xc(Ee.x,Ee.y,me):Ii(Ee.x,Ee.y,me),Pe=bl(v.cameraToCenterDistance,Ae.signedDistanceFromCamera);let we=o.aA(w.textSizeData,R,fe)*Pe/o.aM;h&&(we*=w.tilePixelRatio/C);const{width:ke,height:et,anchor:Ze,textOffset:Ke,textBoxScale:Qe}=ye,Rt=Fa(Ze,ke,et,Ke,Qe,we),Ot=v.getPitchedTextCorrection(Ee.x+N[0],Ee.y+N[1],U),_t=es(Ae.point,me,r,Rt,-v.bearingInRadians,Ot),zt=w.allowVerticalPlacement&&fe.placedOrientation===o.az.vertical?Math.PI/2:0;for(let ci=0;ci<fe.numGlyphs;ci++)o.aG(Y,_t,zt);k&&fe.associatedIconIndex>=0&&(ce[fe.associatedIconIndex]={shiftedAnchor:_t,angle:zt})}else Da(fe.numGlyphs,Y)}if(k){te.clear();const de=w.icon.placedSymbolArray;for(let fe=0;fe<de.length;fe++){const ye=de.get(fe);if(ye.hidden)Da(ye.numGlyphs,te);else{const Ee=ce[fe];if(Ee)for(let me=0;me<ye.numGlyphs;me++)o.aG(te,Ee.shiftedAnchor,Ee.angle);else Da(ye.numGlyphs,te)}}w.icon.dynamicLayoutVertexBuffer.updateData(te)}w.text.dynamicLayoutVertexBuffer.updateData(Y)}function Hf(w,r,h){return h.iconsInText&&r?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function Bl(w,r,h,m,v,S,C,R,k,N,U,H,$){const Y=w.context,te=Y.gl,ce=w.transform,de=R==="map",fe=k==="map",ye=R!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ee=de&&!fe&&!ye,me=!h.layout.get("symbol-sort-key").isConstant();let Ae=!1;const Pe=w.getDepthModeForSublayer(0,di.ReadOnly),we=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ke=[],et=ce.getCircleRadiusCorrection();for(const Ze of m){const Ke=r.getTile(Ze),Qe=Ke.getBucket(h);if(!Qe)continue;const Rt=v?Qe.text:Qe.icon;if(!Rt||!Rt.segments.get().length||!Rt.hasVisibleVertices)continue;const Ot=Rt.programConfigurations.get(h.id),_t=v||Qe.sdfIcons,zt=v?Qe.textSizeData:Qe.iconSizeData,ci=fe||ce.pitch!==0,ji=w.useProgram(Hf(_t,v,Qe),Ot),on=o.ay(zt,ce.zoom),tn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ze);let fn,Zi,Pn,dn,fr=[0,0],Nn=null;if(v)Zi=Ke.glyphAtlasTexture,Pn=te.LINEAR,fn=Ke.glyphAtlasTexture.size,Qe.iconsInText&&(fr=Ke.imageAtlasTexture.size,Nn=Ke.imageAtlasTexture,dn=ci||w.options.rotating||w.options.zooming||zt.kind==="composite"||zt.kind==="camera"?te.LINEAR:te.NEAREST);else{const qi=h.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;Zi=Ke.imageAtlasTexture,Pn=_t||w.options.rotating||w.options.zooming||qi||ci?te.LINEAR:te.NEAREST,fn=Ke.imageAtlasTexture.size}const Un=o.aN(Ke,1,w.transform.zoom),dr=ms(de,w.transform,Un),Ka=o.N();o.aB(Ka,dr);const Qa=bh(fe,de,w.transform,Un),_a=o.aO(ce,Ke,S,C),rs=ce.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),Wl=we&&Qe.hasTextData(),Wc=h.layout.get("icon-text-fit")!=="none"&&Wl&&Qe.hasIconData();if(ye){const qi=w.style.map.terrain?(Kn,tr)=>w.style.map.terrain.getElevation(Ze,Kn,tr):null,nn=h.layout.get("text-rotation-alignment")==="map";ro(Qe,w,v,dr,Ka,fe,N,nn,Ze.toUnwrapped(),ce.width,ce.height,_a,qi)}const ya=v&&we||Wc,ss=ye||ya?za:fe?dr:w.transform.clipSpaceToPixelsMatrix,Cs=_t&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gs;Gs=_t?Qe.iconsInText?Vs(zt.kind,on,Ee,fe,ye,ya,w,ss,Qa,_a,fn,fr,et):Ih(zt.kind,on,Ee,fe,ye,ya,w,ss,Qa,_a,v,fn,0,et):Iu(zt.kind,on,Ee,fe,ye,ya,w,ss,Qa,_a,v,fn,et);const Zs={program:ji,buffers:Rt,uniformValues:Gs,projectionData:rs,atlasTexture:Zi,atlasTextureIcon:Nn,atlasInterpolation:Pn,atlasInterpolationIcon:dn,isSDF:_t,hasHalo:Cs};if(me&&Qe.canOverlap){Ae=!0;const qi=Rt.segments.get();for(const nn of qi)ke.push({segments:new o.aX([nn]),sortKey:nn.sortKey,state:Zs,terrainData:tn})}else ke.push({segments:Rt.segments,sortKey:0,state:Zs,terrainData:tn})}Ae&&ke.sort(((Ze,Ke)=>Ze.sortKey-Ke.sortKey));for(const Ze of ke){const Ke=Ze.state;if(Y.activeTexture.set(te.TEXTURE0),Ke.atlasTexture.bind(Ke.atlasInterpolation,te.CLAMP_TO_EDGE),Ke.atlasTextureIcon&&(Y.activeTexture.set(te.TEXTURE1),Ke.atlasTextureIcon&&Ke.atlasTextureIcon.bind(Ke.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Ke.isSDF){const Qe=Ke.uniformValues;Ke.hasHalo&&(Qe.u_is_halo=1,Bc(Ke.buffers,Ze.segments,h,w,Ke.program,Pe,U,H,Qe,Ke.projectionData,Ze.terrainData)),Qe.u_is_halo=0}Bc(Ke.buffers,Ze.segments,h,w,Ke.program,Pe,U,H,Ke.uniformValues,Ke.projectionData,Ze.terrainData)}}function Bc(w,r,h,m,v,S,C,R,k,N,U){const H=m.context;v.draw(H,H.gl.TRIANGLES,S,C,R,Ai.backCCW,k,U,N,h.id,w.layoutVertexBuffer,w.indexBuffer,r,h.paint,m.transform.zoom,w.programConfigurations.get(h.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Wf(w,r,h,m,v){const S=w.context,C=S.gl,R=Ri.disabled,k=new Gi([C.ONE,C.ONE],o.bp.transparent,[!0,!0,!0,!0]),N=r.getBucket(h);if(!N)return;const U=m.key;let H=h.heatmapFbos.get(U);H||(H=en(S,r.tileSize,r.tileSize),h.heatmapFbos.set(U,H)),S.bindFramebuffer.set(H.framebuffer),S.viewport.set([0,0,r.tileSize,r.tileSize]),S.clear({color:o.bp.transparent});const $=N.programConfigurations.get(h.id),Y=w.useProgram("heatmap",$,!v),te=w.transform.getProjectionData({overscaledTileID:r.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=w.style.map.terrain.getTerrainData(m);Y.draw(S,C.TRIANGLES,di.disabled,R,k,Ai.disabled,Wo(r,w.transform.zoom,h.paint.get("heatmap-intensity"),1),ce,te,h.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,h.paint,w.transform.zoom,$)}function hr(w,r,h,m,v){const S=w.context,C=S.gl,R=w.transform;S.setColorMode(w.colorModeForRenderPass());const k=Pi(S,r),N=h.key,U=r.heatmapFbos.get(N);if(!U)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,U.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1),k.bind(C.LINEAR,C.CLAMP_TO_EDGE);const H=R.getProjectionData({overscaledTileID:h,applyTerrainMatrix:v,applyGlobeMatrix:!m});w.useProgram("heatmapTexture").draw(S,C.TRIANGLES,di.disabled,Ri.disabled,w.colorModeForRenderPass(),Ai.disabled,Ff(w,r,0,1),null,H,r.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,r.paint,R.zoom),U.destroy(),r.heatmapFbos.delete(N)}function en(w,r,h){var m,v;const S=w.gl,C=S.createTexture();S.bindTexture(S.TEXTURE_2D,C),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);const R=(m=w.HALF_FLOAT)!==null&&m!==void 0?m:S.UNSIGNED_BYTE,k=(v=w.RGBA16F)!==null&&v!==void 0?v:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,k,r,h,0,S.RGBA,R,null);const N=w.createFramebuffer(r,h,!1,!1);return N.colorAttachment.set(C),N}function Pi(w,r){return r.colorRampTexture||(r.colorRampTexture=new o.T(w,r.colorRamp,w.gl.RGBA)),r.colorRampTexture}function co(w,r,h,m,v,S,C,R){let k=256;if(v.stepInterpolant){const N=r.getSource().maxzoom,U=C.canonical.z===N?Math.ceil(1<<w.transform.maxZoom-C.canonical.z):1;k=o.an(o.ce(S.maxLineLength/o.a5*1024*U),256,h.maxTextureSize)}return R.gradient=o.cf({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:k,image:R.gradient||void 0,clips:S.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new o.T(h,R.gradient,m.RGBA),R.version=v.gradientVersion,R.texture}function Ts(w,r,h,m,v){w.activeTexture.set(r.TEXTURE0),h.imageAtlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),m.updatePaintBuffers(v)}function Cn(w,r,h,m,v,S){(v||w.lineAtlas.dirty)&&(r.activeTexture.set(h.TEXTURE0),w.lineAtlas.bind(r)),m.updatePaintBuffers(S)}function ts(w,r,h,m,v,S,C){const R=S.gradients[v.id];let k=R.texture;v.gradientVersion!==R.version&&(k=co(w,r,h,m,v,S,C,R)),h.activeTexture.set(m.TEXTURE0),k.bind(v.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}function is(w,r,h,m,v,S,C,R,k){const N=S.gradients[v.id];let U=N.texture;v.gradientVersion!==N.version&&(U=co(w,r,h,m,v,S,C,N)),h.activeTexture.set(m.TEXTURE0),U.bind(v.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE),h.activeTexture.set(m.TEXTURE1),w.lineAtlas.bind(h),R.updatePaintBuffers(k)}function zu(w,r,h,m,v){if(!h||!m||!m.imageAtlas)return;const S=m.imageAtlas.patternPositions;let C=S[h.to.toString()],R=S[h.from.toString()];if(!C&&R&&(C=R),!R&&C&&(R=C),!C||!R){const k=v.getPaintProperty(r);C=S[k],R=S[k]}C&&R&&w.setConstantPatternPositions(C,R)}function Na(w,r,h,m,v,S,C,R){const k=w.context.gl,N="fill-pattern",U=h.paint.get(N),H=U&&U.constantOr(1),$=h.getCrossfadeParameters();let Y,te,ce,de,fe;const ye=w.transform,Ee=h.paint.get("fill-translate"),me=h.paint.get("fill-translate-anchor");C?(te=H&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=k.LINES):(te=H?"fillPattern":"fill",Y=k.TRIANGLES);const Ae=U.constantOr(null);for(const Pe of m){const we=r.getTile(Pe);if(H&&!we.patternsLoaded())continue;const ke=we.getBucket(h);if(!ke)continue;const et=ke.programConfigurations.get(h.id),Ze=w.useProgram(te,et),Ke=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Pe);H&&(w.context.activeTexture.set(k.TEXTURE0),we.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),et.updatePaintBuffers($)),zu(et,N,Ae,we,h);const Qe=ye.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Rt=o.aO(ye,we,Ee,me);if(C){de=ke.indexBuffer2,fe=ke.segments2;const _t=[k.drawingBufferWidth,k.drawingBufferHeight];ce=te==="fillOutlinePattern"&&H?mp(w,$,we,_t,Rt):Dc(_t,Rt)}else de=ke.indexBuffer,fe=ke.segments,ce=H?Pl(w,$,we,Rt):{u_fill_translate:Rt};const Ot=w.stencilModeForClipping(Pe);Ze.draw(w.context,Y,v,Ot,S,Ai.backCCW,ce,Ke,Qe,h.id,ke.layoutVertexBuffer,de,fe,h.paint,w.transform.zoom,et)}}function Ua(w,r,h,m,v,S,C,R){const k=w.context,N=k.gl,U="fill-extrusion-pattern",H=h.paint.get(U),$=H.constantOr(1),Y=h.getCrossfadeParameters(),te=h.paint.get("fill-extrusion-opacity"),ce=H.constantOr(null),de=w.transform;for(const fe of m){const ye=r.getTile(fe),Ee=ye.getBucket(h);if(!Ee)continue;const me=w.style.map.terrain&&w.style.map.terrain.getTerrainData(fe),Ae=Ee.programConfigurations.get(h.id),Pe=w.useProgram($?"fillExtrusionPattern":"fillExtrusion",Ae);$&&(w.context.activeTexture.set(N.TEXTURE0),ye.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ae.updatePaintBuffers(Y));const we=de.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!R,applyTerrainMatrix:!0});zu(Ae,U,ce,ye,h);const ke=o.aO(de,ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),et=h.paint.get("fill-extrusion-vertical-gradient"),Ze=$?Ch(w,et,te,ke,fe,Y,ye):Eh(w,et,te,ke);Pe.draw(k,k.gl.TRIANGLES,v,S,C,Ai.backCCW,Ze,me,we,h.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,h.paint,w.transform.zoom,Ae,w.style.map.terrain&&Ee.centroidVertexBuffer)}}function Va(w,r,h,m,v,S,C,R,k){var N;const U=w.style.projection,H=w.context,$=w.transform,Y=H.gl,te=[`#define NUM_ILLUMINATION_SOURCES ${h.paint.get("hillshade-highlight-color").values.length}`],ce=w.useProgram("hillshade",null,!1,te),de=!w.options.moving;for(const fe of m){const ye=r.getTile(fe),Ee=ye.fbo;if(!Ee)continue;const me=U.getMeshFromTileID(H,fe.canonical,R,!0,"raster"),Ae=(N=w.style.map.terrain)===null||N===void 0?void 0:N.getTerrainData(fe);H.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Ee.colorAttachment.get());const Pe=$.getProjectionData({overscaledTileID:fe,aligned:de,applyGlobeMatrix:!k,applyTerrainMatrix:!0});ce.draw(H,Y.TRIANGLES,S,v[fe.overscaledZ],C,Ai.backCCW,Cu(w,ye,h),Ae,Pe,h.id,me.vertexBuffer,me.indexBuffer,me.segments)}}function uo(w,r,h,m,v,S,C,R,k){var N;const U=w.style.projection,H=w.context,$=w.transform,Y=H.gl,te=w.useProgram("colorRelief"),ce=!w.options.moving;let de=!0,fe=0;for(const ye of m){const Ee=r.getTile(ye),me=Ee.dem;if(de){const Ze=Y.getParameter(Y.MAX_TEXTURE_SIZE),{elevationTexture:Ke,colorTexture:Qe}=h.getColorRampTextures(H,Ze,me.getUnpackVector());H.activeTexture.set(Y.TEXTURE1),Ke.bind(Y.NEAREST,Y.CLAMP_TO_EDGE),H.activeTexture.set(Y.TEXTURE4),Qe.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),de=!1,fe=Ke.size[0]}if(!me||!me.data)continue;const Ae=me.stride,Pe=me.getPixels();if(H.activeTexture.set(Y.TEXTURE0),H.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||w.getTileTexture(Ae),Ee.demTexture){const Ze=Ee.demTexture;Ze.update(Pe,{premultiply:!1}),Ze.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}else Ee.demTexture=new o.T(H,Pe,Y.RGBA,{premultiply:!1}),Ee.demTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const we=U.getMeshFromTileID(H,ye.canonical,R,!0,"raster"),ke=(N=w.style.map.terrain)===null||N===void 0?void 0:N.getTerrainData(ye),et=$.getProjectionData({overscaledTileID:ye,aligned:ce,applyGlobeMatrix:!k,applyTerrainMatrix:!0});te.draw(H,Y.TRIANGLES,S,v[ye.overscaledZ],C,Ai.backCCW,yp(h,Ee.dem,fe),ke,et,h.id,we.vertexBuffer,we.indexBuffer,we.segments)}}const ho=[new o.P(0,0),new o.P(o.a5,0),new o.P(o.a5,o.a5),new o.P(0,o.a5)];function $s(w,r,h,m,v,S,C,R,k=!1,N=!1){const U=m[m.length-1].overscaledZ,H=w.context,$=H.gl,Y=w.useProgram("raster"),te=w.transform,ce=w.style.projection,de=w.colorModeForRenderPass(),fe=!w.options.moving,ye=h.paint.get("raster-opacity"),Ee=h.paint.get("raster-resampling"),me=h.paint.get("raster-fade-duration"),Ae=!!w.style.map.terrain;for(const Pe of m){const we=w.getDepthModeForSublayer(Pe.overscaledZ-U,ye===1?di.ReadWrite:di.ReadOnly,$.LESS),ke=r.getTile(Pe),et=Ee==="nearest"?$.NEAREST:$.LINEAR;H.activeTexture.set($.TEXTURE0),ke.texture.bind(et,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),H.activeTexture.set($.TEXTURE1);const{parentTile:Ze,parentScaleBy:Ke,parentTopLeft:Qe,fadeValues:Rt}=ja(ke,r,me,Ae);ke.fadeOpacity=Rt.tileOpacity,Ze?(Ze.fadeOpacity=Rt.parentTileOpacity,Ze.texture.bind(et,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST)):ke.texture.bind(et,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),ke.texture.useMipmap&&H.extTextureFilterAnisotropic&&w.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const Ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Pe),_t=te.getProjectionData({overscaledTileID:Pe,aligned:fe,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),zt=Mh(Qe,Ke,Rt.fadeMix,h,R),ci=ce.getMeshFromTileID(H,Pe.canonical,S,C,"raster");Y.draw(H,$.TRIANGLES,we,v?v[Pe.overscaledZ]:Ri.disabled,de,k?Ai.frontCCW:Ai.backCCW,zt,Ot,_t,h.id,ci.vertexBuffer,ci.indexBuffer,ci.segments)}}function ja(w,r,h,m){const v={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(h===0||m)return v;if(w.fadingParentID){const S=r.getLoadedTile(w.fadingParentID);if(!S)return v;const C=Math.pow(2,S.tileID.overscaledZ-w.tileID.overscaledZ),R=[w.tileID.canonical.x*C%1,w.tileID.canonical.y*C%1],k=(function(N,U,H){const $=le(),Y=($-U.timeAdded)/H,te=N.fadingDirection===ve.Incoming,ce=o.an(($-N.timeAdded)/H,0,1),de=o.an(1-Y,0,1),fe=te?ce:de;return{tileOpacity:fe,parentTileOpacity:te?de:ce,fadeMix:{opacity:1,mix:1-fe}}})(w,S,h);return{parentTile:S,parentScaleBy:C,parentTopLeft:R,fadeValues:k}}if(w.selfFading){const S=(function(C,R){const k=(le()-C.timeAdded)/R,N=o.an(k,0,1);return{tileOpacity:N,fadeMix:{opacity:N,mix:0}}})(w,h);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:S}}return v}const fo=new o.bp(1,0,0,1),$a=new o.bp(0,1,0,1),Fh=new o.bp(0,0,1,1),Nh=new o.bp(1,0,1,1),Ss=new o.bp(0,1,1,1);function zc(w,r,h,m){Yn(w,0,r+h/2,w.transform.width,h,m)}function po(w,r,h,m){Yn(w,r-h/2,0,h,w.transform.height,m)}function Yn(w,r,h,m,v,S){const C=w.context,R=C.gl;R.enable(R.SCISSOR_TEST),R.scissor(r*w.pixelRatio,h*w.pixelRatio,m*w.pixelRatio,v*w.pixelRatio),C.clear({color:S}),R.disable(R.SCISSOR_TEST)}function Fu(w,r,h){const m=w.context,v=m.gl,S=w.useProgram("debug"),C=di.disabled,R=Ri.disabled,k=w.colorModeForRenderPass(),N="$debug",U=w.style.map.terrain&&w.style.map.terrain.getTerrainData(h);m.activeTexture.set(v.TEXTURE0);const H=r.getTileByID(h.key).latestRawTileData,$=Math.floor((H&&H.byteLength||0)/1024),Y=r.getTile(h).tileSize,te=512/Math.min(Y,512)*(h.overscaledZ/w.transform.zoom)*.5;let ce=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ce+=` => ${h.overscaledZ}`),(function(fe,ye){fe.initDebugOverlayCanvas();const Ee=fe.debugOverlayCanvas,me=fe.context.gl,Ae=fe.debugOverlayCanvas.getContext("2d");Ae.clearRect(0,0,Ee.width,Ee.height),Ae.shadowColor="white",Ae.shadowBlur=2,Ae.lineWidth=1.5,Ae.strokeStyle="white",Ae.textBaseline="top",Ae.font="bold 36px Open Sans, sans-serif",Ae.fillText(ye,5,5),Ae.strokeText(ye,5,5),fe.debugOverlayTexture.update(Ee),fe.debugOverlayTexture.bind(me.LINEAR,me.CLAMP_TO_EDGE)})(w,`${ce} ${$}kB`);const de=w.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(m,v.TRIANGLES,C,R,Gi.alphaBlended,Ai.disabled,Eu(o.bp.transparent,te),null,de,N,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),S.draw(m,v.LINE_STRIP,C,R,k,Ai.disabled,Eu(o.bp.red),U,de,N,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function Uh(w,r,h,m){const{isRenderingGlobe:v}=m,S=w.context,C=S.gl,R=w.transform,k=w.colorModeForRenderPass(),N=w.getDepthModeFor3D(),U=w.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,w.width,w.height]);for(const H of h){const $=r.getTerrainMesh(H.tileID),Y=w.renderToTexture.getTexture(H),te=r.getTerrainData(H.tileID);S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,Y.texture);const ce=r.getMeshFrameDelta(R.zoom),de=R.calculateFogMatrix(H.tileID.toUnwrapped()),fe=dp(ce,de,w.style.sky,R.pitch,v),ye=R.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(S,C.TRIANGLES,N,Ri.disabled,k,Ai.backCCW,fe,te,ye,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}function qf(w,r){if(!r.mesh){const h=new o.aW;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const m=new o.aY;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),r.mesh=new Ji(w.createVertexBuffer(h,Fs.members),w.createIndexBuffer(m),o.aX.simpleSegment(0,0,h.length,m.length))}return r.mesh}class wp{constructor(r,h){this.context=new Qo(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Hi.maxOverzooming+Hi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sr}resize(r,h,m){if(this.width=Math.floor(r*m),this.height=Math.floor(h*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const r=this.context,h=new o.aW;h.emplaceBack(0,0),h.emplaceBack(o.a5,0),h.emplaceBack(0,o.a5),h.emplaceBack(o.a5,o.a5),this.tileExtentBuffer=r.createVertexBuffer(h,Fs.members),this.tileExtentSegments=o.aX.simpleSegment(0,0,4,2);const m=new o.aW;m.emplaceBack(0,0),m.emplaceBack(o.a5,0),m.emplaceBack(0,o.a5),m.emplaceBack(o.a5,o.a5),this.debugBuffer=r.createVertexBuffer(m,Fs.members),this.debugSegments=o.aX.simpleSegment(0,0,4,5);const v=new o.ch;v.emplaceBack(0,0,0,0),v.emplaceBack(o.a5,0,o.a5,0),v.emplaceBack(0,o.a5,0,o.a5),v.emplaceBack(o.a5,o.a5,o.a5,o.a5),this.rasterBoundsBuffer=r.createVertexBuffer(v,fp.members),this.rasterBoundsSegments=o.aX.simpleSegment(0,0,4,2);const S=new o.aW;S.emplaceBack(0,0),S.emplaceBack(o.a5,0),S.emplaceBack(0,o.a5),S.emplaceBack(o.a5,o.a5),this.rasterBoundsBufferPosOnly=r.createVertexBuffer(S,Fs.members),this.rasterBoundsSegmentsPosOnly=o.aX.simpleSegment(0,0,4,5);const C=new o.aW;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(C,Fs.members),this.viewportSegments=o.aX.simpleSegment(0,0,4,2);const R=new o.ci;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(R);const k=new o.aY;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(k);const N=this.context.gl;this.stencilClearMode=new Ri({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.tileExtentMesh=new Ji(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=o.N();o.c7(m,0,this.width,this.height,0,0,1),o.Q(m,m,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const v={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(r,h.TRIANGLES,di.disabled,this.stencilClearMode,Gi.disabled,Ai.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h,m){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source,this.nextStencilID+h.length>256&&this.clearStencil();const v=this.context;v.setColorMode(Gi.disabled),v.setDepthMode(di.disabled);const S={};for(const C of h)S[C.key]=this.nextStencilID++;this._renderTileMasks(S,h,m,!0),this._renderTileMasks(S,h,m,!1),this._tileClippingMaskIDs=S}_renderTileMasks(r,h,m,v){const S=this.context,C=S.gl,R=this.style.projection,k=this.transform,N=this.useProgram("clippingMask");for(const U of h){const H=r[U.key],$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),Y=R.getMeshFromTileID(this.context,U.canonical,v,!0,"stencil"),te=k.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!m,applyTerrainMatrix:!0});N.draw(S,C.TRIANGLES,di.disabled,new Ri({func:C.ALWAYS,mask:0},H,255,C.KEEP,C.KEEP,C.REPLACE),Gi.disabled,m?Ai.disabled:Ai.backCCW,null,$,te,"$clipping",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}_renderTilesDepthBuffer(){const r=this.context,h=r.gl,m=this.style.projection,v=this.transform,S=this.useProgram("depth"),C=this.getDepthModeFor3D(),R=_n(v,{tileSize:v.tileSize});for(const k of R){const N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),U=m.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),H=v.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(r,h.TRIANGLES,C,Ri.disabled,Gi.disabled,Ai.backCCW,null,N,H,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new Ri({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new Ri({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(r){const h=this.context.gl,m=r.sort(((C,R)=>R.overscaledZ-C.overscaledZ)),v=m[m.length-1].overscaledZ,S=m[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const C={};for(let R=0;R<S;R++)C[R+v]=new Ri({func:h.GEQUAL,mask:255},R+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[C,m]}return[{[v]:Ri.disabled},m]}stencilConfigForOverlapTwoPass(r){const h=this.context.gl,m=r.sort(((C,R)=>R.overscaledZ-C.overscaledZ)),v=m[m.length-1].overscaledZ,S=m[0].overscaledZ-v+1;if(this.clearStencil(),S>1){const C={},R={};for(let k=0;k<S;k++)C[k+v]=new Ri({func:h.GREATER,mask:255},S+1+k,255,h.KEEP,h.KEEP,h.REPLACE),R[k+v]=new Ri({func:h.GREATER,mask:255},1+k,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*S+1,[C,R,m]}return this.nextStencilID=3,[{[v]:new Ri({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[v]:new Ri({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},m]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Gi([r.CONSTANT_COLOR,r.ONE],new o.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gi.unblended:Gi.alphaBlended}getDepthModeForSublayer(r,h,m){if(!this.opaquePassEnabledForLayer())return di.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new di(m||this.context.gl.LEQUAL,h,[v,v])}getDepthModeFor3D(){return new di(this.context.gl.LEQUAL,di.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){var m,v;this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(le()),this.imageManager.beginFrame();const S=this.style._order,C=this.style.tileManagers,R={},k={},N={},U={isRenderingToTexture:!1,isRenderingGlobe:((m=r.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const $ in C){const Y=C[$];Y.used&&Y.prepare(this.context),R[$]=Y.getVisibleCoordinates(!1),k[$]=R[$].slice().reverse(),N[$]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<S.length;$++)if(this.style._layers[S[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of S){const Y=this.style._layers[$];if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const te=k[Y.source];(Y.type==="custom"||te.length)&&this.renderLayer(this,C[Y.source],Y,te,U)}if((v=this.style.projection)===null||v===void 0||v.updateGPUdependent({context:this.context,useProgram:$=>this.useProgram($)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?o.bp.black:o.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function($,Y){const te=$.context,ce=te.gl,de=((Pe,we,ke)=>{const et=Math.cos(we.rollInRadians),Ze=Math.sin(we.rollInRadians),Ke=yt(we),Qe=we.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Pe.properties.get("sky-color"),u_horizon_color:Pe.properties.get("horizon-color"),u_horizon:[(we.width/2-Ke*Ze)*ke,(we.height/2+Ke*et)*ke],u_horizon_normal:[-Ze,et],u_sky_horizon_blend:Pe.properties.get("sky-horizon-blend")*we.height/2*ke,u_sky_blend:Qe}})(Y,$.style.map.transform,$.pixelRatio),fe=new di(ce.LEQUAL,di.ReadWrite,[0,1]),ye=Ri.disabled,Ee=$.colorModeForRenderPass(),me=$.useProgram("sky"),Ae=qf(te,Y);me.draw(te,ce.TRIANGLES,fe,ye,Ee,Ai.disabled,de,null,void 0,"sky",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)})(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[S[this.currentLayer]],Y=C[$.source],te=R[$.source];this._renderTileClippingMasks($,te,!1),this.renderLayer(this,Y,$,te,U)}this.renderPass="translucent";let H=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const $=this.style._layers[S[this.currentLayer]],Y=C[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($,U))continue;this.opaquePassEnabledForLayer()||H||(H=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const te=($.type==="symbol"?N:k)[$.source];this._renderTileClippingMasks($,R[$.source],!!this.renderToTexture),this.renderLayer(this,Y,$,te,U)}if(U.isRenderingGlobe&&(function($,Y,te){const ce=$.context,de=ce.gl,fe=$.useProgram("atmosphere"),ye=new di(de.LEQUAL,di.ReadOnly,[0,1]),Ee=$.transform,me=(function(Qe,Rt){const Ot=Qe.properties.get("position"),_t=[-Ot.x,-Ot.y,-Ot.z],zt=o.ar(new Float64Array(16));return Qe.properties.get("anchor")==="map"&&(o.bg(zt,zt,Rt.rollInRadians),o.bh(zt,zt,-Rt.pitchInRadians),o.bg(zt,zt,Rt.bearingInRadians),o.bh(zt,zt,Rt.center.lat*Math.PI/180),o.bJ(zt,zt,-Rt.center.lng*Math.PI/180)),o.cg(_t,_t,zt),_t})(te,$.transform),Ae=Ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pe=Y.properties.get("atmosphere-blend")*Ae.projectionTransition;if(Pe===0)return;const we=Ml(Ee.worldSize,Ee.center.lat),ke=Ee.inverseProjectionMatrix,et=new Float64Array(4);et[3]=1,o.aH(et,et,Ee.modelViewProjectionMatrix),et[0]/=et[3],et[1]/=et[3],et[2]/=et[3],et[3]=1,o.aH(et,et,ke),et[0]/=et[3],et[1]/=et[3],et[2]/=et[3],et[3]=1;const Ze=((Qe,Rt,Ot,_t,zt)=>({u_sun_pos:Qe,u_atmosphere_blend:Rt,u_globe_position:Ot,u_globe_radius:_t,u_inv_proj_matrix:zt}))(me,Pe,[et[0],et[1],et[2]],we,ke),Ke=qf(ce,Y);fe.draw(ce,de.TRIANGLES,ye,Ri.disabled,Gi.alphaBlended,Ai.disabled,Ze,null,null,"atmosphere",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const $=(function(Y,te){let ce=null;const de=Object.values(Y._layers).flatMap((me=>me.source&&!me.isHidden(te)?[Y.tileManagers[me.source]]:[])),fe=de.filter((me=>me.getSource().type==="vector")),ye=de.filter((me=>me.getSource().type!=="vector")),Ee=me=>{(!ce||ce.getSource().maxzoom<me.getSource().maxzoom)&&(ce=me)};return fe.forEach((me=>Ee(me))),ce||ye.forEach((me=>Ee(me))),ce})(this.style,this.transform.zoom);$&&(function(Y,te,ce){for(let de=0;de<ce.length;de++)Fu(Y,te,ce[de])})(this,$,$.getVisibleCoordinates())}this.options.showPadding&&(function($){const Y=$.transform.padding;zc($,$.transform.height-(Y.top||0),3,fo),zc($,Y.bottom||0,3,$a),po($,Y.left||0,3,Fh),po($,$.transform.width-(Y.right||0),3,Nh);const te=$.transform.centerPoint;(function(ce,de,fe,ye){Yn(ce,de-1,fe-10,2,20,ye),Yn(ce,de-10,fe-1,20,2,ye)})($,te.x,$.transform.height-te.y,Ss)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let v=this.terrainFacilitator.dirty;v||(v=r?!o.cj(h,m):!o.ck(h,m)),v||(v=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(o.cl(h,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(S,C){const R=S.context,k=R.gl,N=S.transform,U=Gi.unblended,H=new di(k.LEQUAL,di.ReadWrite,[0,1]),$=C.tileManager.getRenderableTiles(),Y=S.useProgram("terrainDepth");R.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),R.clear({color:o.bp.transparent,depth:1});for(const te of $){const ce=C.getTerrainMesh(te.tileID),de=C.getTerrainData(te.tileID),fe=N.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ye={u_ele_delta:C.getMeshFrameDelta(N.zoom)};Y.draw(R,k.TRIANGLES,H,Ri.disabled,U,Ai.backCCW,ye,de,fe,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain),(function(S,C){const R=S.context,k=R.gl,N=S.transform,U=Gi.unblended,H=new di(k.LEQUAL,di.ReadWrite,[0,1]),$=C.getCoordsTexture(),Y=C.tileManager.getRenderableTiles(),te=S.useProgram("terrainCoords");R.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),R.clear({color:o.bp.transparent,depth:1}),C.coordsIndex=[];for(const ce of Y){const de=C.getTerrainMesh(ce.tileID),fe=C.getTerrainData(ce.tileID);R.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,$.texture);const ye={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(N.zoom)},Ee=N.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});te.draw(R,k.TRIANGLES,H,Ri.disabled,U,Ai.backCCW,ye,fe,Ee,"terrain",de.vertexBuffer,de.indexBuffer,de.segments),C.coordsIndex.push(ce.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,S.width,S.height])})(this,this.style.map.terrain))}renderLayer(r,h,m,v,S){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(v||[]).length)&&(this.id=m.id,o.cm(m)?(function(C,R,k,N,U,H){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:$}=H,Y=Ri.disabled,te=C.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ce,de,fe,ye,Ee,me,Ae,Pe,we){const ke=de.transform,et=de.style.map.terrain,Ze=Ee==="map",Ke=me==="map";for(const Qe of ce){const Rt=ye.getTile(Qe),Ot=Rt.getBucket(fe);if(!Ot||!Ot.text||!Ot.text.segments.get().length)continue;const _t=o.ay(Ot.textSizeData,ke.zoom),zt=o.aN(Rt,1,de.transform.zoom),ci=ms(Ze,de.transform,zt),ji=fe.layout.get("icon-text-fit")!=="none"&&Ot.hasIconData();if(_t){const on=Math.pow(2,ke.zoom-Rt.tileID.overscaledZ),tn=et?(fn,Zi)=>et.getElevation(Qe,fn,Zi):null;lo(Ot,Ze,Ke,we,ke,ci,on,_t,ji,o.aO(ke,Rt,Ae,Pe),Qe.toUnwrapped(),tn)}}})(N,C,k,R,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),U),k.paint.get("icon-opacity").constantOr(1)!==0&&Bl(C,R,k,N,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),Y,te,$),k.paint.get("text-opacity").constantOr(1)!==0&&Bl(C,R,k,N,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),Y,te,$),R.map.showCollisionBoxes&&(ur(C,R,k,N,!0),ur(C,R,k,N,!1))})(r,h,m,v,this.style.placement.variableOffsets,S):o.cn(m)?(function(C,R,k,N,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=U,$=k.paint.get("circle-opacity"),Y=k.paint.get("circle-stroke-width"),te=k.paint.get("circle-stroke-opacity"),ce=!k.layout.get("circle-sort-key").isConstant();if($.constantOr(1)===0&&(Y.constantOr(1)===0||te.constantOr(1)===0))return;const de=C.context,fe=de.gl,ye=C.transform,Ee=C.getDepthModeForSublayer(0,di.ReadOnly),me=Ri.disabled,Ae=C.colorModeForRenderPass(),Pe=[],we=ye.getCircleRadiusCorrection();for(let ke=0;ke<N.length;ke++){const et=N[ke],Ze=R.getTile(et),Ke=Ze.getBucket(k);if(!Ke)continue;const Qe=k.paint.get("circle-translate"),Rt=k.paint.get("circle-translate-anchor"),Ot=o.aO(ye,Ze,Qe,Rt),_t=Ke.programConfigurations.get(k.id),zt=C.useProgram("circle",_t),ci=Ke.layoutVertexBuffer,ji=Ke.indexBuffer,on=C.style.map.terrain&&C.style.map.terrain.getTerrainData(et),tn={programConfiguration:_t,program:zt,layoutVertexBuffer:ci,indexBuffer:ji,uniformValues:Au(C,Ze,k,Ot,we),terrainData:on,projectionData:ye.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!H,applyTerrainMatrix:!0})};if(ce){const fn=Ke.segments.get();for(const Zi of fn)Pe.push({segments:new o.aX([Zi]),sortKey:Zi.sortKey,state:tn})}else Pe.push({segments:Ke.segments,sortKey:0,state:tn})}ce&&Pe.sort(((ke,et)=>ke.sortKey-et.sortKey));for(const ke of Pe){const{programConfiguration:et,program:Ze,layoutVertexBuffer:Ke,indexBuffer:Qe,uniformValues:Rt,terrainData:Ot,projectionData:_t}=ke.state;Ze.draw(de,fe.TRIANGLES,Ee,me,Ae,Ai.backCCW,Rt,Ot,_t,k.id,Ke,Qe,ke.segments,k.paint,C.transform.zoom,et)}})(r,h,m,v,S):o.co(m)?(function(C,R,k,N,U){if(k.paint.get("heatmap-opacity")===0)return;const H=C.context,{isRenderingToTexture:$,isRenderingGlobe:Y}=U;if(C.style.map.terrain){for(const te of N){const ce=R.getTile(te);R.hasRenderableParent(te)||(C.renderPass==="offscreen"?Wf(C,ce,k,te,Y):C.renderPass==="translucent"&&hr(C,k,te,$,Y))}H.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?(function(te,ce,de,fe){const ye=te.context,Ee=ye.gl,me=te.transform,Ae=Ri.disabled,Pe=new Gi([Ee.ONE,Ee.ONE],o.bp.transparent,[!0,!0,!0,!0]);(function(we,ke,et){const Ze=we.gl;we.activeTexture.set(Ze.TEXTURE1),we.viewport.set([0,0,ke.width/4,ke.height/4]);let Ke=et.heatmapFbos.get(o.cd);Ke?(Ze.bindTexture(Ze.TEXTURE_2D,Ke.colorAttachment.get()),we.bindFramebuffer.set(Ke.framebuffer)):(Ke=en(we,ke.width/4,ke.height/4),et.heatmapFbos.set(o.cd,Ke))})(ye,te,de),ye.clear({color:o.bp.transparent});for(let we=0;we<fe.length;we++){const ke=fe[we];if(ce.hasRenderableParent(ke))continue;const et=ce.getTile(ke),Ze=et.getBucket(de);if(!Ze)continue;const Ke=Ze.programConfigurations.get(de.id),Qe=te.useProgram("heatmap",Ke),Rt=me.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ot=me.getCircleRadiusCorrection();Qe.draw(ye,Ee.TRIANGLES,di.disabled,Ae,Pe,Ai.backCCW,Wo(et,me.zoom,de.paint.get("heatmap-intensity"),Ot),null,Rt,de.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,de.paint,me.zoom,Ke)}ye.viewport.set([0,0,te.width,te.height])})(C,R,k,N):C.renderPass==="translucent"&&(function(te,ce){const de=te.context,fe=de.gl;de.setColorMode(te.colorModeForRenderPass());const ye=ce.heatmapFbos.get(o.cd);ye&&(de.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_2D,ye.colorAttachment.get()),de.activeTexture.set(fe.TEXTURE1),Pi(de,ce).bind(fe.LINEAR,fe.CLAMP_TO_EDGE),te.useProgram("heatmapTexture").draw(de,fe.TRIANGLES,di.disabled,Ri.disabled,te.colorModeForRenderPass(),Ai.disabled,Ff(te,ce,0,1),null,null,ce.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments,ce.paint,te.transform.zoom))})(C,k)})(r,h,m,v,S):o.cp(m)?(function(C,R,k,N,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=U,$=k.paint.get("line-opacity"),Y=k.paint.get("line-width");if($.constantOr(1)===0||Y.constantOr(1)===0)return;const te=C.getDepthModeForSublayer(0,di.ReadOnly),ce=C.colorModeForRenderPass(),de=k.paint.get("line-dasharray"),fe=de.constantOr(1),ye=k.paint.get("line-pattern"),Ee=ye.constantOr(1),me=k.paint.get("line-gradient"),Ae=k.getCrossfadeParameters();let Pe;Pe=Ee?"linePattern":fe&&me?"lineGradientSDF":fe?"lineSDF":me?"lineGradient":"line";const we=C.context,ke=we.gl,et=C.transform;let Ze=!0;for(const Ke of N){const Qe=R.getTile(Ke);if(Ee&&!Qe.patternsLoaded())continue;const Rt=Qe.getBucket(k);if(!Rt)continue;const Ot=Rt.programConfigurations.get(k.id),_t=C.context.program.get(),zt=C.useProgram(Pe,Ot),ci=Ze||zt.program!==_t,ji=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ke),on=ye.constantOr(null),tn=de&&de.constantOr(null);if(on&&Qe.imageAtlas){const fr=Qe.imageAtlas,Nn=fr.patternPositions[on.to.toString()],Un=fr.patternPositions[on.from.toString()];Nn&&Un&&Ot.setConstantPatternPositions(Nn,Un)}else if(tn){const fr=k.layout.get("line-cap")==="round",Nn=C.lineAtlas.getDash(tn.to,fr),Un=C.lineAtlas.getDash(tn.from,fr);Ot.setConstantDashPositions(Nn,Un)}const fn=et.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),Zi=et.getPixelScale();let Pn;Ee?(Pn=Nf(C,Qe,k,Zi,Ae),Ts(we,ke,Qe,Ot,Ae)):fe&&me?(Pn=qo(C,Qe,k,Zi,Ae,Rt.lineClipsArray.length),is(C,R,we,ke,k,Rt,Ke,Ot,Ae)):fe?(Pn=Jr(C,Qe,k,Zi,Ae),Cn(C,we,ke,Ot,ci,Ae)):me?(Pn=vp(C,Qe,k,Zi,Rt.lineClipsArray.length),ts(C,R,we,ke,k,Rt,Ke)):Pn=Mu(C,Qe,k,Zi);const dn=C.stencilModeForClipping(Ke);zt.draw(we,ke.TRIANGLES,te,dn,ce,Ai.disabled,Pn,ji,fn,k.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,k.paint,C.transform.zoom,Ot,Rt.layoutVertexBuffer2),Ze=!1}})(r,h,m,v,S):o.cq(m)?(function(C,R,k,N,U){const H=k.paint.get("fill-color"),$=k.paint.get("fill-opacity");if($.constantOr(1)===0)return;const{isRenderingToTexture:Y}=U,te=C.colorModeForRenderPass(),ce=k.paint.get("fill-pattern"),de=C.opaquePassEnabledForLayer()&&!ce.constantOr(1)&&H.constantOr(o.bp.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===de){const fe=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?di.ReadWrite:di.ReadOnly);Na(C,R,k,N,fe,te,!1,Y)}if(C.renderPass==="translucent"&&k.paint.get("fill-antialias")){const fe=C.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,di.ReadOnly);Na(C,R,k,N,fe,te,!0,Y)}})(r,h,m,v,S):o.cr(m)?(function(C,R,k,N,U){const H=k.paint.get("fill-extrusion-opacity");if(H===0)return;const{isRenderingToTexture:$}=U;if(C.renderPass==="translucent"){const Y=new di(C.context.gl.LEQUAL,di.ReadWrite,C.depthRangeFor3D);if(H!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))Ua(C,R,k,N,Y,Ri.disabled,Gi.disabled,$),Ua(C,R,k,N,Y,C.stencilModeFor3D(),C.colorModeForRenderPass(),$);else{const te=C.colorModeForRenderPass();Ua(C,R,k,N,Y,Ri.disabled,te,$)}}})(r,h,m,v,S):o.cs(m)?(function(C,R,k,N,U){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=U,$=C.context,Y=C.style.projection.useSubdivision,te=C.getDepthModeForSublayer(0,di.ReadOnly),ce=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(de,fe,ye,Ee,me,Ae,Pe){const we=de.context,ke=we.gl;for(const et of ye){const Ze=fe.getTile(et),Ke=Ze.dem;if(!Ke||!Ke.data||!Ze.needsHillshadePrepare)continue;const Qe=Ke.dim,Rt=Ke.stride,Ot=Ke.getPixels();if(we.activeTexture.set(ke.TEXTURE1),we.pixelStoreUnpackPremultiplyAlpha.set(!1),Ze.demTexture=Ze.demTexture||de.getTileTexture(Rt),Ze.demTexture){const zt=Ze.demTexture;zt.update(Ot,{premultiply:!1}),zt.bind(ke.NEAREST,ke.CLAMP_TO_EDGE)}else Ze.demTexture=new o.T(we,Ot,ke.RGBA,{premultiply:!1}),Ze.demTexture.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);we.activeTexture.set(ke.TEXTURE0);let _t=Ze.fbo;if(!_t){const zt=new o.T(we,{width:Qe,height:Qe,data:null},ke.RGBA);zt.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),_t=Ze.fbo=we.createFramebuffer(Qe,Qe,!0,!1),_t.colorAttachment.set(zt.texture)}we.bindFramebuffer.set(_t.framebuffer),we.viewport.set([0,0,Qe,Qe]),de.useProgram("hillshadePrepare").draw(we,ke.TRIANGLES,me,Ae,Pe,Ai.disabled,_p(Ze.tileID,Ke),null,null,Ee.id,de.rasterBoundsBuffer,de.quadTriangleIndexBuffer,de.rasterBoundsSegments),Ze.needsHillshadePrepare=!1}})(C,R,N,k,te,Ri.disabled,ce),$.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(Y){const[de,fe,ye]=C.stencilConfigForOverlapTwoPass(N);Va(C,R,k,ye,de,te,ce,!1,H),Va(C,R,k,ye,fe,te,ce,!0,H)}else{const[de,fe]=C.getStencilConfigForOverlapAndUpdateStencilID(N);Va(C,R,k,fe,de,te,ce,!1,H)}})(r,h,m,v,S):o.ct(m)?(function(C,R,k,N,U){if(C.renderPass!=="translucent"||!N.length)return;const{isRenderingToTexture:H}=U,$=C.style.projection.useSubdivision,Y=C.getDepthModeForSublayer(0,di.ReadOnly),te=C.colorModeForRenderPass();if($){const[ce,de,fe]=C.stencilConfigForOverlapTwoPass(N);uo(C,R,k,fe,ce,Y,te,!1,H),uo(C,R,k,fe,de,Y,te,!0,H)}else{const[ce,de]=C.getStencilConfigForOverlapAndUpdateStencilID(N);uo(C,R,k,de,ce,Y,te,!1,H)}})(r,h,m,v,S):o.bU(m)?(function(C,R,k,N,U){if(C.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!N.length)return;const{isRenderingToTexture:H}=U,$=R.getSource(),Y=C.style.projection.useSubdivision;if($ instanceof gs)$s(C,R,k,N,null,!1,!1,$.tileCoords,$.flippedWindingOrder,H);else if(Y){const[te,ce,de]=C.stencilConfigForOverlapTwoPass(N);$s(C,R,k,de,te,!1,!0,ho,!1,H),$s(C,R,k,de,ce,!0,!0,ho,!1,H)}else{const[te,ce]=C.getStencilConfigForOverlapAndUpdateStencilID(N);$s(C,R,k,ce,te,!1,!0,ho,!1,H)}})(r,h,m,v,S):o.cu(m)?(function(C,R,k,N,U){const H=k.paint.get("background-color"),$=k.paint.get("background-opacity");if($===0)return;const{isRenderingToTexture:Y}=U,te=C.context,ce=te.gl,de=C.style.projection,fe=C.transform,ye=fe.tileSize,Ee=k.paint.get("background-pattern");if(C.isPatternMissing(Ee))return;const me=!Ee&&H.a===1&&$===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==me)return;const Ae=Ri.disabled,Pe=C.getDepthModeForSublayer(0,me==="opaque"?di.ReadWrite:di.ReadOnly),we=C.colorModeForRenderPass(),ke=C.useProgram(Ee?"backgroundPattern":"background"),et=N||_n(fe,{tileSize:ye,terrain:C.style.map.terrain});Ee&&(te.activeTexture.set(ce.TEXTURE0),C.imageManager.bind(C.context));const Ze=k.getCrossfadeParameters();for(const Ke of et){const Qe=fe.getProjectionData({overscaledTileID:Ke,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),Rt=Ee?Du($,C,Ee,{tileID:Ke,tileSize:ye},Ze):Ru($,H),Ot=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ke),_t=de.getMeshFromTileID(te,Ke.canonical,!1,!0,"raster");ke.draw(te,ce.TRIANGLES,Pe,Ae,we,Ai.backCCW,Rt,Ot,Qe,k.id,_t.vertexBuffer,_t.indexBuffer,_t.segments)}})(r,0,m,v,S):o.cv(m)&&(function(C,R,k,N){const{isRenderingGlobe:U}=N,H=C.context,$=k.implementation,Y=C.style.projection,te=C.transform,ce=te.getProjectionDataForCustomLayer(U),de={farZ:te.farZ,nearZ:te.nearZ,fov:te.fov*Math.PI/180,modelViewProjectionMatrix:te.modelViewProjectionMatrix,projectionMatrix:te.projectionMatrix,shaderData:{variantName:Y.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Y.shaderPreludeCode.vertexSource}`,define:Y.shaderDefine},defaultProjectionData:ce},fe=$.renderingMode?$.renderingMode:"2d";if(C.renderPass==="offscreen"){const ye=$.prerender;ye&&(C.setCustomLayerDefaults(),H.setColorMode(C.colorModeForRenderPass()),ye.call($,H.gl,de),H.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),H.setColorMode(C.colorModeForRenderPass()),H.setStencilMode(Ri.disabled);const ye=fe==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,di.ReadOnly);H.setDepthMode(ye),$.render(H.gl,de),H.setDirty(),C.setBaseState(),H.bindFramebuffer.set(null)}})(r,0,m,S))}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),m=this.imageManager.getPattern(r.to.toString());return!h||!m}useProgram(r,h,m=!1,v=[]){this.cache=this.cache||{};const S=!!this.style.map.terrain,C=this.style.projection,R=m?vn.projectionMercator:C.shaderPreludeCode,k=m?Bn:C.shaderDefine,N=r+(h?h.cacheKey:"")+`/${m?Ur:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(S?"/terrain":"")+(v?`/${v.join("/")}`:"");return this.cache[N]||(this.cache[N]=new pp(this.context,vn[r],h,bp[r],this._showOverdrawInspector,S,R,k,v)),this.cache[N]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var r,h;if(this._tileTextures){for(const m in this._tileTextures){const v=this._tileTextures[m];if(v)for(const S of v)S.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((r=this.tileExtentMesh.vertexBuffer)===null||r===void 0||r.destroy()),this.tileExtentMesh&&((h=this.tileExtentMesh.indexBuffer)===null||h===void 0||h.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const m in this.cache){const v=this.cache[m];v&&v.program&&this.context.gl.deleteProgram(v.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}function Xf(w,r){let h,m=!1,v=null,S=null;const C=()=>{v=null,m&&(w.apply(S,h),v=setTimeout(C,r),m=!1)};return(...R)=>(m=!0,S=this,h=R,v||C(),v)}class Wn{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let m;return h.split("&").map((v=>v.split("="))).forEach((v=>{v[0]===this._hashName&&(m=v)})),(m&&m[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:m,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const m=h.join("/");let v=m;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${m}`);let S=window.location.hash.replace(v,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let C=window.location.href.replace(/(#.+)?$/,S);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=Xf(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){const h=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),C=Math.round(h.lng*S)/S,R=Math.round(h.lat*S)/S,k=this._map.getBearing(),N=this._map.getPitch();let U="";if(U+=r?`/${C}/${R}/${m}`:`${m}/${R}/${C}`,(k||N)&&(U+="/"+Math.round(10*k)/10),N&&(U+=`/${Math.round(N)}`),this._hashName){const H=this._hashName;let $=!1;const Y=window.location.hash.slice(1).split("&").map((te=>{const ce=te.split("=")[0];return ce===H?($=!0,`${ce}=${U}`):te})).filter((te=>te));return $||Y.push(`${H}=${U}`),`#${Y.join("&")}`}return`#${U}`}_isValidHash(r){if(r.length<3||r.some(isNaN))return!1;try{new o.V(+r[2],+r[1])}catch{return!1}const h=+r[0],m=+(r[3]||0),v=+(r[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&m>=-180&&m<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}const Ha={linearity:.3,easing:o.cw(0,0,.3,1)},Fc=o.e({deceleration:2500,maxSpeed:1400},Ha),Ir=o.e({deceleration:20,maxSpeed:1400},Ha),As=o.e({deceleration:1e3,maxSpeed:360},Ha),zl=o.e({deceleration:1e3,maxSpeed:90},Ha),Rr=o.e({deceleration:1e3,maxSpeed:360},Ha);class lm{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:le(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=le();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,h.roll+=S.rollDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const S=Nu(h.pan.mag(),m,o.e({},Fc,r||{})),C=h.pan.mult(S.amount/h.pan.mag()),R=this._map.cameraHelper.handlePanInertia(C,this._map.transform);v.center=R.easingCenter,v.offset=R.easingOffset,Nc(v,S)}if(h.zoom){const S=Nu(h.zoom,m,Ir),C=o.cx(this._map.transform.zoom+S.amount,this._map.getZoomSnap(),S.amount);v.zoom=C,Nc(v,S)}if(h.bearing){const S=Nu(h.bearing,m,As);v.bearing=this._map.transform.bearing+o.an(S.amount,-179,179),Nc(v,S)}if(h.pitch){const S=Nu(h.pitch,m,zl);v.pitch=this._map.transform.pitch+S.amount,Nc(v,S)}if(h.roll){const S=Nu(h.roll,m,Rr);v.roll=this._map.transform.roll+o.an(S.amount,-179,179),Nc(v,S)}if(v.zoom||v.bearing){const S=h.pinchAround===void 0?h.around:h.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),o.e(v,{noMoveStart:!0})}}function Nc(w,r){(!w.duration||w.duration<r.duration)&&(w.duration=r.duration,w.easing=r.easing)}function Nu(w,r,h){const{maxSpeed:m,linearity:v,deceleration:S}=h,C=o.an(w*v/(r/1e3),-m,m),R=Math.abs(C)/(S*v);return{easing:h.easing,duration:1e3*R,amount:C*(R/2)}}class lr extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m,v={}){m=m instanceof MouseEvent?m:new MouseEvent(r,m);const S=ne.mousePos(h.getCanvas(),m),C=h.unproject(S);super(r,o.e({point:S,lngLat:C,originalEvent:m},v)),this._defaultPrevented=!1,this.target=h}}class ha extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m){const v=r==="touchend"?m.changedTouches:m.touches,S=ne.touchPos(h.getCanvasContainer(),v),C=S.map((k=>h.unproject(k))),R=S.reduce(((k,N,U,H)=>k.add(N.div(H.length))),new o.P(0,0));super(r,{points:S,point:R,lngLats:C,lngLat:h.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Vh extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,m){super(r,{originalEvent:m}),this._defaultPrevented=!1}}class jh{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Vh(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new lr(r.type,this._map,r))}mouseup(r){this._map.fire(new lr(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new lr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new lr(r.type,this._map,r))}mouseover(r){this._map.fire(new lr(r.type,this._map,r))}mouseout(r){this._map.fire(new lr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ha(r.type,this._map,r))}touchmove(r){this._map.fire(new ha(r.type,this._map,r))}touchend(r){this._map.fire(new ha(r.type,this._map,r))}touchcancel(r){this._map.fire(new ha(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tp{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new lr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new lr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fa{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.screenPointToLocation(o.P.convert(r),this._map.terrain)}}class Jo{constructor(r,h){this._map=r,this._tr=new fa(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(ne.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const m=h;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=m,this._box||(this._box=ne.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(v.x,m.x),C=Math.max(v.x,m.x),R=Math.min(v.y,m.y),k=Math.max(v.y,m.y);ne.setTransform(this._box,`translate(${S}px,${R}px)`),this._box.style.width=C-S+"px",this._box.style.height=k-R+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const m=this._startPos,v=h;if(this.reset(),ne.suppressClick(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:r})),{cameraAnimation:S=>S.fitScreenCoordinates(m,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ne.remove(this._box),this._box=null),ne.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new o.l(r,{originalEvent:h}))}}function ns(w,r){if(w.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${r.length}`);const h={};for(let m=0;m<w.length;m++)h[w[m].identifier]=r[m];return h}class Nt{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),m.length===this.numTouches&&(this.centroid=(function(v){const S=new o.P(0,0);for(const C of v)S._add(C);return S.div(v.length)})(h),this.touches=ns(m,h)))}touchmove(r,h,m){if(this.aborted||!this.centroid)return;const v=ns(m,h);for(const S in this.touches){const C=v[S];(!C||C.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(r,h,m){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Uu{constructor(r){this.singleTap=new Nt(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,m){this.singleTap.touchstart(r,h,m)}touchmove(r,h,m){this.singleTap.touchmove(r,h,m)}touchend(r,h,m){const v=this.singleTap.touchend(r,h,m);if(v){const S=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(S&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class $h{constructor(r){this._tr=new fa(r),this._zoomIn=new Uu({numTouches:1,numTaps:2}),this._zoomOut=new Uu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,m){this._zoomIn.touchstart(r,h,m),this._zoomOut.touchstart(r,h,m)}touchmove(r,h,m){this._zoomIn.touchmove(r,h,m),this._zoomOut.touchmove(r,h,m)}touchend(r,h,m){const v=this._zoomIn.touchend(r,h,m),S=this._zoomOut.touchend(r,h,m),C=this._tr;return v?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:o.cx(C.zoom+1,R.getZoomSnap()),around:C.unproject(v)},{originalEvent:r})}):S?(this._active=!0,r.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:o.cx(C.zoom-1,R.getZoomSnap()),around:C.unproject(S)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const v=Array.isArray(h)?h[0]:h;return!this._moved&&v.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(m,v))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&ne.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const da=0,Uc=2,Hh={[da]:1,[Uc]:2};class Wa{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=ne.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!(function(h,m){const v=Hh[m];return h.buttons===void 0||(h.buttons&v)!==v})(r,this._eventButton)}isValidEndEvent(r){return ne.mouseButton(r)===this._eventButton}}class Fl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}class Vu{constructor(r=new Wa({checkCorrectEvent:()=>!0}),h=new Fl){this.mouseMoveStateManager=r,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(r,h,m){return r instanceof MouseEvent?h(r):typeof TouchEvent<"u"&&r instanceof TouchEvent?m(r):void 0}startMove(r){this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.startMove(h)),(h=>this.oneFingerTouchMoveStateManager.startMove(h)))}endMove(r){this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.endMove(h)),(h=>this.oneFingerTouchMoveStateManager.endMove(h)))}isValidStartEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidStartEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h)))}isValidMoveEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidMoveEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h)))}isValidEndEvent(r){return this._executeRelevantHandler(r,(h=>this.mouseMoveStateManager.isValidEndEvent(h)),(h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h)))}}const qa=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=r=>{r.preventDefault()}};class Wh{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,h,m){return this._calculateTransform(r,h,m)}touchmove(r,h,m){if(this._active){if(!this._shouldBePrevented(m.length))return r.preventDefault(),this._calculateTransform(r,h,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,h,m){this._calculateTransform(r,h,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,m){m.length>0&&(this._active=!0);const v=ns(m,h),S=new o.P(0,0),C=new o.P(0,0);let R=0;for(const N in v){const U=v[N],H=this._touches[N];H&&(S._add(U),C._add(U.sub(H)),R++,v[N]=U)}if(this._touches=v,this._shouldBePrevented(R)||!C.mag())return;const k=C.div(R);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(R),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,m){if(!this._firstTwoTouches)return;r.preventDefault();const[v,S]=this._firstTwoTouches,C=Xa(m,h,v),R=Xa(m,h,S);if(!C||!R)return;const k=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],k,r)}touchend(r,h,m){if(!this._firstTwoTouches)return;const[v,S]=this._firstTwoTouches,C=Xa(m,h,v),R=Xa(m,h,S);C&&R||(this._active&&ne.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Xa(w,r,h){for(let m=0;m<w.length;m++)if(w[m].identifier===h)return r[m]}function Gf(w,r){return Math.log(w/r)/Math.LN2}class Ga extends ju{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const m=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Gf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gf(this._distance,m),pinchAround:h}}}function qh(w,r){return 180*w.angleWith(r)/Math.PI}class $u extends ju{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,m){const v=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qh(this._vector,v),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,m=qh(r,this._startVector);return Math.abs(m)<h}}function Za(w){return Math.abs(w.y)>Math.abs(w.x)}class go extends ju{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,m){super.touchstart(r,h,m),this._currentTouchCount=m.length}_start(r){this._lastPoints=r,Za(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=r[0].sub(this._lastPoints[0]),S=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,S,m.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,m){if(this._valid!==void 0)return this._valid;const v=r.mag()>=2,S=h.mag()>=2;if(!v&&!S)return;if(!v||!S)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const C=r.y>0==h.y>0;return Za(r)&&Za(h)&&C}}const Ws={panStep:100,bearingStep:15,pitchStep:10};class Wi{constructor(r){this._tr=new fa(r);const h=Ws;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,m=0,v=0,S=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?m=-1:(r.preventDefault(),S=-1);break;case 39:r.shiftKey?m=1:(r.preventDefault(),S=1);break;case 38:r.shiftKey?v=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?v=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:R=>{const k=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Zf,zoom:h?o.cx(k.zoom+h*(r.shiftKey?2:1),R.getZoomSnap()):k.zoom,bearing:k.bearing+m*this._bearingStep,pitch:k.pitch+v*this._pitchStep,offset:[-S*this._panStep,-C*this._panStep],center:k.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zf(w){return w*(2-w)}const mo=4.000244140625,el=1/450;class Hu{constructor(r,h){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=r,this._tr=new fa(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=el}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const m=le(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,h!==0&&h%mo==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ne.mousePos(this._map.getCanvas(),r),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(o.V.convert(m.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=r.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>mo?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&k!==0&&(k=1/k);const N=typeof this._targetZoom!="number"?r.scale:o.aq(this._targetZoom),U=r.applyConstrain(r.getCameraLngLat(),o.at(N*k)).zoom,H=this._map.getZoomSnap();if(this._type==="wheel"&&H>0){const $=o.cx(r.zoom,H);this._targetZoom=o.cx(U,H,U-$)}else this._targetZoom=U;this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?r.zoom:this._targetZoom,m=this._startZoom,v=this._easing;let S,C=!1;if(this._type==="wheel"&&m&&v){const R=le()-this._lastWheelEventTime,k=Math.min((R+5)/200,1),N=v(k);S=o.G.number(m,h,N),k<1?this._frameId||(this._frameId=!0):C=!0}else S=h,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!C,zoomDelta:S-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=o.cz;if(this._prevEase){const m=this._prevEase,v=(le()-m.start)/m.duration,S=m.easing(v+.01)-m.easing(v),C=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-C*C);h=o.cw(C,R,.25,1)}return this._prevEase={start:le(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Xh{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nl{constructor(r){this._tr=new fa(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:o.cx(this._tr.zoom+(r.shiftKey?-1:1),m.getZoomSnap()),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wu{constructor(){this._tap=new Uu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,m){if(!this._swipePoint)if(this._tapTime){const v=h[0],S=r.timeStamp-this._tapTime<500,C=this._tapPoint.dist(v)<30;S&&C?m.length>0&&(this._swipePoint=v,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(r,h,m)}touchmove(r,h,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=h[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,r.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(r,h,m)}touchend(r,h,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const v=this._tap.touchend(r,h,m);v&&(this._tapTime=r.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yf{constructor(r,h,m){this._el=r,this._mousePan=h,this._touchPan=m}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Es{constructor(r,h,m,v){this._pitchWithRotate=r.pitchWithRotate,this._rollEnabled=r.rollEnabled,this._mouseRotate=h,this._mousePitch=m,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ul{constructor(r,h,m,v){this._el=r,this._touchZoom=h,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ut{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=ne.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=h,this._container.appendChild(v);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=m,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ne.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,h){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:r,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Xt=w=>w.zoom||w.drag||w.roll||w.pitch||w.rotate;class qs extends o.l{}function Vc(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta||w.rollDelta}class qu{get _ownerDocument(){var r;return((r=this._el)===null||r===void 0?void 0:r.ownerDocument)||document}get _ownerWindow(){var r,h;return((h=(r=this._el)===null||r===void 0?void 0:r.ownerDocument)===null||h===void 0?void 0:h.defaultView)||window}constructor(r,h){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,S)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=v.type==="renderFrame"?void 0:v,R={needsRenderFrame:!1},k={},N={};for(const{handlerName:$,handler:Y,allowed:te}of this._handlers){if(!Y.isEnabled())continue;let ce;if(this._blockedByActive(N,te,$))Y.reset();else if(Y[S||v.type]){if(o.cA(v,S||v.type)){const de=ne.mousePos(this._map.getCanvas(),v);ce=Y[S||v.type](v,de)}else if(o.cB(v,S||v.type)){const de=this._getMapTouches(v.touches),fe=ne.touchPos(this._map.getCanvas(),de);ce=Y[S||v.type](v,fe,de)}else o.cC(S||v.type)||(ce=Y[S||v.type](v));this.mergeHandlerResult(R,k,ce,$,C),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()}(ce||Y.isActive())&&(N[$]=Y)}const U={};for(const $ in this._previousActiveHandlers)N[$]||(U[$]=C);this._previousActiveHandlers=N,(Object.keys(U).length||Vc(R))&&(this._changes.push([R,k,U]),this._triggerRenderFrame()),(Object.keys(N).length||Vc(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=R;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lm(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[v,S,C]of this._listeners)ne.addEventListener(v,S,v===this._ownerDocument?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,h,m]of this._listeners)ne.removeEventListener(r,h,r===this._ownerDocument?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(r){const h=this._map,m=h.getCanvasContainer();this._add("mapEvent",new jh(h,r));const v=h.boxZoom=new Jo(h,r);this._add("boxZoom",v),r.interactive&&r.boxZoom&&v.enable();const S=h.cooperativeGestures=new Ut(h,r.cooperativeGestures);this._add("cooperativeGestures",S),r.cooperativeGestures&&S.enable();const C=new $h(h),R=new Nl(h);h.doubleClickZoom=new Xh(R,C),this._add("tapZoom",C),this._add("clickZoom",R),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const k=new Wu;this._add("tapDragZoom",k);const N=h.touchPitch=new go(h);this._add("touchPitch",N),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const U=()=>h.project(h.getCenter()),H=(function({enable:me,clickTolerance:Ae,aroundCenter:Pe=!0,minPixelCenterThreshold:we=100,rotateDegreesPerPixelMoved:ke=.8},et){const Ze=new Wa({checkCorrectEvent:Ke=>ne.mouseButton(Ke)===0&&Ke.ctrlKey||ne.mouseButton(Ke)===2&&!Ke.ctrlKey});return new Hs({clickTolerance:Ae,move:(Ke,Qe)=>{const Rt=et();if(Pe&&Math.abs(Rt.y-Ke.y)>we)return{bearingDelta:o.cy(new o.P(Ke.x,Qe.y),Qe,Rt)};let Ot=(Qe.x-Ke.x)*ke;return Pe&&Qe.y<Rt.y&&(Ot=-Ot),{bearingDelta:Ot}},moveStateManager:Ze,enable:me,assignEvents:qa})})(r,U),$=(function({enable:me,clickTolerance:Ae,pitchDegreesPerPixelMoved:Pe=-.5}){const we=new Wa({checkCorrectEvent:ke=>ne.mouseButton(ke)===0&&ke.ctrlKey||ne.mouseButton(ke)===2});return new Hs({clickTolerance:Ae,move:(ke,et)=>({pitchDelta:(et.y-ke.y)*Pe}),moveStateManager:we,enable:me,assignEvents:qa})})(r),Y=(function({enable:me,clickTolerance:Ae,rollDegreesPerPixelMoved:Pe=.3},we){const ke=new Wa({checkCorrectEvent:et=>ne.mouseButton(et)===2&&et.ctrlKey});return new Hs({clickTolerance:Ae,move:(et,Ze)=>{const Ke=we();let Qe=(Ze.x-et.x)*Pe;return Ze.y<Ke.y&&(Qe=-Qe),{rollDelta:Qe}},moveStateManager:ke,enable:me,assignEvents:qa})})(r,U);h.dragRotate=new Es(r,H,$,Y),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",$,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Y,["mousePitch"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const te=(function({enable:me,clickTolerance:Ae}){const Pe=new Wa({checkCorrectEvent:we=>ne.mouseButton(we)===0&&!we.ctrlKey});return new Hs({clickTolerance:Ae,move:(we,ke)=>({around:ke,panDelta:ke.sub(we)}),activateOnStart:!0,moveStateManager:Pe,enable:me,assignEvents:qa})})(r),ce=new Wh(r,h);h.dragPan=new Yf(m,te,ce),this._add("mousePan",te),this._add("touchPan",ce,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const de=new $u,fe=new Ga;h.touchZoomRotate=new Ul(m,fe,de,k),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",fe,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate),this._add("blockableMapEvent",new Tp(h));const ye=h.scrollZoom=new Hu(h,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ye,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const Ee=h.keyboard=new Wi(h);this._add("keyboard",Ee),r.interactive&&r.keyboard&&h.keyboard.enable()}_add(r,h,m){this._handlers.push({handlerName:r,handler:h,allowed:m}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xt(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,m){for(const v in r)if(v!==m&&(!h||h.indexOf(v)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const m of r)this._el.contains(m.target)&&h.push(m);return h}mergeHandlerResult(r,h,m,v,S){if(!m)return;o.e(r,m);const C={handlerName:v,originalEvent:m.originalEvent||S};m.zoomDelta!==void 0&&(h.zoom=C),m.panDelta!==void 0&&(h.drag=C),m.rollDelta!==void 0&&(h.roll=C),m.pitchDelta!==void 0&&(h.pitch=C),m.bearingDelta!==void 0&&(h.rotate=C)}_applyChanges(){const r={},h={},m={};for(const[v,S,C]of this._changes)v.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(r.rollDelta=(r.rollDelta||0)+v.rollDelta),v.around!==void 0&&(r.around=v.around),v.pinchAround!==void 0&&(r.pinchAround=v.pinchAround),v.noInertia&&(r.noInertia=v.noInertia),o.e(h,S),o.e(m,C);this._updateMapTransform(r,h,m),this._changes=[]}_updateMapTransform(r,h,m){const v=this._map,S=v._getTransformForUpdate(),C=v.terrain;if(!(Vc(r)||C&&this._terrainMovement))return this._fireEvents(h,m,!0);v._stop(!0);let{panDelta:R,zoomDelta:k,bearingDelta:N,pitchDelta:U,rollDelta:H,around:$,pinchAround:Y}=r;Y!==void 0&&($=Y),$=$||v.transform.centerPoint,C&&!S.isPointOnMapSurface($)&&($=S.centerPoint);const te={panDelta:R,zoomDelta:k,rollDelta:H,pitchDelta:U,bearingDelta:N,around:$};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface($)&&($=S.centerPoint);const ce=$.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(R?$.sub(R):$);this._handleMapControls({terrain:C,tr:S,deltasForHelper:te,preZoomAroundLoc:ce,combinedEventsInProgress:h,panDelta:R}),v._applyUpdatedTransform(S),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,m,!0)}_handleMapControls({terrain:r,tr:h,deltasForHelper:m,preZoomAroundLoc:v,combinedEventsInProgress:S,panDelta:C}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(m,h),r)return R.useGlobeControls?(this._terrainMovement||!S.drag&&!S.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(m,h,v)):this._terrainMovement||!S.drag&&!S.zoom?void(S.drag&&this._terrainMovement&&C?h.setCenter(h.screenPointToLocation(h.centerPoint.sub(C))):R.handleMapControlsPan(m,h,v)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(m,h,v));R.handleMapControlsPan(m,h,v)}_fireEvents(r,h,m){const v=Xt(this._eventsInProgress),S=Xt(r),C={};for(const H in r){const{originalEvent:$}=r[H];this._eventsInProgress[H]||(C[`${H}start`]=$),this._eventsInProgress[H]=r[H]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(const H in C)this._fireEvent(H,C[H]);S&&this._fireEvent("move",S.originalEvent);for(const H in r){const{originalEvent:$}=r[H];this._fireEvent(H,$)}const R={};let k;for(const H in this._eventsInProgress){const{handlerName:$,originalEvent:Y}=this._eventsInProgress[H];this._handlersById[$].isActive()||(delete this._eventsInProgress[H],k=h[$]||Y,R[`${H}end`]=k)}for(const H in R)this._fireEvent(H,R[H]);const N=Xt(this._eventsInProgress),U=(v||S)&&!N;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const H=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&H.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(H)}if(m&&U){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!H||!H.essential&&J.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:k})),$(this._map.getBearing())&&this._map.resetNorth()):($(H.bearing||this._map.getBearing())&&(H.bearing=0),H.freezeElevation=!0,this._map.easeTo(H,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new o.l(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((r=>{delete this._frameId,this.handleEvent(new qs("renderFrame",{timeStamp:r})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qn extends o.E{constructor(r,h,m){super(),this._renderFrameCallback=()=>{const v=Math.min((le()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=m.bearingSnap,this._zoomSnap=m.zoomSnap,this.cameraHelper=h,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(r,h){r.apply(this.transform,!0),this.transform=r,this.cameraHelper=h}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(r,h){return this.jumpTo({elevation:r},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(r){this._centerClampedToGround=r}panBy(r,h,m){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},h),m)}panTo(r,h,m){return this.easeTo(o.e({center:r},h),m)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,m){return this.easeTo(o.e({zoom:r},h),m)}zoomIn(r,h){return this.zoomTo(o.cx(this.getZoom()+1,this._zoomSnap),r,h),this}zoomOut(r,h){return this.zoomTo(o.cx(this.getZoom()-1,this._zoomSnap),r,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(r,h){return r!=this.transform.fov&&(this.transform.setFov(r),this.fire(new o.l("movestart",h)).fire(new o.l("move",h)).fire(new o.l("moveend",h))),this}getBearing(){return this.transform.bearing}setZoomSnap(r){return this._zoomSnap=r,this}getZoomSnap(){return this._zoomSnap}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,m){return this.easeTo(o.e({bearing:r},h),m)}resetNorth(r,h){return this.rotateTo(0,o.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}getRoll(){return this.transform.roll}setRoll(r,h){return this.jumpTo({roll:r},h),this}cameraForBounds(r,h){r=mn.convert(r).adjustAntiMeridian();const m=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),m,h)}_cameraForBoxAndBearing(r,h,m,v){const S={top:0,bottom:0,right:0,left:0};if(typeof(v=o.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const N=v.padding;v.padding={top:N,bottom:N,right:N,left:N}}const C=o.e(S,v.padding);v.padding=C;const R=this.transform,k=new mn(r,h);return this.cameraHelper.cameraForBoxAndBearing(v,C,k,m,R)}fitBounds(r,h,m){return this._fitInternal(this.cameraForBounds(r,h),h,m)}fitScreenCoordinates(r,h,m,v,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(r)),this.transform.screenPointToLocation(o.P.convert(h)),m,v),v,S)}_fitInternal(r,h,m){return r?(delete(h=o.e(r,h)).padding,h.linear?this.easeTo(h,m):this.flyTo(h,m)):this}jumpTo(r,h){this.stop();const m=this._getTransformForUpdate();let v=!1,S=!1,C=!1;const R=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,r);const k=m.zoom!==R;return"elevation"in r&&m.elevation!==+r.elevation&&m.setElevation(+r.elevation),"bearing"in r&&m.bearing!==+r.bearing&&(v=!0,m.setBearing(+r.bearing)),"pitch"in r&&m.pitch!==+r.pitch&&(S=!0,m.setPitch(+r.pitch)),"roll"in r&&m.roll!==+r.roll&&(C=!0,m.setRoll(+r.roll)),r.padding==null||m.isPaddingEqual(r.padding)||m.setPadding(r.padding),this._applyUpdatedTransform(m),this.fire(new o.l("movestart",h)).fire(new o.l("move",h)),k&&this.fire(new o.l("zoomstart",h)).fire(new o.l("zoom",h)).fire(new o.l("zoomend",h)),v&&this.fire(new o.l("rotatestart",h)).fire(new o.l("rotate",h)).fire(new o.l("rotateend",h)),S&&this.fire(new o.l("pitchstart",h)).fire(new o.l("pitch",h)).fire(new o.l("pitchend",h)),C&&this.fire(new o.l("rollstart",h)).fire(new o.l("roll",h)).fire(new o.l("rollend",h)),this.fire(new o.l("moveend",h))}calculateCameraOptionsFromTo(r,h,m,v=0){const S=o.a9.fromLngLat(r,h),C=o.a9.fromLngLat(m,v),R=C.x-S.x,k=C.y-S.y,N=C.z-S.z,U=Math.hypot(R,k,N);if(U===0)throw new Error("Can't calculate camera options with same From and To");const H=Math.hypot(R,k),$=o.at(this.transform.cameraToCenterDistance/U/this.transform.tileSize),Y=180*Math.atan2(R,-k)/Math.PI;let te=180*Math.acos(H/U)/Math.PI;return te=N<0?90-te:90+te,{center:C.toLngLat(),elevation:v,zoom:$,pitch:te,bearing:Y}}calculateCameraOptionsFromCameraLngLatAltRotation(r,h,m,v,S){const C=this.transform.calculateCenterFromCameraLngLatAlt(r,h,m,v);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:m,pitch:v,roll:S}}easeTo(r,h){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.cz},r)).animate===!1||!r.essential&&J.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),v=this.getBearing(),S=m.pitch,C=m.roll,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,k="pitch"in r?+r.pitch:S,N="roll"in r?this._normalizeBearing(r.roll,C):C,U="padding"in r?r.padding:m.padding,H=o.P.convert(r.offset);let $,Y;r.around&&($=o.V.convert(r.around),Y=m.locationToScreenPoint($));const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ce=this.cameraHelper.handleEaseTo(m,{bearing:R,pitch:k,roll:N,padding:U,around:$,aroundPoint:Y,offsetAsPoint:H,offset:r.offset,zoom:r.zoom,center:r.center});return this._rotating=this._rotating||v!==R,this._pitching=this._pitching||k!==S,this._rolling=this._rolling||N!==C,this._padding=!m.isPaddingEqual(U),this._zooming=this._zooming||ce.isZooming,this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,te),this.terrain&&this._prepareElevation(ce.elevationCenter),this._ease((de=>{ce.easeFunc(de),this.terrain&&!r.freezeElevation&&this._updateElevation(de),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(de=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(h,de)}),r),this}_prepareEase(r,h,m={}){this._moving=!0,h||m.moving||this.fire(new o.l("movestart",r)),this._zooming&&!m.zooming&&this.fire(new o.l("zoomstart",r)),this._rotating&&!m.rotating&&this.fire(new o.l("rotatestart",r)),this._pitching&&!m.pitching&&this.fire(new o.l("pitchstart",r)),this._rolling&&!m.rolling&&this.fire(new o.l("rollstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(m-(h-(m*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,r))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){if(!this.terrain&&r.elevation>=0&&r.pitch<=90)return{};const h=r.getCameraLngLat(),m=r.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(h,r.zoom):0;if(m<v){const S=this.calculateCameraOptionsFromTo(h,v,r.center,r.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(r){const h=[];if(h.push((v=>this._elevateCameraIfInsideTerrain(v))),this.transformCameraUpdate&&h.push((v=>this.transformCameraUpdate(v))),!h.length)return;const m=r.clone();for(const v of h){const S=m.clone(),{center:C,zoom:R,roll:k,pitch:N,bearing:U,elevation:H}=v(S);C&&S.setCenter(C),H!==void 0&&S.setElevation(H),R!==void 0&&S.setZoom(R),k!==void 0&&S.setRoll(k),N!==void 0&&S.setPitch(N),U!==void 0&&S.setBearing(U),m.apply(S,!1)}this.transform.apply(m,!1)}_fireMoveEvents(r){this.fire(new o.l("move",r)),this._zooming&&this.fire(new o.l("zoom",r)),this._rotating&&this.fire(new o.l("rotate",r)),this._pitching&&this.fire(new o.l("pitch",r)),this._rolling&&this.fire(new o.l("roll",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const m=this._zooming,v=this._rotating,S=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new o.l("zoomend",r)),v&&this.fire(new o.l("rotateend",r)),S&&this.fire(new o.l("pitchend",r)),C&&this.fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}flyTo(r,h){if(!r.essential&&J.prefersReducedMotion){const Qe=o.U(r,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Qe,h)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cz},r);const m=this._getTransformForUpdate(),v=m.bearing,S=m.pitch,C=m.roll,R=m.padding,k="bearing"in r?this._normalizeBearing(r.bearing,v):v,N="pitch"in r?+r.pitch:S,U="roll"in r?this._normalizeBearing(r.roll,C):C,H="padding"in r?r.padding:m.padding,$=o.P.convert(r.offset);let Y=m.centerPoint.add($);const te=m.screenPointToLocation(Y),ce=this.cameraHelper.handleFlyTo(m,{bearing:k,pitch:N,roll:U,padding:H,locationAtOffset:te,offsetAsPoint:$,center:r.center,minZoom:r.minZoom,zoom:r.zoom});let de=r.curve;const fe=Math.max(m.width,m.height),ye=fe/ce.scaleOfZoom,Ee=ce.pixelPathLength;typeof ce.scaleOfMinZoom=="number"&&(de=Math.sqrt(fe/ce.scaleOfMinZoom/Ee*2));const me=de*de;function Ae(Qe){const Rt=(ye*ye-fe*fe+(Qe?-1:1)*me*me*Ee*Ee)/(2*(Qe?ye:fe)*me*Ee);return Math.log(Math.sqrt(Rt*Rt+1)-Rt)}function Pe(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function we(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const ke=Ae(!1);let et=function(Qe){return we(ke)/we(ke+de*Qe)},Ze=function(Qe){return fe*((we(ke)*(Pe(Rt=ke+de*Qe)/we(Rt))-Pe(ke))/me)/Ee;var Rt},Ke=(Ae(!0)-ke)/de;if(Math.abs(Ee)<2e-6||!isFinite(Ke)){if(Math.abs(fe-ye)<1e-6)return this.easeTo(r,h);const Qe=ye<fe?-1:1;Ke=Math.abs(Math.log(ye/fe))/de,Ze=()=>0,et=Rt=>Math.exp(Qe*de*Rt)}return r.duration="duration"in r?+r.duration:1e3*Ke/("screenSpeed"in r?+r.screenSpeed/de:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=v!==k,this._pitching=N!==S,this._rolling=U!==C,this._padding=!m.isPaddingEqual(H),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ce.targetCenter),this._ease((Qe=>{const Rt=Qe*Ke,Ot=1/et(Rt),_t=Ze(Rt);this._rotating&&m.setBearing(o.G.number(v,k,Qe)),this._pitching&&m.setPitch(o.G.number(S,N,Qe)),this._rolling&&m.setRoll(o.G.number(C,U,Qe)),this._padding&&(m.interpolatePadding(R,H,Qe),Y=m.centerPoint.add($)),ce.easeFunc(Qe,Ot,_t,Y),this.terrain&&!r.freezeElevation&&this._updateElevation(Qe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)}),(()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(h)}),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,h)}return r||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(r,h,m){m.animate===!1||m.duration===0?(r(1),h()):(this._easeStart=le(),this._easeOptions=m,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=o.W(r,-180,180);const m=Math.abs(r-h);return Math.abs(r-360-h)<m&&(r-=360),Math.abs(r+360-h)<m&&(r+=360),r}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLat(o.V.convert(r),this.transform):null}}const Mn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Fn{constructor(r=Mn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=ne.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ne.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ne.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const m=this._map._getUIString(`AttributionControl.${h}`);r.title=m,r.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map((v=>typeof v!="string"?"":v))):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style.tileManagers;for(const v in h){const S=h[v];if(S.used||S.usedForTerrain){const C=S.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r=r.filter((v=>String(v).trim())),r.sort(((v,S)=>v.length-S.length)),r=r.filter(((v,S)=>{for(let C=S+1;C<r.length;C++)if(r[C].indexOf(v)>=0)return!1;return!0}));const m=r.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,r.length?(this._innerContainer.innerHTML=ne.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Xu{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const m=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=ne.create("div","maplibregl-ctrl");const h=ne.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ne.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class _o{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,m=h?this._queue.concat(h):this._queue;for(const v of m)if(v.id===r)return void(v.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const m of h)if(!m.cancelled&&(m.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ti=o.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Vi extends o.E{constructor(r){super(),this._lastTilesetChange=le(),this.tileManager=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=r._source.tileSize*2**this.deltaZoom,r.usedForTerrain=!0,r.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(r,h){this.tileManager.update(r,h),this._renderableTilesKeys=[];const m={};for(const v of _n(r,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.tileManager._source.calculateTileZoom}))m[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),o.c7(v.terrainRttPosMatrix32f,0,o.a5,o.a5,0,0,1),this._tiles[v.key]=new Me(v,this.tileSize),this._lastTilesetChange=le());for(const v in this._tiles)m[v]||delete this._tiles[v]}freeRtt(r){for(const h in this._tiles){const m=this._tiles[h];(!r||m.tileID.equals(r)||m.tileID.isChildOf(r)||r.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((r=>this.getTileByID(r)))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r,h){return h?this._getTerrainCoordsForTileRanges(r,h):this._getTerrainCoordsForRegularTile(r)}_getTerrainCoordsForRegularTile(r){const h={};for(const m of this._renderableTilesKeys){const v=this._tiles[m].tileID,S=r.clone(),C=o.bk();if(v.canonical.equals(r.canonical))o.c7(C,0,o.a5,o.a5,0,0,1);else if(v.canonical.isChildOf(r.canonical)){const R=v.canonical.z-r.canonical.z,k=v.canonical.x-(v.canonical.x>>R<<R),N=v.canonical.y-(v.canonical.y>>R<<R),U=o.a5>>R;o.c7(C,0,U,U,0,0,1),o.O(C,C,[-k*U,-N*U,0])}else{if(!r.canonical.isChildOf(v.canonical))continue;{const R=r.canonical.z-v.canonical.z,k=r.canonical.x-(r.canonical.x>>R<<R),N=r.canonical.y-(r.canonical.y>>R<<R),U=o.a5>>R;o.c7(C,0,o.a5,o.a5,0,0,1),o.O(C,C,[k*U,N*U,0]),o.Q(C,C,[1/2**R,1/2**R,0])}}S.terrainRttPosMatrix32f=new Float32Array(C),h[m]=S}return h}_getTerrainCoordsForTileRanges(r,h){const m={};for(const v of this._renderableTilesKeys){const S=this._tiles[v].tileID;if(!this._isWithinTileRanges(S,h))continue;const C=r.clone(),R=o.bk();if(S.canonical.z===r.canonical.z){const k=r.canonical.x-S.canonical.x+r.wrap*(1<<r.canonical.z),N=r.canonical.y-S.canonical.y;o.c7(R,0,o.a5,o.a5,0,0,1),o.O(R,R,[k*o.a5,N*o.a5,0])}else if(S.canonical.z>r.canonical.z){const k=S.canonical.z-r.canonical.z,N=S.canonical.x-(S.canonical.x>>k<<k)+r.wrap*(1<<S.canonical.z),U=S.canonical.y-(S.canonical.y>>k<<k),H=r.canonical.x-(S.canonical.x>>k),$=r.canonical.y-(S.canonical.y>>k),Y=o.a5>>k;o.c7(R,0,Y,Y,0,0,1),o.O(R,R,[-N*Y+H*o.a5,-U*Y+$*o.a5,0])}else{const k=r.canonical.z-S.canonical.z,N=r.canonical.x-(r.canonical.x>>k<<k)+r.wrap*(1<<r.canonical.z),U=r.canonical.y-(r.canonical.y>>k<<k),H=(r.canonical.x>>k)-S.canonical.x,$=(r.canonical.y>>k)-S.canonical.y,Y=o.a5<<k;o.c7(R,0,Y,Y,0,0,1),o.O(R,R,[N*o.a5+H*Y,U*o.a5+$*Y,0])}C.terrainRttPosMatrix32f=new Float32Array(R),m[v]=C}return m}getSourceTile(r,h){const m=this.tileManager._source;let v=r.overscaledZ-this.deltaZoom;if(v>m.maxzoom&&(v=m.maxzoom),v<m.minzoom)return;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(v).key);let S=this.findTileInCaches(this._sourceTileCache[r.key]);if(!S?.dem&&h)for(;v>=m.minzoom&&!S?.dem;)S=this.findTileInCaches(r.scaledTo(v--).key);return S}findTileInCaches(r){let h=this.tileManager.getTileByID(r);return h||(h=this.tileManager._outOfViewCache.getByKey(r),h)}anyTilesAfterTime(r=Date.now()){return this._lastTilesetChange>=r}_isWithinTileRanges(r,h){const m=h[r.canonical.z];return!!m&&(r.wrap>m.minWrap||r.wrap<m.maxWrap||r.canonical.x>=m.minTileXWrapped&&r.canonical.x<=m.maxTileXWrapped&&r.canonical.y>=m.minTileY&&r.canonical.y<=m.maxTileY)}}class xi{constructor(r,h,m){this._meshCache={},this.painter=r,this.tileManager=new Vi(h),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,m,v=o.a5){var S;const C=r.normalizeCoordinates(h,m,v);if(!C)return 0;const R=this.getTerrainData(C.tileID),k=(S=R.tile)===null||S===void 0?void 0:S.dem;if(!k)return 0;const N=o.cD([],[C.x/v*o.a5,C.y/v*o.a5],R.u_terrain_matrix),U=[N[0]*k.dim,N[1]*k.dim],H=Math.floor(U[0]),$=Math.floor(U[1]),Y=U[0]-H,te=U[1]-$;return k.get(H,$)*(1-Y)*(1-te)+k.get(H+1,$)*Y*(1-te)+k.get(H,$+1)*(1-Y)*te+k.get(H+1,$+1)*Y*te}getElevationForLngLatZoom(r,h){if(!o.cE(h,r.wrap()))return 0;const{tileID:m,mercatorX:v,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(m,v%o.a5,S%o.a5,o.a5)}getElevationForLngLat(r,h){const m=_n(h,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let v=0;for(const S of m)S.canonical.z>v&&(v=Math.min(S.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(r,v)}getElevation(r,h,m,v=o.a5){return this.getDEMElevation(r,h,m,v)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const v=this.painter.context,S=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(v,S,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(v,new o.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}const h=this.tileManager.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const v=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new o.T(v,h.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),h.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const m=h&&h.toString()+h.tileID.key+r.key;if(m&&!this._demMatrixCache[m]){const v=this.tileManager.getSource().maxzoom;let S=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=v?S=r.canonical.z-v:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=r.canonical.x-(r.canonical.x>>S<<S),R=r.canonical.y-(r.canonical.y>>S<<S),k=o.cF(new Float64Array(16),[1/(o.a5<<S),1/(o.a5<<S),0]);o.O(k,k,[C*o.a5,R*o.a5,0]),this._demMatrixCache[r.key]={matrix:k,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,m=h.width/devicePixelRatio,v=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(h.context,{width:m,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(h.context,{width:m,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(m,v,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,m,v))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,C=0;S<this._coordsTextureSize;S++)for(let R=0;R<this._coordsTextureSize;R++,C+=4)h[C+0]=255&R,h[C+1]=255&S,h[C+2]=R>>8<<4|S>>8,h[C+3]=0;const m=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),v=new o.T(r,m,r.gl.RGBA,{premultiply:!1});return v.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),m=this.painter.context,v=m.gl,S=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(S,R-C-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null);const k=h[0]+(h[2]>>4<<8),N=h[1]+((15&h[2])<<8),U=this.coordsIndex[255-h[3]],H=U&&this.tileManager.getTileByID(U);if(!H)return null;const $=this._coordsTextureSize,Y=(1<<H.tileID.canonical.z)*$;return new o.a9((H.tileID.canonical.x*$+k)/Y+H.tileID.wrap,(H.tileID.canonical.y*$+N)/Y,this.getElevation(H.tileID,k,N,$))}depthAtPoint(r){const h=new Uint8Array(4),m=this.painter.context,v=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),m.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(r){var h;const m=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,v=m&&r.canonical.y===0,S=m&&r.canonical.y===(1<<r.canonical.z)-1,C=`m_${v?"n":""}_${S?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const R=this.painter.context,k=new o.cG,N=new o.aY,U=this.meshSize,H=o.a5/U,$=U*U;for(let we=0;we<=U;we++)for(let ke=0;ke<=U;ke++)k.emplaceBack(ke*H,we*H,0);for(let we=0;we<$;we+=U+1)for(let ke=0;ke<U;ke++)N.emplaceBack(ke+we,U+ke+we+1,U+ke+we+2),N.emplaceBack(ke+we,U+ke+we+2,ke+we+1);const Y=k.length,te=Y+(U+1),ce=(U+1)*U,de=v?o.br:0,fe=v?0:1,ye=S?o.bs:o.a5,Ee=S?0:1;for(let we=0;we<=U;we++)k.emplaceBack(we*H,de,fe);for(let we=0;we<=U;we++)k.emplaceBack(we*H,ye,Ee);for(let we=0;we<U;we++)N.emplaceBack(ce+we,te+we,te+we+1),N.emplaceBack(ce+we,te+we+1,ce+we+1),N.emplaceBack(0+we,Y+we+1,Y+we),N.emplaceBack(0+we,0+we+1,Y+we+1);const me=k.length,Ae=me+2*(U+1);for(const we of[0,1])for(let ke=0;ke<=U;ke++)for(const et of[0,1])k.emplaceBack(we*o.a5,ke*H,et);for(let we=0;we<2*U;we+=2)N.emplaceBack(me+we,me+we+1,me+we+3),N.emplaceBack(me+we,me+we+3,me+we+2),N.emplaceBack(Ae+we,Ae+we+3,Ae+we+1),N.emplaceBack(Ae+we,Ae+we+2,Ae+we+3);const Pe=new Ji(R.createVertexBuffer(k,Ti.members),R.createIndexBuffer(N),o.aX.simpleSegment(0,0,k.length,N.length));return this._meshCache[C]=Pe,Pe}getMeshFrameDelta(r){return 2*Math.PI*o.bE/Math.pow(2,Math.max(r,0))/5}getMinTileElevationForLngLatZoom(r,h){var m;if(!o.cE(h,r.wrap()))return 0;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(m=this.getMinMaxElevation(v).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,m={minElevation:null,maxElevation:null};return h&&h.dem&&(m.minElevation=h.dem.min*this.exaggeration,m.maxElevation=h.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(r,h){const m=o.a9.fromLngLat(r.wrap()),v=(1<<h)*o.a5,S=m.x*v,C=m.y*v,R=Math.floor(S/o.a5),k=Math.floor(C/o.a5);return{tileID:new o.a2(h,0,h,R,k),mercatorX:S,mercatorY:C}}}class wn{constructor(r,h,m){this._context=r,this._size=h,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(m.texture),{id:r,fbo:h,texture:m,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((h=>r.id!==h)),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((r=>!r.inUse))===!1}}const Xs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class pa{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new wn(r.context,30,h.tileManager.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){var m,v;this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=r._order.filter((S=>!r._layers[S].isHidden(h))),this._coordsAscending={};for(const S in r.tileManagers){this._coordsAscending[S]={};const C=r.tileManagers[S].getVisibleCoordinates(),R=r.tileManagers[S].getSource(),k=R instanceof gs?R.terrainTileRanges:null;for(const N of C){const U=this.terrain.tileManager.getTerrainCoords(N,k);for(const H in U)this._coordsAscending[S][H]||(this._coordsAscending[S][H]=[]),this._coordsAscending[S][H].push(U[H])}}this._rttFingerprints={};for(const S of r._order){const C=r._layers[S],R=C.source;if(Xs[C.type]&&!this._rttFingerprints[R]){this._rttFingerprints[R]={};const k=(v=(m=r.tileManagers[R])===null||m===void 0?void 0:m.getState().revision)!==null&&v!==void 0?v:0;for(const N in this._coordsAscending[R])this._rttFingerprints[R][N]=`${this._coordsAscending[R][N].map((U=>U.key)).sort().join()}#${k}`}}for(const S of this._renderableTiles)for(const C in this._rttFingerprints){const R=this._rttFingerprints[C][S.tileID.key];R&&R!==S.rttFingerprint[C]&&(S.rtt=[])}}renderLayer(r,h){if(r.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),v=r.type,S=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Xs[v]&&(this._prevType&&Xs[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(r.id),!C))return!0;if(Xs[this._prevType]||Xs[v]&&C){this._prevType=v;const R=this._stacks.length-1,k=this._stacks[R]||[];for(const N of this._renderableTiles){if(this.pool.isFull()&&(Uh(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(N),N.rtt[R]){const H=this.pool.getObjectForId(N.rtt[R].id);if(H.stamp===N.rtt[R].stamp){this.pool.useObject(H);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),N.rtt[R]={id:U.id,stamp:U.stamp},S.context.bindFramebuffer.set(U.fbo.framebuffer),S.context.clear({color:o.bp.transparent,stencil:0}),S.currentStencilSource=void 0;for(let H=0;H<k.length;H++){const $=S.style._layers[k[H]],Y=$.source?this._coordsAscending[$.source][N.tileID.key]:[N.tileID];S.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),S._renderTileClippingMasks($,Y,!0),S.renderLayer(S,S.style.tileManagers[$.source],$,Y,m),$.source&&(N.rttFingerprint[$.source]=this._rttFingerprints[$.source][N.tileID.key])}}return Uh(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),Xs[v]}return!1}}const Vl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Drag to rotate map, click to reset north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},jl=A,yo={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Mn,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Kf={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class hn{constructor(r,h,m=!1){this.mousedown=S=>{this.startMove(S,ne.mousePos(this.element,S)),ne.addEventListener(window,"mousemove",this.mousemove),ne.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,ne.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHandler.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ne.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),ne.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=ne.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const v=new Vu;this._rotatePitchHandler=new Hs({clickTolerance:3,move:(S,C)=>{const R=h.getBoundingClientRect(),k=new o.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:o.cy(new o.P(S.x,C.y),C,k),pitchDelta:m?-.5*(C.y-S.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=r,ne.addEventListener(h,"mousedown",this.mousedown),ne.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),ne.addEventListener(h,"touchcancel",this.reset)}startMove(r,h){this._rotatePitchHandler.dragStart(r,h),ne.disableDrag()}move(r,h){const m=this.map,{bearingDelta:v,pitchDelta:S}=this._rotatePitchHandler.dragMove(r,h)||{};v&&m.setBearing(m.getBearing()+v),S&&m.setPitch(m.getPitch()+S)}off(){const r=this.element;ne.removeEventListener(r,"mousedown",this.mousedown),ne.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.removeEventListener(window,"touchend",this.touchend),ne.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){ne.enableDrag(),ne.removeEventListener(window,"mousemove",this.mousemove),ne.removeEventListener(window,"mouseup",this.mouseup),ne.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ne.removeEventListener(window,"touchend",this.touchend)}}let ga;function jc(w,r,h,m=!1){if(m||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return w?.wrap();const v=new o.V(w.lng,w.lat);if(w=new o.V(w.lng,w.lat),r){const S=new o.V(w.lng-360,w.lat),C=new o.V(w.lng+360,w.lat),R=h.locationToScreenPoint(w).distSqr(r);h.locationToScreenPoint(S).distSqr(r)<R?w=S:h.locationToScreenPoint(C).distSqr(r)<R&&(w=C)}for(;Math.abs(w.lng-h.center.lng)>180;){const S=h.locationToScreenPoint(w);if(S.x>=0&&S.y>=0&&S.x<=h.width&&S.y<=h.height)break;w.lng>h.center.lng?w.lng-=360:w.lng+=360}return w.lng!==v.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(w))?w:v}const $c={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gu(w,r,h){const m=w.classList;for(const v in $c)m.remove(`maplibregl-${h}-anchor-${v}`);m.add(`maplibregl-${h}-anchor-${r}`)}class Zu extends o.E{constructor(r){if(super(),this._onClick=h=>{this.fire(new o.l("click",{originalEvent:h}))},this._onKeyPress=h=>{const m=h.code,v=h.charCode||h.keyCode;m!=="Space"&&m!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=h=>{const m=h.originalEvent.target,v=this._element;this._popup&&(m===v||v.contains(m))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();(h?.type==="terrain"||h?.type==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=jc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),ne.setTransform(this._element,`${$c[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${v}`),J.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(h&&h.type==="moveend")})).catch((()=>{}))},this._onMove=h=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(r?.opacity,r?.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne.create("div");const h=ne.createNS("http://www.w3.org/2000/svg","svg"),m=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${m}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${m}`);const S=ne.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const C=ne.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const R=ne.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const fe of k){const ye=ne.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",fe.rx),ye.setAttributeNS(null,"ry",fe.ry),R.appendChild(ye)}const N=ne.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const U=ne.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(U);const H=ne.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const $=ne.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild($);const Y=ne.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const te=ne.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ce=ne.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#000000"),ce.setAttributeNS(null,"opacity","0.25"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962");const de=ne.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),te.appendChild(ce),te.appendChild(de),C.appendChild(R),C.appendChild(N),C.appendChild(H),C.appendChild(Y),C.appendChild(te),h.appendChild(C),h.setAttributeNS(null,"height",m*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=o.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(h=>{h.preventDefault()})),this._element.addEventListener("mousedown",(h=>{h.preventDefault()})),Gu(this._element,this._anchor,"marker"),this._element.addEventListener("click",this._onClick),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),r.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ne.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.V.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const v=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,m;const v=(h=this._map)===null||h===void 0?void 0:h.terrain,S=this._map.transform.isLocationOccluded(this._lngLat);if(!v||S){const Y=S?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Y&&(this._element.style.opacity=Y))}if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const C=this._map,R=C.terrain.depthAtPoint(this._pos),k=C.terrain.getElevationForLngLat(this._lngLat,C.transform);if(C.transform.lngLatToCameraDepth(this._lngLat,k)-R<.006)return void(this._element.style.opacity=this._opacity);const N=-this._offset.y/C.transform.pixelsPerMeter,U=Math.sin(C.getPitch()*Math.PI/180)*N,H=C.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),$=C.transform.lngLatToCameraDepth(this._lngLat,k+U)-H>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return(this._opacity===void 0||r===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Yu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let tl=0,vo=!1;const Sr={maxWidth:100,unit:"metric"};function Tn(w,r,h){const m=h&&h.maxWidth||100,v=w._container.clientHeight/2,S=w._container.clientWidth/2,C=w.unproject([S-m/2,v]),R=w.unproject([S+m/2,v]),k=Math.round(w.project(R).x-w.project(C).x),N=Math.min(m,k,w._container.clientWidth),U=C.distanceTo(R);if(h&&h.unit==="imperial"){const H=3.2808*U;H>5280?Ya(r,N,H/5280,w._getUIString("ScaleControl.Miles")):Ya(r,N,H,w._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ya(r,N,U/1852,w._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Ya(r,N,U/1e3,w._getUIString("ScaleControl.Kilometers")):Ya(r,N,U,w._getUIString("ScaleControl.Meters"))}function Ya(w,r,h,m){const v=(function(S){const C=Math.pow(10,`${Math.floor(S)}`.length-1);let R=S/C;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(k){const N=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*N)/N})(R),C*R})(h);w.style.width=r*(v/h)+"px",w.innerHTML=`${v}&nbsp;${m}`}const $l={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},Hl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hc(w){if(w){if(typeof w=="number"){const r=Math.round(Math.abs(w)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,w),"top-left":new o.P(r,r),"top-right":new o.P(-r,r),bottom:new o.P(0,-w),"bottom-left":new o.P(r,-r),"bottom-right":new o.P(-r,-r),left:new o.P(w,0),right:new o.P(-w,0)}}if(w instanceof o.P||Array.isArray(w)){const r=o.P.convert(w);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:o.P.convert(w.center||[0,0]),top:o.P.convert(w.top||[0,0]),"top-left":o.P.convert(w["top-left"]||[0,0]),"top-right":o.P.convert(w["top-right"]||[0,0]),bottom:o.P.convert(w.bottom||[0,0]),"bottom-left":o.P.convert(w["bottom-left"]||[0,0]),"bottom-right":o.P.convert(w["bottom-right"]||[0,0]),left:o.P.convert(w.left||[0,0]),right:o.P.convert(w.right||[0,0])}}return Hc(new o.P(0,0))}const ma=A;g.AJAXError=o.cJ,g.EXTENT=o.a5,g.Event=o.l,g.Evented=o.E,g.LngLat=o.V,g.MercatorCoordinate=o.a9,g.Point=o.P,g.addProtocol=o.cK,g.config=o.c,g.removeProtocol=o.cL,g.AttributionControl=Fn,g.BoxZoomHandler=Jo,g.CanvasSource=io,g.CooperativeGesturesHandler=Ut,g.DoubleClickZoomHandler=Xh,g.DragPanHandler=Yf,g.DragRotateHandler=Es,g.EdgeInsets=_s,g.FullscreenControl=class extends o.E{constructor(w={}){var r;super(),this._onFullscreenChange=()=>{var h;let m=window.document.fullscreenElement||window.document.webkitFullscreenElement;for(;!((h=m?.shadowRoot)===null||h===void 0)&&h.fullscreenElement;)m=m.shadowRoot.fullscreenElement;m===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,this._pseudo=(r=w.pseudo)!==null&&r!==void 0&&r,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ne.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=ne.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ne.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){this._pseudo?this._togglePseudoFullScreen():window.document.exitFullscreen?window.document.exitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._pseudo?this._togglePseudoFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},g.GeoJSONSource=rr,g.GeolocateControl=class extends o.E{constructor(w){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new o.V(r.coords.longitude,r.coords.latitude),m=r.coords.accuracy,v=this._map.getBearing(),S=o.e({bearing:v},this.options.fitBoundsOptions),C=mn.fromLngLat(h,m);this._map.fitBounds(C,S,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new o.V(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=r=>{if(this._map){if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&vo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this._geolocateButton=ne.create("button","maplibregl-ctrl-geolocate",this._container),ne.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zu({element:this._dotElement}),this._circleElement=ne.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(h=>{const m=h?.[0]instanceof ResizeObserverEntry;h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Yu,w)}onAdd(w){return this._map=w,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(r=!1){if(ga!==void 0&&!r)return ga;if(window.navigator.permissions===void 0)return ga=!!window.navigator.geolocation,ga;try{ga=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ga=!!window.navigator.geolocation}return ga}))})().then((r=>this._finishSetupUI(r))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ne.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,tl=0,vo=!1}_isOutOfMapMaxBounds(w){const r=this._map.getMaxBounds(),h=w.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const w=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&w))return;const r=this._map.project(w),h=this._map.unproject([r.x+100,r.y]),m=w.distanceTo(h)/100,v=2*this._accuracy/m;this._circleElement.style.width=`${v.toFixed(2)}px`,this._circleElement.style.height=`${v.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tl--,vo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),tl++,tl>1?(w={maximumAge:6e5,timeout:0},vo=!0):(w=this.options.positionOptions,vo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},g.GlobeControl=class{constructor(){this._toggleProjection=()=>{var w;const r=(w=this._map.getProjection())===null||w===void 0?void 0:w.type;this._map.setProjection(r!=="mercator"&&r?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var w;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((w=this._map.getProjection())===null||w===void 0?void 0:w.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(w){return this._map=w,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ne.create("button","maplibregl-ctrl-globe",this._container),ne.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._map.on("projectiontransition",this._updateGlobeIcon),this._container}onRemove(){ne.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._map.off("projectiontransition",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},g.Hash=Wn,g.ImageSource=gs,g.KeyboardHandler=Wi,g.LngLatBounds=mn,g.LogoControl=Xu,g.Map=class extends qn{get _ownerWindow(){var w,r;return((r=(w=this._container)===null||w===void 0?void 0:w.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window}constructor(w){var r,h;o.cH.mark(o.cI.create);const m=Object.assign(Object.assign(Object.assign({},yo),w),{canvasContextAttributes:Object.assign(Object.assign({},yo.canvasContextAttributes),w.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const v=new er,S=new El;m.minZoom!==void 0&&v.setMinZoom(m.minZoom),m.maxZoom!==void 0&&v.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&v.setMinPitch(m.minPitch),m.maxPitch!==void 0&&v.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&v.setRenderWorldCopies(m.renderWorldCopies),m.transformConstrain!==null&&v.setConstrainOverride(m.transformConstrain),super(v,S,{bearingSnap:m.bearingSnap,zoomSnap:m.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new _o,this._controls=[],this._mapId=o.af(),this._lostContextStyle={style:null,images:null},this._contextLost=R=>{if(R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy(),this._lostContextStyle=this._getStyleAndImages(),this.style){for(const k of Object.values(this.style._layers))if(k.type==="custom"&&console.warn(`Custom layer with id '${k.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),k._listeners)for(const[N]of Object.entries(k._listeners))console.warn(`Custom layer with id '${k.id}' had event listeners for event '${N}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:R}))}else this.fire(new o.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new o.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._zoomSnap=m.zoomSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Vl),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this._zoomLevelsToOverscale=m.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=m.transformCameraUpdate,this.transformConstrain=m.transformConstrain,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,m.reduceMotion!==void 0&&(J.prefersReducedMotion=m.reduceMotion),this._imageQueueHandle=wt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ft(m.transformRequest),this._container=this._resolveContainer(m.container),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new qu(this,m),this._hash=m.hash&&new Wn(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.e({},m.fitBoundsOptions,{duration:0}))));const C=typeof m.style=="string"||((h=(r=m.style)===null||r===void 0?void 0:r.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Fn(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new Xu,m.logoPosition),this.on("style.load",(()=>{if(C||this._resizeTransform(),this.transform.unmodified){const R=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new o.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new o.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new o.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(w,r){return this.style.setGlobalStateProperty(w,r),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(w,r){if(r===void 0&&(r=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=w.onAdd(this);this._controls.push(w);const m=this._controlPositions[r];return r.indexOf("bottom")!==-1?m.insertBefore(h,m.firstChild):m.appendChild(h),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(w);return r>-1&&this._controls.splice(r,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}coveringTiles(w){return _n(this.transform,w)}calculateCameraOptionsFromTo(w,r,h,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLat(h,this.transform)),super.calculateCameraOptionsFromTo(w,r,h,m)}resize(w,r=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(r);const h=!this._moving;return h&&(this.stop(),this.fire(new o.l("movestart",w)).fire(new o.l("move",w))),this.fire(new o.l("resize",w)),h&&this.fire(new o.l("moveend",w)),this}_resizeInternal(w=!0){const[r,h]=this._containerDimensions(),m=this._getClampedPixelRatio(r,h);if(this._resizeCanvas(r,h,m),this.painter.resize(r,h,m),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const S=this._getClampedPixelRatio(r,h);this._resizeCanvas(r,h,S),this.painter.resize(r,h,S)}this._resizeTransform(w)}_resizeTransform(w=!0){var r;const[h,m]=this._containerDimensions();this.transform.resize(h,m,w),(r=this._requestedCameraState)===null||r===void 0||r.resize(h,m,w)}_getClampedPixelRatio(w,r){const{0:h,1:m}=this._maxCanvasSize,v=this.getPixelRatio(),S=w*v,C=r*v;return Math.min(S>h?h/S:1,C>m?m/C:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(mn.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom){const r=this.transform.zoom,h=this._getTransformForUpdate();return h.setMinZoom(w),this._applyUpdatedTransform(h),this._update(),r!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom){const r=this.transform.zoom,h=this._getTransformForUpdate();return h.setMaxZoom(w),this._applyUpdatedTransform(h),this._update(),r!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch){const r=this.transform.pitch,h=this._getTransformForUpdate();return h.setMinPitch(w),this._applyUpdatedTransform(h),this._update(),r!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(w>=this.transform.minPitch){const r=this.transform.pitch,h=this._getTransformForUpdate();return h.setMaxPitch(w),this._applyUpdatedTransform(h),this._update(),r!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.setRenderWorldCopies(w),this._update()}setTransformConstrain(w){return this.transform.setConstrainOverride(w),this._update()}project(w){return this.transform.locationToScreenPoint(o.V.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.screenPointToLocation(o.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,r,h){if(w==="mouseenter"||w==="mouseover"){let m=!1;return{layers:r,listener:h,delegates:{mousemove:S=>{const C=r.filter((k=>this.getLayer(k))),R=C.length!==0?this.queryRenderedFeatures(S.point,{layers:C}):[];R.length?m||(m=!0,h.call(this,new lr(w,this,S.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(w==="mouseleave"||w==="mouseout"){let m=!1;return{layers:r,listener:h,delegates:{mousemove:C=>{const R=r.filter((k=>this.getLayer(k)));(R.length!==0?this.queryRenderedFeatures(C.point,{layers:R}):[]).length?m=!0:m&&(m=!1,h.call(this,new lr(w,this,C.originalEvent)))},mouseout:C=>{m&&(m=!1,h.call(this,new lr(w,this,C.originalEvent)))}}}}{const m=v=>{const S=r.filter((R=>this.getLayer(R))),C=S.length!==0?this.queryRenderedFeatures(v.point,{layers:S}):[];C.length&&(v.features=C,h.call(this,v),delete v.features)};return{layers:r,listener:h,delegates:{[w]:m}}}}_saveDelegatedListener(w,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(r)}_removeDelegatedListener(w,r,h){if(!this._delegatedListeners||!this._delegatedListeners[w])return;const m=this._delegatedListeners[w];for(let v=0;v<m.length;v++){const S=m[v];if(S.listener===h&&S.layers.length===r.length&&S.layers.every((C=>r.includes(C)))){for(const C in S.delegates)this.off(C,S.delegates[C]);return void m.splice(v,1)}}}on(w,r,h){if(h===void 0)return super.on(w,r);const m=typeof r=="string"?[r]:r,v=this._createDelegatedListener(w,m,h);this._saveDelegatedListener(w,v);for(const S in v.delegates)this.on(S,v.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(w,m,h)}}}once(w,r,h){if(h===void 0)return super.once(w,r);const m=typeof r=="string"?[r]:r,v=this._createDelegatedListener(w,m,h);for(const S in v.delegates){const C=v.delegates[S];v.delegates[S]=(...R)=>{this._removeDelegatedListener(w,m,h),C(...R)}}this._saveDelegatedListener(w,v);for(const S in v.delegates)this.once(S,v.delegates[S]);return this}off(w,r,h){return h===void 0?super.off(w,r):(this._removeDelegatedListener(w,typeof r=="string"?[r]:r,h),this)}queryRenderedFeatures(w,r){if(!this.style)return[];let h;const m=w instanceof o.P||Array.isArray(w),v=m?w:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(m?{}:w)||{},v instanceof o.P||typeof v[0]=="number")h=[o.P.convert(v)];else{const S=o.P.convert(v[0]),C=o.P.convert(v[1]);h=[S,new o.P(C.x,S.y),C,new o.P(S.x,C.y),S]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(w,r){return this.style.querySourceFeatures(w,r)}setStyle(w,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(w,r))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const r=this._locale[w];if(r==null)throw new Error(`Missing UI string '${w}'`);return r}_updateStyle(w,r){var h,m;if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(w,r)));const v=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new $o(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,r,v):this.style.loadJSON(w,r,v),this):((m=(h=this.style)===null||h===void 0?void 0:h.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,r){if(typeof w=="string"){const h=this._requestManager.transformRequest(w,"Style");o.j(h,new AbortController).then((m=>{this._updateDiff(m.data,r)})).catch((m=>{m&&this.fire(new o.k(m))}))}else typeof w=="object"&&this._updateDiff(w,r)}_updateDiff(w,r){try{this.style.setState(w,r)&&this._update(!0)}catch(h){o.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(w,r)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(w,r){return this._lazyInitEmptyStyle(),this.style.addSource(w,r),this._update(!0)}isSourceLoaded(w){const r=this.style&&this.style.tileManagers[w];if(r!==void 0)return r.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const r=this.style.tileManagers[w.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const m=this.style._layers[h];m.type==="hillshade"&&m.source===w.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===w.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new xi(this.painter,r,w),this.painter.renderToTexture=new pa(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var m;h.dataType==="style"?this.terrain.tileManager.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==w.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=h.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:w})),this}getTerrain(){var w,r;return(r=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const w=this.style&&this.style.tileManagers;for(const r of Object.values(w))if(!r.areTilesLoaded())return!1;return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}setSourceTileLodParams(w,r,h){if(h){const m=this.getSource(h);if(!m)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);m.calculateTileZoom=ii(Math.max(1,w),Math.max(1,r))}else for(const m in this.style.tileManagers)this.style.tileManagers[m].getSource().calculateTileZoom=ii(Math.max(1,w),Math.max(1,r));return this._update(!0),this}refreshTiles(w,r){const h=this.style.tileManagers[w];if(!h)throw new Error(`There is no tile manager with ID "${w}", cannot refresh tile`);r===void 0?h.reload(!0):h.refreshTiles(r.map((m=>new o.ac(m.z,m.x,m.y))))}addImage(w,r,h={}){const{pixelRatio:m=1,sdf:v=!1,stretchX:S,stretchY:C,content:R,textFitWidth:k,textFitHeight:N}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||o.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:H,data:$}=r,Y=r;return this.style.addImage(w,{data:new o.R({width:U,height:H},new Uint8Array($)),pixelRatio:m,stretchX:S,stretchY:C,content:R,textFitWidth:k,textFitHeight:N,sdf:v,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,w),this}}{const{width:U,height:H,data:$}=J.getImageData(r);this.style.addImage(w,{data:new o.R({width:U,height:H},$),pixelRatio:m,stretchX:S,stretchY:C,content:R,textFitWidth:k,textFitHeight:N,sdf:v,version:0})}}updateImage(w,r){const h=this.style.getImage(w);if(!h)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=r instanceof HTMLImageElement||o.b(r)?J.getImageData(r):r,{width:v,height:S,data:C}=m;if(v===void 0||S===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||S!==h.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(r instanceof HTMLImageElement||o.b(r));return h.data.replace(C,R),this.style.updateImage(w,h),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return wt.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,r){return this._lazyInitEmptyStyle(),this.style.addLayer(w,r),this._update(!0)}moveLayer(w,r){return this.style.moveLayer(w,r),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,r,h){return this.style.setLayerZoomRange(w,r,h),this._update(!0)}setFilter(w,r,h={}){return this.style.setFilter(w,r,h),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,r,h,m={}){return this.style.setPaintProperty(w,r,h,m),this._update(!0)}getPaintProperty(w,r){return this.style.getPaintProperty(w,r)}setLayoutProperty(w,r,h,m={}){return this.style.setLayoutProperty(w,r,h,m),this._update(!0)}getLayoutProperty(w,r){return this.style.getLayoutProperty(w,r)}setGlyphs(w,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,r,h,(m=>{m||this._update(!0)})),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,r,(h=>{h||this._update(!0)})),this}setLight(w,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(w,r={}){return this._lazyInitEmptyStyle(),this.style.setSky(w,r),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(w,r){return this.style.setFeatureState(w,r),this._update()}removeFeatureState(w,r){return this.style.removeFeatureState(w,r),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,r=0;return this._container&&(w=this._container.clientWidth||400,r=this._container.clientHeight||300),[w,r]}_setupResizeObserver(){var w;let r=!1;const h=Xf((v=>{this._trackResize&&!this._removed&&(this.resize(v),this.redraw())}),50),m=(w=this._ownerWindow.ResizeObserver)!==null&&w!==void 0?w:ResizeObserver;this._resizeObserver=new m((v=>{r?h(v):r=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(w){if(typeof w=="string"){const r=document.getElementById(w);if(!r)throw new Error(`Container '${w}' not found.`);return r}if(w instanceof HTMLElement||w&&typeof w=="object"&&w.nodeType===1)return w;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const r=this._canvasContainer=ne.create("div","maplibregl-canvas-container",w);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=ne.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),m=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],m);const v=this._controlContainer=ne.create("div","maplibregl-control-container",w),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((C=>{S[C]=ne.create("div",`maplibregl-ctrl-${C} `,v)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,r,h){this._canvas.width=Math.floor(h*w),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const w=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let r=null;this._canvas.addEventListener("webglcontextcreationerror",(m=>{r={requestedAttributes:w},m&&(r.statusMessage=m.statusMessage,r.type=m.type)}),{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,w):this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w),!h){const m="Failed to initialize WebGL";throw r?(r.message=m,new Error(JSON.stringify(r))):new Error(m)}this.painter=new wp(h,this.transform),Ie.testSupport(h)}migrateProjection(w,r){super.migrateProjection(w,r),this.painter.transform=w,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var r,h,m,v,S;const C=this._idleTriggered?this._fadeDuration:0,R=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const H=this.transform.zoom,$=le();this.style.zoomHistory.update(H,$);const Y=new o.H(H,{now:$,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),te=Y.crossFadingFactor();te===1&&te===this._crossFadingFactor||(k=!0,this._crossFadingFactor=te),this.style.update(Y)}const N=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==R;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((v=this.style.projection)===null||v===void 0?void 0:v.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||N)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,N),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cH.mark(o.cI.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,o.cH.mark(o.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),wt.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r?.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ne.remove(this._canvasContainer),ne.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cH.remove(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,J.frame(this._frameRequest,(w=>{o.cH.recordStartOfFrameAt(w),this._frameRequest=null;try{this._render(w)}catch(r){if(!o.Z(r)&&!(function(h){return h.message===Ko})(r))throw r}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return jl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(w){return this._lazyInitEmptyStyle(),this.style.setProjection(w),this._update(!0)}},g.MapMouseEvent=lr,g.MapTouchEvent=ha,g.MapWheelEvent=Vh,g.Marker=Zu,g.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),m=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(r,h)=>{const m=this._map._getUIString(`NavigationControl.${h}`);r.title=m,r.setAttribute("aria-label",m)},this.options=o.e({},Kf,w),this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(r=>r.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(r=>this._map.zoomIn({},{originalEvent:r}))),ne.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(r=>this._map.zoomOut({},{originalEvent:r}))),ne.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})})),this._compassIcon=ne.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ne.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,r){const h=ne.create("button",w,this._container);return h.type="button",h.addEventListener("click",r),h}},g.Popup=class extends o.E{constructor(w){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ne.remove(this._content),this._container&&(ne.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ne.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ne.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=jc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!r)return;const h=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const v=Hc(this.options.offset);if(!m){const C=this._container.offsetWidth,R=this._container.offsetHeight,k=(function(U){var H,$,Y,te;return U?{top:(H=U.top)!==null&&H!==void 0?H:0,right:($=U.right)!==null&&$!==void 0?$:0,bottom:(Y=U.bottom)!==null&&Y!==void 0?Y:0,left:(te=U.left)!==null&&te!==void 0?te:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let N;N=h.y+v.bottom.y<R+k.top?["top"]:h.y>this._map.transform.height-R-k.bottom?["bottom"]:[],h.x<C/2+k.left?N.push("left"):h.x>this._map.transform.width-C/2-k.right&&N.push("right"),m=N.length===0?"bottom":N.join("-")}let S=h.add(v[m]);this.options.subpixelPositioning||(S=S.round()),ne.setTransform(this._container,`${$c[m]} translate(${S.x}px,${S.y}px)`),Gu(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create($l),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=o.V.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const r=document.createDocumentFragment(),h=document.createElement("body");let m;for(h.innerHTML=w;m=h.firstChild,m;)r.appendChild(m);return this.setDOMContent(r)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ne.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}setPadding(w){this.options.padding=w,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=ne.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Hl);w&&w.focus()}},g.RasterDEMTileSource=Ca,g.RasterTileSource=to,g.ScaleControl=class{constructor(w){this._onMove=()=>{Tn(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,Tn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Sr),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ne.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},g.ScrollZoomHandler=Hu,g.Style=$o,g.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=ne.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ne.create("button","maplibregl-ctrl-terrain",this._container),ne.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ne.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},g.TwoFingersTouchPitchHandler=go,g.TwoFingersTouchRotateHandler=$u,g.TwoFingersTouchZoomHandler=Ga,g.TwoFingersTouchZoomRotateHandler=Ul,g.VectorTileSource=ko,g.VideoSource=vc,g.addSourceType=(w,r)=>o._(void 0,void 0,void 0,(function*(){if(fu(w))throw new Error(`A source type called "${w}" already exists.`);((h,m)=>{no[h]=m})(w,r)})),g.clearPrewarmedResources=function(){const w=Ht;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(gt),Ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},g.createTileMesh=cp,g.getMaxParallelImageRequests=function(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS},g.getRTLTextPluginStatus=function(){return K().getRTLTextPluginStatus()},g.getVersion=function(){return ma},g.getWorkerCount=function(){return Mt.workerCount},g.getWorkerUrl=function(){return o.c.WORKER_URL},g.importScriptInWorkers=function(w){return Mr().broadcast("IS",w)},g.isTimeFrozen=function(){return oe.isFrozen()},g.now=le,g.prewarm=function(){vi().acquire(gt)},g.restoreNow=function(){oe.restoreNow()},g.setMaxParallelImageRequests=function(w){o.c.MAX_PARALLEL_IMAGE_REQUESTS=w},g.setNow=function(w){oe.setNow(w)},g.setRTLTextPlugin=function(w,r){return K().setRTLTextPlugin(w,r)},g.setWorkerCount=function(w){Mt.workerCount=w},g.setWorkerUrl=function(w){o.c.WORKER_URL=w}}));var d=t;return d}))})(Cv)),Cv.exports}var TN=wN();const SN=L_(TN),w2=["#e6f2ff","#cce5ff","#b3d9ff","#99ccff","#80bfff","#66b3ff","#4da6ff","#3399ff","#1a8cff","#0080ff","#ffe6e6","#ffcccc","#ffb3b3","#ff9999","#ff8080","#ff6666","#ff4d4d","#ff3333","#ff1a1a","#ff0000","#e6ffe6","#ccffcc","#b3ffb3","#99ff99","#80ff80","#66ff66","#4dff4d","#33ff33","#1aff1a","#00ff00","#ffffcc","#ffff99","#ffff66","#ffff33","#ffff00","#ffe6cc","#ffcc99","#ffb266","#ff9933","#ff8000","#e6e6ff","#ccccff","#b3b3ff","#9999ff","#8080ff","#e6f0ff","#d4e8ff","#c2dfff","#b0d7ff","#9eceff"];function AN(i){let e=0;for(let s=0;s<i.length;s++)e=(e<<5)-e+i.charCodeAt(s),e=e&e;const t=Math.abs(e)%w2.length;return w2[t]}function EN(i){return i.features.forEach(e=>{const t=e.properties?.ADMIN||e.properties?.NAME||"unknown";e.properties.color=AN(t)}),i}const T2="https://tiles.openfreemap.org/styles/liberty",CN={version:8,sources:{},layers:[{id:"background",type:"background",paint:{"background-color":"#f0ede8"}}]},MN="./data/countries.geojson",Eb="countries",S2="country-borders",PN=[0,0],IN=2,RN=250;function DN({basemap:i,onDeckViewStateChange:e,onClick:t}){const s=Si.useRef(null),l=Si.useRef(null),d=Si.useRef(null),g=Si.useRef(null),o=Si.useRef(t);Si.useEffect(()=>{o.current=t},[t]);const{setViewport:A}=iE();return Si.useEffect(()=>{if(!s.current||l.current)return;const M=new SN.Map({container:s.current,style:T2,center:PN,zoom:IN,attributionControl:{compact:!0}});return M.on("move",()=>{const I=M.getCenter(),z=M.getZoom();e({longitude:I.lng,latitude:I.lat,zoom:z,pitch:M.getPitch(),bearing:M.getBearing()}),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{const W=M.getBounds();A({west:W.getWest(),south:W.getSouth(),east:W.getEast(),north:W.getNorth(),zoom:z})},RN)}),M.on("click",I=>{o.current?.({lng:I.lngLat.lng,lat:I.lngLat.lat})}),l.current=M,()=>{g.current&&clearTimeout(g.current),M.remove(),l.current=null}},[A,e]),Si.useEffect(()=>{const M=l.current;if(!M)return;const I=async()=>{if(!d.current){const J=await(await fetch(MN)).json();d.current=EN(J)}M.getSource(Eb)||M.addSource(Eb,{type:"geojson",data:d.current}),M.getLayer(S2)||M.addLayer({id:S2,type:"fill",source:Eb,paint:{"fill-color":["get","color"],"fill-opacity":.6,"fill-outline-color":"#555555"}})},z=()=>{i==="streets"?M.setStyle(T2):(M.once("style.load",()=>{I().catch(console.error)}),M.setStyle(CN))};M.isStyleLoaded()?z():M.once("load",z)},[i]),Dn.jsx("div",{ref:s,className:"map-view"})}const ON={longitude:0,latitude:0,zoom:2,pitch:0,bearing:0};function kN({basemap:i,mode:e}){const[t,s]=Si.useState(ON),{layers:l,onClick:d}=bN(e);return Dn.jsxs("div",{className:"map-canvas",children:[Dn.jsx(DN,{basemap:i,onDeckViewStateChange:s,onClick:d}),Dn.jsx(Pz,{style:{position:"absolute",inset:"0",pointerEvents:"none"},viewState:t,controller:!1,layers:l})]})}function LN(){const[i,e]=Si.useState("none"),[t,s]=Si.useState("streets");return Dn.jsx(uN,{children:Dn.jsxs("div",{className:"app",children:[Dn.jsx(RE,{mode:i,basemap:t,onModeChange:e,onBasemapChange:s}),Dn.jsxs("div",{className:"app__body",children:[Dn.jsx(DE,{}),Dn.jsx(kN,{basemap:t,mode:i})]})]})})}IE.createRoot(document.getElementById("root")).render(Dn.jsx(wE.StrictMode,{children:Dn.jsx(LN,{})}));
